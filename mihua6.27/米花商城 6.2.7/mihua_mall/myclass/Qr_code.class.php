<?php
 class Qr_code { public static function curl_or_file_get_content($file, $cache_file) { goto DRMIa; ddOp1: self::write_cach($cache_file, $url); goto Q1VUO; kvWeW: Nvepc: goto ddOp1; r2B_o: if (filesize($cache_file) == 0 && $flag == 1) { goto ohTe4; } goto LvGf3; O98xE: ohTe4: goto V7RgU; L3p1D: goto Nvepc; goto O98xE; wwhHU: $flag = 2; goto XkJsw; xaV7R: B6oPn: goto aRLLE; DQHc3: zniq6: goto m3TYj; wVwnd: $url = self::curl_file_get_contents($file); goto kvWeW; DRMIa: if (extension_loaded("\143\165\162\x6c")) { goto zniq6; } goto ISu05; YidqB: $flag = 1; goto xaV7R; XEH96: goto Nvepc; goto pI1UK; Q1VUO: return $url; goto OKVdU; pI1UK: dixMR: goto wVwnd; XkJsw: goto B6oPn; goto DQHc3; LvGf3: if (filesize($cache_file) == 0 && $flag == 2) { goto dixMR; } goto L3p1D; ISu05: $url = file_get_contents($file); goto wwhHU; V7RgU: $url = file_get_contents($file); goto XEH96; m3TYj: $url = self::curl_file_get_contents($file); goto YidqB; aRLLE: self::write_cach($cache_file, $url); goto r2B_o; OKVdU: } public static function write_cach($cache_file, $url) { goto ZXo18; G5MKm: fclose($fp); goto tW0DM; ZXo18: $bild = $cache_file; goto aS4Bl; cQmx1: CwbgM: goto FUfE8; BT_Ag: hcu_B: goto rbjv2; FUfE8: return ''; goto BT_Ag; zaKar: $ws = fwrite($fp, $url); goto G5MKm; M6C0V: return 1; goto uqDTq; aS4Bl: $fp = fopen($bild, "\167"); goto zaKar; tW0DM: if ($ws == false || $ws == 0 || empty($ws)) { goto CwbgM; } goto M6C0V; uqDTq: goto hcu_B; goto cQmx1; rbjv2: } public static function curl_file_get_contents($durl) { goto KR9MM; jiS6U: $r = curl_exec($ch); goto spZb7; zZFew: if (!(function_exists("\143\165\x72\x6c\137\x69\x6e\x69\x74") && function_exists("\x63\165\x72\154\x5f\145\x78\145\143"))) { goto NiD6l; } goto TWACf; iRLm3: curl_setopt($ch, CURLOPT_TIMEOUT, 5); goto ydOx3; KR9MM: $r = null; goto zZFew; ydOx3: curl_setopt($ch, CURLOPT_USERAGENT, "\x4d\157\172\x69\154\x6c\x61\x2f\65\x2e\x30\40\50\127\x69\x6e\x64\x6f\167\163\x20\x4e\x54\40\66\x2e\x31\73\x20\x57\x4f\x57\x36\64\73\40\162\166\x3a\71\56\60\x2e\61\51\40\x47\x65\143\x6b\157\57\62\x30\61\60\60\61\60\x31\40\106\x69\x72\145\146\x6f\170\57\x39\56\60\x2e\61"); goto nolzA; pybs0: return $r; goto UAPNN; Oqqfy: NiD6l: goto pybs0; TWACf: $ch = curl_init(); goto nlRNa; nlRNa: curl_setopt($ch, CURLOPT_URL, $durl); goto iRLm3; nolzA: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto jiS6U; spZb7: curl_close($ch); goto Oqqfy; UAPNN: } public static function mergeImage($bg, $qr, $out, $param) { goto p_IZu; ZV3Yq: imagecopyresized($bgImg, $qrImg, $left, $top, 0, 0, $width, $height, $qrWidth, $qrHeight); goto uW0GC; Ahw8D: imagejpeg($bgImg, null, 100); goto DQ1AD; bXNiG: fclose($fh); goto taXxg; FoPki: $bgImg = self::imagecreate($bg); goto Za5yz; R3udZ: $fh = fopen($out, "\167\53"); goto ZYgpC; oI7TH: imagedestroy($bgImg); goto FPG3A; ZYgpC: fwrite($fh, $contents); goto bXNiG; p_IZu: list($bgWidth, $bgHeight) = @getimagesize($bg); goto Ee_sd; FPG3A: imagedestroy($qrImg); goto R3udZ; uW0GC: ob_start(); goto Ahw8D; tRrsh: extract($param); goto FoPki; Za5yz: $qrImg = self::imagecreate($qr); goto ZV3Yq; Ee_sd: list($qrWidth, $qrHeight) = @getimagesize($qr); goto tRrsh; DQ1AD: $contents = ob_get_contents(); goto eADW4; eADW4: ob_end_clean(); goto oI7TH; taXxg: } public static function imagecreate($bg) { goto HZNG7; CYtNo: return $bgImg; goto ftvtQ; V7g4g: AHzxb: goto CYtNo; SDQRX: HhcFV: goto ZSi_e; HZNG7: $bgImg = @imagecreatefromjpeg($bg); goto ymIt7; AxOU_: $bgImg = @imagecreatefromgif($bg); goto V7g4g; FvMeP: $bgImg = @imagecreatefrompng($bg); goto SDQRX; ZSi_e: if (!(false == $bgImg)) { goto AHzxb; } goto AxOU_; ymIt7: if (!(false == $bgImg)) { goto HhcFV; } goto FvMeP; ftvtQ: } public function GrabImage($url, $filename = '') { goto ZJRsk; Q8xMY: $filename = date("\x59\155\x64\x48\x69\163") . $ext; goto JNXBr; HC24T: $img = ob_get_contents(); goto Q_3VP; osVnE: ob_start(); goto NM6mi; nwO6x: if (!($ext != "\56\x67\151\x66" && $ext != "\x2e\x6a\160\x67" && $ext != "\56\x70\156\147")) { goto bwnb2; } goto yfrrj; wIj1M: $fp2 = @fopen($filename, "\141"); goto ZNFXj; JNXBr: qAxKU: goto osVnE; V5CGC: return false; goto T84Ce; T84Ce: KJCSm: goto sdtzt; ubs5j: $ext = strrchr($url, "\56"); goto nwO6x; ZJRsk: if (!($url == '')) { goto KJCSm; } goto V5CGC; nkuBK: $size = strlen($img); goto wIj1M; mQ7z3: fclose($fp2); goto mD0d5; Q_3VP: ob_end_clean(); goto nkuBK; mD0d5: return $filename; goto lawUV; ZNFXj: fwrite($fp2, $img); goto mQ7z3; sdtzt: if (!($filename == '')) { goto qAxKU; } goto ubs5j; NM6mi: readfile($url); goto HC24T; qCCVg: bwnb2: goto Q8xMY; yfrrj: return false; goto qCCVg; lawUV: } public static function writeText($bg, $out, $text, $param = array()) { goto qjeH1; peZAc: $font = IA_ROOT . "\x2f\x61\x64\144\157\156\163\57\x6d\151\x68\x75\x61\137\x6d\141\154\154\57\146\x6f\x6e\x74\57\x6d\x73\171\x68\x62\x64\x2e\x74\164\x66"; goto rw9rV; kysIK: extract($param); goto pNLpU; wKz0A: imagettftext($im, $size, 0, $left, $top + $size / 2, $white, $font, $text); goto YP5uv; pNLpU: $im = imagecreatefromjpeg($bg); goto eTG7j; Hoal_: $fh = fopen($out, "\167\53"); goto hM2to; tIs3N: ob_end_clean(); goto oTPzk; eTG7j: $black = imagecolorallocate($im, 0, 0, 0); goto peZAc; aTEmI: $contents = ob_get_contents(); goto tIs3N; E1uo4: fclose($fh); goto f1CO9; c8LFC: imagejpeg($im, null, 100); goto aTEmI; rw9rV: $white = imagecolorallocate($im, 255, 255, 255); goto wKz0A; oTPzk: imagedestroy($im); goto Hoal_; qjeH1: list($bgWidth, $bgHeight) = @getimagesize($bg); goto kysIK; YP5uv: ob_start(); goto c8LFC; hM2to: fwrite($fh, $contents); goto E1uo4; f1CO9: } public static function decode_channel_param($item, $p) { goto gKNtr; QkMdX: $item["\141\x76\x61\x74\x61\162\x65\156\141\x62\x6c\x65"] = intval($gpc["\x61\x76\x61\164\x61\x72\145\156\x61\x62\154\x65"]); goto wZYNt; DhTDp: $item["\x6e\x61\x6d\145\x65\156\141\x62\x6c\x65"] = intval($gpc["\156\x61\x6d\x65\145\x6e\141\142\x6c\x65"]); goto ORnPU; pHqEp: $item["\141\166\141\x74\x61\x72\164\157\x70"] = intval($gpc["\x61\x76\141\x74\141\162\164\x6f\x70"]) ? intval($gpc["\141\x76\x61\x74\x61\162\x74\157\x70"]) : 10; goto k5jI4; z3zfE: $item["\x71\162\150\145\151\x67\150\164"] = intval($gpc["\161\x72\x68\145\x69\147\150\164"]) ? intval($gpc["\x71\162\150\x65\151\x67\x68\x74"]) : 240; goto x0oXO; DI8pL: $item["\x6e\x61\155\x65\164\x6f\x70"] = intval($gpc["\156\141\155\145\164\x6f\160"]) ? intval($gpc["\156\x61\155\145\x74\157\160"]) : 28; goto KAXKU; wZYNt: $item["\x6e\x61\x6d\145\x6c\145\x66\x74"] = intval($gpc["\156\x61\155\x65\154\145\146\164"]) ? intval($gpc["\156\x61\155\x65\154\145\146\164"]) : 210; goto DI8pL; gKNtr: $gpc = unserialize($p); goto htP0C; GBWIH: $item["\x6e\141\155\x65\143\x6f\154\x6f\162"] = $gpc["\156\x61\x6d\145\143\x6f\154\157\162"]; goto DhTDp; k5jI4: $item["\141\166\x61\164\141\x72\167\x69\144\164\x68"] = intval($gpc["\x61\166\x61\164\x61\162\x77\151\x64\164\x68"]) ? intval($gpc["\x61\x76\141\164\x61\162\167\x69\144\164\x68"]) : 86; goto vyPaH; ORnPU: return $item; goto cCjsG; KAXKU: $item["\x6e\x61\155\145\163\x69\172\x65"] = intval($gpc["\x6e\x61\x6d\145\163\151\x7a\145"]) ? intval($gpc["\x6e\x61\x6d\x65\x73\151\x7a\145"]) : 30; goto GBWIH; j9T1W: $item["\x71\162\164\x6f\160"] = intval($gpc["\161\162\x74\157\x70"]) ? intval($gpc["\x71\162\x74\157\160"]) : 475; goto BMFLE; vyPaH: $item["\141\x76\x61\164\x61\x72\x68\x65\x69\x67\x68\164"] = intval($gpc["\141\166\141\x74\141\162\150\x65\x69\147\150\x74"]) ? intval($gpc["\x61\x76\141\164\x61\162\150\145\151\x67\x68\x74"]) : 86; goto QkMdX; htP0C: $item["\x71\x72\154\x65\146\164"] = intval($gpc["\x71\162\x6c\x65\x66\x74"]) ? intval($gpc["\x71\x72\154\145\146\164"]) : 145; goto j9T1W; BMFLE: $item["\x71\162\x77\151\144\x74\150"] = intval($gpc["\x71\162\x77\151\144\164\150"]) ? intval($gpc["\161\162\167\x69\144\164\150"]) : 240; goto z3zfE; x0oXO: $item["\x61\x76\x61\x74\141\x72\154\x65\146\164"] = intval($gpc["\x61\166\x61\164\141\x72\x6c\145\146\164"]) ? intval($gpc["\x61\166\141\164\141\x72\x6c\x65\x66\164"]) : 111; goto pHqEp; cCjsG: } static function mkdirs($path) { goto R82WR; eRdE8: mkdir($path, 0777, true); goto SFINr; R82WR: if (is_dir($path)) { goto m2BTG; } goto eRdE8; SFINr: m2BTG: goto Cw6zH; Cw6zH: return is_dir($path); goto hkfU0; hkfU0: } public static function qrcode_adv($attachurl, $uniacid, $from_user, $bg, $qr_file, $channel) { goto Jtb3j; gA5E5: $enableHead = $ch["\141\x76\x61\x74\x61\162\x65\x6e\141\x62\x6c\x65"]; goto pi7P4; uKYYm: JwCYG: goto XswuO; pi7P4: $enableName = $ch["\156\141\155\x65\x65\x6e\x61\142\154\145"]; goto pTO_J; F9twz: $target_file = $dir_file . $att_target_file; goto Mw2cK; En0fO: EGHdC: goto uKYYm; XswuO: return $target_file; goto PSrvE; b_tW1: if (!empty($_W["\163\x65\x74\164\x69\156\x67"]["\x72\145\155\x6f\x74\145"]["\x74\x79\160\x65"])) { goto kexgT; } goto yrqK8; iLMnH: self::mkdirs($mihua_dir); goto F9twz; wR_dI: $fans = mc_fetch($uid, array("\x6e\x69\x63\x6b\x6e\x61\x6d\145", "\x61\166\141\x74\141\x72")); goto kDsbc; Z6CwT: if (!(strlen($fans["\141\x76\141\164\141\162"]) > 10)) { goto cvfBt; } goto I3LUo; Jtb3j: global $_W; goto tphiJ; N_xXo: if (empty($fans)) { goto JwCYG; } goto udokJ; G33wi: Va419: goto ed9mY; mmzq3: piiCY: goto xz3ry; o8Olh: self::curl_or_file_get_content($qr_file, $qr_cache_file); goto b_tW1; tm5IN: self::mergeImage($target_file, $head_cache_file, $target_file, array("\154\x65\x66\164" => $ch["\141\x76\x61\x74\x61\162\154\x65\x66\x74"], "\x74\157\x70" => $ch["\141\x76\x61\164\x61\x72\164\157\x70"], "\167\x69\144\164\150" => $ch["\141\x76\141\164\141\162\x77\151\144\164\x68"], "\x68\145\x69\147\150\x74" => $ch["\x61\166\141\164\x61\162\x68\145\151\147\x68\164"])); goto G5TYP; XcdrX: self::mkdirs($dir_file); goto iLMnH; yrqK8: $bg_file = ATTACHMENT_ROOT . $bg; goto mIakx; rfGwC: $att_target_file = "\161\162\55\151\155\x61\147\145\55" . $rand_file; goto O2l5D; qs80C: $dir_file = ATTACHMENT_ROOT . "\x6d\151\150\165\x61\x5f\155\141\x6c\x6c\x2f\x74\155\160\x70\151\x63\57"; goto HZmZC; ed9mY: fs4_2: goto vD5wa; Mw2cK: $head_cache_file = $mihua_dir . $att_head_cache_file; goto zhjNt; HZmZC: $mihua_dir = MODULE_ROOT . "\x2f\x74\155\x70\160\151\143\x2f"; goto XcdrX; pTO_J: $uid = mc_openid2uid($from_user); goto wR_dI; udokJ: if (!$enableName) { goto fs4_2; } goto DTcdO; O2l5D: $att_head_cache_file = "\150\x65\141\144\55\151\x6d\141\x67\x65\55" . $rand_file; goto qs80C; zhjNt: $qr_cache_file = $mihua_dir . "\x71\x72\x2d" . $uniacid . "\x2d" . $from_user . "\x2e\x6a\x70\x67"; goto o8Olh; I3LUo: $head_file = $fans["\x61\x76\141\164\x61\x72"]; goto NH94V; jV8x7: kexgT: goto xp_hN; AfuTC: self::writeText($target_file, $target_file, "\xe6\210\x91\346\x98\xaf" . $fans_info["\156\151\x63\153\x6e\x61\155\145"], array("\x73\x69\172\x65" => $ch["\156\141\155\x65\x73\x69\172\x65"], "\154\x65\146\x74" => $ch["\156\141\155\145\154\x65\x66\x74"], "\x74\x6f\160" => $ch["\156\141\x6d\145\x74\157\x70"])); goto G33wi; NB1ZC: $ch = self::decode_channel_param($ch, $ch["\142\147\x70\x61\162\141\155"]); goto QesoZ; QesoZ: $rand_file = $from_user . "\x2e\152\160\x67"; goto rfGwC; xp_hN: $bg_file = tomedia($bg); goto mmzq3; DTcdO: if (!(strlen($fans_info["\x6e\151\x63\153\156\x61\155\145"]) > 0)) { goto Va419; } goto AfuTC; tphiJ: $ch = pdo_fetch("\x53\x45\114\105\x43\124\x20\52\40\106\x52\117\x4d\x20" . tablename("\155\x69\150\x75\141\137\155\x61\154\154\137\x63\x68\x61\x6e\156\x65\x6c") . "\x20\127\110\x45\122\x45\x20\143\150\x61\x6e\156\x65\154\75\x3a\143\150\141\156\156\x65\154", array("\72\x63\150\141\x6e\156\x65\x6c" => $channel)); goto NB1ZC; mIakx: goto piiCY; goto jV8x7; vD5wa: if (!$enableHead) { goto EGHdC; } goto Z6CwT; kDsbc: $fans_info = mc_fansinfo($uid, $uniacid, $uniacid); goto N_xXo; G5TYP: cvfBt: goto En0fO; NH94V: self::curl_or_file_get_content($head_file, $head_cache_file); goto tm5IN; xz3ry: self::mergeImage($bg_file, $qr_cache_file, $target_file, array("\154\145\x66\164" => $ch["\161\162\x6c\x65\x66\164"], "\164\157\x70" => $ch["\161\x72\x74\157\x70"], "\x77\151\x64\x74\x68" => $ch["\x71\x72\167\x69\x64\164\150"], "\x68\x65\151\x67\x68\164" => $ch["\x71\x72\x68\145\151\x67\x68\x74"])); goto gA5E5; PSrvE: } static function delFileUnderDir($dirName) { goto xj009; GHy6j: if (!($item != "\56" && $item != "\56\x2e")) { goto Enz5F; } goto rf85B; eFOY_: if (!(false !== ($item = readdir($handle)))) { goto aYCr1; } goto GHy6j; C_ldS: SBqtp: goto COu2N; xj009: if (!($handle = opendir("{$dirName}"))) { goto fWVyu; } goto nkUO6; rf85B: if (!is_dir("{$dirName}\57{$item}")) { goto SBqtp; } goto K0LGM; og6uX: fWVyu: goto gsqnM; COu2N: Enz5F: goto bGcsE; nkUO6: F4D14: goto eFOY_; OeJ5K: closedir($handle); goto og6uX; K0LGM: delFileUnderDir("{$dirName}\57{$item}"); goto C_ldS; bGcsE: goto F4D14; goto gK1wR; gK1wR: aYCr1: goto OeJ5K; gsqnM: } }