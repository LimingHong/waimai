<?php
 class model_user { static function mergeOlduser($userinfo, $unionid, $avatar, $nickname, $params, $params2) { goto kdL_Y; n1iwZ: pdo_update("\x6d\151\x68\165\x61\137\155\141\x6c\x6c\x5f\x75\x73\145\x72", $udata, $whereData); goto kt2NJ; xWuE3: if (!($userinfo["\x6c\x6f\147\151\x6e\164\151\x6d\x65"] < time() - 24 * 3600 || empty($userinfo["\141\x76\141\164\141\x72"]) || empty($userinfo["\x6e\151\143\x6b\156\141\x6d\145"]))) { goto lh9Qp; } goto wF7Rg; kdL_Y: global $_W; goto Htb4K; JCtL0: $udata[$params] = $res[$params]; goto XndUf; Tqm4a: $udata["\165\156\151\157\156\111\x64"] = $unionid; goto b6SVC; wx5tp: if (!(strpos($userinfo["\141\x76\141\x74\141\x72"], "\x77\x78\56\x71\154\157\x67\x6f\56\x63\x6e") !== false)) { goto hTbNE; } goto PxBg5; VWTO7: pdo_delete("\x6d\151\150\x75\141\137\155\141\x6c\x6c\137\x75\x73\145\x72", array("\151\x64\x20\x3c\76" => $userinfo["\x69\x64"], "\x75\x6e\151\x6f\x6e\151\x64" => $unionid, "\x75\x6e\x69\141\x63\151\144" => $_W["\x75\x6e\151\x61\143\x69\144"])); goto aJ7Qg; f67xb: if (!($userinfo["\x73\x74\x61\x74\165\163"] == "\55\x31")) { goto PyUpY; } goto CfZDQ; b6SVC: VEEcQ: goto R9pZQ; wF7Rg: $udata["\156\x69\143\153\x6e\x61\155\x65"] = $nickname; goto wx5tp; lu063: lh9Qp: goto f67xb; kt2NJ: dSOyK: goto KP8t4; PxBg5: $udata["\150\x65\141\144\151\x6d\x67\x75\x72\154"] = $avatar; goto N03cS; XndUf: $udata["\167\x78\141\x70\160"] = 2; goto VWTO7; VkxaY: PyUpY: goto WIjVO; CfZDQ: die("\346\202\250\347\x9a\204\xe8\264\xa6\xe5\x8f\xb7\345\267\262\xe8\242\xab\xe7\246\201\347\224\xa8"); goto VkxaY; dyJ9W: if (!$res) { goto y8rKB; } goto JCtL0; jBm4s: if (!empty($userinfo["\x75\x6e\x69\x6f\156\151\144"])) { goto VEEcQ; } goto Tqm4a; F9Rc0: njpjm: goto rk5Lv; R9pZQ: $res = util::getSingelDataInSingleTable("\155\151\x68\165\x61\137\x6d\x61\x6c\x6c\x5f\x75\163\145\162", array($params => $userinfo[$params2], "\165\156\x69\157\156\151\x64" => $unionid), "\52"); goto dyJ9W; aJ7Qg: y8rKB: goto F9Rc0; rk5Lv: if (!$udata) { goto dSOyK; } goto UaVYS; QMWZ5: $udata["\x6c\x6f\x67\151\x6e\164\151\x6d\x65"] = time(); goto lu063; WIjVO: if (!($unionid && $userinfo["\x77\x78\141\160\160"] != 2)) { goto njpjm; } goto jBm4s; N03cS: hTbNE: goto QMWZ5; Htb4K: $udata = array(); goto xWuE3; UaVYS: $whereData = array("\x75\156\x69\x61\x63\x69\x64" => $_W["\x75\156\151\141\x63\151\x64"], $params => $userinfo[$params]); goto n1iwZ; KP8t4: } static function mergeUser($newData, $unionid, $params) { goto DOU9s; trn0x: if ($unionid) { goto dwc9w; } goto r8i3R; Db1xA: x1E7_: goto qXkew; TEV2a: eOkFq: goto uE3eQ; TOh3Q: if (!(!empty($res[$params]) && $res["\157\160\145\x6e\151\144"] != $res["\157\160\x65\156\151\144\137\167\170\x61\160\x70"])) { goto x1E7_; } goto ce4vu; a3Wv7: $res = util::getSingelDataInSingleTable("\155\151\150\165\x61\137\x6d\x61\154\x6c\x5f\165\163\145\162", array("\165\x6e\151\157\156\x69\144" => $unionid), "\52"); goto vsXB0; H1x4p: SuH0D: goto uOP_H; uOP_H: $newData[$params] = $res[$params]; goto TOh3Q; FbeYv: stMuX: goto TEV2a; ce4vu: $newData["\167\170\141\x70\x70"] = 2; goto Db1xA; vsXB0: if ($res) { goto SuH0D; } goto Yugag; r8i3R: pdo_insert("\x6d\x69\x68\x75\x61\x5f\x6d\141\x6c\154\x5f\x75\163\x65\162", $newData); goto vJWte; XVXPx: goto stMuX; goto H1x4p; YG9ub: $newData["\x75\x6e\151\x6f\x6e\x49\144"] = $unionid; goto a3Wv7; Yugag: pdo_insert("\155\x69\150\x75\x61\x5f\155\141\x6c\154\x5f\165\x73\145\x72", $newData); goto XVXPx; DOU9s: global $_W; goto trn0x; HaSmj: dwc9w: goto YG9ub; vJWte: goto eOkFq; goto HaSmj; uE3eQ: return $newData; goto FtiSx; qXkew: pdo_update("\x6d\x69\150\x75\x61\137\155\x61\154\154\x5f\x75\163\x65\x72", $newData, array("\x75\156\151\x6f\156\151\x64" => $unionid, "\165\156\151\141\143\x69\x64" => $_W["\165\x6e\151\x61\143\151\144"])); goto FbeYv; FtiSx: } static function getUserCredit($openid) { global $_W; return array("\x63\x72\x65\144\x69\x74\61" => $_W["\155\x65\x6d\142\x65\x72"]["\143\x72\145\144\151\x74\61"], "\143\x72\145\x64\x69\x74\x32" => $_W["\155\x65\x6d\x62\145\x72"]["\143\162\x65\x64\151\x74\62"]); } static function getMemberByopenid_wxapp($openid_wxapp) { goto Y2iuK; OkCu5: JLApp: goto BiMo2; Y2iuK: if (!empty($openid_wxapp)) { goto JLApp; } goto eV7mq; uJ4pL: return $data; goto gqiOn; eV7mq: return; goto OkCu5; BiMo2: $data = Util::getSingelDataInSingleTable("\x6d\x69\150\165\141\x5f\155\141\154\x6c\137\155\145\155\142\145\x72", array("\x6f\160\x65\x6e\151\x64\137\167\170\141\160\160" => $openid_wxapp)); goto uJ4pL; gqiOn: } static function updateUserCredit($openid, $value, $type, $tag = "\347\xb1\263\350\212\xb1\345\x95\x86\xe5\237\216\xe6\250\241\xe5\x9d\x97\xe5\217\x98\345\212\250\344\274\x9a\345\221\x98\xe7\247\257\345\210\x86") { goto wpnXu; B1GYw: if ($result["\x65\162\162\x6e\x6f"] == "\x2d\x31") { goto tAetV; } goto pW13F; b49iR: return true; goto SDffV; wpnXu: global $_W; goto L1mHr; sOSYw: $uid = mc_openid2uid($openid); goto ZRUHF; BSw1W: return $result; goto IK3Ql; ZRUHF: $result = mc_credit_update($uid, "\143\x72\x65\144\151\164\61", $value, array($uid, "\347\261\263\xe8\212\xb1\345\x95\x86\345\237\x8e\346\250\241\345\x9d\x97\xe5\x8f\x98\xe5\x8a\xa8\344\274\x9a\xe5\221\230\347\247\257\345\x88\206", "\x6d\151\x68\165\141\x5f\x6d\x61\x6c\x6c", $type)); goto B1GYw; SDffV: goto pxSPw; goto mxL6D; mxL6D: tAetV: goto VWXBn; ag6iK: pdo_insert("\143\x6f\162\x65\137\x70\141\171\154\x6f\147", $paylog); goto b49iR; n7W1L: pxSPw: goto BSw1W; pW13F: $paylog = array("\x74\171\160\x65" => $type, "\x75\156\x69\x61\x63\151\144" => $_W["\165\156\x69\141\x63\x69\144"], "\157\160\145\x6e\x69\x64" => $openid, "\164\151\144" => date("\131\x2d\x6d\55\144\x20\110\x3a\x69\72\163"), "\146\x65\x65" => $value, "\155\x6f\144\165\x6c\145" => "\155\151\150\x75\141\137\x6d\141\x6c\x6c", "\164\141\147" => $tag, "\x65\x6e\x63\x72\171\x70\164\x5f\143\x6f\144\145" => $tag); goto ag6iK; VWXBn: return false; goto n7W1L; L1mHr: load()->model("\x6d\x63"); goto sOSYw; IK3Ql: } static function updateUserMoney($openid, $value, $type) { goto rybsb; KzWiN: load()->model("\155\x63"); goto Hmu50; rybsb: global $_W; goto KzWiN; C6aFL: pdo_insert("\x63\157\x72\145\137\x70\141\x79\x6c\x6f\147", $paylog); goto aVFr4; qFzxX: $paylog = array("\164\171\x70\145" => "\x62\141\143\x6b", "\x75\x6e\151\141\x63\x69\144" => $_W["\x75\x6e\151\x61\x63\x69\x64"], "\157\160\x65\156\151\x64" => $openid, "\x74\x69\144" => date("\x59\x2d\x6d\55\144\x20\x48\72\x69\x3a\163"), "\x66\x65\145" => $value, "\155\157\144\165\154\145" => "\x6d\x69\150\x75\x61\137\155\x61\x6c\x6c", "\164\141\147" => "\xe5\x95\206\345\237\x8e\xe8\xae\242\xe5\x8d\x95\xe9\x80\x80\346\xac\xbe", "\145\156\143\x72\171\x70\164\x5f\x63\157\x64\x65" => "\345\x95\x86\xe5\x9f\x8e\xe8\256\242\345\215\225\351\x80\x80\xe6\254\xbe"); goto C6aFL; Hmu50: $uid = mc_openid2uid($openid); goto x8C2n; aVFr4: return $result; goto i09mw; x8C2n: $result = mc_credit_update($uid, "\x63\162\145\x64\x69\164\x32", $value, array($uid, "\xe5\x95\206\xe5\x9f\216\xe8\xae\242\xe5\x8d\225\351\x80\200\xe6\254\xbe", "\155\x69\x68\165\141\x5f\155\141\x6c\154", $type)); goto qFzxX; i09mw: } static function initUserInfo() { goto Bg_OM; nFjGv: $data = array("\154\x6f\x67\x69\x6e\x74\x69\x6d\145" => time(), "\156\151\143\153\x6e\141\x6d\145" => $oauthinfo["\156\x69\x63\153\x6e\x61\155\145"], "\x68\145\x61\144\151\x6d\x67\x75\x72\x6c" => $oauthinfo["\x68\x65\141\x64\151\155\x67\x75\x72\x6c"]); goto ptfqV; O_Dh6: $data = array("\165\156\151\x61\x63\x69\x64" => $_W["\165\156\x69\141\x63\151\144"], "\x6f\160\x65\x6e\x69\x64" => $_W["\x6f\160\x65\156\x69\x64"], "\165\151\144" => $uid, "\156\151\143\153\156\x61\x6d\145" => $oauthinfo["\156\x69\143\x6b\x6e\x61\x6d\x65"], "\150\x65\141\144\x69\155\x67\x75\162\154" => $oauthinfo["\150\x65\x61\144\151\x6d\147\165\162\x6c"], "\154\x6f\147\151\x6e\x74\151\155\145" => time()); goto y0KWC; emsGq: $userinfo = self::getSingleUser($_W["\157\x70\145\x6e\151\144"]); goto iKyJi; TPevL: Util::deleteCache("\146\163\165\x73\145\x72", $_W["\157\x70\145\156\151\x64"]); goto UNAn4; X69di: if (empty($oauthinfo["\x6e\151\x63\153\156\141\x6d\x65"])) { goto Ge7Hb; } goto nFjGv; xE_dP: $userinfo = Util::getSingelDataInSingleTable("\x6d\x69\150\165\x61\x5f\x6d\141\x6c\x6c\137\165\163\145\162", array("\x6f\x70\145\156\x69\144" => $_W["\157\x70\x65\x6e\151\144"])); goto adFx2; LsNPv: $userinfo = self::getSingleUser($_W["\157\x70\x65\x6e\x69\x64"]); goto P7A0G; XSka3: $uid = mc_openid2uid($_W["\157\x70\145\x6e\x69\144"]); goto O_Dh6; JTqRi: if (!($userinfo["\154\x6f\x67\151\156\164\x69\155\145"] < time() - 24 * 3600)) { goto yvZnb; } goto U9tFI; qyjex: return $userinfo; goto YWzFb; lOXpi: HTTtz: goto qyjex; hQYid: if (!($userinfo["\x73\x74\141\x74\165\x73"] == 1)) { goto QR9Pn; } goto bG5Oi; iKyJi: goto HTTtz; goto RzVLF; bG5Oi: die("\xe6\202\xa8\xe7\232\x84\350\264\246\xe5\217\267\345\xb7\262\350\xa2\xab\xe7\246\x81\xe7\x94\250"); goto W8dM8; Bg_OM: global $_W; goto LsNPv; q3f0q: $oauthinfo = mc_oauth_userinfo($_W["\165\x6e\151\141\x63\x69\144"]); goto X69di; RzVLF: Qur5h: goto hQYid; U9tFI: load()->model("\155\143"); goto q3f0q; W8dM8: QR9Pn: goto JTqRi; NvVIy: $oauthinfo = mc_oauth_userinfo($_W["\165\156\x69\141\x63\x69\x64"]); goto XSka3; ptfqV: pdo_update("\x6d\151\150\x75\141\x5f\x6d\141\154\154\137\165\163\145\x72", $data, array("\151\x64" => $userinfo["\151\144"])); goto TPevL; P7A0G: if (!empty($userinfo)) { goto Qur5h; } goto xE_dP; adFx2: if (!(empty($userinfo["\x6c\x6f\147\151\x6e\164\x69\x6d\145"]) && !empty($_W["\157\x70\x65\156\x69\x64"]))) { goto FakT1; } goto iqdgI; y0KWC: pdo_insert("\x6d\x69\x68\x75\x61\x5f\155\141\x6c\154\137\165\x73\x65\x72", $data); goto hfKe4; iqdgI: load()->model("\x6d\x63"); goto NvVIy; j93vt: yvZnb: goto lOXpi; hfKe4: FakT1: goto emsGq; UNAn4: Ge7Hb: goto j93vt; YWzFb: } static function getSingleUser($openid) { return Util::getDataByCacheFirst("\146\163\165\x73\145\x72", $openid, array("\x55\x74\x69\154", "\147\145\164\123\151\156\x67\x65\x6c\104\x61\x74\x61\111\156\123\151\x6e\x67\154\x65\124\x61\x62\154\145"), array("\x6d\x69\150\165\x61\x5f\155\x61\154\x6c\137\165\163\145\x72", array("\x6f\160\x65\156\151\144" => $openid))); } static function getUserByopenid($openid) { goto vR5gJ; KvHvK: return $data; goto Lf2HG; vR5gJ: if (!empty($openid)) { goto TVoT9; } goto h1pW3; hm_7s: TVoT9: goto kQrnc; kQrnc: $data = Util::getSingelDataInSingleTable("\155\151\x68\x75\141\x5f\x6d\x61\154\154\x5f\165\163\145\x72", array("\x6f\x70\145\156\x69\x64" => $openid)); goto KvHvK; h1pW3: reutrn; goto hm_7s; Lf2HG: } static function alertWechatLogin() { goto LuNwq; LuNwq: global $_W; goto TFq1z; TFq1z: $qrcode = tomedia("\x71\x72\143\157\144\145\137" . $_W["\141\x63\151\x64"] . "\x2e\x6a\160\x67"); goto MnY3H; MnY3H: die("\74\x21\x44\x4f\x43\124\x59\120\x45\40\150\164\155\154\76\12\40\x20\40\40\40\40\40\40\x20\x20\40\40\x3c\x68\164\x6d\x6c\x3e\74\150\x65\141\x64\76\x3c\155\x65\164\x61\40\156\x61\155\145\x3d\47\x76\151\x65\x77\x70\x6f\162\x74\47\x20\143\x6f\156\164\x65\156\x74\x3d\47\x77\151\144\164\150\75\x64\145\x76\x69\143\145\55\167\x69\x64\x74\x68\54\40\151\x6e\151\164\x69\x61\x6c\x2d\163\143\x61\154\x65\75\x31\54\x20\x75\x73\145\162\x2d\x73\x63\141\x6c\x61\142\154\x65\75\60\47\76\xa\40\40\40\40\x20\40\40\40\40\x20\40\x20\40\x20\40\40\74\x74\151\x74\x6c\x65\x3e\346\217\220\347\244\xba\74\57\x74\x69\x74\154\x65\76\x3c\155\x65\164\141\40\x63\x68\141\162\163\145\164\75\x27\165\x74\146\55\x38\47\76\x3c\x6d\x65\x74\141\40\156\141\x6d\145\x3d\47\166\151\145\x77\160\157\162\164\x27\40\143\x6f\156\x74\145\156\x74\x3d\47\167\151\x64\164\x68\x3d\144\145\x76\x69\x63\x65\55\167\151\x64\x74\150\x2c\x20\x69\156\151\164\x69\x61\x6c\x2d\x73\143\141\154\145\x3d\x31\x2c\40\x75\x73\145\x72\55\163\x63\x61\154\x61\142\x6c\x65\x3d\60\47\76\74\x6c\x69\156\x6b\40\x72\145\154\75\x27\163\x74\171\x6c\x65\x73\x68\145\x65\x74\x27\x20\x74\x79\160\145\75\x27\164\x65\x78\x74\57\x63\x73\x73\47\40\150\x72\x65\146\75\x27\x68\164\x74\x70\163\x3a\57\57\x72\x65\163\56\167\170\x2e\x71\161\56\x63\x6f\x6d\x2f\x63\x6f\156\x6e\x65\143\x74\57\172\150\x5f\103\116\57\150\164\x6d\154\145\x64\151\164\x69\x6f\156\57\x73\x74\x79\154\x65\x2f\167\x61\160\137\x65\162\162\x31\x61\71\70\x35\63\56\x63\x73\163\47\76\12\x20\40\40\x20\x20\x20\x20\40\x20\40\40\40\74\x2f\x68\x65\141\x64\x3e\xa\x20\40\40\x20\x20\x20\40\x20\40\40\40\x20\74\x62\157\144\171\x3e\12\x20\x20\40\x20\40\40\40\40\x20\40\x20\x20\74\144\x69\x76\40\143\x6c\x61\163\163\x3d\x27\160\141\147\x65\137\155\x73\x67\47\x3e\74\x64\x69\x76\40\x63\154\x61\x73\x73\75\x27\151\x6e\x6e\x65\162\x27\76\x3c\x73\x70\141\156\x20\143\154\141\x73\163\x3d\x27\155\163\147\x5f\x69\x63\x6f\x6e\x5f\x77\x72\160\47\x3e\74\x69\40\143\x6c\x61\163\163\x3d\47\x69\x63\x6f\x6e\x38\60\x5f\x73\155\x69\154\x65\47\76\74\57\151\76\x3c\57\163\160\141\x6e\x3e\74\x64\x69\x76\x20\x63\x6c\x61\x73\x73\75\x27\155\x73\147\137\x63\157\156\164\145\x6e\164\47\76\x3c\150\x34\x3e\350\257\267\xe5\205\x88\347\224\xa8\xe5\276\256\344\xbf\241\346\211\xab\344\272\214\347\273\264\xe7\240\x81\xe5\205\xb3\346\xb3\250\xe6\x88\x91\344\xbb\xac\74\57\x68\x34\76\x3c\x62\162\x3e\74\151\155\147\x20\167\151\x64\x74\150\75\x27\62\60\60\x70\x78\47\x20\x73\162\x63\75\x27" . $qrcode . "\47\76\74\57\x64\x69\x76\76\x3c\57\142\x6f\x64\x79\76\74\57\x68\164\155\x6c\76\x3c\x2f\x64\151\166\x3e\x3c\57\144\x69\x76\76\x3c\57\144\151\x76\x3e\xa\40\40\x20\x20\x20\x20\x20\x20\40\x20\40\x20\x3c\x2f\142\157\x64\171\76\x3c\57\150\x74\x6d\154\76"); goto zhCBt; zhCBt: } }