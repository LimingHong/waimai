<?php
 goto HeajA; ker0r: function find_have_send($openid, $uniacid, $orderid) { goto h_bLN; Flqjv: if (!$result) { goto DFuhX; } goto b3THA; Podfs: $result = pdo_fetch("\x73\145\x6c\145\143\x74\x20\x2a\40\x66\162\157\155\40" . tablename("\x6d\151\150\165\141\137\x6d\141\x6c\154\137\162\145\x64") . "\40\40\167\x68\145\x72\x65\40\157\x70\145\156\151\x64\75\x3a\157\x70\x65\x6e\x69\x64\40\x61\x6e\x64\x20\165\156\x69\141\143\151\x64\75\72\x75\156\151\141\x63\x69\144\40\141\x6e\144\x20\157\162\x64\145\x72\151\x64\75\72\157\162\x64\145\162\151\x64", array("\157\160\x65\156\x69\144" => $openid, "\165\156\x69\141\x63\151\144" => $uniacid, "\157\162\144\x65\162\151\x64" => $orderid)); goto Flqjv; XzpVP: DFuhX: goto rAc7r; b3THA: return true; goto XzpVP; rAc7r: JwpkI: goto YmOt3; h_bLN: if (!($orderid > 0 && $openid && $uniacid)) { goto JwpkI; } goto Podfs; YmOt3: return false; goto ng68W; ng68W: } goto ZDu9t; Il8rk: function http_post($url, $param, $post_file = false) { goto o6mF4; cu3gv: curl_setopt($oCurl, CURLOPT_SSLVERSION, 1); goto JDaRw; Lbhmr: if (intval($aStatus["\x68\x74\164\x70\137\x63\x6f\x64\145"]) == 200) { goto UPhAX; } goto oi8U0; p7UJ2: curl_setopt($oCurl, CURLOPT_RETURNTRANSFER, 1); goto Yry9G; ZfNXU: curl_close($oCurl); goto Lbhmr; Mo2e1: foreach ($param as $key => $val) { $aPOST[] = $key . "\75" . urlencode($val); eoBFB: } goto rl5dz; Yry9G: curl_setopt($oCurl, CURLOPT_POST, true); goto hc7Sr; NWF8V: XSUcm: goto TQg9v; o6mF4: $oCurl = curl_init(); goto PB90_; oi8U0: return false; goto uISXP; hyiyl: curl_setopt($oCurl, CURLOPT_SSL_VERIFYHOST, false); goto cu3gv; pMf_T: $strPOST = join("\x26", $aPOST); goto Sb69D; Sb69D: goto XSUcm; goto VepO7; IcZoT: $aStatus = curl_getinfo($oCurl); goto ZfNXU; X9Ebj: curl_setopt($ch, CURLOPT_SSLKEYTYPE, "\120\x45\x4d"); goto Nz2B3; iLjM2: $sContent = curl_exec($oCurl); goto IcZoT; ld7xm: $aPOST = array(); goto Mo2e1; Nz2B3: curl_setopt($ch, CURLOPT_SSLKEY, WxPayConfig::SSLKEY_PATH); goto GgvGL; Z6kfU: tPgEe: goto tijDu; JDaRw: curl_setopt($ch, CURLOPT_SSLCERTTYPE, "\120\105\115"); goto dSXDs; I8G0p: UPhAX: goto CT1ns; JlA07: $strPOST = $param; goto NWF8V; rl5dz: f5QE5: goto pMf_T; CT1ns: return $sContent; goto Z6kfU; PB90_: if (!(stripos($url, "\x68\x74\164\x70\x73\x3a\x2f\57") !== FALSE)) { goto JgTUj; } goto uJUbD; GgvGL: JgTUj: goto YDodg; TQg9v: curl_setopt($oCurl, CURLOPT_URL, $url); goto p7UJ2; VepO7: S0V1F: goto JlA07; uISXP: goto tPgEe; goto I8G0p; uJUbD: curl_setopt($oCurl, CURLOPT_SSL_VERIFYPEER, FALSE); goto hyiyl; YDodg: if (is_string($param) || $post_file) { goto S0V1F; } goto ld7xm; dSXDs: curl_setopt($ch, CURLOPT_SSLCERT, WxPayConfig::SSLCERT_PATH); goto X9Ebj; hc7Sr: curl_setopt($oCurl, CURLOPT_POSTFIELDS, $strPOST); goto iLjM2; tijDu: } goto xHIab; ZDu9t: function getNonceStr($length = 32) { goto zwy9t; g6SZ0: uCbBr: goto Hr2yd; ZTCjJ: IVPBK: goto xe4A3; TerDB: $i++; goto jGU_W; Hr2yd: return $str; goto CEYBn; TemVk: $str = ''; goto qk2xF; xe4A3: if (!($i < $length)) { goto uCbBr; } goto UdN3u; jGU_W: goto IVPBK; goto g6SZ0; UdN3u: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto oIsTX; oIsTX: imHOW: goto TerDB; zwy9t: $chars = "\141\142\143\144\x65\146\x67\x68\151\x6a\153\154\x6d\156\x6f\160\x71\162\163\164\x75\166\167\x78\171\172\60\61\62\x33\x34\x35\66\67\x38\x39"; goto TemVk; qk2xF: $i = 0; goto ZTCjJ; CEYBn: } goto Il8rk; aFeXT: function insert_red_record($openid, $money, $uniacid, $orderid = 0) { goto x2ZQg; jdErZ: $in["\x6d\157\156\145\171"] = $money; goto NRD1V; YfIUM: pdo_insert("\x6d\151\x68\x75\141\x5f\155\141\x6c\154\137\162\145\144", $in); goto zP2BI; NRD1V: $in["\165\x6e\151\x61\143\x69\x64"] = $uniacid; goto IJT1_; x2ZQg: $in["\x6f\160\145\x6e\151\x64"] = $openid; goto jdErZ; IJT1_: $in["\157\162\x64\145\x72\x69\x64"] = $orderid; goto SqJs0; SqJs0: $in["\141\x64\144\x74\151\x6d\x65"] = time(); goto YfIUM; zP2BI: } goto ker0r; HeajA: function sendRedPack($params = array(), $oid) { goto vO1Sp; jyrK_: $params["\x6e\157\x6e\143\x65\137\163\164\162"] = getNonceStr(); goto zDHfq; RhJYi: if (!(strval($xml->return_code) == "\106\101\x49\x4c")) { goto JmdeI; } goto j7k9f; Xx2f5: Q2bPn: goto JGwY_; j7k9f: return false; goto P1AqD; BOKqs: $have_send = find_have_send($params["\x72\145\x5f\157\x70\145\156\x69\x64"], $_W["\165\x6e\151\141\143\x69\x64"], $oid); goto cga3t; ixnD0: Tx41u: goto gWRox; ed1Qt: if (!is_error($result)) { goto w1RCq; } goto zOa52; Lb8yS: $extras = array(); goto ub9oc; MtTwB: insert_red_record($params["\x72\x65\137\157\x70\x65\x6e\x69\144"], $params["\164\x6f\x74\x61\x6c\137\x61\155\157\x75\156\164"] / 100, $_W["\165\x6e\151\x61\x63\x69\x64"], $oid); goto K58BY; zDHfq: $params["\155\x63\x68\137\142\x69\154\154\x6e\x6f"] = $ordersn; goto wH2h4; cga3t: if (!$have_send) { goto Q2bPn; } goto HKAK2; HKAK2: return true; goto Xx2f5; xgyBt: $extras["\103\x55\x52\x4c\x4f\120\124\137\x53\x53\x4c\113\105\x59"] = $cert_dir . "\x2f\141\160\x69\x63\x6c\151\145\x6e\164\x5f\x6b\x65\x79\56\x70\x65\155\x2e"; goto hLb59; P1AqD: JmdeI: goto iJmLV; ZfXbC: $ordersn = $params["\x6d\143\150\x5f\x69\x64"] . date("\131\x6d\x64") . substr(getMillisecond(), 0, 7) . mt_rand(100, 999); goto jyrK_; iJmLV: if (!(strval($xml->result_code) == "\x46\x41\111\114")) { goto NEh07; } goto vJkns; vO1Sp: global $_W; goto BOKqs; zOa52: return false; goto T51Jt; oXTmb: $xml = array2xml($params); goto Lb8yS; w_dB7: $params["\x73\x69\147\x6e"] = strtoupper(md5($string1)); goto oXTmb; T51Jt: w1RCq: goto tB3fg; Hz8S0: unset($params["\x6b\145\x79"]); goto SaKEY; SsgqJ: $extras["\x43\125\122\x4c\117\120\x54\137\x53\x53\x4c\x43\105\122\x54"] = $cert_dir . "\57\x61\160\151\143\154\x69\145\x6e\164\x5f\143\145\x72\x74\x2e\160\x65\155\x2e"; goto xgyBt; tB3fg: $xml = @simplexml_load_string($result["\x63\157\156\164\x65\x6e\x74"], "\123\x69\155\160\154\x65\x58\x4d\114\105\x6c\145\155\x65\x6e\x74", LIBXML_NOCDATA); goto RhJYi; vJkns: return false; goto jX1eH; SaKEY: ksort($params); goto IGLGk; uVqe6: $_key = $params["\153\145\171"]; goto Hz8S0; JCdmF: foreach ($params as $key => $v) { goto GEf5q; GEf5q: if (!empty($v)) { goto dyiiV; } goto kwDZR; C7S8l: $string1 .= "{$key}\x3d{$v}\46"; goto wGYyo; kwDZR: goto FEwip; goto GYXBe; GYXBe: dyiiV: goto C7S8l; wGYyo: FEwip: goto cu4yi; cu4yi: } goto ixnD0; IGLGk: $string1 = ''; goto JCdmF; wH2h4: $params["\x63\154\151\x65\x6e\164\x5f\x69\160"] = CLIENT_IP; goto uVqe6; K58BY: return true; goto NBlDi; ub9oc: $cert_dir = $_SERVER["\104\117\103\125\x4d\105\116\124\x5f\x52\x4f\117\x54"] . "\x2f\x70\141\x79\155\145\x6e\164\57\x63\x65\x72\x74\57"; goto SsgqJ; kGa4Z: $uri = "\150\164\164\x70\163\x3a\57\57\141\160\151\56\155\x63\x68\x2e\167\145\x69\170\151\156\56\x71\161\x2e\143\x6f\x6d\57\155\155\x70\x61\x79\155\x6b\x74\164\x72\141\156\163\146\x65\162\163\57\163\145\x6e\144\x72\145\x64\x70\x61\x63\x6b"; goto ZfXbC; JGwY_: load()->func("\x63\x6f\155\x6d\x75\156\x69\143\141\x74\x69\x6f\x6e"); goto kGa4Z; hLb59: $result = ihttp_request($uri, $xml, $extras); goto ed1Qt; gWRox: $string1 .= "\153\145\x79\x3d" . $_key; goto w_dB7; jX1eH: NEh07: goto MtTwB; NBlDi: } goto aFeXT; xHIab: function getMillisecond() { goto U_WYt; y1zUk: $time = $time[1] . $time[0] * 1000; goto iRoqZ; iRoqZ: $time2 = explode("\56", $time); goto GSHMQ; U_WYt: $time = explode("\x20", microtime()); goto y1zUk; GSHMQ: $time = $time2[0]; goto PoJHt; PoJHt: return $time; goto yg0ss; yg0ss: } goto AkYVv; AkYVv: function ToXml($values) { goto od14a; VjOQW: $xml .= "\74\x2f\170\155\154\x3e"; goto BILIY; BILIY: return $xml; goto ugcEf; ULqwp: $xml = "\74\170\155\x6c\76"; goto zUIv3; hAQ43: i3mDs: goto ULqwp; zUIv3: foreach ($values as $key => $val) { goto UEI1q; SoDtC: V7bSw: goto Wixwt; WssGC: Gf3Il: goto Rs0dq; Wixwt: cW8gS: goto FAo7f; UEI1q: if (is_numeric($val)) { goto Gf3Il; } goto LOZSX; LOZSX: $xml .= "\x3c" . $key . "\x3e\74\41\x5b\x43\104\x41\x54\x41\133" . $val . "\x5d\135\x3e\x3c\57" . $key . "\76"; goto blI1T; Rs0dq: $xml .= "\74" . $key . "\76" . $val . "\x3c\57" . $key . "\x3e"; goto SoDtC; blI1T: goto V7bSw; goto WssGC; FAo7f: } goto npgB2; npgB2: eedp0: goto VjOQW; od14a: if (!(!is_array($values) || count($values) <= 0)) { goto i3mDs; } goto aFMcB; aFMcB: return false; goto hAQ43; ugcEf: }