<{extends file="<{$tempdir}>/public/admin.html"}> 
<{block name=extendjs}>
<script type="text/javascript" language="javascript" src="<{$siteurl}>/templates/<{$tempdir}>/public/js/artdialog/plugins/iframeTools.js"></script>
<script type="text/javascript" language="javascript" src="<{$siteurl}>/templates/adminpage/public/js/colorpicker.js"></script>
<link rel="stylesheet" type="text/css" href="<{$siteurl}>/templates/adminpage/public/css/colorpicker.css">
<link href="<{$siteurl}>/templates/adminpage/public/css/phone.css" rel="stylesheet" type="text/css">
        <{/block}>
 <{block name=controlname}>用户端首页设置<{/block}>
 <{block name=bodylist}>
   <div style="width:auto;overflow-x:hidden;overflow-y:auto;bottom:50px;">
       <div class="page" style="height:800px;">
           <div class="appAddtoCon">
               <div class="appAddtoLeft">
                   <div class="appAddtoImgCon">
                       <div class="appAddtoImgBox">

                           <div class="appAddtoBox">
                               <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app_001.png" />
                               </div>
                               <div class="appAddto">
                                   <a href="javascript:;" data="imgflash" >编辑</a>
                               </div>
                           </div>

                           <div class="appAddtoBox">
                               <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app_002.png" />
                               </div>
                               <div class="appAddto">
                                   <a href="javascript:;" data="classlist" >编辑</a>
                               </div>
                           </div>
						   
							   <!--分类下一张图片-->
							   <div class="appAddtoBox appAddtoBoxss">
								   <div class="appAddtoImg">
									   <img <{ofunc type=img link="<{$flxinfo['imgurl']|default:$shoplogo}>"}> id='flximgs' style='height:136px' />
								   </div>
									<div class="appAddto">
									   <a href="javascript:;" data="flximg" >编辑</a>
								   </div>
							   </div>
						   
						   <div class="appAddtoBox">
                               <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app_0011.png" />
                               </div>
                           </div>
						   
                           
                           <div class="appAddtoBox">
                               <div class="appAddtoImg" id="sddd" style="background-color:#fff;">


                               </div>
                               <div class="appAddto">
                                   <a href="javascript:;" data="ztylist" >编辑</a>
                               </div>
                           </div>

                           <div class="appAddtoBox" style="background-color: #fff;">
                               <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app0714.png" style="width:93.5%;margin-left:8px;" />
                               </div>
                               <div class="appAddto">
                                   <a href="javascript:;" data="imgflash2" >编辑</a>
                               </div>
                           </div>

                           <div class="appAddtoBox">
                               <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app_004.png" />
                               </div>   
                           </div>
						   <div class="appAddtoBox">
						       <div class="appAddtoImg">
                                   <img src="<{$siteurl}>/templates/adminpage/public/images/app_0045.png" />
                               </div>   
                               <div class="appAddto">
                                   <a href="javascript:;" data="imgflash3" >编辑</a>
                               </div>   
                           </div>
                       </div>
                   </div>
               </div>
               <!---  js 调用模块 -->
               <div id="showjscontent"></div>
			   <div id="bgimg" style='display:none'>
			       <div class='bgimgtit'>分类背景设置<span style='font-size:12px'>(图片尺寸建议长宽比=2:1)</span></div>
			       <div class='bgimgshow'> <img   <{ofunc type=img link="<{$flinfo['imgurl']}>"}> style='width:230px;height:130px' id="bgimgshow"/></div>
			       <div class='bgimgcz'>
						<span>浏览上传</span>						 
						<input class="appfile1" type="file" id="imgFile1" name="imgFile1" />
                        <input type="hidden" id="bgimgurl" value="<{$flinfo['imgurl']}>" />	
						<input type="hidden" id="fenleifontcolor" value="<{$flinfo['color']}>" />	
						<div style="text-align: left;margin:20px 0 0 15px;"><span style="border:none">是否显示背景图片：</span>
						    <input type='radio' name='is_showimg' value='1' <{if $flinfo['is_show'] == 1}>checked<{/if}>>是
						    <input type='radio' name='is_showimg' value='0' <{if $flinfo['is_show'] != 1}>checked<{/if}>>否
						</div>
                        <div style="text-align: left;margin:20px 0 0 15px;margin-top:0px;">  <div class="form-item" style='display:block;padding-bottom:20px;'><label style="color:#666666;">分类名称字体颜色:</label><input type="text" id="color" name="color" value="<{$flinfo['color']}>"   style="width:80px;"/></div><div id="picker"> </div>
 </div>						
				        <div id="getcolor">
							 <form action="" style="width: 245px;">								 
							 </form>
						 </div>
				   </div>
				   <div style='text-align: center;'><span style='border: 1px solid #ccc;cursor: pointer;padding: 2px 5px;' onclick='saveimgandcolor();'>提交保存</span></div>
			   </div>
			   <div id="bgimg1" style='margin-left:0;display:none;height:400px'>
			       <div class='bgimgtit'>图片设置<span style='font-size:12px'>(图片尺寸建议长宽比=3:2)</span></div>
			       <div class='bgimgshow'> <img <{ofunc type=img link="<{$flinfo['imgurl']}>"}>  style='width:230px;height:130px' id="flximgshow"/></div>
			       <div class='bgimgcz'>
						<span>浏览上传</span>						 
						<input class="appfile2" type="file" id="imgFile2" name="imgFile2" />
						<div style="text-align: left;margin:20px 0 0 15px;"><span style="border:none">是否显示图片：</span>
						    <input type='radio' name='is_showflximg' class='is_showflximg' value='1' <{if $flxinfo['is_show'] == 1}>checked<{/if}>>是
						    <input type='radio' name='is_showflximg' class='is_showflximg' value='0' <{if $flxinfo['is_show'] != 1}>checked<{/if}>>否
						</div>
						<div style="text-align: left;margin-left:15px;"><span style="border:none">是否跳转链接：</span>
						    <input type='radio' name='is_gourl' class='is_gourl' value='1' <{if $flxinfo['is_gourl'] == 1}>checked<{/if}>>是
						    <input type='radio' name='is_gourl' class='is_gourl' value='0' <{if $flxinfo['is_gourl'] != 1}>checked<{/if}>>否
						</div>						
						<div class='urldiv' style="text-align: left;margin-left:25px; font-size: 14px;color: #666666;<{if $flxinfo['is_gourl'] != 1}>display:none<{/if}>" >
						    链接标题：<input type='text' name='gourltit' class='gourltit' value="<{$flxinfo['title']}>" ><br>
						    链接地址：<input type='text' name='gourl' class='gourl' value="<{$flxinfo['gourl']}>" >					     
						</div>
                        <input type="hidden" id="flximg" value="<{$flxinfo['imgurl']}>" />			     
				   </div>
				   <div style='text-align: center;'><span style='border: 1px solid #ccc;cursor: pointer;padding: 2px 5px;' onclick='saveflximg();'>提交保存</span></div>
			   </div>
           </div>
       </div>
<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
	 $('#bgimg1').hide();
	 $('#demo').hide();
	 $('#picker').farbtastic('#color');
	});
 </script>
<script>  
$('.is_gourl').live('click',function(){
    var isgourl = $(this).val();
	if(isgourl == 1){
	    $('.urldiv').show();
	}else{
	    $('.urldiv').hide();
	}
})
 var conc = "<{$flinfo['color']}>";  
 
 $("#is_rgb").css("background-color",conc);
 $("#fenleifontcolor").val(conc);
 function CW(){		
	$('#color').css('background-color',conc);
	$('#color').val(conc);
	$("#getcolor").show();    
}
function setIndexColor(c){	 
	$("#is_rgb").css("backgroundColor",c);
	$("#fenleifontcolor").val(c);
}
function saveimgandcolor(){   
    var flimgurl = $('#bgimgurl').val();
	var flfontcolor = $('#fenleifontcolor').val();
    var is_showflimg = $('input[name="is_showimg"]:checked').val();   
    var url = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=saveimgandcolor&random=@random@&datatype=json';
	   $.ajax({
		   type: 'post',
		   async:true,
		   data:{'flimgurl': flimgurl,'flfontcolor':flfontcolor,'is_showflimg':is_showflimg},
		   url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
		   dataType: 'json',success: function(content) {
			   if(content.error == false){
				    alert(content.msg);
			   }else{
				   if(content.error == true){
					   alert(content.msg);
				   }else{
					   alert(content);
				   }
			   }
		   },
		   error: function(content) {
			   alert('数据提交失败');
		   }
   })


}
</script>	   
	   
<style>
.gourl,.gourltit{
    width: 166px;
    height: 28px;
    line-height: 28px;
    padding: 0 15px;
    font-size: 14px;
    color: #666666;
    background-color: #fff;
    border: 1px solid #e6e6e6;
}
#picker {
    margin: 20px 25px!important;
}
#is_rgb {
    cursor: pointer;
    width: 80px;
    height: 20px;
    display: inline-block;
    position: relative;
    top: 4px;
}
.bgimgcz span {
    padding:5px 10px;
    width: 58px;
    height: 28px;
    line-height: 28px;  
    text-align: center;
    font-size: 14px;
    color: #666666;
    border: 1px solid #cccccc;
}
#imgFile1,#imgFile2{
    width: 80px;
    height: 30px;
    padding: 0;
    opacity: 0;
    filter: Alpha(opacity=0);
    position: absolute;
    top: 9px;
	background-color:red;
    right: 100px;
}
#bgimg,#bgimg1{
    display:inline-block;
    background-color: yellow;
    width: 280px;
    height: 632px;       
    margin-left: 20px;
	border: 1px solid #d6d6d6;    
    background-color: #fff;
}
.bgimgtit{
    font-weight:bold;
    width: 100%;
    height: 36px;
    line-height: 36px;
    background-color: #f0f0f0;
	text-align:center;
	font-size: 15px;
    color: #666666;	
}
.bgimgshow{
    padding: 10px 0;
    text-align:center;
}
.bgimgcz{
    padding: 10px 0;
	text-align:center;
	position:relative
}
</style>
       <script type="text/javascript" language="javascript" src="<{$siteurl}>/templates/adminpage/public/js/ajaxfileupload.js"> </script>
       <script>
           $(function(){
               showzty();
               $('.appAddto a').bind('click',function(){
                   $('#showjscontent').html('');
                   var act = $(this).attr('data');
				   if(act == 'flximg'){	
                       $('#bgimg').hide();                      			   
				       showflximg();
				   }else{
					   if(act == 'classlist'){
						   $('#bgimg').show();						   
						   $('#bgimg1').css('display','inline-block');
						   $('#bgimg').css('display','inline-block');
						   $('#bgimg1').hide();
					   }else{
						   $('#bgimg').hide();
						   $('#bgimg1').hide();
					   }
					   get_paramhtml(act);
				   }   
               });
           });
           function get_paramhtml(act){
               if(act == ' '){
                   alert("获取失败");
                   return false;
               }
               var content = htmlback("<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module="+act+"");
               if(content.flag == false){
                   var getmoreContent =  $.trim(content.content);
                   if( getmoreContent == ''){
                       alert("获取失败");
                   }else{
                       $('#showjscontent').append(getmoreContent);
                   }
               }else{
                   alert('获取失败');
               }
           }
           function showflximg(){  
		       $('#bgimg1').show();	
		       $('#bgimg1').css('display','inline-block');		
		       
		   }
		   function saveflximg(){
				var flximg = $('#flximg').val();
				var is_showflximg = $('input[name="is_showflximg"]:checked').val();   
                var gourl = $('input[name="gourl"]').val();  
                var gourltit = $('input[name="gourltit"]').val();  				
				var is_gourl = $('input[name="is_gourl"]:checked').val();   
				var url = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=saveflximg&random=@random@&datatype=json';
				   $.ajax({
					   type: 'post',
					   async:true,
					   data:{'flximg': flximg,'is_showflximg':is_showflximg,'gourl':gourl,'gourltit':gourltit,'is_gourl':is_gourl},
					   url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
					   dataType: 'json',success: function(content) {
						   if(content.error == false){
								alert(content.msg);
						   }else{
							   if(content.error == true){
								   alert(content.msg);
							   }else{
								   alert(content);
							   }
						   }
					   },
					   error: function(content) {
						   alert('数据提交失败');
					   }
			   })		   
		   }
           $("input[name='ztystyle']").live('click',function(){
               var url = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=ztymodetog&random=@random@&datatype=json';
               $.ajax({
                   type: 'post',
                   async:true,
                   data:{'ztytype': $(this).val()},
                   url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
                   dataType: 'json',success: function(content) {
                       if(content.error == false){
                           $('#showjscontent').html('');
                           get_paramhtml('ztylist');
                           showzty();
                       }else{
                           if(content.error == true){
                               alert(content.msg);
                           }else{
                               alert(content);
                           }
                       }
                   },
                   error: function(content) {
                       alert('数据提交失败');
                   }
           })
           })

           $("#imgFile").live("change", function (){
               ajaxFileUpload();
               $("#upload").replaceWith($("#upload").clone(true));
           });
           $('input[name="link_type"]').live('click',function(){
               var link_type = $(this).val();
               if(link_type == 1){
                   $('select[name="i_catid"]').show();
                   $('select[name="i_catid"]').parent().show();
                   $('input[name="i_links"]').hide();
                   $('input[name="i_links"]').parent().hide();
               }else if(link_type == 2){
                   $('select[name="i_catid"]').hide();
                   $('select[name="i_catid"]').parent().hide();
                   $('input[name="i_links"]').show();
                   $('input[name="i_links"]').parent().show();
               }
           });


           $('#doclose').live('click',function(){
               $('#bottom_edit').hide();
           });
           $('.appAdda_bg01').live('click',function(){
               if(confirm('确认显示')){
                   var tempid = $(this).parents('tr').attr('cid');
                   if(tempid==0){
                       alert("数据不存在");return;
                   }
                   var type = $(this).parents('tr').attr('type');
                   var ztytype=$("input[name='ztystyle']:checked").val();
                   $(this).html('隐藏');
                   $(this).addClass('appAdda_bg02');
                   $(this).removeClass('appAdda_bg01');
                   var url = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=togdata&random=@random@&datatype=json';
                   $.ajax({
                       type: 'post',
                       async:false,
                       data:{'id':tempid,'type':type,'flag':1,'ztytype':ztytype},
                       url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
                       dataType: 'json',success: function(content) {
                           if(content.error == false){

                           }else{
                               if(content.error == true)
                               {
                                   alert(content.msg);
                               }else{
                                   alert(content);
                               }
                           }
                       },
                       error: function(content) {
                           alert('数据提交失败');
                       }
                   });
               }
               return false;
           });
           $('.appAdda_bg02').live('click',function(){
               if(confirm('确认隐藏')){
                   var tempid = $(this).parents('tr').attr('cid');
                   var type = $(this).parents('tr').attr('type');
                   var ztytype=$("input[name='ztystyle']:checked").val();
                   $(this).html('显示');
                   $(this).addClass('appAdda_bg01');
                   $(this).removeClass('appAdda_bg02');
                   var url = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=togdata&random=@random@&datatype=json';
                   $.ajax({
                       type: 'post',
                       async:false,
                       data:{'id':tempid,'type':type,'flag':0,'ztytype':ztytype},
                       url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
                       dataType: 'json',success: function(content) {
                           if(content.error == false){

                           }else{
                               if(content.error == true)
                               {
                                   alert(content.msg);
                               }else{
                                   alert(content);
                               }
                           }
                       },
                       error: function(content) {
                           alert('数据提交失败');
                       }
                   });
               }
           });
           function GetRequest(url) {
               var theRequest = new Object();
               if (url.indexOf("?") != -1) {
                   var str = url.substr(1);
                   strs = str.split("&");
                   for(var i = 0; i < strs.length; i ++) {
                       theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
                   }
               }
               return theRequest;
           }
           function ajaxFileUpload(){
               $.ajaxFileUpload({
				   url:'<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=uploadapp&uploaddir=index&datatype=json',
				   secureuri:false,
				   fileElementId:'imgFile',
				   dataType: 'json',
				   data:{'inputname':'imgFile'},
				   success: function (data, status){
					   if(typeof(data.error) != 'undefined'){
						   if(data.error == false){
							   $('input[name="i_img_url"]').val(data.msg);
						   }else{
							   alert(data.msg);
						   }
					   }else{
						   alert(data);
					   }
				   },
				   error: function (data, status, e){   
					   alert(e);
				   }
			   })
               return false;

           }
           $("#imgFile1").live("change", function () {
               ajaxFileUpload1();
               $("#upload").replaceWith($("#upload").clone(true));
           });
           function ajaxFileUpload1(){
               $.ajaxFileUpload(
                       {
                           url:'<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=uploadapp&uploaddir=index&datatype=json',
                           secureuri:false,
                           fileElementId:'imgFile1',
                           dataType: 'json',
                           data:{'inputname':'imgFile1'},
                           success: function (data, status)
                           {    
                               if(typeof(data.error) != 'undefined'){
                                   if(data.error == false){
                                       $('#bgimgurl').val(data.msg);
									   $('#bgimgshow').attr('src',data.msg);
                                   }else{
                                       alert(data.msg);
                                   }
                               }else{
                                   alert(data);
                               }
                           },
                           error: function (data, status, e){
                              console.log(e);
							  alert(e);
                           }
                       }
               )
               return false;
           }
		    $("#imgFile2").live("change", function () {
               ajaxFileUpload2();
               $("#upload").replaceWith($("#upload").clone(true));
           });
           function ajaxFileUpload2(){
               $.ajaxFileUpload(
                       {
                           url:'<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=uploadapp&uploaddir=index&datatype=json',
                           secureuri:false,
                           fileElementId:'imgFile2',
                           dataType: 'json',
                           data:{'inputname':'imgFile2'},
                           success: function (data, status)
                           {    
                               if(typeof(data.error) != 'undefined'){
                                   if(data.error == false){
                                       $('#flximg').val(data.msg);
									   $('#flximgshow').attr('src',data.msg);
									   $('#flximgs').attr('src',data.msg);
                                   }else{
                                       alert(data.msg);
                                   }
                               }else{
                                   alert(data);
                               }
                           },
                           error: function (data, status, e){
                              console.log(e);
							  alert(e);
                           }
                       }
               )
               return false;
           }
           function htmlback(url,info)
           {
               var backmessage = {'flag':true,'content':''};
               $.ajax({
                   type: 'POST',
                   async:false,
                   url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
                   data: info,
                   dataType: 'html',success: function(content) {
                       backmessage['flag'] = false;
                       backmessage['content'] = content;
                   },
                   error: function(content) {
                       backmessage['content'] = '获取失败';
                   }
               });
               return backmessage;
           }

           function showzty(){
               $('#sddd').html(' ');
               var type=$("input[name='ztystyle']:checked").val();
               var ztyurl = '<{$siteurl}>/index.php?ctrl=adminpage&action=weixin&module=ztymodehtml';
               var content = htmlback(ztyurl,{'type':type});
               if(content.flag == false){
                   var getmoreContent =  $.trim(content.content);
                   if( getmoreContent == ''){
                       alert("获取失败");
                   }else{
                       $('#sddd').append(getmoreContent);
                   }
               }else{
                   alert('获取失败');
               }
           }

       </script>

   </div>
<{/block}>