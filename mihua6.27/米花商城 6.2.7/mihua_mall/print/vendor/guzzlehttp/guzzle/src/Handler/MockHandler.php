<?php
 namespace GuzzleHttp\Handler; use GuzzleHttp\Exception\RequestException; use GuzzleHttp\HandlerStack; use GuzzleHttp\Promise\PromiseInterface; use GuzzleHttp\Promise\RejectedPromise; use GuzzleHttp\TransferStats; use Psr\Http\Message\RequestInterface; use Psr\Http\Message\ResponseInterface; class MockHandler implements \Countable { private $queue = array(); private $lastRequest; private $lastOptions; private $onFulfilled; private $onRejected; public static function createWithMiddleware(array $queue = null, callable $onFulfilled = null, callable $onRejected = null) { return HandlerStack::create(new self($queue, $onFulfilled, $onRejected)); } public function __construct(array $queue = null, callable $onFulfilled = null, callable $onRejected = null) { goto p26Bg; NtmBL: lXOXJ: goto dha1U; eF2PQ: if (!$queue) { goto lXOXJ; } goto fLtG1; IT2dx: $this->onRejected = $onRejected; goto eF2PQ; fLtG1: call_user_func_array([$this, "\x61\x70\x70\145\156\144"], $queue); goto NtmBL; p26Bg: $this->onFulfilled = $onFulfilled; goto IT2dx; dha1U: } public function __invoke(RequestInterface $request, array $options) { goto fgbH5; aW06l: JNDgt: goto d5zx6; f8cVR: uuSm8: goto ttKL5; fgbH5: if ($this->queue) { goto mKCQf; } goto sFN1z; LknSL: if (!isset($options["\157\156\137\x68\x65\x61\x64\145\x72\163"])) { goto iVfGW; } goto JL84A; EsqqW: if (!isset($options["\144\x65\x6c\x61\171"])) { goto JNDgt; } goto KoF7z; SLp0v: throw new \InvalidArgumentException("\x6f\156\x5f\x68\x65\141\144\x65\x72\163\x20\x6d\165\163\164\40\x62\x65\40\143\x61\x6c\154\141\142\154\x65"); goto f8cVR; QluQR: $response = $response instanceof \Exception ? \GuzzleHttp\Promise\rejection_for($response) : \GuzzleHttp\Promise\promise_for($response); goto x6Tdx; yx0J3: $response = array_shift($this->queue); goto LknSL; cPLWf: mKCQf: goto EsqqW; ttKL5: try { $options["\x6f\x6e\x5f\x68\x65\141\x64\145\x72\163"]($response); } catch (\Exception $e) { $msg = "\x41\156\x20\x65\162\162\157\x72\x20\x77\141\163\x20\145\x6e\x63\157\x75\x6e\x74\x65\x72\x65\144\x20\144\165\162\151\x6e\147\x20\x74\x68\x65\x20\x6f\x6e\x5f\x68\145\141\144\145\162\x73\x20\145\x76\145\x6e\164"; $response = new RequestException($msg, $request, $response, $e); } goto xc_DV; xc_DV: iVfGW: goto H173r; hPgDp: g0L5H: goto QluQR; KoF7z: usleep($options["\144\145\154\x61\171"] * 1000); goto aW06l; x6Tdx: return $response->then(function ($value) use($request, $options) { $this->invokeStats($request, $options, $value); if (!$this->onFulfilled) { goto SMBbH; } call_user_func($this->onFulfilled, $value); SMBbH: if (!isset($options["\x73\x69\x6e\153"])) { goto qv7yB; } $contents = (string) $value->getBody(); $sink = $options["\163\151\x6e\x6b"]; if (is_resource($sink)) { goto d0YbJ; } if (is_string($sink)) { goto uzjWB; } if ($sink instanceof \Psr\Http\Message\StreamInterface) { goto eQ47Y; } goto gPH83; d0YbJ: fwrite($sink, $contents); goto gPH83; uzjWB: file_put_contents($sink, $contents); goto gPH83; eQ47Y: $sink->write($contents); gPH83: qv7yB: return $value; }, function ($reason) use($request, $options) { $this->invokeStats($request, $options, null, $reason); if (!$this->onRejected) { goto w6PDc; } call_user_func($this->onRejected, $reason); w6PDc: return \GuzzleHttp\Promise\rejection_for($reason); }); goto X9vY1; d5zx6: $this->lastRequest = $request; goto S1IUm; S1IUm: $this->lastOptions = $options; goto yx0J3; JL84A: if (is_callable($options["\x6f\156\x5f\150\145\141\x64\145\x72\163"])) { goto uuSm8; } goto SLp0v; H173r: if (!is_callable($response)) { goto g0L5H; } goto CPhgR; sFN1z: throw new \OutOfBoundsException("\115\157\143\x6b\x20\x71\x75\145\165\x65\40\151\x73\40\x65\x6d\x70\164\171"); goto cPLWf; CPhgR: $response = call_user_func($response, $request, $options); goto hPgDp; X9vY1: } public function append() { foreach (func_get_args() as $value) { goto HyoXf; qObSu: yBjY6: goto deSqV; deSqV: re5kq: goto zvY2G; HyoXf: if ($value instanceof ResponseInterface || $value instanceof \Exception || $value instanceof PromiseInterface || is_callable($value)) { goto FuSmJ; } goto cY4aN; GKH8l: goto yBjY6; goto nSJnr; o0MVA: $this->queue[] = $value; goto qObSu; nSJnr: FuSmJ: goto o0MVA; cY4aN: throw new \InvalidArgumentException("\x45\170\160\145\143\x74\x65\144\40\x61\40\x72\x65\163\160\157\156\x73\145\40\x6f\x72\x20" . "\145\170\x63\x65\160\164\151\157\x6e\56\x20\106\157\x75\156\144\x20" . \GuzzleHttp\describe_type($value)); goto GKH8l; zvY2G: } usksE: } public function getLastRequest() { return $this->lastRequest; } public function getLastOptions() { return $this->lastOptions; } public function count() { return count($this->queue); } private function invokeStats(RequestInterface $request, array $options, ResponseInterface $response = null, $reason = null) { goto WFsl1; WFsl1: if (!isset($options["\x6f\x6e\137\163\164\141\x74\x73"])) { goto Qi3_w; } goto GCLOt; vZyS7: call_user_func($options["\157\x6e\x5f\x73\x74\x61\x74\163"], $stats); goto QZCJq; QZCJq: Qi3_w: goto QOl1p; GCLOt: $stats = new TransferStats($request, $response, 0, $reason); goto vZyS7; QOl1p: } }