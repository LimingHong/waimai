webpackJsonp([58],{DVD5:function(e,t){},kIM1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Gu7T"),n=a.n(s),i=a("Dd8w"),d=a.n(i),r=a("Yo4o"),o=a("NYxO"),l=a("Cz8s"),c=a("mtWM"),u=a.n(c),h={data:function(){return{query:{},showLoading:!0,key:"",mapConfig:{center:{}},map:{lat:"",lng:""},addressPois:[],addressSearch:[],handAddDialogStatus:!1,handAddress:""}},components:{PublicHeader:l.a},computed:d()({},Object(o.c)(["editAddress","erranderExtra"])),watch:{key:function(){var e=this,t=this.key;this.addressSearch=[],t&&this.util.request({url:"system/common/map/suggestion",data:{key:t}}).then(function(t){var a=t.data.message;a.errno||(e.addressSearch=[].concat(n()(e.addressSearch),n()(a.message)))})}},methods:d()({},Object(o.b)(["replaceAddress"]),{onToggleHandAddDialogStatus:function(){this.handAddDialogStatus=!this.handAddDialogStatus},onConfirmAddress:function(){var e=this;e.handAddress?this.util.request({url:"wmall/member/address/handAdd",data:{address:e.handAddress}}).then(function(t){var a=t.data.message;if(a.errno)e.util.$toast(a.message);else{var s=(a=a.message).address;s&&s.location_x&&s.location_y&&(e.replaceAddress(s),e.editAddress&&e.$router.replace(e.util.getUrl({path:"/pages/member/addressPost",query:e.util.extend(e.query,{from:"location"})})))}}):e.util.$toast("请输入要添加的坐标名称")},onLoad:function(){var e=this,t={sid:this.sid,erranderId:this.erranderId};this.erranderExtra&&this.erranderExtra.agentid&&(t.agentid=this.erranderExtra.agentid),this.util.request({url:"wmall/member/address/location",data:t}).then(function(t){e.showLoading=!1;var a=t.data.message;e.mapConfig=a.message.map,e.map.lat=a.message.map.center.location_x,e.map.lng=a.message.map.center.location_y,e.loadmap(),e.onGetAddressPois(e.map.lat,e.map.lng)})},onGetAddressPois:function(e,t){var a=this,s={type:"商务住宅|科教文化服务|地名地址信息|医疗保健服务|政府机构及社会团体|住宿服务|公司企业|道路附属设施|购物服务|生活服务|体育休闲服务|交通设施服务",location:e+","+t},n="https://restapi.amap.com/v3/place/around?key=37bb6a3b1656ba7d7dc8946e7e26f39b&radius=1000&offset=25&page=1&extensions=all&output=json&keywords=&json="+this.util.toQueryString(s);u.a.get(n).then(function(e){if("OK"==(e=e.data).info){var t=[];for(var s in e.pois){var n=e.pois[s].location.split(","),i={name:e.pois[s].address,address:e.pois[s].name,lng:n[0],lat:n[1],location_x:n[1],location_y:n[0]};t.push(i)}a.addressPois=t}})},onSelectAddress:function(e){this.replaceAddress(e),this.editAddress&&this.$router.replace(this.util.getUrl({path:"/pages/member/addressPost",query:this.util.extend(this.query,{from:"location"})}))},loadmap:function(){var e=this;Object(r.a)().then(function(t){window.map=e.map=new t.Map("allmap1",{resizeEnable:!0,center:[e.mapConfig.center.location_y,e.mapConfig.center.location_x],zoom:17}),t.event.addListener(e.map,"dragend",function(){var t=e.map.getCenter();e.onGetAddressPois(t.lat,t.lng)}),e.util.getLocation({successLocation:function(t){e.map.panTo([t.lng,t.lat]),e.onGetAddressPois(t.lat,t.lng)},fail:function(e){}})})}}),created:function(){this.query=this.util.parseQuery(this.$route.query),this.query&&(this.id=this.query.id,this.sid=this.query.sid,this.channel=this.query.channel,this.input=this.query.input,this.erranderId=this.query.erranderId,this.orderId=this.query.orderId)},mounted:function(){this.onLoad()}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"address-location"}},[a("public-header",{attrs:{title:"新增收货地址"}}),e._v(" "),a("transition",{attrs:{name:"loading"}},[a("iloading",{directives:[{name:"show",rawName:"v-show",value:e.showLoading,expression:"showLoading"}]})],1),e._v(" "),a("div",{staticClass:"content"},[a("van-search",{attrs:{placeholder:"请输入您的收货地址"},model:{value:e.key,callback:function(t){e.key=t},expression:"key"}}),e._v(" "),e.key?a("van-cell-group",{staticClass:"search-list"},[e._l(e.addressSearch,function(t,s){return a("van-cell",{key:s,attrs:{title:t.address,label:t.name},on:{click:function(a){return e.onSelectAddress(t)}}})}),e._v(" "),a("div",{staticClass:"padding-15-tb text-center font-14"},[a("span",{staticClass:"c-danger",on:{click:e.onToggleHandAddDialogStatus}},[e._v("未找到地址？点我手动添加")])])],2):[e._m(0),e._v(" "),e.addressPois.length>0?a("div",{staticClass:"location-list"},[e._l(e.addressPois,function(t,s){return a("div",{key:s,staticClass:"list-item flex-lr van-hairline--bottom ",class:{active:0==s},on:{click:function(a){return e.onSelectAddress(t)}}},[a("i",{staticClass:"icon icon-locationfill"}),e._v(" "),a("div",{staticClass:"item-inner"},[a("div",{staticClass:"name ellipsis"},[e._v(e._s(t.address))]),e._v(" "),a("div",{staticClass:"address ellipsis"},[e._v(e._s(t.name))])])])}),e._v(" "),a("div",{staticClass:"padding-15-r padding-15-tb text-center font-14"},[a("span",{staticClass:"c-danger",on:{click:e.onToggleHandAddDialogStatus}},[e._v("未找到地址？点我手动添加")])])],2):e._e()]],2),e._v(" "),a("van-dialog",{attrs:{title:"添加收货地址","show-cancel-button":""},on:{confirm:e.onConfirmAddress},model:{value:e.handAddDialogStatus,callback:function(t){e.handAddDialogStatus=t},expression:"handAddDialogStatus"}},[a("div",{staticClass:"padding-15"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.handAddress,expression:"handAddress"}],staticClass:"w-100",attrs:{type:"text",placeholder:"请输入收货地址"},domProps:{value:e.handAddress},on:{input:function(t){t.target.composing||(e.handAddress=t.target.value)}}})])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"map-content"},[t("div",{attrs:{id:"allmap1"}}),this._v(" "),t("div",{staticClass:"center-marker"},[t("img",{attrs:{src:"static/img/marker_red.png",alt:""}})])])}]};var p=a("VU/8")(h,m,!1,function(e){a("DVD5")},null,null);t.default=p.exports}});