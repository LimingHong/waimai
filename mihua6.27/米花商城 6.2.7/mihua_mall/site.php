<?php
 goto iWaXf; Fvi6y: require_once IA_ROOT . '/addons/mihua_mall/myclass/Qr_code.class.php'; goto geCcA; h36X3: define('APISERVER', 'http://api.szmihua.com'); goto jYnE3; e927I: define('mihua_AUTHKEY', 'mihua_mallcco1905cmodule'); goto yz07F; jRgG9: require_once IA_ROOT . '/addons/mihua_mall/myclass/dir.functions.php'; goto Bhjgd; pIx6l: require_once IA_ROOT . '/addons/mihua_mall/myclass/excel.php'; goto tVsMF; WBz1j: require_once IA_ROOT . '/addons/mihua_mall/myclass/client.class.php'; goto jRgG9; gMfPf: define('MODULE_URL', '../addons/mihua_mall/'); goto JMaIP; iWaXf: defined('IN_IA') or exit('Access Denied'); goto ol4p9; MD0PD: require_once IA_ROOT . '/addons/mihua_mall/model/model_good.class.php'; goto F4ap1; YuRL2: require_once IA_ROOT . '/addons/mihua_mall/myclass/WeixinPay.class.php'; goto sqRFg; E5niM: require_once IA_ROOT . '/addons/mihua_mall/model/model_express.class.php'; goto cmRz_; DfxDo: require_once IA_ROOT . '/framework/library/qrcode/phpqrcode.php'; goto leU7S; M32g1: require_once 'wxapi/log.php'; goto h36X3; Bhjgd: require_once IA_ROOT . '/addons/mihua_mall/model/model_card.class.php'; goto FBS0j; jYnE3: define('mihua_mall_VERSION', '150317X1'); goto vSTRH; iFB9X: define('STYLE', '../addons/mihua_mall/recouse/'); goto gMfPf; F4ap1: require_once IA_ROOT . '/addons/mihua_mall/model/model_order.class.php'; goto nUQKZ; Et4aQ: define('mihua_COOKIE_SID', 'sid_' . mihua_mall_VERSION); goto ZbEbO; ff3NI: define('mihua_COOKIE_XOAUHURL', 'mh_xaurl_' . mihua_mall_VERSION); goto e927I; LAD8K: require_once IA_ROOT . '/addons/mihua_mall/myclass/Util.class.php'; goto Fvi6y; FBS0j: require_once IA_ROOT . '/addons/mihua_mall/model/model_group.class.php'; goto MD0PD; nUQKZ: require_once IA_ROOT . '/addons/mihua_mall/model/model_user.class.php'; goto E5niM; geCcA: require_once IA_ROOT . '/addons/mihua_mall/myclass/Message.class.php'; goto LiCSA; vSTRH: define('mihua_COOKIE_QRCODE', 'qrcode_' . mihua_mall_VERSION); goto Et4aQ; sqRFg: require_once IA_ROOT . '/addons/mihua_mall/myclass/Admin.class.php'; goto pIx6l; cmRz_: require_once IA_ROOT . '/addons/mihua_mall/myclass/SubExpress.class.php'; goto e6wUO; SeBus: require_once IA_ROOT . '/addons/mihua_mall/myclass/WebCommon.class.php'; goto YuRL2; VQ1qC: require_once IA_ROOT . '/addons/mihua_mall/myclass/func.php'; goto LAD8K; tVsMF: require_once IA_ROOT . '/addons/mihua_mall/myclass/virtual.php'; goto WBz1j; yz07F: define('mihua_VERSION', IA_ROOT . '/addons/mihua_mall/version.json'); goto iFB9X; ZbEbO: define('mihua_COOKIE_OPENID', 'mh_oid_' . mihua_mall_VERSION); goto ff3NI; e6wUO: require_once IA_ROOT . '/addons/mihua_mall/model/model_payResult.class.php'; goto DfxDo; leU7S: require_once 'wxapi/lib/WxPay.Api.php'; goto M32g1; ol4p9: require_once IA_ROOT . '/addons/mihua_mall/myclass/autoLoad.php'; goto VQ1qC; LiCSA: require_once IA_ROOT . '/addons/mihua_mall/myclass/queue.class.php'; goto SeBus; JMaIP: class mihua_mallModuleSite extends WeModuleSite { public function doWebAuth() { goto THNR2; jFVnf: if (!($op == 'doauth')) { goto z6biP; } goto eAiL0; vlirO: $this->adminMessage('更新授权成功', referer(), 'success'); goto t5Zsc; AAoN8: z6biP: goto FYSG3; eAiL0: if (empty($response['content'])) { goto uBTpo; } goto vlirO; THNR2: global $_W, $_GPC; goto jFVnf; t5Zsc: uBTpo: goto AAoN8; FYSG3: } public function __call($function_name, $args) { goto PnTj4; coWYG: $fname = str_ireplace('doWeb', '', $function_name); goto rz2lF; cjO15: ADSOK: goto coWYG; rz2lF: $this->__web($fname); goto nc8hk; bPzOg: $fname = str_ireplace('doMobile', '', $function_name); goto YanR_; PnTj4: if (strstr($function_name, 'doWeb')) { goto ADSOK; } goto MhDBU; Bzfq6: uXFLO: goto bPzOg; kn4CV: goto Zosix; goto cjO15; gUj7f: Zosix: goto UddZg; MhDBU: if (strstr($function_name, 'doMobile')) { goto uXFLO; } goto kn4CV; YanR_: $this->__mobileNew($fname); goto gUj7f; nc8hk: goto Zosix; goto Bzfq6; UddZg: } public function __web($module) { goto S2kio; TK3pN: load()->func('tpl'); goto bcfIT; C_18m: include $this->template($module); goto jcBqo; S2kio: global $_GPC, $_W; goto pCtaM; uuV3M: if (in_array($_W['role'], array("manager", "operator", "founder", "clerk", "vice_founder"))) { goto ds3ox; } goto hffgM; pCtaM: load()->func('file'); goto TK3pN; a_r17: require_once IA_ROOT . '/addons/mihua_mall/module/web/' . $module . '.php'; goto udnbx; qWoUE: $op = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto uuV3M; udnbx: $module = lcfirst($module); goto C_18m; hffgM: message('您的账号没有访问此公众号的权限.'); goto RwL22; bcfIT: load()->model('mc'); goto qWoUE; RwL22: ds3ox: goto a_r17; jcBqo: } public function __mobileNew($module) { goto w7OZb; mG1hp: include $this->template('black'); goto kyVzg; pVFT8: GnK16: goto tmF00; TerrZ: require_once IA_ROOT . '/addons/mihua_mall/module/mobile/' . $module . '.php'; goto tZmRB; ncPEV: exit; goto hIxTS; w7OZb: global $_GPC, $_W; goto xAk8K; kyVzg: exit; goto pVFT8; HEg87: GtHOd: goto mG1hp; tZmRB: include $this->template($module); goto ncPEV; hIxTS: goto GnK16; goto HEg87; xAk8K: if (!file_exists(IA_ROOT . '/addons/mihua_mall/module/mobile/' . $module . '.php')) { goto GtHOd; } goto TerrZ; tmF00: } public function changeWechatSend($id, $status, $msg = "") { goto K03yU; FDQBE: ksort($sign); goto j8tdw; cKHTF: $account = WeAccount::create($acid); goto DotFE; AmdiL: if (empty($paylog['openid'])) { goto vhapL; } goto bjgvH; wqv2K: $send['sign_method'] = 'sha1'; goto cKHTF; QSwVT: qBXhW: goto sY_2N; UQUjc: if (!($payment['payment']['wechat']['version'] == '2')) { goto OdJuQ; } goto PBz8w; vRB6v: $acid = $paylog['tag']['acid']; goto LbRUW; W2lsy: $sign = $send; goto r74Ts; S0Zk6: $paylog['tag'] = iunserializer($paylog['tag']); goto vRB6v; Clsgv: $send = array("appid" => $account['key'], "openid" => $paylog['openid'], "transid" => $paylog['tag']['transaction_id'], "out_trade_no" => $paylog['plid'], "deliver_timestamp" => TIMESTAMP, "deliver_status" => $status, "deliver_msg" => $msg); goto W2lsy; K03yU: global $_W; goto ut0U9; y25N7: OdJuQ: goto Clsgv; EwyHP: $payment = uni_setting($account['uniacid'], 'payment'); goto UQUjc; ZnFA4: $paylog = pdo_fetch('SELECT plid, openid, tag FROM ' . tablename('core_paylog') . " WHERE tid = '{$id}' AND status = 1 AND type = 'wechat'"); goto AmdiL; ut0U9: load()->model('account'); goto ZnFA4; DotFE: $response = $account->changeOrderStatus($send); goto rrscO; jj7eZ: uY2L3: goto SSgd7; rrscO: if (!is_error($response)) { goto uY2L3; } goto lv5Hy; LbRUW: $account = account_fetch($acid); goto EwyHP; j8tdw: $string = ''; goto zmlHt; sY_2N: $send['app_signature'] = sha1(rtrim($string, '&')); goto wqv2K; bjgvH: $profile = pdo_fetch('select * from ' . tablename('mihua_mall_member') . " where from_user='{$paylog['openid']}' "); goto U_obb; lv5Hy: message($response['message']); goto jj7eZ; U_obb: $this->checkisAgent($paylog['openid'], $profile, 2); goto S0Zk6; zmlHt: foreach ($sign as $key => $v) { goto ctp05; aOetM: nWWdH: goto VpsqR; ctp05: $key = strtolower($key); goto Y7tgx; Y7tgx: $string .= "{$key}={$v}&"; goto aOetM; VpsqR: } goto QSwVT; SSgd7: vhapL: goto x3S_0; PBz8w: return true; goto y25N7; r74Ts: $sign['appkey'] = $payment['payment']['wechat']['signkey']; goto FDQBE; x3S_0: } public function selectTemplate($module) { goto X9xNs; z6IfX: load()->model('mc'); goto dadkh; Ix7PC: $out = $mu_str . $module; goto zegfb; TGWeS: JPawe: goto Ix7PC; TpcwP: $mu_str = "../{$mu_str}/"; goto TGWeS; X9xNs: global $_W, $_GPC; goto z6IfX; WOl0x: if (!$mu_str) { goto JPawe; } goto TpcwP; tsLBR: $mu_str = $settings['mu_str']; goto WOl0x; dadkh: $settings = $this->module['config']; goto tsLBR; zegfb: return $out; goto ZElJ0; ZElJ0: } public function domobileprint() { goto CcXyS; qYTSJ: require_once IA_ROOT . '/addons/mihua_mall/print' . DIRECTORY_SEPARATOR . 'CloudPrintClient.php'; goto Vh0LU; o1mUV: print_r($appKey); goto ChB0n; ChB0n: $printData = new CloudPrintClient($appId, $appKey); goto JQg21; wDnHI: print_r('====='); goto T9DNE; mmuKR: $content .= '^B2订单详情

'; goto yI3wt; dyVzW: $content .= '^H2合计：11' . '元
'; goto hg3aI; CcXyS: global $_W, $_GPC; goto eAq4k; Vh0LU: $appId = $settings['print_id']; goto PoOqg; Cruul: $content .= '--------------------------------
'; goto dyVzW; A7dKG: require_once IA_ROOT . '/addons/mihua_mall/print' . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php'; goto qYTSJ; g8i1j: $content .= '下单时间：' . '
'; goto B2UGf; eAq4k: $settings = $this->module['config']; goto A7dKG; qnUje: $content .= '--------------------------------
'; goto QxpVF; QxpVF: $content .= 'test'; goto Cruul; yI3wt: $content .= '^H2订单编号：2222' . '
'; goto g8i1j; B2UGf: $content .= '名称　　　　　 单价  数量 金额
'; goto qnUje; PoOqg: $appKey = $settings['print_key']; goto eN1sn; eN1sn: print_r($appId); goto o1mUV; T9DNE: print_r($result); goto YzgwX; hg3aI: $result = $printData->cloudPrint($content); goto hHAkj; JQg21: $content = '^N1^F1
'; goto mmuKR; hHAkj: print_r($content); goto wDnHI; YzgwX: } public function autoRegedit2($from_user, $flag = 1) { goto cepzK; Idvon: load()->func('communication'); goto h3qPp; K5VZd: E17V_: goto Td3wc; gpvdu: e_V8o: goto RP8gd; P3qAM: $member_data = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid and from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Mo0Tk; C57ZB: pdo_update('mc_mapping_fans', array("nickname" => $nickname, "acid" => $_W['acid']), array("fanid" => $myfansx['fanid'])); goto K5VZd; ruBXY: VPqpK: goto TaHhU; CvtuU: pdo_update('mc_members', array("avatar" => $info['headimgurl']), array("uid" => $myfansx['uid'])); goto fs0gg; XMdHY: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $nickname, "commission" => 0, "createtime" => TIMESTAMP, "flagtime" => TIMESTAMP, "shareid" => $seid, "status" => 1, "flag" => 1, "uid" => $uid); goto VfwOR; eidQj: goto VPqpK; goto xFDgT; AHGJD: LpThD: goto kWgcR; vW3dP: $mcfansx = pdo_fetch('SELECT avatar FROM ' . tablename('mc_members') . ' WHERE `uniacid` = :uniacid AND uid=:uid limit 1', array(":uniacid" => $_W['uniacid'], ":uid" => $myfansx['uid'])); goto BdNJM; dWGV1: $uid = mc_openid2uid($from_user); goto EqEuR; BdNJM: $seid = 0; goto BGB0p; BGB0p: $shareids = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_share_history') . ' WHERE  from_user=:from_user and uniacid=:uniacid limit 1', array(":from_user" => $from_user, ":uniacid" => $_W['uniacid'])); goto PbziE; w7rME: UQahW: goto uJwG0; PbziE: $nickname = $myfansx['nickname']; goto BWCVm; S4v11: $nickname = $info['nickname']; goto WWBJt; xFDgT: hueNg: goto bl2iU; YdKqD: if (empty($profile['id'])) { goto E1Unc; } goto hI17o; XHCy4: $data = array("realname" => $nickname); goto ytSFa; EqEuR: $myfansx = pdo_fetch('SELECT uid, fanid,openid,nickname,follow FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto vW3dP; X47RH: goto hXoot; goto jw31V; uJwG0: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto jKu4o; QZy3j: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto gpvdu; BWCVm: if (!(empty($nickname) || empty($mcfansx['avatar']))) { goto JfbAu; } goto j0Tip; C2dd9: $oauth2_url = 'https://api.weixin.qq.com/cgi-bin/user/info?access_token=' . $access_token . '&openid=' . $from_user . '&lang=zh_CN'; goto Idvon; bl2iU: pdo_update('mihua_mall_member', $data, array("from_user" => $from_user)); goto fPg63; Z6cZU: hXoot: goto Ur6yh; iXIhc: $member = $this->getMember($shareids['sharemid']); goto zwk_Q; F1FNV: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $nickname, "commission" => 0, "createtime" => TIMESTAMP, "flagtime" => TIMESTAMP, "shareid" => $seid, "status" => 1, "flag" => 0, "uid" => $uid); goto VQ7W5; WWBJt: if (empty($nickname)) { goto E17V_; } goto C57ZB; wvAr0: $sharemember = pdo_fetch('SELECT from_user,id FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND id=:id ', array(":uniacid" => $_W['uniacid'], ":id" => $seid)); goto JizUl; eJSff: load()->model('mc'); goto dWGV1; cepzK: global $_W, $_GPC; goto eJSff; mr4QI: if (empty($nickname)) { goto sI4ql; } goto XHCy4; ndL6F: h5mtf: goto X47RH; TaHhU: if (!(!empty($seid) && $seid != 0 && $theone['promotertimes'] == 1)) { goto MAygF; } goto wvAr0; LgO5g: $profile = pdo_fetch('SELECT from_user,id,realname,uid FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND from_user=:from_user ', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto YdKqD; EmQcn: IbnEu: goto w7rME; Td3wc: if (empty($info['headimgurl'])) { goto DysY9; } goto CvtuU; hI17o: if (!empty($profile['uid'])) { goto e_V8o; } goto jVzqJ; BCtFp: EHFnc: goto O1LzY; lrJeY: $seid = 0; goto EmQcn; h3qPp: $content = ihttp_get($oauth2_url); goto uQeHm; VfwOR: axEZi: goto P3qAM; uQeHm: $info = @json_decode($content['content'], true); goto S4v11; hJPdg: if ($flag == 1) { goto LpThD; } goto eidQj; Mo0Tk: if (!empty($member_data)) { goto hueNg; } goto hJPdg; jVzqJ: $data = array("uid" => $uid); goto QZy3j; ytSFa: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto qUS2_; jKu4o: if ($theone['promotertimes'] == 1) { goto VLCur; } goto F1FNV; RP8gd: if (!empty($profile['realname'])) { goto h5mtf; } goto mr4QI; xY195: JfbAu: goto LgO5g; l2WNg: goto UQahW; goto BCtFp; jw31V: E1Unc: goto lKj6g; EzLXV: VLCur: goto XMdHY; o11kw: $seid = 0; goto l2WNg; kWgcR: pdo_insert('mihua_mall_member', $data); goto ruBXY; qUS2_: sI4ql: goto ndL6F; fPg63: goto VPqpK; goto AHGJD; JizUl: $joinfans = pdo_fetch('SELECT openid,nickname FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto XeOFi; fs0gg: DysY9: goto xY195; j0Tip: $access_token = $this->get_weixin_token(); goto C2dd9; zwk_Q: if (!($member['flag'] != 1)) { goto IbnEu; } goto lrJeY; VQ7W5: goto axEZi; goto EzLXV; lKj6g: if (!empty($shareids['sharemid'])) { goto EHFnc; } goto o11kw; O1LzY: $seid = $shareids['sharemid']; goto iXIhc; XeOFi: MAygF: goto Z6cZU; Ur6yh: } protected function pay($params = array(), $mine = array()) { goto jikxG; dinG0: foreach ($cards as $key => &$val) { goto WifXj; QuWE9: goto SxoxI; goto DiXbe; yEsIO: $val['discount_cn'] = sprintf('%.2f', $params['fee'] * (1 - $val['extra']['discount'] * 0.01)); goto JniE3; L7p1s: $token[$key] = $val; goto wZYY2; DiXbe: sLTdB: goto yEsIO; uyZBi: egPFz: goto todLS; wZYY2: if (!($log['fee'] < $val['extra']['least_cost'] * 0.01)) { goto eHm7b; } goto Z4X79; JniE3: $coupon[$key] = $val; goto xVPwQ; B9YuP: unset($val['icon']); goto UQ36W; Z4X79: unset($token[$key]); goto AKOkK; AKOkK: eHm7b: goto QuWE9; xVPwQ: SxoxI: goto B9YuP; WifXj: if ($val['type'] == '1') { goto sLTdB; } goto gsumI; gsumI: $val['discount_cn'] = sprintf('%.2f', $val['extra']['reduce_cost'] * 0.01); goto L7p1s; UQ36W: unset($val['description']); goto uyZBi; todLS: } goto twHqW; ORYlC: $cards = activity_paycenter_coupon_available(); goto yTwe2; XGVbt: if (is_array($setting['payment'])) { goto Exxed; } goto zZyGW; e8iOb: $pars['type'] = ''; goto HLBWq; GNpVB: load()->model('module'); goto VrpTM; R2zCc: $setting = uni_setting($_W['uniacid'], array("payment", "creditbehaviors")); goto XGVbt; qNK_i: yqLUv: goto aKQaN; svebs: $callback = $_W['siteurl']; goto sXtzB; EvvU7: if (!empty($_W['fans']['uid'])) { goto fiI2d; } goto nfL4o; twHqW: LS_6S: goto qNK_i; LcvZ7: X2GYo: goto zdZs9; Phg9l: BUyCI: goto hjwXQ; cZ4Za: nBD5J: goto EvvU7; ncWuT: if (!($log['status'] == '1')) { goto tYNJP; } goto rOCqS; yTwe2: if (empty($cards)) { goto yqLUv; } goto dinG0; wBhPd: exit($site->{$method}($pars)); goto C5FkE; uBeWQ: $params['module'] = $this->module['name']; goto g_VCx; G1S7y: if ($this->inMobile) { goto EKhgB; } goto dfv2K; r0G2I: $pars = array(); goto Z3SXu; xOuEY: goto X2GYo; goto kR0HB; gGWi0: fiI2d: goto nJOA6; kR0HB: CputV: goto jKhbX; cKwTO: $we7_coupon_info = module_fetch('we7_coupon'); goto LUgvs; WsWDe: UmP7C: goto uBeWQ; IzJv0: $you = 0; goto Z_vxH; dfv2K: message('支付功能只能在手机上使用', '', ''); goto oEvUI; zdZs9: load()->model('activity'); goto GNpVB; fkWHR: $pay = $setting['payment']; goto cKwTO; g_VCx: if (!($params['fee'] <= 0)) { goto BUyCI; } goto r0G2I; KagTX: $params['_payopenid'] = $_openid; goto iMQgN; hjwXQ: $log = pdo_get('core_paylog', array("uniacid" => $_W['uniacid'], "module" => $params['module'], "tid" => $params['tid'])); goto yV9u1; zZyGW: message('没有有效的支付方式, 请联系网站管理员.', '', 'error'); goto PeziK; hPH1L: U4uPz: goto ncWuT; BrasW: $pars['result'] = 'success'; goto e8iOb; PpK_s: $_appid = trim($_GPC['appid']); goto KagTX; Ku0ly: $cfg = $this->module['config']; goto ap8E4; jikxG: global $_GPC, $_W; goto Ku0ly; Jc84g: tYNJP: goto R2zCc; iMQgN: $params['_appid'] = $_appid; goto LcvZ7; befLt: if (!empty($_GPC['sign'])) { goto CputV; } goto svebs; m3yFc: $credtis = mc_credit_fetch($_W['member']['uid']); goto PyNIb; nJOA6: if (!(!empty($pay['credit']['switch']) || !empty($pay['credit']['pay_switch']))) { goto vpKB1; } goto m3yFc; VrpTM: activity_coupon_type_init(); goto G1S7y; VssBi: $method = 'payResult'; goto dCqg6; yV9u1: if (!empty($log)) { goto U4uPz; } goto EOPiC; nfL4o: $pay['credit']['switch'] = false; goto gGWi0; sXtzB: $url = 'https://wex.hsyunfu.com/oauth/wex/login.do?ret_url=' . urlencode($callback); goto YjkVs; ap8E4: if (!($cfg['islanniu_hsyunfu'] == 1)) { goto UmP7C; } goto befLt; HLBWq: $pars['tid'] = $params['tid']; goto jkytY; dCqg6: if (!method_exists($site, $method)) { goto zrxYp; } goto wBhPd; PyNIb: vpKB1: goto IzJv0; Z3SXu: $pars['from'] = 'return'; goto BrasW; YjkVs: header('Location: ' . $url); goto IEaLi; EOPiC: $log = array("uniacid" => $_W['uniacid'], "acid" => $_W['acid'], "openid" => $_W['member']['uid'], "module" => $this->module['name'], "tid" => $params['tid'], "fee" => $params['fee'], "card_fee" => $params['fee'], "status" => "0", "is_usecard" => "0"); goto rzX2Q; PeziK: Exxed: goto fkWHR; jKhbX: $_openid = trim($_GPC['openid']); goto PpK_s; oRhrD: exit; goto AoguM; C5FkE: zrxYp: goto Phg9l; LUgvs: if (!(!empty($we7_coupon_info) && $cfg['islanniu_hsyunfu'] == 1)) { goto nBD5J; } goto ORYlC; oEvUI: EKhgB: goto WsWDe; rzX2Q: pdo_insert('core_paylog', $log); goto hPH1L; aKQaN: $cards_str = json_encode($cards); goto cZ4Za; rOCqS: message('这个订单已经支付成功, 不需要重复支付.', '', 'info'); goto Jc84g; jkytY: $site = WeUtility::createModuleSite($params['module']); goto VssBi; IEaLi: exit; goto xOuEY; Z_vxH: include $this->template('common/paycenter'); goto oRhrD; AoguM: } public function payResult($params) { goto Wo1Ro; YhGVI: Z_gm_: goto g3oHe; uWJ3l: goto Z_gm_; goto oyY0H; s0ZjS: cS51W: goto Fd_Os; N_icr: ECIQD: goto GVURd; Wo1Ro: load()->func('logging'); goto gs4p3; ppYvE: $_W['uniacid'] = $log['uniacid']; goto HySnV; uaFcU: $_W['openid'] = $params['user']; goto Sqz0J; gs4p3: logging_run($params); goto bvMD6; Fd_Os: goto hXnDA; goto TLSTv; HySnV: TPmjk: goto IjfSD; GVURd: Gpgus: goto ZL51Z; IjfSD: if (!(!empty($log) && $log['status'] == '1' && $log['fee'] == $params['fee'] || $params['type'] == 'delivery' && $log['fee'] == $params['fee'])) { goto qE0IP; } goto RRi_a; Bng8v: if (!($params['from'] == 'return')) { goto Gpgus; } goto elI3J; ZL51Z: qE0IP: goto GLlQh; V3XNm: $_W['siteroot'] = str_replace('addons/bm_payms', '', $_W['siteroot']); goto S1jdG; S1jdG: $_W['siteroot'] = str_replace('addons/lanniu_hsyunfu', '', $_W['siteroot']); goto uaFcU; QkAPv: asg6x: goto bJNRY; oyY0H: OvXxR: goto aLuXG; WexGf: if (!empty($_W['uniacid'])) { goto TPmjk; } goto ppYvE; W6So6: message('余额充值成功！', $this->createMobileUrl('balance_record'), 'success'); goto yJzHK; D93pM: if (strstr($id, 'ye')) { goto OvXxR; } goto sjDDk; kWp7N: $PayResult->payresult_ye($params); goto QkAPv; M73RX: NbW7Q: goto eDfNJ; bJNRY: n5_tV: goto Bng8v; nanFz: message('订单支付成功！', $this->createMobileUrl('mygroup', array("groupid" => $groupid['groupid'], "op" => "detail")), 'success'); goto s0ZjS; elI3J: if ($params['result'] == 'success' || $params['type'] == 'delivery') { goto wss4f; } goto D93pM; aLuXG: message('余额充值支败！', $this->createMobileUrl('balance_record'), 'error'); goto YhGVI; S6MxL: $log = pdo_fetch('select * from ' . tablename('core_paylog') . ' where  tid =:tid and module =:module ', array(":tid" => $params['tid'], "module" => "mihua_mall")); goto WexGf; Sqz0J: $id = $params['tid']; goto S6MxL; UVKQV: if (strstr($id, 'ye')) { goto tWNx5; } goto GYeun; TLSTv: tWNx5: goto ZxMOT; bvMD6: global $_W, $_GPC; goto V3XNm; RRi_a: $order = pdo_fetch('SELECT *  FROM ' . tablename('mihua_mall_order') . " WHERE ordersn = '{$id}' and uniacid = " . $_W['uniacid']); goto Egxnv; yJzHK: hXnDA: goto N_icr; GYeun: $PayResult->payresult_order($params, $order); goto FdO1A; zekLz: if (strstr($id, 'ye')) { goto y_zU6; } goto GoPIV; PqRCA: if (!($params['result'] == 'success' && $params['from'] == 'notify')) { goto n5_tV; } goto zekLz; FdO1A: if ($order['ordertype'] != 1) { goto NbW7Q; } goto VO71s; ZxMOT: $PayResult->payresult_ye($params); goto W6So6; u2ZqQ: y_zU6: goto kWp7N; mKmFt: goto asg6x; goto u2ZqQ; UR9Fo: goto cS51W; goto M73RX; Egxnv: $PayResult = new model_payResult(); goto PqRCA; VO71s: message('订单支付成功！', $this->createMobileUrl('myorder', array("status" => 6)), 'success'); goto UR9Fo; eDfNJ: $groupid = pdo_fetch('SELECT groupid  FROM ' . tablename('mihua_mall_order') . " WHERE ordersn = '{$id}' and uniacid = " . $_W['uniacid']); goto nanFz; g3oHe: goto ECIQD; goto DIrhq; GoPIV: $PayResult->payresult_order($params, $order); goto mKmFt; sjDDk: message('订单支付失败！', $this->createMobileUrl('myorder', array("status" => 0)), 'error'); goto uWJ3l; DIrhq: wss4f: goto UVKQV; GLlQh: } private function checkAuth() { goto X45aL; RLkQo: pdo_update('mc_mapping_fans', array("uid" => $uid), array("fanid" => $fanid)); goto j7hJC; K5zsF: pdo_insert('mc_mapping_fans', $post); goto HDJQf; SBZsx: if (empty($fan['uid'])) { goto otUEv; } goto o4KbS; JVc1a: $_W['openid'] = random(28); goto cBEo5; NUJt3: goto qKkad; goto RFjzA; iWilj: $_W['member']['uid'] = $uid; goto CIUvx; ld_Dt: $fan = pdo_get('mc_mapping_fans', array("openid" => $_W['openid'])); goto hecPj; cBEo5: NEz5V: goto izrTn; izrTn: $post = array("uniacid" => $_W['uniacid'], "updatetime" => time(), "openid" => $_W['openid'], "follow" => 0); goto K5zsF; RFjzA: NGaU3: goto vGcb3; x3Hi5: if (!empty($_W['openid'])) { goto NEz5V; } goto JVc1a; ygDJq: $setting = cache_load('unisetting:' . $_W['uniacid']); goto U9YYF; vGcb3: $fanid = $fan['fanid']; goto SHnJz; hecPj: if (!empty($fan)) { goto NGaU3; } goto x3Hi5; vhjfi: $_W['fans']['uid'] = $fan['uid']; goto yi5rS; j7hJC: mjvg3: goto E0UI6; E0UI6: PIacU: goto OJ1TS; U9YYF: if (empty($_W['member']['uid']) && empty($setting['passport']['focusreg'])) { goto aRLOo; } goto GRSep; SHnJz: qKkad: goto SBZsx; HDJQf: $fanid = pdo_insertid(); goto NUJt3; a0Y8_: goto PIacU; goto asXh3; rqTaV: otUEv: goto Upfyn; GRSep: checkauth(); goto a0Y8_; asXh3: aRLOo: goto ld_Dt; eVuyF: $uid = pdo_insertid(); goto iWilj; X45aL: global $_W; goto ygDJq; o4KbS: $_W['member']['uid'] = $fan['uid']; goto vhjfi; yi5rS: goto mjvg3; goto rqTaV; CIUvx: $_W['fans']['uid'] = $uid; goto RLkQo; Upfyn: pdo_insert('mc_members', array("uniacid" => $_W['uniacid'])); goto eVuyF; OJ1TS: } public function doMobilePay() { goto aW2sQ; xaXQH: $goodsTitle = pdo_fetchcolumn($sql, array(":id" => $goodsId, ":uniacid" => $_W['uniacid'])); goto A1VXx; NNGVG: $log['result'] = 'success'; goto v0sAf; j6NM_: $params['ordersn'] = $order['ordersn']; goto qmF60; RiAgD: $params['tid'] = $order['ordersn']; goto E476j; E476j: $params['user'] = $order['from_user']; goto q0eiW; nSb1C: if (!($order['paytype'] == 1 && $_W['fans']['credit2'] < $order['price'])) { goto JIa6n; } goto JzD9x; h0GSF: $cfg = $this->module['config']; goto LK9se; m4okS: $log = pdo_get('core_paylog', array("uniacid" => $_W['uniacid'], "module" => "mihua_mall", "tid" => $params['tid'])); goto cNBFI; mSQC6: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id and uniacid=:uniacid', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto i1koZ; mk5CK: $this->payResult($log); goto UXntT; X8skG: JIa6n: goto RfOUx; slewl: hsCEG: goto CigWb; qmF60: $params['virtual'] = $order['goodstype'] == 2 ? true : false; goto m4okS; aW2sQ: global $_W, $_GPC; goto ZLD87; fL1fR: $log['openid'] = $order['from_user']; goto NNGVG; EX52L: load()->model('mc'); goto MtNn5; GUc5j: $from_user = $_W['openid']; goto DyNgO; kAMbt: $log['status'] = 1; goto fL1fR; UrRJV: $this->bjpay($params, $order['sendtype']); goto wy3Iu; ZLD87: $this->checkAuth(); goto hV6NU; i1koZ: $goodsstr = ''; goto NU0Dq; aJ0hR: DPZOb: goto nSb1C; ECj0m: $profile = $this->getProfile(); goto cRSKW; RfOUx: if (!($order['price'] <= 0)) { goto MrUPf; } goto Y_60A; UXntT: exit; goto SVIIS; WIAqQ: message('抱歉，您的订单已经付款或是被关闭，请重新进入付款！', $this->createMobileUrl('myorder'), 'error'); goto slewl; q0eiW: $params['title'] = $goodsTitle; goto j6NM_; bf37Z: $sql = 'SELECT `title` FROM ' . tablename('mihua_mall_goods') . ' WHERE `id` = :id and uniacid=:uniacid'; goto xaXQH; CigWb: $sql = 'SELECT `goodsid` FROM ' . tablename('mihua_mall_order_goods') . ' WHERE `orderid` = :orderid and uniacid=:uniacid'; goto uEgbZ; uEgbZ: $goodsId = pdo_fetchcolumn($sql, array(":orderid" => $orderid, ":uniacid" => $_W['uniacid'])); goto bf37Z; hV6NU: $this->toflag(); goto GUc5j; cNBFI: if (!empty($log)) { goto DPZOb; } goto pFpXc; qVW0k: $paylog_id = pdo_insert('core_paylog', $log); goto aJ0hR; CmudW: $orderid = intval($_GPC['orderid']); goto mSQC6; LK9se: if (!empty($profile['id'])) { goto zsd00; } goto C3vcR; NU0Dq: $bodygoods = ''; goto fNFEv; fNFEv: if (!($order['status'] != '0')) { goto hsCEG; } goto WIAqQ; C3vcR: $this->autoRegedit($modulephp); goto ECj0m; MtNn5: $modulephp = 'pay'; goto h0GSF; pFpXc: $log = array("uniacid" => $_W['uniacid'], "acid" => $_W['acid'], "openid" => $order['from_user'], "module" => "mihua_mall", "tid" => $params['tid'], "fee" => $params['fee'], "card_fee" => $params['fee'], "status" => "0", "is_usecard" => "0"); goto qVW0k; v0sAf: $log['from'] = 'return'; goto mk5CK; A1VXx: $params['fee'] = $order['price']; goto RiAgD; JzD9x: message('抱歉，您帐户的余额不够支付该订单，请充值！', create_url('site/entry/charge', array("name" => "member", "uniacid" => $_W['uniacid'])), 'error'); goto X8skG; SVIIS: MrUPf: goto UrRJV; cRSKW: zsd00: goto FI5C1; Y_60A: pdo_update('core_paylog', array("status" => 1), array("module" => "mihua_mall", "tid" => $params['tid'])); goto kAMbt; FI5C1: $signPackage = $this->getSignPackage($modulephp); goto CmudW; DyNgO: $profile = $this->getProfile(); goto EX52L; wy3Iu: } public function sendshopmsg($id) { goto h9kAL; DQcTn: $from_user = $order['from_user']; goto dFKFs; yRcBS: jIfGx: goto sGzwt; UVUpQ: $user_data = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . '   WHERE from_user=:from_user', array(":from_user" => $order['from_user'])); goto bI1Jx; VzKj4: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE id ={$id}"); goto Jcgnb; vr_yQ: cXEA2: goto yokiy; jhJtL: if (!($openid != $order['from_user'])) { goto cXEA2; } goto xAl5t; bI1Jx: if (!($user_data['flag'] != 1)) { goto jWiIL; } goto FAk4k; EH8yL: $this->sendgmsptz($order['ordersn'], $order['price'], $realname, $openid); goto wV3sj; tvmpO: if (!$order['shareid2']) { goto SoLRI; } goto xB8k3; t6anj: jWiIL: goto mgHR1; mgHR1: goto VJn3g; goto RCmVG; hwBbe: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid3']} "); goto EH8yL; RCmVG: AqSGZ: goto sj0No; xB8k3: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid2']} "); goto by0Ka; I3Lez: $realname = pdo_fetchcolumn('select nickname from ' . tablename('mc_members') . " where uid ={$uid}"); goto DQcTn; Jcgnb: if (!$order) { goto jIfGx; } goto W_jY1; sj0No: VJn3g: goto yRcBS; Ym7HD: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid']} "); goto jhJtL; dFKFs: $profile = $this->getProfile($from_user); goto QIoyV; W_jY1: $uid = mc_openid2uid($order['from_user']); goto I3Lez; xAl5t: $this->sendgmsptz($order['ordersn'], $order['price'], $realname, $openid); goto vr_yQ; wV3sj: LP90J: goto UVUpQ; tgFfX: SoLRI: goto csLaA; IZDZu: if (!$order['shareid']) { goto Rt6XH; } goto Ym7HD; WGuU5: load()->model('mc'); goto VzKj4; csLaA: if (!$order['shareid3']) { goto LP90J; } goto hwBbe; yokiy: Rt6XH: goto tvmpO; QIoyV: if (empty($profile)) { goto AqSGZ; } goto IZDZu; h9kAL: global $_W, $_GPC; goto WGuU5; FAk4k: pdo_update('mihua_mall_member', array("flag" => 1, "uid" => $uid, "flagtime" => TIMESTAMP), array("from_user" => $order['from_user'])); goto t6anj; by0Ka: $this->sendgmsptz($order['ordersn'], $order['price'], $realname, $openid); goto tgFfX; sGzwt: } public function getShareId($from_user = "", $level = 1) { goto qU1wv; RawzA: k4LFV: goto Ma5zD; pURCY: if (!($level == 3)) { goto k4LFV; } goto e1eDf; Ma5zD: return 0; goto rxjxH; YEg8b: return $profile['shareid']; goto o06m6; YVJLs: if (!($level == 1)) { goto UaMyC; } goto YEg8b; GDRHf: Q2KNC: goto HiwrM; rxjxH: goto Q2KNC; goto QEzhb; BejrJ: if (!($level == 2 || $level == 3)) { goto ksDQI; } goto z4DLF; Bd_Lj: return $profile2['shareid']; goto MLMkM; NI9X0: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND 
		from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto YDDrC; o06m6: UaMyC: goto BejrJ; qU1wv: global $_W, $_GPC; goto FfUMa; fxm2r: return 0; goto XFcsM; f1LmA: if (!empty($profile2['shareid'])) { goto fkfRC; } goto fxm2r; MLMkM: Tjuy3: goto FpGvn; AOLrS: W5b2o: goto Ok2Ob; dvsvE: return 0; goto AOLrS; e1eDf: $profile3 = pdo_fetch('SELECT shareid FROM ' . tablename('mihua_mall_member') . ' WHERE  id=:sid', array(":sid" => $profile2['shareid'])); goto Z6cVK; FfUMa: if (!empty($from_user)) { goto H19fm; } goto k2pcV; z4DLF: $profile2 = pdo_fetch('SELECT shareid FROM ' . tablename('mihua_mall_member') . ' WHERE  id=:sid', array(":sid" => $profile['shareid'])); goto f1LmA; QEzhb: RQzsn: goto ZNyXQ; mHgUV: if (!($level == 2)) { goto Tjuy3; } goto Bd_Lj; gHbAw: H19fm: goto NI9X0; FpGvn: ksDQI: goto pURCY; YDDrC: if (empty($profile['shareid'])) { goto RQzsn; } goto YVJLs; Z6cVK: if (!empty($profile3['shareid'])) { goto W5b2o; } goto dvsvE; Ok2Ob: return $profile3['shareid']; goto RawzA; XFcsM: fkfRC: goto mHgUV; ZNyXQ: return 0; goto GDRHf; k2pcV: $from_user = $this->getFromUser(); goto gHbAw; HiwrM: } public function time_tran($the_time) { goto Jv4Z5; UuENx: $ret .= '<span class=\'hour\'>' + $hours + ' </span> ' + ':'; goto vB9aL; vqFbS: if (!($hours > 0)) { goto vJ3nr; } goto UuENx; V3jNQ: JqE22: goto EMy4s; LCGtE: if (!($mins > 0)) { goto s1Csr; } goto qUIGD; AW8sX: $remain = $remain % 3600; goto KCiQA; rj12U: if (!($days > 0)) { goto GxG7g; } goto IqD3V; sh36t: E4hSU: goto AW8sX; zBv1u: vhKml: goto xcT60; Ztz2y: $secs = '0' . $secs; goto zBv1u; vB9aL: vJ3nr: goto LCGtE; uGgcF: if (!(strlen($mins) <= 1)) { goto JqE22; } goto tFAFC; IqD3V: $ret .= '<span class=\'day\'>' + $days + ' </span>天 '; goto XLI2a; POiZl: $days = '0' . $days; goto Al55b; EvZAg: $hours = '0' . $hours; goto sh36t; xcT60: $ret = ''; goto rj12U; VrhyW: $remain = $timediff % 86400; goto y4LoQ; wbf12: if (!(strlen($secs) <= 1)) { goto vhKml; } goto Ztz2y; EMy4s: $secs = $remain % 60; goto wbf12; tFAFC: $mins = '0' . $mins; goto V3jNQ; ZEEg9: $ret .= '<span class=\'sec\'>' + $secs + ' </span> '; goto uKyr8; KCiQA: $mins = intval($remain / 60); goto uGgcF; z48bL: s1Csr: goto ZEEg9; Al55b: iNhQl: goto VrhyW; qUIGD: $ret .= '<span class=\'min\'>' + $mins + ' </span> ' + ':'; goto z48bL; zmuw5: if (!(strlen($hours) <= 1)) { goto E4hSU; } goto EvZAg; XLI2a: GxG7g: goto vqFbS; Dqyu6: $days = intval($timediff / 86400); goto VwmRb; VwmRb: if (!(strlen($days) <= 1)) { goto iNhQl; } goto POiZl; uKyr8: return array($ret, $timediff); goto Kxeb3; y4LoQ: $hours = intval($remain / 3600); goto zmuw5; Jv4Z5: $timediff = $the_time - time(); goto Dqyu6; Kxeb3: } public function bjpay($params = array(), $paytype) { goto l51Cv; neR1u: if (!($params['fee'] <= 0)) { goto e2dVf; } goto ROtzY; Kkxzo: $sql = 'SELECT * FROM ' . tablename('core_paylog') . ' WHERE `uniacid`=:uniacid AND `module`=:module AND `tid`=:tid'; goto Tmsxp; cWoq3: $log = pdo_fetch($sql, $pars); goto ki8TW; aMlj9: e2dVf: goto Z5MVa; Tmsxp: $pars = array(); goto AnfvQ; ROtzY: message('支付错误, 金额小于0'); goto aMlj9; gfcKW: $pars[':tid'] = $pars['tid']; goto cWoq3; Z5MVa: $params['module'] = $this->module['name']; goto Kkxzo; ki8TW: if (!(!empty($log) && $log['status'] == '1')) { goto swsOE; } goto A_nAK; l51Cv: global $_W; goto neR1u; rRfPF: swsOE: goto gWwPo; B_Ipj: $pars[':module'] = $params['module']; goto gfcKW; CJUNp: include $this->template($template); goto bUqal; AnfvQ: $pars[':uniacid'] = $_W['uniacid']; goto B_Ipj; gWwPo: $template = $this->selectTemplate('bjpay'); goto CJUNp; A_nAK: message('这个订单已经支付成功, 不需要重复支付.'); goto rRfPF; bUqal: } public function shareClick($mid, $joinway = 0) { goto izXeb; Z6bJr: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto rucB1; zyFeU: ubhCh: goto Jmnzu; dtEtU: if (!empty($joinway)) { goto ubhCh; } goto NjOhv; dh9r_: pdo_update('mihua_mall_member', array("clickcount" => $member['clickcount'] + 1), array("id" => $mid)); goto aNvmC; jvat7: $share = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_share_history') . ' WHERE from_user=:from_user and uniacid=:uniacid', array(":from_user" => $fromuser, ":uniacid" => $_W['uniacid'])); goto f3UCV; bfdN5: if (empty($fans)) { goto ZkUaj; } goto Ue3xr; Ue3xr: load()->model('mc'); goto kG06Y; y56js: pdo_update('mc_members', array("credit1" => $credit['credit1'] + $theone['clickcredit']), array("uid" => $fans['uid'], "uniacid" => $_W['uniacid'])); goto vhtIM; aV2uM: fTxgt: goto l_khN; CTb3a: if (!(!empty($member['id']) && $member['status'] == 1)) { goto PL8P1; } goto dh9r_; vhtIM: ZkUaj: goto U2azt; l_khN: PL8P1: goto tO0MN; izXeb: global $_W, $_GPC; goto dtEtU; U2azt: dihdZ: goto TghVM; d0oWh: $fans = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE  uniacid = :uniacid and openid=:from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $member['from_user'])); goto bfdN5; kG06Y: $credit = mc_credit_fetch($fans['uid']); goto y56js; f3UCV: $member = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . " WHERE uniacid = '{$_W['uniacid']}' AND id = '{$mid}'"); goto iSNSq; rucB1: if (!(empty($share['sharemid']) && !empty($mid) && empty($users['id']))) { goto u34Gz; } goto CTb3a; iSNSq: $users = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . " WHERE uniacid = '{$_W['uniacid']}' AND from_user = '{$fromuser}' limit 1"); goto Z6bJr; OcwsG: pdo_insert('mihua_mall_share_history', $data); goto aV2uM; tO0MN: u34Gz: goto bLfhb; NjOhv: $joinway = 0; goto zyFeU; aNvmC: if (empty($theone['clickcredit'])) { goto dihdZ; } goto d0oWh; TghVM: if (!($member['flag'] == 1)) { goto fTxgt; } goto hq9Zz; Jmnzu: $fromuser = $this->getFromUser(); goto jvat7; hq9Zz: $data = array("uniacid" => $_W['uniacid'], "from_user" => $fromuser, "sharemid" => $mid, "joinway" => $joinway); goto OcwsG; bLfhb: } public function checkisAgent($from_user, $profile, $status = 1) { goto ltIEZ; NyqC2: $joinfans = pdo_fetch('SELECT openid,nickname FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto NaCMm; hoLTC: if (!($commtime['promotermoney'] <= $totalmoney && $commtime['promotertimes'] == 3)) { goto Fq43d; } goto hLICY; w1lg2: $total = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto u1Cgz; OEJI4: RQlH_: goto wQKhO; hMLtT: $flag = $profile['flag']; goto BncIx; LyIwG: $sharemember = pdo_fetch('SELECT from_user,id FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND id=:id ', array(":uniacid" => $_W['uniacid'], ":id" => $profile['shareid'])); goto NyqC2; HMjFG: nb86d: goto VjboK; NNltn: TPQVZ: goto NB22p; VjboK: if (!($commtime['promotercount'] <= $total && $commtime['promotertimes'] == 2)) { goto fizjD; } goto FrcYF; hLICY: $toagent = 1; goto NNaoS; ltIEZ: global $_W, $_GPC; goto hMLtT; BncIx: if (!(!empty($profile['id']) && $profile['flag'] == 0)) { goto TPQVZ; } goto w1lg2; u1Cgz: $totalmoney = pdo_fetchcolumn('SELECT sum(price) FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto x6EB3; nuDnn: if (!($total >= 1 && $commtime['promotertimes'] == 0)) { goto nb86d; } goto K3_Z1; WfH5c: pdo_update('mihua_mall_member', array("flagtime" => $flagtime, "flag" => 1), array("id" => $profile['id'])); goto AvK_1; nXZwr: T_nIx: goto WfH5c; NB22p: return $flag; goto VqAtp; l8KBs: fizjD: goto hoLTC; pnQmM: $toagent = 0; goto nuDnn; NNaoS: Fq43d: goto vGdz0; h0sCq: dvVpD: goto NNltn; FrcYF: $toagent = 1; goto l8KBs; Kt3tt: $this->sendtjrtzdl($joinfans['nickname'], $sharemember['from_user']); goto D9JVA; Yc86e: $lastorder = pdo_fetch('SELECT createtime FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user order by createtime desc limit 1", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto pnQmM; x6EB3: $commtime = pdo_fetch('select promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto Yc86e; EcL8o: $flagtime = $lastorder['createtime']; goto CGeL_; PkbqR: $flagtime = TIMESTAMP; goto nXZwr; NaCMm: if (!(!empty($sharemember) && !empty($sharemember['id']) && !empty($joinfans['nickname']))) { goto PWhqn; } goto Kt3tt; KI50I: $toagent = 1; goto OEJI4; vGdz0: if (!($commtime['promotertimes'] == 1)) { goto RQlH_; } goto KI50I; AvK_1: $flag = 1; goto LyIwG; K3_Z1: $toagent = 1; goto HMjFG; wQKhO: if (!($toagent == 1)) { goto dvVpD; } goto EcL8o; D9JVA: PWhqn: goto h0sCq; CGeL_: if (!empty($flagtime)) { goto T_nIx; } goto PkbqR; VqAtp: } public function checkAgent($from_user, $profile, $status = 1) { goto lyM7Q; li31m: gjLjq: goto MhFmU; lyM7Q: global $_W, $_GPC; goto Fue13; MhFmU: if (!($commtime['promotercount'] <= $total && $commtime['promotertimes'] == 2)) { goto Gav6r; } goto W9Mjv; Fue13: $flag = $profile['flag']; goto ITmeL; w4_5H: $totalmoney = pdo_fetchcolumn('SELECT sum(price) FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto TquQl; DXnhM: if (!($commtime['promotermoney'] <= $totalmoney && $commtime['promotertimes'] == 3)) { goto GMlhU; } goto VB2oY; DN9u4: GMlhU: goto WDGnp; x0bmj: return $toagent; goto CvArf; E0s8W: $toagent = 1; goto li31m; EDD4g: $lastorder = pdo_fetch('SELECT createtime FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user order by createtime desc limit 1", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Wu_ga; dEFk3: mj9WW: goto x0bmj; W9Mjv: $toagent = 1; goto rx90R; rx90R: Gav6r: goto DXnhM; TquQl: $commtime = pdo_fetch('select promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto EDD4g; T_grd: if (!($total >= 1 && $commtime['promotertimes'] == 0)) { goto gjLjq; } goto E0s8W; ITmeL: $total = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE status= '{$status}' AND  uniacid = :uniacid  AND from_user = :from_user", array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto w4_5H; F9LNM: $toagent = 1; goto dEFk3; VB2oY: $toagent = 1; goto DN9u4; Wu_ga: $toagent = 0; goto T_grd; WDGnp: if (!($commtime['promotertimes'] == 1)) { goto mj9WW; } goto F9LNM; CvArf: } public function getMid() { goto Nj6tH; lBiJb: $profile = $this->getProfile(); goto VfqYk; kTt4Q: if (empty($_COOKIE['mid_' . mihua_mall_VERSION . $_W['uniacid']])) { goto IHJmx; } goto OPBga; AHP6_: return $profile['id']; goto m2UoC; m2UoC: UPJdG: goto EMc9p; n0FLb: IHJmx: goto lBiJb; q4n1w: goto UPJdG; goto n0FLb; VfqYk: setcookie('mid_' . mihua_mall_VERSION . $_W['uniacid'], $profile['id'], time() + 3600); goto AHP6_; OPBga: return $_COOKIE['mid_' . mihua_mall_VERSION . $_W['uniacid']]; goto q4n1w; Nj6tH: global $_W, $_GPC; goto kTt4Q; EMc9p: } public function getMember($mid) { goto PlJjn; pnOzq: return $profile; goto banh_; PlJjn: global $_W; goto UovzH; UovzH: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND id = :id', array(":uniacid" => $_W['uniacid'], ":id" => $mid)); goto pnOzq; banh_: } public function getMemberByFid($from_user) { goto uMRTF; D1WXb: return $profile; goto kBecy; uMRTF: global $_W; goto eW7g1; eW7g1: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto D1WXb; kBecy: } public function getProfile($from_user = "") { goto LoI70; kF4n3: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto r8CA_; NylHD: Th2vd: goto Njy4F; O_JxZ: pdo_delete('mc_mapping_fans', array("fanid" => $checkdelfansid[$a]['fanid'])); goto Dhan0; aSC0X: yw1Lw: goto JRtyn; cN61Y: cZ2kA: goto zcpL2; c5QCJ: yGhaJ: goto HVjHa; s124I: goto yw1Lw; goto cN61Y; Xrmhj: a2YiY: goto OPVmv; rraBZ: pdo_insert('mc_members', $row); goto x2dnO; OPVmv: return $profile; goto Sb6d9; Njy4F: if ($myfans) { goto qGBIC; } goto cVRsp; xPby9: $uid = pdo_insertid(); goto sR8Ip; HVjHa: if (!(!empty($profile['id']) && !empty($from_user))) { goto a2YiY; } goto bolyl; Y1Svz: mT8B4: goto dzN9Z; r8CA_: if (!(!empty($profile['id']) && empty($_COOKIE['mid_' . mihua_mall_VERSION . $_W['uniacid']]))) { goto mT8B4; } goto RmoYp; zJZkf: $myfans = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE openid = :from_user', array(":from_user" => $from_user)); goto SqQty; x2dnO: $uid = pdo_insertid(); goto jcfzX; bolyl: $fansscount = pdo_fetchcolumn('SELECT count(fanid) FROM ' . tablename('mc_mapping_fans') . ' WHERE uniacid = :uniacid AND openid = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto JjLjd; z4LMB: $checkdelfansid = pdo_fetchall('SELECT fanid FROM ' . tablename('mc_mapping_fans') . ' WHERE uniacid = :uniacid AND openid = :from_user order by fanid ', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Yph1e; RmoYp: setcookie('mid_' . mihua_mall_VERSION . $_W['uniacid'], $profile['id'], time() + 3600); goto Y1Svz; JjLjd: if (!($fansscount > 1)) { goto U4Rua; } goto z4LMB; LoI70: global $_W, $_GPC; goto wu3pY; hRHUd: qGBIC: goto Xrmhj; JRtyn: if (!($a < $fansscount)) { goto cZ2kA; } goto O_JxZ; MXbyl: $row = array("uniacid" => $_W['uniacid'], "nickname" => $profile['realname'], "realname" => $profile['realname'], "gender" => 0, "salt" => random(8), "createtime" => TIMESTAMP, "email" => time() . random(8) . '@we7.cc', "password" => random(8)); goto uAJWb; SqQty: if (!(empty($myfans['uid']) && $from_user && $myfans['fanid'])) { goto Th2vd; } goto MXbyl; cVRsp: $row = array("uniacid" => $_W['uniacid'], "nickname" => $profile['realname'], "realname" => $profile['realname'], "gender" => 0, "salt" => random(8), "createtime" => TIMESTAMP, "email" => time() . random(8) . '@we7.cc', "password" => random(8)); goto rraBZ; uAJWb: pdo_insert('mc_members', $row); goto xPby9; R3xjx: $a++; goto s124I; V0GgO: EsjQf: goto kF4n3; zcpL2: U4Rua: goto zJZkf; jcfzX: $row2 = array("uid" => $uid, "openid" => $from_user, "uniacid" => $_W['uniacid'], "acid" => $_W['acid'], "nickname" => $profile['realname'], "salt" => $row['salt']); goto BumH_; dzN9Z: if (!($profile['flag'] == 1 && ($profile['flagtime'] == 0 || empty($profile['flagtime'])) && !empty($profile['id']))) { goto yGhaJ; } goto UUJSX; Yph1e: $a = 1; goto aSC0X; Dhan0: pbmBt: goto R3xjx; sR8Ip: pdo_update('mc_mapping_fans', array("uid" => $uid), array("openid" => $from_user, "uniacid" => $_W['uniacid'])); goto NylHD; wu3pY: if (!empty($from_user)) { goto EsjQf; } goto CSAK9; CSAK9: $from_user = $this->getFromUser(); goto V0GgO; UUJSX: pdo_update('mihua_mall_member', array("flagtime" => TIMESTAMP), array("id" => $profile['id'])); goto c5QCJ; BumH_: pdo_insert('mc_mapping_fans', $row2); goto hRHUd; Sb6d9: } public function getParentNickName($from_user) { goto IHj_O; LYga7: return $myfansx['realname']; goto HvQbR; IHj_O: global $_W; goto GdVs5; GdVs5: $myfansx = pdo_fetch('SELECT shareid FROM ' . tablename('mihua_mall_member') . ' WHERE uniacid = :uniacid and from_user =:from_user  limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto N1uuF; EnC2B: return '-'; goto Mzk8Y; HvQbR: UM0qt: goto dxEu1; VtppI: Yk3LB: goto PWWuM; Mzk8Y: goto UM0qt; goto VtppI; N1uuF: if (!empty($myfansx['shareid']) && $myfansx['shareid'] != 0) { goto Yk3LB; } goto EnC2B; PWWuM: $myfansx = pdo_fetch('SELECT realname FROM ' . tablename('mihua_mall_member') . ' WHERE uniacid = :uniacid and id =:shareid  limit 1', array(":uniacid" => $_W['uniacid'], ":shareid" => $myfansx['shareid'])); goto LYga7; dxEu1: } public function getLevel($fanscount) { goto zcBhj; bSLij: if (!empty($myfansx['medal_name'])) { goto Imv7Z; } goto uCFRK; nxZtC: goto Jkj02; goto qZumD; p4wkt: Jkj02: goto hM6xl; X55SF: $myfansx = pdo_fetch('SELECT medal_name FROM ' . tablename('mihua_mall_phb_medal') . ' WHERE uniacid = :uniacid and  fans_count<=:fans_count order by fans_count desc  limit 1', array(":uniacid" => $_W['uniacid'], ":fans_count" => $fanscount)); goto bSLij; WOKLC: return $myfansx['medal_name']; goto p4wkt; zcBhj: global $_W; goto X55SF; qZumD: Imv7Z: goto WOKLC; uCFRK: return '普通代理'; goto nxZtC; hM6xl: } public function autoRegedit($fromaction) { goto RFJTp; egN8q: goto Y2mc0; goto z7wqf; qukor: $seid = $shareids['sharemid']; goto Xj_os; Xj_os: $member = $this->getMember($shareids['sharemid']); goto nopZV; L8vL_: BxBFw: goto qukor; ZVSgR: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto M3D8l; jpTWH: $member_data = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid and from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto joGUH; gshsY: XgDKp: goto Za9Th; JRwwn: pdo_update('mihua_mall_member', $data, array("from_user" => $from_user)); goto ruxx2; Za9Th: aHLRa: goto egN8q; kCz1K: if (empty($profile['realname'])) { goto Iafz7; } goto BJWnD; i488r: if (!(!empty($sharemember) && !empty($sharemember['id']) && !empty($joinfans['nickname']))) { goto FE1m0; } goto jNYfT; D1_kX: x00D0: goto JRwwn; kav1J: SGPNG: goto r9tl0; yESnG: if (empty($nickname)) { goto SGPNG; } goto PsmEw; AIpS1: $access_token = $this->get_weixin_token(); goto e_G2U; UjvGC: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $nickname, "commission" => 0, "createtime" => TIMESTAMP, "flagtime" => TIMESTAMP, "shareid" => $seid, "status" => 1, "flag" => 1, "uid" => $uid); goto Gmis4; PsmEw: pdo_update('mc_mapping_fans', array("nickname" => $nickname, "acid" => $_W['acid']), array("fanid" => $myfansx['fanid'])); goto kav1J; SC_mH: if ($from_user) { goto ugeRR; } goto KL71Z; y_ujw: goto v2cQD; goto L8vL_; PX19l: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $nickname, "commission" => 0, "createtime" => TIMESTAMP, "flagtime" => TIMESTAMP, "shareid" => $seid, "status" => 1, "flag" => 0, "uid" => $uid); goto oBK52; M3D8l: if ($theone['promotertimes'] == 1) { goto GGKqC; } goto PX19l; Sn1A5: $profile = pdo_fetch('SELECT from_user,id,realname,uid FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND from_user=:from_user ', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto r7PaL; viGeO: NZuIs: goto toDAj; Em0r0: $seid = 0; goto z_KTY; imSjm: yakGc: goto byoHn; nopZV: if (!($member['flag'] != 1)) { goto NZuIs; } goto BtFCB; L0Hi1: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto gshsY; Ey2ML: $nickname = $myfansx['nickname']; goto txGn2; r9tl0: if (empty($info['headimgurl'])) { goto wdAsn; } goto CdLiw; Fka6R: if (empty($nickname)) { goto XgDKp; } goto z52Ve; kwD3s: pdo_insert('mihua_mall_member', $data); goto vkZQj; lRt3u: FE1m0: goto imSjm; dgr29: GGKqC: goto UjvGC; r7PaL: if (empty($profile['id'])) { goto IQ5fw; } goto llq3P; byoHn: Y2mc0: goto Ou0BU; z_KTY: $shareids = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_share_history') . ' WHERE  from_user=:from_user and uniacid=:uniacid limit 1', array(":from_user" => $from_user, ":uniacid" => $_W['uniacid'])); goto Ey2ML; KL71Z: goto b2u5V; goto D1_kX; Gmis4: nj1mD: goto jpTWH; n5CF_: $nickname = $info['nickname']; goto yESnG; NYiOX: goto aHLRa; goto RXC2D; J4S7n: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto hKkL3; oBK52: goto nj1mD; goto dgr29; JfgPc: load()->model('mc'); goto kHRTg; hKkL3: v3SBc: goto kCz1K; llq3P: if (!empty($profile['uid'])) { goto v3SBc; } goto KR_Cz; RXC2D: Iafz7: goto Fka6R; ruxx2: goto b2u5V; goto FzH1w; Xq7al: $joinfans = pdo_fetch('SELECT openid,nickname FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto i488r; CdLiw: pdo_update('mc_members', array("avatar" => $info['headimgurl']), array("uid" => $myfansx['uid'])); goto gyADi; gUwbI: $this->checkisAgent($from_user, $profile); goto qC1Dg; Dsst2: if (!empty($shareids['sharemid'])) { goto BxBFw; } goto YgD7Q; BtFCB: $seid = 0; goto viGeO; z52Ve: $data = array("realname" => $nickname); goto L0Hi1; J2LMf: $sharemember = pdo_fetch('SELECT from_user,id FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND id=:id ', array(":uniacid" => $_W['uniacid'], ":id" => $seid)); goto Xq7al; kFMzw: $info = @json_decode($content['content'], true); goto n5CF_; RFJTp: global $_W, $_GPC; goto JfgPc; Y1MYn: Of80L: goto Sn1A5; u8WvQ: $uid = mc_openid2uid($from_user); goto reZq_; KR_Cz: $data = array("uid" => $uid); goto J4S7n; jNYfT: $this->sendtjrtzdl($joinfans['nickname'], $sharemember['from_user']); goto lRt3u; e_G2U: $oauth2_url = 'https://api.weixin.qq.com/cgi-bin/user/info?access_token=' . $access_token . '&openid=' . $from_user . '&lang=zh_CN'; goto MaLKm; joGUH: if (!empty($member_data)) { goto x00D0; } goto SC_mH; MaLKm: load()->func('communication'); goto TTiOB; z7wqf: IQ5fw: goto Dsst2; reZq_: $myfansx = pdo_fetch('SELECT fanid,openid,nickname,follow FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Em0r0; TTiOB: $content = ihttp_get($oauth2_url); goto kFMzw; FzH1w: ugeRR: goto kwD3s; txGn2: if (!empty($nickname)) { goto Of80L; } goto AIpS1; BJWnD: $nickname = $profile['realname']; goto NYiOX; toDAj: v2cQD: goto ZVSgR; D1kSU: if (!(!empty($seid) && $seid != 0 && $theone['promotertimes'] == 1)) { goto yakGc; } goto J2LMf; kHRTg: $from_user = $this->getFromUser(); goto u8WvQ; gyADi: wdAsn: goto Y1MYn; YgD7Q: $seid = 0; goto y_ujw; vkZQj: b2u5V: goto D1kSU; Ou0BU: $profile = $this->getProfile(); goto gUwbI; qC1Dg: } private function memberQrcode($from_user) { goto QF3qz; IRSuj: $rule = pdo_fetch('SELECT * from ' . tablename('mihua_mall_channel') . ' where msgtype=:msgtype and isdel=0  and uniacid=:uniacid  order by channel desc', array("uniacid" => $uniacid, "msgtype" => 10)); goto Jo0D0; hN7AI: $ch = pdo_fetch('select * from ' . tablename('mihua_mall_channel') . ' WHERE channel=:channel', array(":channel" => $rule['channel'])); goto omn0b; I_AKc: $uniacid = $_W['uniacid']; goto IRSuj; mLE_D: $bg = $rule['bg']; goto PkkId; AZYLJ: $qr_adv = Qr_code::qrcode_adv($_W['attachurl'], $uniacid, $from_user, $bg, $qr_file, $ch['channel']); goto QuL91; PkkId: $this->account = WeAccount::create($_W['acid']); goto GmhBK; GmhBK: $weixin_qr = $this->account->barCodeCreateFixed($barcode); goto IMKbt; IMKbt: $qr_file = 'https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=' . $weixin_qr['ticket']; goto AZYLJ; hf8jA: $profile = $this->getProfile(); goto I_AKc; gkPiR: WIuWh: goto oh6vV; omn0b: if (empty($ch['channel'])) { goto WIuWh; } goto mLE_D; QuL91: return $qr_adv; goto gkPiR; VzCQX: load()->classs('account'); goto hf8jA; Jo0D0: $barcode = array("action_name" => "QR_LIMIT_SCENE", "action_info" => array("scene" => array("scene_id" => $profile['id']))); goto hN7AI; OqZ4d: load()->model('mc'); goto VzCQX; QF3qz: global $_W; goto OqZ4d; oh6vV: } public function encode_channel_param($gpc) { $params = array("qrleft" => intval($gpc['qrleft']), "qrtop" => intval($gpc['qrtop']), "qrwidth" => intval($gpc['qrwidth']), "qrheight" => intval($gpc['qrheight']), "avatarleft" => intval($gpc['avatarleft']), "avatartop" => intval($gpc['avatartop']), "avatarwidth" => intval($gpc['avatarwidth']), "avatarheight" => intval($gpc['avatarheight']), "avatarenable" => intval($gpc['avatarenable']), "nameleft" => intval($gpc['nameleft']), "nametop" => intval($gpc['nametop']), "namesize" => intval($gpc['namesize']), "namecolor" => intval($gpc['namecolor']), "nameenable" => intval($gpc['nameenable'])); return serialize($params); } public function get_weixin_token() { goto gqW90; BPbaz: exit('升级中...'); goto f8jH6; FE71P: $access_token = $accObj->fetch_token(); goto Rm2pz; f8jH6: goto Yl1wA; goto EV60h; Grr88: $accObj = WeixinAccount::create($acid); goto FE71P; YTaBW: load()->classs('weixin.account'); goto Grr88; KCwHb: Yl1wA: goto qamNF; fxXUF: if ($acid) { goto I3uNb; } goto BPbaz; gqW90: global $_W, $_GPC; goto Cpntv; Rm2pz: return $access_token; goto KCwHb; EV60h: I3uNb: goto YTaBW; Cpntv: $acid = pdo_fetchcolumn('select acid from ' . tablename('account') . " where uniacid ={$_W['uniacid']} "); goto fxXUF; qamNF: } public function getSignPackage($urlaction = "list", $datas = array(), $imgUrl = "", $title = "") { goto l7oOH; vz2qk: $nonceStr = $_W['account']['jssdkconfig']['nonceStr']; goto Dx3mz; neyqm: return $signPackage; goto rvH_y; m99lV: if (!empty($title)) { goto w2bJG; } goto Sm8jW; Xos0Q: w2bJG: goto Gbswa; XpNLY: m_Ucd: goto D9yxE; arkWp: k11Gu: goto Potgj; Gbswa: if (!empty($imgUrl)) { goto k11Gu; } goto ijzIB; ijzIB: $imgUrl = $_W['attachurl'] . $cfg['logo']; goto arkWp; Potgj: $datas['mid'] = $mid; goto fHw48; brXvt: $timestamp = $_W['account']['jssdkconfig']['timestamp']; goto vz2qk; fHw48: $signPackage = array("appId" => $_W['account']['jssdkconfig']['appId'], "nonceStr" => $_W['account']['jssdkconfig']['nonceStr'], "timestamp" => $_W['account']['jssdkconfig']['timestamp'], "title" => $title, "imgUrl" => $imgUrl, "link" => $_W['siteroot'] . 'app/' . $this->createMobileUrl($urlaction, $datas, true), "signature" => $_W['account']['jssdkconfig']['signature'], "description" => $cfg['description']); goto neyqm; Dx3mz: $mid = $this->getMid(); goto J9ANi; D9yxE: $cfg = $this->module['config']; goto m99lV; Sm8jW: $title = $_W['account']['name']; goto Xos0Q; J9ANi: if (!empty($datas)) { goto m_Ucd; } goto YBL2k; YBL2k: $datas = array("id" => $mid); goto XpNLY; l7oOH: global $_W, $_GPC; goto brXvt; rvH_y: } public function createNonceStr($length = 16) { goto zQAp6; BBSU2: $result = $_W['account']['jssdkconfig']; goto YADK2; YADK2: return $result['nonceStr']; goto KD9Ga; zQAp6: global $_W; goto BBSU2; KD9Ga: } public function get_js_ticket() { goto iycsV; SZuHJ: return $js_info[1]; goto U1Y9z; iycsV: global $_W; goto k24QQ; k24QQ: $js_info = unserialize($_W['account']['jsapi_ticket']); goto SZuHJ; U1Y9z: } public function getAddressSignInfo($code, $url, $signPackage) { goto eTTut; Zu2ws: $Parameters['url'] = $url; goto QRQN7; QRQN7: ksort($Parameters); goto ZMRzL; k2dvo: $Parameters = array(); goto VYLe0; wzSxi: $result_ = json_encode($infoarray); goto jQ2Cn; VYLe0: $Parameters['accesstoken'] = $accesstoken; goto j3yid; jQ2Cn: return $result_; goto mRkDT; QSp5s: $accesstoken = $token['access_token']; goto IBGKx; IBGKx: $noncestr = $this->createNonceStr(6); goto k2dvo; b3D3D: $infoarray = array("appId" => $signPackage['appId'], "scope" => "jsapi_address", "signType" => "sha1", "addrSign" => $addrSign, "timeStamp" => '' . $signPackage['timestamp'], "nonceStr" => $noncestr); goto wzSxi; eTTut: $token = $this->getToken($code); goto QSp5s; hlAzu: $addrSign = sha1($String); goto b3D3D; ZMRzL: $String = $this->formatBizQueryParaMap($Parameters, false); goto hlAzu; v521n: $Parameters['timestamp'] = $signPackage['timestamp']; goto Zu2ws; j3yid: $Parameters['appid'] = $signPackage['appId']; goto eSUmt; eSUmt: $Parameters['noncestr'] = $noncestr; goto v521n; mRkDT: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto La4wR; DZxq1: return $reqPar; goto AyAUy; La4wR: $buff = ''; goto YfuJ_; H11kA: if (!(strlen($buff) > 0)) { goto UQNQz; } goto F2uMh; IgqmW: UQNQz: goto DZxq1; RUMXN: $reqPar; goto H11kA; F2uMh: $reqPar = substr($buff, 0, strlen($buff) - 1); goto IgqmW; bM3pf: foreach ($paraMap as $k => $v) { goto MN11O; swjhM: fIl5E: goto nXXuG; MN11O: if (!$urlencode) { goto o_GKi; } goto fmpAN; fmpAN: $v = urlencode($v); goto Zl0S9; Zl0S9: o_GKi: goto jxPZK; jxPZK: $buff .= $k . '=' . $v . '&'; goto swjhM; nXXuG: } goto csCUq; csCUq: kJUzW: goto RUMXN; YfuJ_: ksort($paraMap); goto bM3pf; AyAUy: } public function getToken($code) { goto WnfUC; ieIjm: $oauth2_code = 'https://api.weixin.qq.com/sns/oauth2/access_token?appid=' . $appid . '&secret=' . $secret . '&code=' . $code . '&grant_type=authorization_code'; goto mV8CB; WnfUC: global $_W, $_GPC; goto GJQ4N; YHv3u: if (!(empty($appid) || empty($secret))) { goto BL5PG; } goto Z7X4n; u4fHt: BL5PG: goto ieIjm; eQOV9: $secret = $_W['account']['secret']; goto YHv3u; GJQ4N: $appid = $_W['account']['key']; goto eQOV9; mV8CB: load()->func('communication'); goto vt6IF; AbLG6: $token = @json_decode($content['content'], true); goto WiGZ6; vt6IF: $content = ihttp_get($oauth2_code); goto AbLG6; WiGZ6: return $token; goto S1kqn; Z7X4n: message('微信公众号没有配置公众号AppId和公众号AppSecret!'); goto u4fHt; S1kqn: } public function getUserTokenForAddr() { goto ZPI0I; MedQd: $oauth2_code = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=' . $appid . '&redirect_uri=' . urlencode($url) . '&response_type=code&scope=snsapi_base&state=0#wechat_redirect'; goto a9Rjo; oc8Bs: ilND4: goto Eit2D; KZSE6: $appid = $_W['account']['key']; goto dVmXq; dVmXq: $secret = $_W['account']['secret']; goto N5EtY; FiPpn: message('微信公众号没有配置公众号AppId和公众号AppSecret!'); goto oc8Bs; Eit2D: $url = $_W['siteroot'] . 'app/index.php?' . $_SERVER['QUERY_STRING']; goto MedQd; a9Rjo: header("location:{$oauth2_code}"); goto vRmGV; N5EtY: if (!(empty($appid) || empty($secret))) { goto ilND4; } goto FiPpn; ZPI0I: global $_W, $_GPC; goto KZSE6; vRmGV: } public function getFromUser($state = 0) { goto JXhxE; JXhxE: global $_W; goto SyVHm; SyVHm: if (!$_W['openid']) { goto weRcJ; } goto UL921; UL921: return $_W['openid']; goto TBmx2; TBmx2: weRcJ: goto rT9Vy; rT9Vy: } public function getQr_code() { goto rC70e; pPZrV: if (!empty($qr_code)) { goto DFFj_; } goto JCncR; Prm_z: $qr_code = $_W['attachurl'] . $cfg['qr_code']; goto XHuFL; j7_qq: $cfg = $this->module['config']; goto mRO_b; rC70e: global $_W, $_GPC; goto j7_qq; mRO_b: $mid = $_GPC['mid']; goto HMBZA; G5avq: $qr_code = pdo_fetchcolumn('SELECT url FROM ' . tablename('qrcode') . ' WHERE uniacid=:uniacid and
			  `qrcid` =:mid  order by id desc LIMIT 1', array(":mid" => $mid, ":uniacid" => $_W['uniacid'])); goto pPZrV; xZPr1: return $qr_code; goto agVrp; ZkICl: j5YR9: goto xZPr1; qytS7: DFFj_: goto ZkICl; HMBZA: if (!empty($mid)) { goto Dyqfr; } goto Prm_z; JCncR: $qr_code = $_W['attachurl'] . $cfg['qr_code']; goto qytS7; XHuFL: goto j5YR9; goto iOtLK; iOtLK: Dyqfr: goto G5avq; agVrp: } public function checkUser() { goto VYC7H; uxt20: $cfg = $this->module['config']; goto M4P1r; tGJkH: if (!empty($qrcode_flag)) { goto wH2Im; } goto CpaWV; UmxpL: $shownotice = 1; goto ZINjv; rJKYd: goto cKc13; goto eNBba; e3Q6X: if (!empty($profile['id'])) { goto bXqWt; } goto ApXpQ; DkL4e: $fans = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE openid=:from_user and uniacid=:uniacid', array(":from_user" => $from_user, ":uniacid" => $_W['uniacid'])); goto w4z4d; VD0kY: if (!($fans['follow'] != 1 && $qrcode_flag == 1)) { goto jXA0f; } goto UmxpL; VYC7H: global $_W, $_GPC; goto bB1S1; bbPd4: if (empty($from_user) && $qrcode_flag == 1) { goto RM9sG; } goto DkL4e; hhn3x: $from_user = $this->getFromUser(); goto bbPd4; EXaLA: wH2Im: goto e3Q6X; ApXpQ: $this->autoRegedit($modulephp); goto yTomV; bB1S1: load()->model('mc'); goto xDT8Y; ZINjv: jXA0f: goto rJKYd; xDT8Y: $shownotice = 0; goto li6s5; JQLQV: cKc13: goto SnIMX; SnIMX: return $shownotice; goto ZHqJl; x7A6W: $uid = mc_openid2uid($from_user); goto FJvnm; eNBba: RM9sG: goto fmO7_; yTomV: $profile = $this->getProfile(); goto N5Tbb; fmO7_: $shownotice = 1; goto JQLQV; N5Tbb: bXqWt: goto hhn3x; w4z4d: $this->toflag(); goto x7A6W; FJvnm: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto VD0kY; M4P1r: $qrcode_flag = $cfg['qrcode_flag']; goto tGJkH; CpaWV: $qrcode_flag = 2; goto EXaLA; li6s5: $profile = $this->getProfile(); goto uxt20; ZHqJl: } public function sendtempmsg($template_id, $url, $data, $topcolor) { goto RJd6G; IhKAV: return; goto SOVeS; KTfB7: return true; goto pVgJl; npoWK: if (!empty($tokens)) { goto IjNwv; } goto IhKAV; rtBcL: $res = ihttp_post('https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=' . $tokens, $postarr); goto KTfB7; YKLZi: $tokens = $this->get_weixin_token(); goto npoWK; RJd6G: global $_W, $_GPC; goto Xh34J; Xh34J: $from_user = $this->getFromUser(); goto YKLZi; mcQw9: $postarr = '{"touser":"' . $from_user . '","template_id":"' . $template_id . '","url":"' . $url . '","topcolor":"' . $topcolor . '","data":' . $data . '}'; goto rtBcL; SOVeS: IjNwv: goto mcQw9; pVgJl: } public function sendcustomMsg($from_user, $msg) { goto MPhFt; pV4pf: message('发送失败，原因为' . $status['message']); goto QxdQ8; QxdQ8: ndK46: goto LDpXK; heVu3: if (!is_error($status)) { goto ndK46; } goto pV4pf; r3aFR: $status = $account_api->sendCustomNotice($message); goto heVu3; rjzZN: $account_api = WeAccount::create(); goto r3aFR; MPhFt: $message = array("msgtype" => "text", "text" => array("content" => urlencode($msg)), "touser" => $from_user); goto rjzZN; LDpXK: } public function __web2() { goto u6cue; nhh4W: $mapping_fans = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE `uid` = :uid', array(":uid" => $_GPC['uid'])); goto BVFO8; ykpOp: load()->func('tpl'); goto W3cXB; BVFO8: $_GPC['from_user'] = $mapping_fans['openid']; goto ZwXtf; dv3gz: load()->func('file'); goto ykpOp; u6cue: global $_W, $_GPC; goto dv3gz; W3cXB: load()->model('mc'); goto nhh4W; ZwXtf: checklogin(); goto sNDAh; sNDAh: } public function doWebStatistics() { goto cg6D_; eZ4an: exit; goto vvW6D; l14zK: include $this->template('orderstatistics'); goto yTFqS; SGhrq: vV8ZS: goto Y3DMm; FaW6w: q2D02: goto ZbjQS; Cs0X_: $dateindex = 1; goto UV5Ca; ChkdF: if (empty($_GPC['memberrankingEXP01'])) { goto Twy0c; } goto hNk25; DeiGz: BOC2K: goto VXcPW; nmpAF: $nowyear = intval(date('Y', time())); goto DjBiC; CodVl: $chartdata3[$index]['counts'] = $chart1data['counts']; goto jIO5f; LJ68D: KU875: goto I3dIl; lsOyE: $chart1data = pdo_fetch('SELECT count(*) as counts,\'' . $time . '\' as dates FROM ' . tablename('mihua_mall_member') . "   WHERE uniacid = '{$_W['uniacid']}' {$conditionflag} and " . $condtitiontime . '>=' . $start_time . ' and  ' . $condtitiontime . '<=' . $end_time); goto CodVl; nSgwr: $years2 = array(array("year" => $nowyear - 3, "checked" => 0), array("year" => $nowyear - 2, "checked" => 0), array("year" => $nowyear - 1, "checked" => 0), array("year" => $nowyear, "checked" => 1)); goto w895y; wR1gf: include $this->template('red'); goto a3ytb; hZ300: $topcount = 0; goto sFdmh; sevpu: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_member') . "   WHERE uniacid = '{$_W['uniacid']}' "); goto nmpAF; Debg0: require 'report.php'; goto dTyAK; ge87r: if (!($op == 'saledetails')) { goto k80AU; } goto uSsEl; GXvQh: t1nlh: goto ge87r; c_r7k: exit; goto TeYca; g8wGk: $dayordercount = pdo_fetchcolumn('SELECT sum(cast(price as decimal(8,2))) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}'  and createtime >=" . strtotime($dropdayForYaer . '-' . $selectmonthSale . '-' . $day . ' 00:00:01') . ' and createtime <=' . strtotime($dropdayForYaer . '-' . $selectmonthSale . '-' . $day . ' 23:59:59')); goto ZNZui; uSyPR: $dropMonthForYaer2 = $_GPC['dropMonthForYaer2'] ? $_GPC['dropMonthForYaer2'] : $nowyear; goto oRiRy; XvDUe: exit; goto mBakq; jaIX8: $ordercount = 0; goto bQ6Ka; OEJm1: $end_time = strtotime($time . '-' . $lastday . ' 23:59:59'); goto lsOyE; JOwXk: require 'report.php'; goto dmak1; t21VK: if ($usertype == 'agent') { goto OR9Vk; } goto B_1Kv; LtuMd: $selectmonthSale = $_GPC['selectmonthSale'] ? $_GPC['selectmonthSale'] : $nowmonth; goto riqTW; kkd26: QMFlf: goto OdVmV; xz76s: if (empty($_GPC['realname'])) { goto NSktk; } goto s9u2g; IDHcu: $list = pdo_fetchall('SELECT * ,count(*) as snum from ' . tablename('mihua_mall_member') . " where uniacid = '{$_W['uniacid']}' and shareid>0    GROUP BY shareid ORDER BY snum desc limit 30"); goto pNdah; K6pDu: $ordersn = $_GPC['ordersn']; goto KiEhh; ZC0N7: $day++; goto gRjGv; rPxt2: Y3_q2: goto ohPwa; nFXrQ: $daydatas[$dayindex]['day'] = $day; goto WoTTg; iMY6O: $datas = array(array()); goto LdeP2; QccmH: $condition2 = ''; goto p3304; KMpKi: pJtug: goto Vc6pT; AXKBb: $list = pdo_fetchall('select t1.* from (SELECT orders.status,orders.uniacid,orders.id,orders.createtime,orders.ordersn,orders.price,orders.dispatchprice,orders.paytype,(select member.realname from ' . tablename('mihua_mall_member') . ' member where member.from_user=orders.from_user and orders.uniacid=member.uniacid limit 1 ) realnamestr,(select taddress.realname from ' . tablename('mihua_mall_address') . ' taddress where taddress.id=orders.addressid  and orders.uniacid=taddress.uniacid limit 1 ) tdrealname,(select concat(taddress.province,taddress.city,taddress.area,taddress.address) from ' . tablename('mihua_mall_address') . ' taddress where taddress.id=orders.addressid  and orders.uniacid=taddress.uniacid limit 1 ) tdaddress,(select taddress.mobile from ' . tablename('mihua_mall_address') . ' taddress where taddress.id=orders.addressid  and orders.uniacid=taddress.uniacid limit 1 ) tdmobile from ' . tablename('mihua_mall_order') . " orders where orders.uniacid = :uniacid {$conditionOrderStatus} order by orders.createtime  desc) t1 where t1.uniacid = :uniacid   {$condition}   LIMIT " . ($pindex - 1) * $psize . ',' . $psize, array(":uniacid" => $_W['uniacid'])); goto ZcRJR; y5Rht: $dropMonthForYaer = intval($dropMonthForYaer); goto LtuMd; lhMeF: $chart1data = pdo_fetch('SELECT count(*) as counts,\'' . $time . '\' as dates FROM ' . tablename('mihua_mall_member') . "   WHERE uniacid = '{$_W['uniacid']}' {$conditionflag} and " . $condtitiontime . '>=' . $start_time . ' and  ' . $condtitiontime . '<=' . $end_time); goto j1vy0; K7Wuj: UveIh: goto abdEG; SHnAd: $lastday = date('t', strtotime($dropMonthForYaer2 . '-' . $dateindex . '-1')); goto P7BOR; MhFSp: require 'report.php'; goto lLwQZ; Fe4E2: Q3wSo: goto qRmNu; JCPmR: if (!empty($_GPC['allorderstatus'])) { goto z3aMC; } goto PPDSY; Bn0gb: k80AU: goto bVxKE; JppFp: goto gdV4E; goto Q8EmR; n3cuQ: $condition .= ' and t1.realnamestr=\'' . $realname . '\''; goto p0HR1; aRpNt: if (!($radiodayForSaleType == '1')) { goto t0Hke; } goto g8wGk; Qv47Y: $allorderstatus = 1; goto J3TY2; rQwXm: $topcount = $ordercount; goto PB5It; VXcPW: $condition1 = ''; goto QccmH; AypbO: T0s_i: goto JPbaE; QZ5De: if (empty($_GPC['addressname'])) { goto Z8d5f; } goto Q2pS0; VzK3n: $nowmonth = intval(date('m', time())); goto Weo8_; abdEG: $total = pdo_fetchcolumn('select count(t1.id) from (SELECT orders.uniacid,orders.id,orders.createtime,orders.ordersn,orders.price,orders.dispatchprice,orders.paytype,(select member.realname from ' . tablename('mihua_mall_member') . ' member where member.from_user=orders.from_user and orders.uniacid=member.uniacid limit 1 ) realnamestr,(select taddress.realname from ' . tablename('mihua_mall_address') . ' taddress where taddress.id=orders.addressid  and orders.uniacid=taddress.uniacid limit 1 ) tdrealname from ' . tablename('mihua_mall_order') . " orders where orders.uniacid = :uniacid {$conditionOrderStatus} order by orders.createtime  desc) t1 where t1.uniacid = :uniacid  {$condition}  ", array(":uniacid" => $_W['uniacid'])); goto rNEia; nzQw7: if (!($dateindex >= 0)) { goto L17nL; } goto VjsBD; lkJNy: $dayordercount = 0; goto uQDbv; vB6vk: if (!empty($_GPC['start_time']) && !empty($_GPC['end_time'])) { goto k4k_M; } goto MqfwX; tvdxd: $dayindex = 0; goto oPD_7; v3hVS: goto Q3wSo; goto W85tx; vzNHB: $condition2 = ' and orders2.createtime>=' . $start_time . ' and ' . 'orders2.createtime<=' . $end_time; goto qRqDa; kVwf5: $condition = ''; goto Pb4a6; dnTFi: xRR0v: goto bDB1M; QEcUe: DjB8_: goto Cs0X_; RFuL8: $condition = ''; goto mAWGE; eFPiv: $daydatas = array(array()); goto tvdxd; b9o1E: vrWlT: goto vHY2v; Qd3C9: goto ufPKs; goto l6k4D; MjBng: $list = pdo_fetchall('SELECT member.realname,(' . 'SELECT count(orders.id) FROM ' . tablename('mihua_mall_order') . ' orders where orders.from_user=member.from_user and orders.uniacid=member.uniacid ' . $condition1 . ') as ordercount,(' . 'SELECT sum(cast(orders2.price as decimal(8,2))) FROM ' . tablename('mihua_mall_order') . ' orders2 where orders2.from_user=member.from_user  and member.uniacid=orders2.uniacid ' . $condition2 . ') ordermoney FROM ' . tablename('mihua_mall_member') . " member WHERE member.uniacid = '{$_W['uniacid']}' ORDER BY " . $sortname . '  DESC limit 100'); goto ChkdF; HoyhI: $report = 'productsaleranking'; goto MhFSp; ulq8Y: $pindex = 1; goto tjEqV; KiEhh: $condition .= ' and t1.ordersn=\'' . $ordersn . '\''; goto ljFpI; jLXT2: $daytopcount = $dayordercount; goto SGhrq; XfWeN: foreach ($daydatas as $index => $row) { goto wQcQQ; AzFqG: $daydatas[$index]['persent'] = round($daydatas[$index]['count'] / $dayallcount, 2) * 100; goto lrM6Q; C2bT3: $daydatas[$index]['persent'] = 0; goto aMJ2j; aMJ2j: goto IBG0Z; goto pUwDr; pUwDr: PLaw3: goto AzFqG; n1Vs4: gQylV: goto IG2wm; wQcQQ: if ($dayallcount > 0) { goto PLaw3; } goto C2bT3; lrM6Q: IBG0Z: goto n1Vs4; IG2wm: } goto GLMJ3; pK7PD: z2hRn: goto sr6bf; W85tx: c390t: goto pRJ8U; yTFqS: exit; goto zjUxT; FM_FB: $sortname = $_GPC['sortname'] ? $_GPC['sortname'] : 'ordermoney'; goto sOa7S; ml8W5: $index = $index + 1; goto kkd26; KCFL9: goto aGmmT; goto FaW6w; eJD85: if (!($op == 'memberranking')) { goto XdQ8R; } goto FM_FB; Y6BPi: exit; goto pK7PD; UACy7: ypvXH: goto Djubp; HOxBZ: ufPKs: goto rYprH; pRJ8U: $time = date('Y-m-d', time()); goto Fe4E2; NUteY: $dropMonthForYaer = $_GPC['dropMonthForYaer'] ? $_GPC['dropMonthForYaer'] : $nowyear; goto wOj4T; rNEia: $pager = pagination($total, $pindex, $psize); goto NNN6T; B7CXW: gdV4E: goto ICM4X; qRmNu: $start_time = strtotime($time . ' 00:00:01'); goto OtMFi; mBakq: Twy0c: goto IL1iD; ZGR1q: Nyalx: goto BGt2I; RaQqN: $start_time = strtotime(date('Y-m-01 00:00:01', time())); goto O4vma; j1vy0: $chartdata1[$index]['counts'] = $chart1data['counts']; goto hQNXm; fRuNA: if (!($day <= $lastday)) { goto uEJPL; } goto MmSUE; f5l_G: $dayordercount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}'  and createtime >=" . strtotime($dropdayForYaer . '-' . $selectmonthSale . '-' . $day . ' 00:00:01') . ' and createtime <=' . strtotime($dropdayForYaer . '-' . $selectmonthSale . '-' . $day . ' 23:59:59')); goto acytf; lJjoP: raB4_: goto Bk6Bz; y8_Zv: $end_time = strtotime($_GPC['end_time'] . ' 23:59:59'); goto GBbYP; hoiJb: $pindex = 1; goto ktcYN; uQDbv: Hmy5Y: goto nFXrQ; Bk6Bz: include $this->template('userincreasestatistics'); goto e8yUD; H_slo: $pindex = max(1, intval($_GPC['page'])); goto UpMvb; lXSQB: x8bRJ: goto BLYgX; ouKLM: $dayallcount = $dayallcount + $dayordercount; goto A81RL; vHY2v: $dateindex = 1; goto psbqQ; Agrrn: $end_time = strtotime(date('Y-m-t 23:59:59', time())); goto mVVLS; hQcaF: exit; goto iymem; rYprH: $condition = ' and t1.addtime>=' . $start_time . ' and t1.addtime<=' . $end_time; goto Nvokr; l79M0: $cfg = $this->module['config']; goto IDHcu; dhtA_: if (!($topcount < $ordercount)) { goto qdG5D; } goto rQwXm; Id09V: include $this->template('salereport'); goto dlOdS; fHruT: foreach ($list as $id => $displayorder) { goto Bqx3c; pvmpO: Qo742: goto h5JjF; Bqx3c: $list[$id]['cpersent'] = round($list[$id]['salescount'] / ($list[$id]['viewcount'] == 0 ? 1 : $list[$id]['viewcount']) * 100, 2); goto gu25R; CK4ug: VicxZ: goto v8lFv; h5JjF: sB0gx: goto JKaTs; gfwFW: $list[$id]['salescount'] = 0; goto R2oub; RYBP9: $list[$id]['viewcount'] = 0; goto CK4ug; YMMPC: if (!empty($list[$id]['cpersent'])) { goto Qo742; } goto UrM36; UrM36: $list[$id]['cpersent'] = 0; goto pvmpO; v8lFv: if (!empty($list[$id]['salescount'])) { goto eiB36; } goto gfwFW; gu25R: if (!empty($list[$id]['viewcount'])) { goto VicxZ; } goto RYBP9; R2oub: eiB36: goto YMMPC; JKaTs: } goto lXSQB; WoTTg: $daydatas[$dayindex]['count'] = $dayordercount; goto wFDwY; hQNXm: $chartdata1[$index]['dates'] = $chart1data['dates']; goto Q1wla; wFDwY: $dayindex = $dayindex + 1; goto ouKLM; gL1M6: HVp86: goto gjGm7; O0NtL: $conditionOrderStatus = 'and orders.status=3'; goto EkXeq; DjBiC: $nowmonth = intval(date('m', time())); goto JVgWa; gAm7m: s4B5t: goto mMQYs; WLnnR: $allmembercount = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . "   WHERE uniacid = '{$_W['uniacid']}' "); goto DkbPP; gDo3S: $condition .= ' and t1.tdrealname=\'' . $addressname . '\''; goto bp4ng; ljFpI: sgAC8: goto JCPmR; GMm6q: jQoM5: goto OYg17; OtMFi: $end_time = strtotime($time . ' 23:59:59'); goto lhMeF; tjEqV: VuTut: goto Na5f6; yGIOu: $this->__web2(); goto iuWb0; AbgJM: $allordercount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE status=3 and uniacid = '{$_W['uniacid']}' "); goto WLnnR; uSsEl: $condition = ''; goto H_slo; JPbaE: foreach ($datas as $index => $row) { goto Syptp; Avjcp: goto yld2E; goto USdBh; USdBh: Lg8O3: goto fltnZ; Syptp: if ($allcount > 0) { goto Lg8O3; } goto Xosr7; Xosr7: $datas[$index]['persent'] = 0; goto Avjcp; LLli9: yld2E: goto sHmLa; fltnZ: $datas[$index]['persent'] = round($datas[$index]['count'] / $allcount, 2) * 100; goto LLli9; sHmLa: TKTb7: goto NezOO; NezOO: } goto gAm7m; NLWxM: $start_time = strtotime($_GPC['start_time'] . ' 00:00:01'); goto qJIQA; NZOyC: $dropdayForYaer = intval($dropdayForYaer); goto xtAk9; Yc1Pj: $nowday = date('t', time()); goto TXnAy; w895y: foreach ($years2 as $id => $displayorder) { goto F4gHm; F4gHm: if ($years2[$id]['year'] == $dropMonthForYaer2) { goto jE4it; } goto pYZBI; toiNT: SySRE: goto mol0z; LvRAK: $years2[$id]['checked'] = 1; goto EiUh_; EiUh_: OquiB: goto toiNT; aly04: jE4it: goto LvRAK; pYZBI: $years2[$id]['checked'] = 0; goto kiOFo; kiOFo: goto OquiB; goto aly04; mol0z: } goto b9o1E; H_xwE: MjUzU: goto iMY6O; O22LL: $report = 'saledetails'; goto mKcOC; DkbPP: $allorderviewcount = pdo_fetchcolumn('SELECT sum(cast(viewcount as decimal(8,0))) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}' "); goto BAK30; Djubp: Zgcog: goto cE16y; DqJkR: $month++; goto D0W9h; JIfP6: goto iaYQQ; goto lSDvB; r_tN6: $allorderprice = pdo_fetchcolumn('SELECT sum(cast(price as decimal(8,2))) FROM ' . tablename('mihua_mall_order') . " WHERE status=3 and uniacid = '{$_W['uniacid']}' "); goto AbgJM; p6YcB: JqwG8: goto xU1DE; D0W9h: goto JC5r4; goto AypbO; sw77Q: if (!empty($_GPC['start_time']) && !empty($_GPC['end_time'])) { goto Z025x; } goto RaQqN; jIO5f: $chartdata3[$index]['dates'] = $chart1data['dates']; goto PLGWV; Na5f6: if ($_GPC['realname']) { goto DWPTX; } goto itjt_; gRjGv: goto LL0en; goto fbqol; tmBJc: $end_time = strtotime($_GPC['end_time'] . ' 23:59:59'); goto rcFQN; Pb4a6: if (!empty($_GPC['start_time']) && !empty($_GPC['end_time'])) { goto q2D02; } goto sV8vq; jWSpB: include $this->template('saletargets'); goto eZ4an; Vc6pT: $start_time = strtotime($_GPC['start_time'] . ' 00:00:01'); goto BvqMr; F75rC: Dr41H: goto eJD85; bQ6Ka: uWecd: goto dhtA_; PLGWV: $chartdata3[$index]['index'] = $index; goto ml8W5; U4G_S: exit; goto nR3o5; bDB1M: include $this->template('productsaleranking'); goto GD7CE; L4_lr: $start_time = strtotime($time . '-1' . ' 00:00:01'); goto OEJm1; gh32z: $datas[$index]['month'] = $month; goto kGmGm; nR3o5: NreNc: goto wR1gf; Q2pS0: $addressname = $_GPC['addressname']; goto gDo3S; Y3DMm: XymtC: goto ZC0N7; uKsY2: TwgD2: goto XAdPE; hf40N: al1so: goto nzQw7; Q8EmR: DWPTX: goto O4nil; lWo5o: $chartdata2[$index]['dates'] = $dateindex; goto GembO; axgwu: $start_time = strtotime($_GPC['start_time'] . ' 00:00:01'); goto y8_Zv; b0dhz: HGt9Y: goto fVGLR; QOP9c: if (!($month <= 12)) { goto T0s_i; } goto gh32z; n3FIi: $index = 0; goto uPOwE; kcy8Y: Qpf8C: goto Mo4rT; nF8b6: $total = pdo_fetchcolumn('select t1.*,t2.nickname from ' . tablename('mihua_mall_red') . ' t1 left join ' . tablename('mc_mapping_fans') . " t2 on t1.openid=t2.openid where  t1.uniacid = '{$_W['uniacid']}'  order by t1.red_id desc "); goto JppFp; HSpYU: $report = 'salereport01'; goto TeKdL; riqTW: $radiodayForSaleType = $_GPC['radiodayForSaleType'] ? $_GPC['radiodayForSaleType'] : '0'; goto uzIPs; pchok: if (!($nowyear == $dropMonthForYaer)) { goto Zgcog; } goto lZZH6; yZXmV: if (empty($_GPC['productsalerankingEXP01'])) { goto xRR0v; } goto HoyhI; sOa7S: if (!empty($_GPC['start_time']) && !empty($_GPC['end_time'])) { goto pJtug; } goto DucXN; FHEL5: exit; goto x84dQ; a3ytb: m2wCX: goto k01xh; uPOwE: $chartdata2 = array(); goto shMbk; Weo8_: $years = array(array("year" => $nowyear - 3, "checked" => 0), array("year" => $nowyear - 2, "checked" => 0), array("year" => $nowyear - 1, "checked" => 0), array("year" => $nowyear, "checked" => 1)); goto NUteY; eBXJJ: $condition = ' and t1.createtime>=' . $start_time . ' and t1.createtime<=' . $end_time; goto xz76s; Cdyjw: $allcount = 0; goto hZ300; sr6bf: if (!($op == 'userincreasestatistics')) { goto HGt9Y; } goto Jg7bO; BRh4U: if (!($op == 'salereport')) { goto Dr41H; } goto MG0DQ; mz0Hq: $list = pdo_fetchall('SELECT goods.*,0 as cpersent,(select sum((ordergoods.price*ordergoods.total)) from  ' . tablename('mihua_mall_order_goods') . " ordergoods where ordergoods.goodsid=goods.id and ordergoods.uniacid=goods.uniacid {$condition}) salesmoney,(select sum(ordergoods.total) from  " . tablename('mihua_mall_order_goods') . " ordergoods where ordergoods.goodsid=goods.id and ordergoods.uniacid=goods.uniacid {$condition}) salescount  from " . tablename('mihua_mall_goods') . ' goods  where goods.uniacid = :uniacid order by salesmoney  desc', array(":uniacid" => $_W['uniacid'])); goto yZXmV; Mpj80: JC5r4: goto QOP9c; l6k4D: Z025x: goto NLWxM; B_1Kv: $condtitiontime = 'createtime'; goto JIfP6; p6seO: nC5q4: goto axgwu; JTGPP: $psize = 20; goto Cm_R6; lLwQZ: exit; goto dnTFi; TeKdL: $list = $datas; goto Debg0; NNN6T: if (empty($_GPC['orderstatisticsEXP01'])) { goto T1mmi; } goto x3hqu; oaFg2: $pindex = max(1, intval($_GPC['page'])); goto JTGPP; NuFnY: $condition = ' and ordergoods.createtime>=' . $start_time . ' and ordergoods.createtime<=' . $end_time; goto mz0Hq; EXzlq: $index = 0; goto Js_X3; A81RL: if (!($daytopcount < $dayordercount)) { goto vV8ZS; } goto jLXT2; mAWGE: $pindex = max(1, intval($_GPC['page'])); goto QUegc; O4mir: if (!($op == 'productsaleranking')) { goto t1nlh; } goto kVwf5; p0HR1: NSktk: goto QZ5De; a6Hl1: vNTMU: goto Id09V; dTyAK: exit; goto S5Hxi; DucXN: $start_time = strtotime(date('Y-m-01 00:00:01', time())); goto g3sRc; O0yHS: pdo_update('mihua_mall_member', array("flagtime" => TIMESTAMP), array("flag" => 1, "flagtime" => 0)); goto p6YcB; oRiRy: $dropMonthForYaer2 = intval($dropMonthForYaer2); goto nSgwr; cKa5h: if (!($op == 'red')) { goto m2wCX; } goto RFuL8; JzM3V: $end_time = strtotime($_GPC['end_time'] . ' 23:59:59'); goto GMm6q; xU1DE: $op = $_GPC['op'] ? $_GPC['op'] : 'salereport'; goto BRh4U; qGRdR: $allcount = $allcount + $ordercount; goto agJC6; rO8Wu: goto BOC2K; goto KMpKi; TKd0_: $ordercount = pdo_fetchcolumn('SELECT sum(cast(price as decimal(8,2))) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}'  and createtime >=" . strtotime($dropMonthForYaer . '-' . $month . '-1' . ' 00:00:01') . ' and createtime <=' . strtotime($dropMonthForYaer . '-' . $month . '-' . $lastday . ' 23:59:59')); goto Gu1x5; AVV0E: $index = $index + 1; goto rPxt2; lSDvB: OR9Vk: goto nFWBa; OdVmV: $dateindex++; goto k9SzZ; MmSUE: if (!($radiodayForSaleType == '0')) { goto cKgjz; } goto f5l_G; cTpUS: if (!($needfixcount > 0)) { goto JqwG8; } goto O0yHS; VjsBD: if ($dateindex == 0) { goto c390t; } goto Qwgh5; uexUs: z3aMC: goto Qv47Y; ZNZui: t0Hke: goto R1RSf; dmak1: exit; goto a6Hl1; LdeP2: $index = 0; goto Cdyjw; ICM4X: $pager = pagination($total, $pindex, $psize); goto Hqb7d; GLMJ3: Q9nQB: goto CROmZ; Hqb7d: if (empty($_GPC['redEXP01'])) { goto NreNc; } goto q2He0; Js_X3: $dateindex = 7; goto hf40N; Jg7bO: $usertype = $_GPC['usertype'] ? $_GPC['usertype'] : 'user'; goto k1Ge7; O6xw6: if (empty($_GPC['saledetailsEXP01'])) { goto BRFnP; } goto O22LL; iuWb0: $needfixcount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_member') . ' WHERE flag=1 and flagtime=0'); goto cTpUS; z8ZsD: $start_time = strtotime(date('Y-m-01 00:00:01', time())); goto cSLKX; tbg9R: $condtitiontime = 'flagtime'; goto rh0Lh; acytf: cKgjz: goto aRpNt; cSLKX: $end_time = strtotime(date('Y-m-t 23:59:59', time())); goto JA_nw; b8VFu: $chartdata2[$index]['counts'] = $chart1data['counts']; goto lWo5o; UZW2O: k4k_M: goto dmPwm; Cm_R6: if (!empty($_GPC['start_time']) && !empty($_GPC['end_time'])) { goto nC5q4; } goto z8ZsD; aS88b: $start_time = strtotime($time . ' 00:00:01'); goto yctgY; zhoSd: if (!($op == 'productsalestatistics')) { goto z2hRn; } goto TN29q; p3304: if (!(!empty($start_time) && !empty($end_time) && !empty($_GPC['start_time']) && !empty($_GPC['end_time']))) { goto MTnhK; } goto fLDH6; TXnAy: $chartdata1 = array(); goto EXzlq; uzIPs: $dropdayForYaer = $_GPC['dropdayForYaer'] ? $_GPC['dropdayForYaer'] : $nowyear; goto NZOyC; qJIQA: $end_time = strtotime($_GPC['end_time'] . ' 23:59:59'); goto HOxBZ; flQ8M: foreach ($years as $id => $displayorder) { goto SCoRu; wtkMR: k5_sG: goto pFv4T; fb32Z: goto k5_sG; goto anQEv; pFv4T: zI3HI: goto UPDKP; SCoRu: if ($years[$id]['year'] == $dropMonthForYaer) { goto H9Sj4; } goto twwqq; anQEv: H9Sj4: goto Ytcap; twwqq: $years[$id]['checked'] = 0; goto fb32Z; Ytcap: $years[$id]['checked'] = 1; goto wtkMR; UPDKP: } goto QEcUe; G_0W1: $total = pdo_fetchcolumn('SELECT count(ordergoods.id) from  ' . tablename('mihua_mall_order_goods') . ' ordergoods left join ' . tablename('mihua_mall_order') . " orders  on orders.id=ordergoods.orderid where orders.uniacid = :uniacid {$condition} order by orders.createtime desc", array(":uniacid" => $_W['uniacid'])); goto Y2kST; pxgwc: $total = pdo_fetchcolumn('select t1.*,t2.nickname from ' . tablename('mihua_mall_red') . ' t1 left join ' . tablename('mc_mapping_fans') . ' t2 on t1.openid=t2.openid where t2.nickname like :nickname and  t1.uniacid = :uniacid  order by t1.red_id desc ', array(":nickname" => '%' . $_GPC['realname'] . '%', ":uniacid" => $_W['uniacid'])); goto B7CXW; xtAk9: foreach ($years as $id => $displayorder) { goto GxkEV; GxkEV: if ($years[$id]['year'] == $dropMonthForYaer) { goto gcFlL; } goto yGYJM; yGYJM: $years[$id]['checked'] = 0; goto RkkSA; lXloe: NthoD: goto aHano; RkkSA: goto NthoD; goto tV1Rv; aHano: kiuk9: goto OLJs8; tV1Rv: gcFlL: goto O5TFJ; O5TFJ: $years[$id]['checked'] = 1; goto lXloe; OLJs8: } goto H_xwE; rcFQN: aGmmT: goto NuFnY; mVVLS: goto jQoM5; goto UZW2O; fbqol: uEJPL: goto XfWeN; Sw3b1: $daytopcount = 0; goto eFPiv; Y2kST: $pager = pagination($total, $pindex, $psize); goto O6xw6; ndy0M: exit; goto pvuAO; GBbYP: G3GGz: goto eBXJJ; ZsGqM: $month = 13; goto UACy7; I3dIl: include $this->template('fansrange'); goto hQcaF; fVGLR: if (!($op == 'saletargets')) { goto IE5aC; } goto r_tN6; Gu1x5: rxr0b: goto szTIN; TN29q: $list = pdo_fetchall('SELECT goods.*,0 as cpersent,(select sum(ordergoods.total) from  ' . tablename('mihua_mall_order_goods') . ' ordergoods where ordergoods.goodsid=goods.id and ordergoods.uniacid=goods.uniacid ) salescount from ' . tablename('mihua_mall_goods') . ' goods  where goods.uniacid = :uniacid order by (salescount/goods.viewcount)  desc ', array(":uniacid" => $_W['uniacid'])); goto fHruT; kpE00: if (!($dateindex <= 12)) { goto raB4_; } goto SHnAd; pvuAO: T1mmi: goto l14zK; agJC6: $index = $index + 1; goto pchok; LwXPe: if (!($op == 'fansrange')) { goto Rq33Q; } goto l79M0; bVxKE: if (!($op == 'orderstatistics')) { goto n0HfT; } goto Etfa9; S5Hxi: uAtiP: goto mBA0w; k9SzZ: goto ElHVk; goto lJjoP; bp4ng: Z8d5f: goto o3HxS; Cny_f: $end_time = strtotime(date('Y-m-t 23:59:59', time())); goto KCFL9; qa3Fk: $day = 1; goto cVrb5; mMQYs: $dayallcount = 0; goto Sw3b1; G4vBe: $pindex = 1; goto o2zsB; cVrb5: LL0en: goto fRuNA; wOj4T: $radioMonthForSaleType = $_GPC['radioMonthForSaleType'] ? $_GPC['radioMonthForSaleType'] : '0'; goto y5Rht; mokna: goto al1so; goto pASn7; mKcOC: require 'report.php'; goto c_r7k; Q1wla: $chartdata1[$index]['index'] = $index; goto Is4TS; ZbjQS: $start_time = strtotime($_GPC['start_time'] . ' 00:00:01'); goto tmBJc; P7BOR: $time = $dropMonthForYaer2 . '-' . $dateindex; goto L4_lr; szTIN: if (!empty($ordercount)) { goto uWecd; } goto jaIX8; OYg17: $condition = ' and orders.createtime>=' . $start_time . ' and orders.createtime<=' . $end_time; goto Ooljj; GXnFY: include $this->template('saledetails'); goto GFKSz; nFWBa: $conditionflag = ' and flag=1'; goto tbg9R; mGEAr: $datas[$index]['count'] = $ordercount; goto qGRdR; MG0DQ: $nowyear = intval(date('Y', time())); goto VzK3n; q2He0: $report = 'red'; goto c6nv_; Nvokr: if (empty($_GPC['redEXP01'])) { goto VuTut; } goto oRTT4; Is4TS: $index = $index + 1; goto kcy8Y; w8Ipw: $psize = 9999; goto G4vBe; w_OYe: if (!($dateindex <= $lastday)) { goto Nyalx; } goto S70Xx; fLDH6: $condition1 = ' and orders.createtime>=' . $start_time . ' and ' . 'orders.createtime<=' . $end_time; goto vzNHB; g3sRc: $end_time = strtotime(date('Y-m-t 23:59:59', time())); goto rO8Wu; R6VMP: $ordercount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}'  and createtime >=" . strtotime($dropMonthForYaer . '-' . $month . '-1' . ' 00:00:01') . ' and createtime <=' . strtotime($dropMonthForYaer . '-' . $month . '-' . $lastday . ' 23:59:59')); goto uKsY2; kGmGm: $lastday = date('t', strtotime($dropMonthForYaer . '-' . $month . '-1')); goto Fv8wE; pASn7: L17nL: goto n3FIi; SaBkK: $chartdata3 = array(); goto uSyPR; psbqQ: ElHVk: goto kpE00; qv8tB: require 'report.php'; goto XvDUe; Pjlqy: require 'report.php'; goto ndy0M; mBA0w: if (empty($_GPC['salereportEXP02'])) { goto vNTMU; } goto Q9AMq; jS801: $chart1data = pdo_fetch('SELECT count(*) as counts,\'' . $time . '\' as dates FROM ' . tablename('mihua_mall_member') . "   WHERE uniacid = '{$_W['uniacid']}' {$conditionflag} and " . $condtitiontime . '>=' . $start_time . ' and  ' . $condtitiontime . '<=' . $end_time); goto b8VFu; vvW6D: IE5aC: goto O4mir; yctgY: $end_time = strtotime($time . ' 23:59:59'); goto jS801; BLYgX: include $this->template('productsalestatistics'); goto Y6BPi; O4vma: $end_time = strtotime(date('Y-m-t 23:59:59', time())); goto Qd3C9; MqfwX: $start_time = strtotime(date('Y-m-01 00:00:01', time())); goto Agrrn; o3HxS: if (empty($_GPC['ordersn'])) { goto sgAC8; } goto K6pDu; hNk25: $report = 'memberranking'; goto qv8tB; x3hqu: $report = 'orderstatistics'; goto Pjlqy; shMbk: $dropMonthForYaer = $_GPC['dropMonthForYaer'] ? $_GPC['dropMonthForYaer'] : $nowyear; goto rih6b; pNdah: foreach ($list as $key => $value) { goto anWxU; uBmpo: $list[$key]['realname'] = $mber['realname']; goto VdEsu; vtQe4: $count2 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto ERl6h; sXqJf: QfTd3: goto wz3FQ; XcYkh: $count = 0; goto ximYP; ZM2Fj: d9d1w: goto gjhww; ERl6h: $mylist2 = pdo_fetchall('	select * ,2 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto ZM2Fj; iHj0V: Sj5dj: goto pTmi0; b3xFS: $str3 = ''; goto TnWSK; u5Lf_: $str = trim($str, ','); goto H2KRJ; W_8Cx: foreach ($level2 as &$citem) { $str = $str . $citem['id'] . ','; EAm_q: } goto mq1ZK; ximYP: if (!true) { goto Rzgk1; } goto At1k_; yvqiJ: $level3 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and shareid in( ' . $str . ')'); goto rSMSh; COhuP: Rzgk1: goto FUO6K; rSMSh: $rowindex = 0; goto b3xFS; VdEsu: $from_user = $mber['from_user']; goto XcYkh; ZP1mu: jq7y6: goto gXvzL; pTmi0: $list[$key]['num'] = $count1 + $count2 + $count3; goto sXqJf; gXvzL: $str3 = trim($str3, ','); goto hVxLL; iPD37: $count1 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto WyJYC; pM3rz: $count3 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto jz4Bg; jz4Bg: $mylist3 = pdo_fetchall('	select * ,3 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and ( fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto iHj0V; TnWSK: foreach ($level3 as &$citem) { $str3 = $str3 . $citem['id'] . ','; MGvpG: } goto ZP1mu; anWxU: $mber = pdo_fetch('select realname,from_user from ' . tablename('mihua_mall_member') . " where uniacid = '{$_W['uniacid']}' and id={$value['shareid']}"); goto uBmpo; qnEJb: $str = ''; goto W_8Cx; FUO6K: if (!(true && $cfg['globalCommissionLevel'] >= 2 && $mylist1)) { goto d9d1w; } goto VR3fb; VR3fb: $level2 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and  shareid = ' . $value['shareid']); goto scF6C; hVxLL: $sql3_member = 'select mber3.from_user from ' . tablename('mihua_mall_member') . ' mber3 where  mber3.realname<>\'\' and mber3.id!=mber3.shareid and mber3.shareid in (' . $str3 . ')  '; goto pM3rz; WyJYC: $mylist1 = pdo_fetchall('	select *,1 as level from ' . tablename('mc_mapping_fans') . " fans where  openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}"); goto COhuP; mq1ZK: U2yWo: goto u5Lf_; scF6C: $rowindex = 0; goto qnEJb; At1k_: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where    mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $value['shareid']; goto iPD37; H2KRJ: $sql2_member = 'select mber2.from_user from ' . tablename('mihua_mall_member') . ' mber2 where  mber2.realname<>\'\' and mber2.id!=mber2.shareid and mber2.shareid in (' . $str . ')  '; goto vtQe4; gjhww: if (!(true && $cfg['globalCommissionLevel'] >= 3 && $mylist2)) { goto Sj5dj; } goto yvqiJ; wz3FQ: } goto LJ68D; sFdmh: $month = 1; goto Mpj80; o2zsB: NmTxP: goto HUWmc; Mo4rT: $dateindex--; goto mokna; gc2wv: $selectmonthSale = $_GPC['selectmonthSale'] ? $_GPC['selectmonthSale'] : $nowmonth; goto QzO21; itjt_: $list = pdo_fetchall('select t1.*,t2.nickname from ' . tablename('mihua_mall_red') . ' t1 left join ' . tablename('mc_mapping_fans') . " t2 on t1.openid=t2.openid where  t1.uniacid = '{$_W['uniacid']}'   order by t1.red_id desc LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto nF8b6; UV5Ca: ilhyj: goto w_OYe; TeYca: BRFnP: goto GXnFY; rih6b: $dropMonthForYaer = intval($dropMonthForYaer); goto gc2wv; zjUxT: n0HfT: goto cKa5h; eJLeQ: $psize = 9999; goto hoiJb; zicct: $list = $daydatas; goto JOwXk; Etfa9: $condition = ''; goto oaFg2; c6nv_: require 'report.php'; goto U4G_S; gjGm7: if (empty($_GPC['orderstatisticsEXP01'])) { goto nyKgU; } goto eJLeQ; ohPwa: $dateindex++; goto DHC7p; HUWmc: $list = pdo_fetchall('SELECT ordergoods.price,ordergoods.total,(select title from ' . tablename('mihua_mall_goods') . ' goods where ordergoods.goodsid=goods.id) titles,orders.createtime,orders.ordersn from  ' . tablename('mihua_mall_order_goods') . ' ordergoods left join ' . tablename('mihua_mall_order') . " orders  on orders.id=ordergoods.orderid where orders.uniacid = :uniacid {$condition} order by orders.createtime  desc  LIMIT " . ($pindex - 1) * $psize . ',' . $psize, array(":uniacid" => $_W['uniacid'])); goto G_0W1; S70Xx: $time = $dropMonthForYaer . '-' . $selectmonthSale . '-' . $dateindex; goto aS88b; cg6D_: global $_W, $_GPC; goto yGIOu; PPDSY: $allorderstatus = 0; goto O0NtL; dmPwm: $start_time = strtotime($_GPC['start_time'] . ' 00:00:01'); goto JzM3V; sV8vq: $start_time = strtotime(date('Y-m-01 00:00:01', time())); goto Cny_f; oRTT4: $psize = 9999; goto ulq8Y; s9u2g: $realname = $_GPC['realname']; goto n3cuQ; GFKSz: exit; goto Bn0gb; x84dQ: XdQ8R: goto LwXPe; Qwgh5: $time = date('Y-m-d', strtotime('-' . $dateindex . ' day')); goto v3hVS; O4nil: $list = pdo_fetchall('select t1.*,t2.nickname from ' . tablename('mihua_mall_red') . ' t1 left join ' . tablename('mc_mapping_fans') . ' t2 on t1.openid=t2.openid where t2.nickname like :nickname and  t1.uniacid = :uniacid order by t1.red_id desc LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, array(":nickname" => '%' . $_GPC['realname'] . '%', ":uniacid" => $_W['uniacid'])); goto pxgwc; DHC7p: goto ilhyj; goto ZGR1q; QzO21: $lastday = date('t', strtotime($dropMonthForYaer . '-' . $selectmonthSale . '-1')); goto flQ8M; Ooljj: if (empty($_GPC['saledetailsEXP01'])) { goto NmTxP; } goto w8Ipw; CROmZ: if (empty($_GPC['salereportEXP01'])) { goto uAtiP; } goto HSpYU; JA_nw: goto G3GGz; goto p6seO; cE16y: xp7OF: goto DqJkR; GembO: $chartdata2[$index]['index'] = $index; goto AVV0E; PB5It: qdG5D: goto u2PXd; J3TY2: $conditionOrderStatus = 'and orders.status>=0'; goto gL1M6; R1RSf: if (!empty($dayordercount)) { goto Hmy5Y; } goto lkJNy; ZcRJR: foreach ($list as $id => $displayorder) { $list[$id]['ordergoods'] = pdo_fetchall('SELECT goods.thumb,ordersgoods.price,ordersgoods.total,goods.title,ordersgoods.optionname from ' . tablename('mihua_mall_order_goods') . ' ordersgoods left join ' . tablename('mihua_mall_goods') . ' goods on goods.id=ordersgoods.goodsid  where ordersgoods.uniacid = :uniacid and ordersgoods.orderid=:oid order by ordersgoods.createtime  desc ', array(":uniacid" => $_W['uniacid'], ":oid" => $list[$id]['id'])); BJiF1: } goto K7Wuj; iymem: Rq33Q: goto zhoSd; Q9AMq: $report = 'salereport02'; goto zicct; e8yUD: exit; goto b0dhz; IL1iD: include $this->template('memberranking'); goto FHEL5; JVgWa: $years = array(array("year" => $nowyear - 3, "checked" => 0), array("year" => $nowyear - 2, "checked" => 0), array("year" => $nowyear - 1, "checked" => 0), array("year" => $nowyear, "checked" => 1)); goto Yc1Pj; BAK30: $haveordermembercount = pdo_fetchcolumn('SELECT count(member.id) from ' . tablename('mihua_mall_member') . " member  WHERE member.uniacid = '{$_W['uniacid']}' and  member.from_user in (SELECT orders.from_user FROM" . tablename('mihua_mall_order') . " orders where orders.uniacid = '{$_W['uniacid']}' group by orders.from_user)"); goto jWSpB; oPD_7: $lastday = date('t', strtotime($dropdayForYaer . '-' . $selectmonthSale . '-1')); goto qa3Fk; UpMvb: $psize = 20; goto vB6vk; u2PXd: $datas[$index]['month'] = $month; goto mGEAr; GD7CE: exit; goto GXvQh; k1Ge7: $condtitiontime = ''; goto MqGDj; EkXeq: goto HVp86; goto uexUs; qRqDa: MTnhK: goto MjBng; rh0Lh: iaYQQ: goto sevpu; BGt2I: $index = 0; goto SaBkK; Fv8wE: if (!($radioMonthForSaleType == '0')) { goto TwgD2; } goto R6VMP; ktcYN: nyKgU: goto AXKBb; dlOdS: exit; goto F75rC; XAdPE: if (!($radioMonthForSaleType == '1')) { goto rxr0b; } goto TKd0_; BvqMr: $end_time = strtotime($_GPC['end_time'] . ' 23:59:59'); goto DeiGz; lZZH6: if (!($nowmonth == $month)) { goto ypvXH; } goto ZsGqM; MqGDj: $conditionflag = ''; goto t21VK; QUegc: $psize = 20; goto sw77Q; k01xh: } public function doWebCategory() { goto md9ux; kdICf: if (empty($_GPC['displayorder'])) { goto xHzxi; } goto pPyDf; md9ux: global $_W, $_GPC; goto TGoQu; PRs_3: $id = intval($_GPC['id']); goto WWEnS; h8JhY: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY parentid ASC, displayorder DESC"); goto dhNit; NTPK6: aLAVC: goto IZa3n; FceHr: $children = array(); goto h8JhY; Bq72K: Qc0jg: goto E6XuY; BCxuK: $id = intval($_GPC['id']); goto qAV5M; p7dFo: goto OcUH1; goto RMzZf; nsdPz: D3df1: goto kdICf; oZ4qr: if ($operation == 'display') { goto D3df1; } goto IGnm7; dhNit: foreach ($category as $index => $row) { goto ibsh3; V2qtJ: $children[$row['parentid']][] = $row; goto XnsnH; pRkjV: WHV6v: goto XhJM1; XnsnH: unset($category[$index]); goto VmhA1; VmhA1: zCVmD: goto pRkjV; ibsh3: if (empty($row['parentid'])) { goto zCVmD; } goto V2qtJ; XhJM1: } goto ihhOA; ihhOA: Bukug: goto Y8kpM; Jrtnk: goto uLlRT; goto nsdPz; etxK4: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto oZ4qr; rQWMv: if (!checksubmit('submit')) { goto aLAVC; } goto uk9qu; pPyDf: foreach ($_GPC['displayorder'] as $id => $displayorder) { pdo_update('mihua_mall_category', array("displayorder" => $displayorder), array("id" => $id)); QVNhL: } goto TrNud; IZa3n: include $this->template('category'); goto MO1WP; CdUAj: $this->adminMessage('抱歉，分类不存在或是已经被删除！', $this->createWebUrl('category', array("op" => "display")), 'error'); goto Bq72K; yGT2z: if (!empty($parent)) { goto Kx005; } goto BVa0I; y9CDO: nNwwd: goto SMAwG; Y8kpM: include $this->template('category'); goto Fu9Cy; N_rrV: xHzxi: goto FceHr; BQtjX: if (!empty($id)) { goto UZ0o9; } goto b2qNN; BVa0I: $this->adminMessage('抱歉，上级分类不存在或是已经被删除！', $this->createWebUrl('post'), 'error'); goto joOaG; IGnm7: if ($operation == 'post') { goto Nmw2U; } goto toByP; TGoQu: $this->__web2(); goto G_qD1; DMfk0: $this->adminMessage('抱歉，请输入分类名称！'); goto SQkAa; HVdkK: Nmw2U: goto llXVR; Tvmwz: pdo_update('mihua_mall_category', $data, array("id" => $id, "uniacid" => $_W['uniacid'])); goto EH5xE; TrNud: Ba6B1: goto ysl3Y; vWayx: $category = array("displayorder" => 0); goto nBNK3; SQkAa: XHMmn: goto GKA41; qAV5M: $category = pdo_fetch('SELECT id, parentid FROM ' . tablename('mihua_mall_category') . " WHERE id = '{$id}' and uniacid = '{$_W['uniacid']}'"); goto xgyxs; WWEnS: if (!empty($id)) { goto vdbqE; } goto vWayx; ZBeVs: $category = pdo_fetch(' SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE id = '{$id}'"); goto y9CDO; a68sx: unset($data['parentid']); goto Tvmwz; RMzZf: UZ0o9: goto a68sx; xgyxs: if (!empty($category)) { goto Qc0jg; } goto CdUAj; lv6a6: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto pe7gB; Q3G5s: uLlRT: goto aQUl9; EH5xE: OcUH1: goto rSt03; joOaG: Kx005: goto caHKH; YfwYo: $count_pcate = pdo_fetchcolumn(' SELECT id FROM ' . tablename('mihua_mall_goods') . " WHERE pcate = '{$parentid}' and ccate =0"); goto q_VvR; ysl3Y: $this->adminMessage('分类排序更新成功！', $this->createWebUrl('category', array("op" => "display")), 'success'); goto N_rrV; aIcfr: $id = pdo_insertid(); goto p7dFo; uk9qu: if (!empty($_GPC['catename'])) { goto XHMmn; } goto DMfk0; G_qD1: $uniacid = $_W['uniacid']; goto lv6a6; b2qNN: pdo_insert('mihua_mall_category', $data); goto aIcfr; MO1WP: goto uLlRT; goto rfFDJ; pe7gB: $modules = 'category'; goto etxK4; Fu9Cy: goto uLlRT; goto HVdkK; nBNK3: goto nNwwd; goto Q1B_V; E6XuY: pdo_delete('mihua_mall_category', array("id" => $id, "parentid" => $id), 'OR'); goto Cp_m5; q_VvR: $parent = pdo_fetch('SELECT id, name FROM ' . tablename('mihua_mall_category') . " WHERE id = '{$parentid}'"); goto yGT2z; SMAwG: if (empty($parentid)) { goto F80B1; } goto YfwYo; rfFDJ: W069I: goto BCxuK; GKA41: $data = array("uniacid" => $_W['uniacid'], "name" => $_GPC['catename'], "enabled" => intval($_GPC['enabled']), "displayorder" => intval($_GPC['displayorder']), "isrecommand" => intval($_GPC['isrecommand']), "description" => $_GPC['description'], "parentid" => intval($parentid), "cate_url" => $_GPC['cate_url'], "thumb" => $_GPC['images']); goto BQtjX; llXVR: $parentid = intval($_GPC['parentid']); goto PRs_3; caHKH: F80B1: goto rQWMv; rSt03: $this->adminMessage('更新分类成功！', $this->createWebUrl('category', array("op" => "display")), 'success'); goto NTPK6; Cp_m5: $this->adminMessage('分类删除成功！', $this->createWebUrl('category', array("op" => "display")), 'success'); goto Q3G5s; Q1B_V: vdbqE: goto ZBeVs; toByP: if ($operation == 'delete') { goto W069I; } goto Jrtnk; aQUl9: } public function doWebIndex() { goto WpK9y; WA4MO: if ($createtime == 1) { goto Re0yk; } goto ahGwI; esZ4K: $address = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_address') . ' WHERE id IN (\'' . implode('\',\'', $addressids) . '\')', array(), 'id'); goto dKAOB; fTzqF: goto hTSsL; goto ZE3uv; i0Za4: dd05q: goto d6vh4; O5jGM: JOMbN: goto js0TW; PXMqw: $where .= ' and status in(0,1,2,3)'; goto mldMf; g71_t: xO6R1: goto EJbEo; WpK9y: global $_GPC, $_W; goto fsASr; wyFch: ZYTWi: goto Mh2xe; wCimU: $weekNum = pdo_fetch('SELECT COUNT(*)as num, cast(sum(price) as decimal(10,2))  as money FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . " and DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE_FORMAT(FROM_UNIXTIME(createtime),'%Y-%m-%d') {$condition}"); goto fxbVg; G7Gfj: goto hTSsL; goto i0Za4; gsT7X: $where .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto fTzqF; y01Lq: $remark = pdo_fetchall('select id, ordersn ,remark from ' . tablename('mihua_mall_order') . ' where uniacid =:uniacid  and remark !=\'\' order by id desc limit 5 ', array(":uniacid" => $_W['uniacid'])); goto D1qVg; xk4OQ: $name = 'yestdayNum' . $i; goto xiriD; ho1gW: $goodNum = pdo_fetchcolumn('SELECT COUNT(*) FROM' . tablename('mihua_mall_goods') . 'WHERE `uniacid` = :uniacid and deleted=0  ', array(":uniacid" => $_W['uniacid'])); goto MYAx_; GE4Ah: $where = " uniacid = '{$_W['uniacid']}'"; goto M7GU2; mldMf: goto hTSsL; goto HAcWQ; fxbVg: if (!empty($weekNum['money'])) { goto ErpSI; } goto aDaJF; GgxUW: yvxQ0: goto zHYY_; iayGp: message('您的账号没有访问此公众号的权限.'); goto X4nC4; ghoDT: $createtime = intval($_GPC['createtime']); goto D4hlN; qKQa7: $todayNum = pdo_fetch('SELECT COUNT(*)as num, cast(sum(price) as decimal(10,2))  as money FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . " and DATE_FORMAT(FROM_UNIXTIME(createtime),'%Y-%m-%d') = DATE_FORMAT(NOW(),'%Y-%m-%d') {$condition}"); goto iQb50; tz_dh: if ($status == 1 && $sendtype == 2) { goto ZYTWi; } goto T0Y8n; aDaJF: $weekNum['money'] = 0; goto Cn8Qe; LrG46: $where .= ' and (ordertype=1 or (ordertype!=1 and iscomplete=1))'; goto gsT7X; RrY5x: unset($row); goto IdcCF; kL_dq: NdbN2: goto VBEmw; nUQ0J: KKtwv: goto wCimU; T0Y8n: if ($status == 1 && empty($sendtype)) { goto T0l4P; } goto XnZ_a; MJ2gy: $remark = intval($_GPC['remark']); goto GE4Ah; H67ve: $where .= " and status={$status}"; goto G7Gfj; NeoDw: if (!empty($yestdayNum['money'])) { goto VprY6; } goto AL7sE; vhFjA: $monthNum['money'] = 0; goto y0181; iQb50: if (!empty($todayNum['money'])) { goto JOMbN; } goto GnBre; jdTge: $monthNum = pdo_fetch('SELECT COUNT(*)as num, cast(sum(price) as decimal(10,2))  as money FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . " and DATE_SUB(CURDATE(), INTERVAL 30 DAY) <= DATE_FORMAT(FROM_UNIXTIME(createtime),'%Y-%m-%d') {$condition}"); goto WXjfp; Aj6ez: $memberNum = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid  and  realname !=\'\'  ', array(":uniacid" => $_W['uniacid'])); goto ho1gW; Cn8Qe: ErpSI: goto jdTge; y0181: BAbbY: goto ZVNBc; D1qVg: include $this->template('index'); goto VrZxX; dKAOB: SGI5x: goto y01Lq; EJbEo: if (!($i <= 14)) { goto KKtwv; } goto xk4OQ; ljcXX: $i = 2; goto g71_t; ZE3uv: rISug: goto PXMqw; AL7sE: $yestdayNum['money'] = 0; goto HxKut; zHYY_: $i++; goto aNL8I; MYAx_: $orderNum = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE `uniacid` = :uniacid  {$condition} ", array(":uniacid" => $_W['uniacid'])); goto qKQa7; fsASr: if (in_array($_W['role'], array("manager", "operator", "founder", "clerk", "vice_founder"))) { goto DxHlq; } goto iayGp; GnBre: $todayNum['money'] = 0; goto O5jGM; ahGwI: if ($remark == 1) { goto NdbN2; } goto H67ve; M7GU2: if (empty($status)) { goto dd05q; } goto tz_dh; Mh2xe: $where .= ' and ( status=1 and sendtype =2 )'; goto KHWGT; CIZxN: hTSsL: goto CBko2; D4hlN: $sendtype = intval($_GPC['sendtype']); goto MJ2gy; KHWGT: goto hTSsL; goto oRF_8; oRF_8: T0l4P: goto LrG46; WXjfp: if (!empty($monthNum['money'])) { goto BAbbY; } goto vhFjA; UjRBm: o2UKw: goto RrY5x; QwVk7: $condition = ' and (status in (0,1,2,3,4,5,6,7))'; goto Aj6ez; F6BFl: if (empty($addressids)) { goto SGI5x; } goto esZ4K; HAcWQ: Re0yk: goto eOEos; VBEmw: $where .= ' and remark !=\'\''; goto CIZxN; js0TW: $yestdayNum = pdo_fetch('SELECT COUNT(*)as num,cast(sum(price) as decimal(10,2))  as money FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . " and TO_DAYS( NOW( ) ) - TO_DAYS(DATE_FORMAT(FROM_UNIXTIME(createtime),'%Y-%m-%d')) <= 1 {$condition}"); goto NeoDw; hqjCA: goto hTSsL; goto wyFch; aNL8I: goto xO6R1; goto nUQ0J; eOEos: $where .= 'and DATE_FORMAT(FROM_UNIXTIME(createtime),\'%Y-%m-%d\') = DATE_FORMAT(NOW(),\'%Y-%m-%d\')'; goto cXO6h; X4nC4: DxHlq: goto QwVk7; ZVNBc: $status = intval($_GPC['status']); goto ghoDT; nbJeV: if (empty($list)) { goto hHW9k; } goto V20Kf; HxKut: VprY6: goto ljcXX; xiriD: ${$name} = pdo_fetch('SELECT COUNT(*)as num, cast(sum(price) as decimal(10,2))  as money FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . " and TO_DAYS( NOW( ) ) - TO_DAYS(DATE_FORMAT(FROM_UNIXTIME(createtime),'%Y-%m-%d')) = {$i} {$condition}"); goto GgxUW; cXO6h: goto hTSsL; goto kL_dq; IdcCF: hHW9k: goto F6BFl; V20Kf: foreach ($list as &$row) { goto ffiMB; X38qF: $row['dispatch'] = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . ' WHERE id = :id', array(":id" => $row['dispatch'])); goto PIDXe; PIDXe: h7HJi: goto jusra; ffiMB: !empty($row['addressid']) && ($addressids[$row['addressid']] = $row['addressid']); goto X38qF; jusra: } goto UjRBm; d6vh4: $where .= 'and DATE_FORMAT(FROM_UNIXTIME(createtime),\'%Y-%m-%d\') = DATE_FORMAT(NOW(),\'%Y-%m-%d\')'; goto hqjCA; XnZ_a: if ($status == 6) { goto rISug; } goto WA4MO; CBko2: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE  {$where} ORDER BY id DESC LIMIT 5"); goto nbJeV; VrZxX: } public function doWebLoginout() { goto sBrLj; QgHKx: isetcookie('_admin_id', '', time() - 1); goto ymLfl; ctXV_: include $this->template('signin'); goto Moe5J; vRiEx: isetcookie('__uid', '', time() - 1); goto ctXV_; sBrLj: global $_GPC, $_W; goto QgHKx; ymLfl: isetcookie('__session', '', time() - 1); goto vRiEx; Moe5J: exit; goto nHfQy; nHfQy: } public function doMobileLogin() { goto uuVH2; xgH8W: isetcookie('__session', '', time() - 1); goto ayOcu; dShlP: isetcookie('_admin_id', '', time() - 1); goto xgH8W; er0ib: exit; goto YtP93; ayOcu: isetcookie('__uid', '', time() - 1); goto V9C6P; uuVH2: global $_GPC, $_W; goto dShlP; V9C6P: include $this->template('../signin'); goto er0ib; YtP93: } public function doMobileLoginup() { goto MvfMe; n569O: tGuIV: goto Nda2V; mid1w: aNyS3: goto lpEYr; L2X4y: exit; goto bL0Nw; XAxr6: xy60d: goto sg20I; kbftt: exit; goto eOHsW; Nda2V: message($result['msg'], referer(), 'error'); goto kbftt; MvfMe: global $_GPC, $_W; goto j1YoL; sg20I: header('Location:' . $_W['siteroot'] . 'web/' . $this->createWebUrl('uniacidList')); goto L2X4y; zkOuY: goto dShPw; goto n569O; j1YoL: $admin = new Admin(); goto UKTFm; bL0Nw: dShPw: goto mid1w; IktJf: $result = $admin->adminLogin($_GPC['username'], $_GPC['password']); goto nwOmI; eOHsW: goto dShPw; goto XAxr6; nwOmI: if ($result['errcode'] == 1) { goto tGuIV; } goto lncj0; lncj0: if ($result['errcode'] == 0) { goto xy60d; } goto zkOuY; UKTFm: if (!$_GPC['username']) { goto aNyS3; } goto IktJf; lpEYr: } public function doWebuniacidList() { goto r_pBi; EBLO2: $pars[':uid'] = $_W['uid']; goto V_bTY; h_nz6: $total = pdo_fetchcolumn($tsql, $pars); goto MYlMW; YOxRX: hfOoL: goto Kurnf; V_bTY: $order_by = ' ORDER BY c.`rank` DESC'; goto fVwTz; VPXtb: irAuJ: goto lbK13; MYlMW: $sql = 'SELECT * FROM ' . tablename('uni_account') . ' as a LEFT JOIN' . tablename('account') . " as b ON a.default_acid = b.acid  {$condition} {$order_by}, a.`uniacid` DESC "; goto UMgFq; AYi8C: if (!($_GPC['ac'] == 'change')) { goto KJNXW; } goto Su_vS; VD_dH: $condition .= ' WHERE a.default_acid <> 0 AND b.isdeleted <> 1'; goto LU9sE; NiY30: if (!empty($_W['isfounder'])) { goto lSNGe; } goto VP98s; lbK13: $tsql = 'SELECT COUNT(*) FROM ' . tablename('uni_account') . ' as a LEFT JOIN' . tablename('account') . " as b ON a.default_acid = b.acid {$condition} {$order_by}, a.`uniacid` DESC"; goto h_nz6; lgv4s: foreach ($list as $unia => &$account) { goto w6sS0; Exvkn: $account['role'] = uni_permission($_W['uid'], $account['uniacid']); goto wco14; wco14: $account['setmeal'] = uni_setmeal($account['uniacid']); goto UnmWP; w6sS0: $account['details'] = uni_accounts($account['uniacid']); goto Exvkn; UnmWP: Te4x_: goto LxVvJ; LxVvJ: } goto UUgbn; Su_vS: isetcookie('__uniacid', $_GPC['uniacid'], 7 * 86400); goto U2ad2; DLlT_: $list = pdo_fetchall($sql, $pars); goto nnMUt; pNYaB: exit; goto XqYvP; UUgbn: qGaob: goto YOxRX; Kurnf: include $this->template('uniacidList'); goto IvtQO; r_pBi: global $_GPC, $_W; goto AYi8C; VP98s: $condition .= 'LEFT JOIN ' . tablename('uni_account_users') . ' as c ON a.uniacid = c.uniacid WHERE a.default_acid <> 0 AND c.uid = :uid AND b.isdeleted <> 1'; goto EBLO2; nnMUt: if (empty($list)) { goto hfOoL; } goto lgv4s; U2ad2: isetcookie('__uid', $_W['uid'], 7 * 86400); goto dPNN9; D_VDj: header('Location:' . $this->createWebUrl('index')); goto pNYaB; UMgFq: $pager = pagination($total, $pindex, $psize); goto DLlT_; LU9sE: $order_by = ' ORDER BY a.`rank` DESC'; goto VPXtb; IvtQO: exit; goto pAX_0; XqYvP: KJNXW: goto NiY30; fVwTz: goto irAuJ; goto jc8rw; jc8rw: lSNGe: goto VD_dH; dPNN9: $_SESSION['uniacid'] = $_GPC['uniacid']; goto D_VDj; pAX_0: } public function doWebVirtual_comments() { goto kbODK; sIvxT: include $this->template('comments_detail'); goto T7p3t; umISi: $cid = intval($_GPC['cate_2']); goto I7DNz; wBqop: H1H60: goto sgr8z; GuyVw: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}' and deleted=0 {$condition} ORDER BY status DESC, displayorder DESC, id DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto NkvJ6; D0WBW: exit; goto gxv6u; bCQLk: VGFKJ: goto umISi; QTT6H: goto Cc9S0; goto wBqop; iy27O: $in['goods_id'] = $gid; goto iVYmj; TXOhC: $cid = intval($_GPC['cate_1']); goto Xo7O0; PNOuz: $itembyid = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id', array(":id" => $id)); goto PdMoe; A2oMf: $op = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto YM6xl; zV20s: KVqFZ: goto X8Tr4; z8K39: u3Evv: goto GuyVw; zXHRZ: r7Gp5: goto TXOhC; N0oHG: $in['nickname'] = trim($_GPC['nickname']); goto jpilv; wuJ_o: f1liX: goto SjUWB; Zmbu8: $gid = $_GPC['gid']; goto sjVew; gxv6u: Mk1yR: goto dJpLh; fYY43: if (empty($_GPC['keyword'])) { goto py0wn; } goto pzKyD; T1CPI: S7m2p: goto hT7Sm; af83i: if (!isset($_GPC['status'])) { goto yvXGD; } goto jbvLC; hT7Sm: if (!($op == 'delete_comments')) { goto uupgF; } goto yTfM1; jpilv: if ($addtime) { goto H1H60; } goto dxUqf; VOxJv: $in['status'] = '1'; goto rvhvz; ZU8mG: exit; goto Fma_9; zGndy: $id = intval($_GPC['id']); goto OX_t0; Fma_9: Hjj2U: goto T1CPI; iVYmj: $in['comment_content'] = $comment; goto N0oHG; ZG8_W: goto Mk1yR; goto zV20s; S06mu: $psize = 10; goto zGndy; j4Ez9: $condition = ''; goto IVbbK; kQV9i: $psize = 20; goto j4Ez9; H9z3b: if (!($op == 'post')) { goto iao0g; } goto S06mu; E2TkS: goto RobhH; goto wuJ_o; CBcdI: BVlt7: goto D9K2V; tN05x: cmFOH: goto iy27O; PvDzM: if (!isset($_GPC['status'])) { goto u3Evv; } goto mF4yw; dJpLh: uupgF: goto sRdVC; T7p3t: exit; goto WN72S; qqPip: Cc9S0: goto mrHpp; sjVew: $comment = $_GPC['comment']; goto L0hQI; pzKyD: $condition .= " AND title LIKE '%{$_GPC['keyword']}%'"; goto fpLvV; paN_3: $children = ''; goto vaQvq; bSUJ5: $this->adminMessage('删除失败', $this->createWebUrl('virtual_comments', array("op" => "post", "id" => $gid)), 'error'); goto ug4Dl; kbODK: global $_GPC, $_W; goto G1hYR; vaQvq: foreach ($category as $cid => $cate) { goto uUddW; cCzj1: feA3S: goto MvyII; sMpX8: $children[$cate['parentid']][$cate['id']] = array($cate['id'], $cate['name']); goto jJ_wK; uUddW: if (empty($cate['parentid'])) { goto gPpUw; } goto sMpX8; jJ_wK: gPpUw: goto cCzj1; MvyII: } goto GyXBQ; qH0mi: if ($comment) { goto cmFOH; } goto RaOhN; RaOhN: $this->adminMessage('请求不能为空', $this->createWebUrl('virtual_comments', array("op" => "post", "id" => $gid)), 'error'); goto aEiEh; medi4: goto v0h87; goto bCQLk; osT8w: if (empty($category)) { goto i7EbG; } goto paN_3; rKNhY: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . ' g left join ' . tablename('mihua_mall_othercate') . " o on g.othercate= o.othercate  WHERE  g.uniacid = '{$_W['uniacid']}' and g.deleted=0 {$condition}"); goto CBcdI; Xo7O0: $condition .= " AND pcate = '{$cid}'"; goto cpMaK; sgr8z: $in['addtime'] = $addtime; goto qqPip; PdMoe: $list = pdo_fetchall('select comment.* , comment.nickname as xnnickname,user.avatar,user.nickname,goods.title,goods.thumb from ' . tablename('mihua_mall_comment') . ' comment  left join  ' . tablename('mihua_mall_goods') . ' goods on goods.id=comment.goods_id
		            					left join ' . tablename('mc_members') . ' user on user.uid=comment.uid where goods.id= :id  and comment.uniacid =:uniacid order by comment.addtime desc  LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, array(":id" => $id, "uniacid" => $_W['uniacid'])); goto u20Ew; cpMaK: v0h87: goto PvDzM; u8hqk: goto BVlt7; goto C_lim; MihVM: if ($cid) { goto KVqFZ; } goto bSUJ5; M9cpZ: if (empty($_GPC['keyword'])) { goto FpWe2; } goto gF7dF; YM6xl: $pindex = max(1, intval($_GPC['page'])); goto kQV9i; rvhvz: pdo_insert('mihua_mall_comment', $in); goto VU8Ws; jbvLC: $condition .= ' AND g.status = \'' . intval($_GPC['status']) . '\''; goto ksmL3; OX_t0: if (empty($id)) { goto TTfB4; } goto PNOuz; ocMbM: $this->adminMessage('删除成功', $this->createWebUrl('virtual_comments', array("op" => "post", "id" => $gid)), 'success'); goto D0WBW; A1DC3: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY parentid ASC, displayorder DESC", array(), 'id'); goto osT8w; yTfM1: $gid = $_GPC['gid']; goto Yx7Hx; IKhwu: if (!($op == 'post_comments')) { goto S7m2p; } goto Zmbu8; zoGHS: if (!empty($_GPC['cate_2'])) { goto f1liX; } goto e37GH; ljXqf: goto v0h87; goto zXHRZ; X8Tr4: pdo_delete('mihua_mall_comment', array("comment_id" => $cid, "uniacid" => $_W['uniacid'])); goto ocMbM; gPhbm: goto Hjj2U; goto tN05x; I7DNz: $condition .= " AND ccate = '{$cid}'"; goto ljXqf; jsb34: a7QAT: goto l_9bG; ksmL3: yvXGD: goto mzPwI; aEiEh: exit; goto gPhbm; tR34U: i7EbG: goto A2oMf; wPx8j: FpWe2: goto zoGHS; WN72S: iao0g: goto IKhwu; bLSuI: if (!empty($_GPC['cate_1'])) { goto r7Gp5; } goto medi4; Q7hM3: if (!empty($_GPC['cate_2'])) { goto VGFKJ; } goto bLSuI; sRdVC: include $this->template('virtual_comments'); goto o6Al2; l_9bG: $cid = intval($_GPC['cate_1']); goto oEsRc; GyXBQ: CCjsv: goto tR34U; VU8Ws: $this->adminMessage('提交成功', $this->createWebUrl('virtual_comments', array("op" => "post", "id" => $gid)), 'success'); goto ZU8mG; fpLvV: py0wn: goto Q7hM3; T_5S7: $cfg = $this->module['config']; goto A1DC3; vqcsR: goto RobhH; goto jsb34; oEsRc: $condition .= " AND (g.pcate = '{$cid}' or o.cateid= '{$cid}')"; goto h3a1n; mzPwI: $list = pdo_fetchall('SELECT  distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . " o on g.othercate= o.othercate  WHERE  g.uniacid = '{$_W['uniacid']}' and g.deleted=0 {$condition} 
			 ORDER BY g.status DESC, g.displayorder DESC, g.id DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto rKNhY; ug4Dl: exit; goto ZG8_W; mrHpp: $in['uniacid'] = $_W['uniacid']; goto VOxJv; G1hYR: $this->__web2(); goto T_5S7; kwW36: $condition .= " AND (g.ccate = '{$cid}' or o.cateid= '{$cid}')"; goto vqcsR; SjUWB: $cid = intval($_GPC['cate_2']); goto kwW36; L0hQI: $addtime = strtotime($_GPC['addtime']); goto qH0mi; u20Ew: TTfB4: goto sIvxT; gF7dF: $condition .= " AND g.title LIKE '%{$_GPC['keyword']}%'"; goto wPx8j; mF4yw: $condition .= ' AND status = \'' . intval($_GPC['status']) . '\''; goto z8K39; C_lim: IJO05: goto M9cpZ; e37GH: if (!empty($_GPC['cate_1'])) { goto a7QAT; } goto E2TkS; D9K2V: $pager = pagination($total, $pindex, $psize); goto H9z3b; dxUqf: $in['addtime'] = TIMESTAMP; goto QTT6H; IVbbK: if (!empty($_GPC['cate_2']) || !empty($_GPC['cate_1'])) { goto IJO05; } goto fYY43; NkvJ6: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 {$condition}"); goto u8hqk; h3a1n: RobhH: goto af83i; Yx7Hx: $cid = $_GPC['cid']; goto MihVM; o6Al2: } public function doWebComment() { goto N2L7k; hf99m: $op = trim($_GPC['op']) ? trim($_GPC['op']) : 'list'; goto ogWSw; tRtlS: if ($_GPC['title'] && $_GPC['status'] == -1) { goto dm6oB; } goto sml6T; Uu18g: exit; goto TAUiC; FTrhM: wvlLh: goto ZgTlO; he2s7: if ($_GPC['title'] && $_GPC['status'] != -1) { goto JaB93; } goto TZVOP; P60HY: PaRXt: goto eZl7B; HTMp7: WkASU: goto gDXq6; B4Kpn: pdo_delete('mihua_mall_comment', array("comment_id" => $cid, "uniacid" => $uniacid)); goto Veqlb; Q4bxk: include $this->template('comment'); goto Uu18g; DuNCF: $title = $_GPC['title']; goto wrCeK; kxWS0: die(json_encode(array("status" => "success"))); goto yqbjF; pRXPW: $this->adminMessage('操作成功', $this->createWebUrl('comment', array("status" => "-1")), 'success'); goto opvBY; HbGE2: IOHK7: goto tPET5; Veqlb: $this->adminMessage('删除成功', $this->createWebUrl('comment'), 'success'); goto hLpwK; Yd5lw: $list = pdo_fetchall('select comment.* ,user.avatar,user.nickname,goods.title from ' . tablename('mihua_mall_comment') . ' comment  left join  ' . tablename('mihua_mall_goods') . ' goods on goods.id=comment.goods_id
		            					left join ' . tablename('mc_members') . ' user on user.uid=comment.uid where comment.status=:status  and comment.uniacid =:uniacid  and  goods.title like :title order by comment.comment_id desc', array(":status" => $_GPC['status'], ":title" => "%{$title}%", "uniacid" => $uniacid)); goto S30j3; dJJW3: Dmsjw: goto LKPJC; N2L7k: global $_GPC, $_W; goto QSIcv; qESIb: $psize = 20; goto QVxU0; iNaE8: $pindex = max(1, intval($_GPC['page'])); goto qESIb; SJIUq: $cid = (int) $_GPC['cid']; goto NiJ5W; hLpwK: UFdya: goto YgMZz; sml6T: if (!$_GPC['title'] && $_GPC['status'] != -1) { goto WkASU; } goto he2s7; d2OTz: if (!($op == 'delete')) { goto UFdya; } goto eM5od; opvBY: XdaBo: goto kQ6tK; YgMZz: if (!($op == 'domanage')) { goto XdaBo; } goto JuVRu; JuVRu: $cid = (int) $_GPC['cid']; goto yuJv0; yqbjF: exit; goto P60HY; tPET5: $total = count($list); goto E3JGg; UkFCk: JaB93: goto R5Xkx; QVxU0: $uniacid = $_W['uniacid']; goto hf99m; gDXq6: $list = pdo_fetchall('select comment.* ,user.avatar,user.nickname,goods.title from ' . tablename('mihua_mall_comment') . ' comment  left join  ' . tablename('mihua_mall_goods') . ' goods on goods.id=comment.goods_id
		            					left join ' . tablename('mc_members') . ' user on user.uid=comment.uid where comment.status=:status  and comment.uniacid =:uniacid  order by comment.comment_id desc', array("status" => $_GPC['status'], "uniacid" => $uniacid)); goto W8qtR; TLSpm: $status = -1; goto Jhqqq; TAUiC: mq2FS: goto d2OTz; W8qtR: goto IOHK7; goto UkFCk; Jhqqq: $_GPC['status'] = $status; goto FTrhM; ZgTlO: if (!($op == 'list')) { goto mq2FS; } goto tRtlS; NiJ5W: pdo_update('mihua_mall_comment', array("reply" => $_GPC['reply']), array("comment_id" => $cid, "uniacid" => $uniacid)); goto kxWS0; a2iNv: goto IOHK7; goto HTMp7; sft8L: dm6oB: goto DuNCF; ogWSw: if (!(empty($_GPC['status']) && $_GPC['status'] != 0)) { goto wvlLh; } goto TLSpm; uS1xI: goto IOHK7; goto sft8L; E3JGg: $pager = pagination($total, $pindex, $psize); goto Q4bxk; kQ6tK: if (!($op == 'reply')) { goto PaRXt; } goto SJIUq; QSIcv: $this->__web2(); goto iNaE8; eM5od: $cid = (int) $_GPC['cid']; goto B4Kpn; TZVOP: if ($_GPC['status'] == -1) { goto Dmsjw; } goto uS1xI; R5Xkx: $title = $_GPC['title']; goto Yd5lw; S30j3: goto IOHK7; goto dJJW3; yuJv0: pdo_update('mihua_mall_comment', array("status" => $_GPC['status']), array("comment_id" => $cid, "uniacid" => $uniacid)); goto pRXPW; LKPJC: $list = pdo_fetchall('select comment.* ,user.avatar,user.nickname,goods.title from ' . tablename('mihua_mall_comment') . ' comment  left join  ' . tablename('mihua_mall_goods') . ' goods on goods.id=comment.goods_id
		            					left join ' . tablename('mc_members') . " user on user.uid=comment.uid where 1=1  and comment.uniacid ={$uniacid}  order by comment.comment_id  desc LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto HbGE2; wrCeK: $list = pdo_fetchall('select comment.* ,user.avatar,user.nickname,goods.title from ' . tablename('mihua_mall_comment') . ' comment  left join  ' . tablename('mihua_mall_goods') . ' goods on goods.id=comment.goods_id
		            					left join ' . tablename('mc_members') . ' user on user.uid=comment.uid where goods.title like :title  and comment.uniacid =:uniacid order by comment.comment_id desc ', array("title" => "%{$title}%", "uniacid" => $uniacid)); goto a2iNv; eZl7B: } public function doWebGetWebGoods() { goto htiXw; mp7Vl: if (empty($list)) { goto iu3Y4; } goto vAIaJ; mVc5d: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_category') . ' where parentid=:cid and enabled=1 ', $where); goto uGTcu; W9wFh: exit; goto URuwi; uGTcu: uQsVR: goto mp7Vl; htiXw: global $_W, $_GPC; goto eR6qq; vAIaJ: echo json_encode(array("status" => "success", "list" => $list)); goto VmgCn; OmDUu: $where[':cid'] = $cid; goto mVc5d; NUTlZ: $cid = intval($_GPC['cid']); goto lTrvL; eR6qq: $errcode = 0; goto NUTlZ; VmgCn: iu3Y4: goto W9wFh; lTrvL: if (!($cid != '0')) { goto uQsVR; } goto OmDUu; URuwi: } public function doWebSetGoodsProperty() { goto zrAHX; xTLbB: pdo_update('mihua_mall_goods', array('is' . $type => $data), array("id" => $id, "uniacid" => $_W['uniacid'])); goto DKW6z; yQhoU: die(json_encode(array("result" => 1, "data" => $data))); goto AcOFw; BKqOM: if ($_GPC['type'] == 'status') { goto ARIOr; } goto xTLbB; zrAHX: global $_GPC, $_W; goto m9wS0; iSfLQ: pdo_update('mihua_mall_goods', array($type => $data), array("id" => $id, "uniacid" => $_W['uniacid'])); goto UV4a9; UV4a9: ErJHB: goto yQhoU; ZX2lr: if (in_array($type, array("new", "hot", "recommand", "discount", "status", "sendfree"))) { goto h_7JF; } goto Rtrje; k4beu: h_7JF: goto BKqOM; Rtrje: die(json_encode(array("result" => 0))); goto k4beu; F0Sfi: ARIOr: goto iSfLQ; m9wS0: $id = intval($_GPC['id']); goto FttWG; FttWG: $type = $_GPC['type']; goto K8rkV; DKW6z: goto ErJHB; goto F0Sfi; K8rkV: $data = intval($_GPC['data']); goto EXJ3m; EXJ3m: empty($data) ? $data = 1 : ($data = 0); goto ZX2lr; AcOFw: } public function doWebGoods() { goto z_Tog; KPcQq: goto bhOUw; goto isqu5; aDEHC: $this->adminMessage('操作失败！', referer(), 'error'); goto DjCqf; uEUSF: pdo_update('mihua_mall_spec', $a, array("id" => $get_spec_id)); goto pLbM0; fgWgl: $h[$m][$j] = array("html" => "", "id" => $specs[$m]['items'][$kid]['id']); goto WdL9f; IaVEt: $piclist1 = unserialize($item['thumb_url']); goto XZ0Tc; kmu3y: oevrq: goto U8sLL; txR8v: nkhai: goto LYt9o; YE3Jr: $d['id'] = $item_id; goto hRFng; uiVnx: $option_id = $get_option_id; goto PCfW7; FKa5U: if (is_numeric($get_item_id)) { goto YDnLx; } goto EVVXI; q3ayj: pdo_query('delete from ' . tablename('mihua_mall_spec_item') . " where uniacid={$_W['uniacid']} and specid={$spec_id}"); goto bN4xp; X8_AS: $n = 0; goto CN6fh; hKqLZ: if (!empty($_GPC['cate_2'])) { goto tLocY; } goto wdAEG; c2OLs: kOBqP: goto H2dtt; NYKrm: $hh .= '<input name="option_stock_' . $ids . '[]"  type="text" class="span1 option_stock option_stock_' . $ids . '" value="' . $val['stock'] . '"/></td>'; goto HhUmg; SdH7v: kJGEH: goto zCB9k; aLAdX: tLocY: goto CPdAX; y7ja9: I3BM9: goto fnRmw; WFGkz: if (!($red_packet < 1 || $red_packet > 200)) { goto DT2ur; } goto YVijc; WbAwj: goto mQgfF; goto j4_0U; Mmx9I: $res = WebCommon::deleteAllGood($_GPC['checkid']); goto gUBS7; xpH2K: o2Pbr: goto FBDyb; DRuvF: $spec_item_titles = $_POST['spec_item_title_' . $get_spec_id]; goto oSnss; AeRH_: $html .= '<th><div class="input-append input-prepend"><span class="add-on">重量(克)</span><input type="text" class="span1 option_weight_all"  VALUE=""/><span class="add-on"><a href="javascript:;" class="icon-hand-down" title="批量设置" onclick="setCol(\'option_weight\');"></a></span></div></th>'; goto afMdc; alfXD: U_bYR: goto sD4KX; Kmhrb: $param_id = ''; goto Zjfzg; Eveih: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 {$condition}"); goto OWFCd; iype7: $this->adminMessage($upload['message'], '', 'error'); goto YMD1N; mhTOb: AiSCu: goto pjqmw; vilHF: $children = array(); goto MTIHC; ls1ml: $condition .= " AND pcate = '{$cid}'"; goto fGyrF; obBEl: include $this->template('goods'); goto RyizT; NouTX: $hh .= $h[$j][$i]['html']; goto Fhhx8; VQQfy: $idsarr = explode('_', $ids); goto ZSHae; WrRfi: $hh .= '<td><input name="option_productprice_' . $ids . '[]" type="text" class="span1 option_productprice option_productprice_' . $ids . '" " value="' . $val['productprice'] . '"/></td>'; goto yyU33; bvRgh: KEJV3: goto V5kzi; Pl1zZ: g7Ty3: goto kEPyU; GzeC1: pdo_update('mihua_mall_goods', array("deleted" => 1), array("id" => $id, "uniacid" => $_W['uniacid'])); goto Qoxj8; vxj1H: XVOEM: goto L88Ww; t_jUX: if (!($j < $len)) { goto DWv7Z; } goto hQn1q; y5hvU: $othercate = date('mdH') . random(4, 1); goto lp3wi; gSv9L: if (!empty($_GPC['cate_2']) || !empty($_GPC['cate_1'])) { goto v2Xfl; } goto oSTsh; Wpbjx: $id = intval($_GPC['id']); goto nljIN; sRW2U: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY parentid ASC, displayorder DESC"); goto J0tjW; hbU0j: if (!($item['othercate'] > 0)) { goto qCUfd; } goto mN3po; olbTL: goto g7Ty3; goto FvCTm; vfnB0: $data['thumb'] = $upload['path']; goto i49Ri; lBquu: $get_option_id = $_GPC['option_id_' . $ids][0]; goto ZBo76; lp3wi: w76ap: goto p2JCY; ddHnA: VlmbO: goto oo9fM; h_8kH: $hh .= '<tr>'; goto FbK10; ENbG6: $specids = array(); goto XEQ9A; GDcNc: $hh .= '<td><input name="option_marketprice_' . $ids . '[]" type="text" class="span1 option_marketprice option_marketprice_' . $ids . '" value="' . $val['marketprice'] . '"/></td>'; goto WrRfi; B2Kk7: $stores = pdo_fetchall('select id,storename from ' . tablename('mihua_mall_store') . ' where id in (' . $item['storeids'] . ' ) and uniacid=' . $_W['uniacid']); goto kskRB; UpUbV: Txhj8: goto RF_0b; jkIPg: Afti5: goto lxsNV; AfOYx: $i = 0; goto p2kYb; jRPeQ: Xzk0y: goto QtTKY; gfF0r: goto KkV6y; goto vxj1H; XdS_h: $j++; goto WbAwj; w2V1O: APPPZ: goto QZUa_; nPj06: $id = intval($_GPC['id']); goto Qtqwm; WR7Pj: goto mT1pX; goto raPVu; QdUsN: ZY9k0: goto tMEJe; cKMm_: if (empty($_FILES['xsthumb']['tmp_name'])) { goto oqVOR; } goto igyin; fXXbP: SpcV7: goto s7IE8; iNZB0: $option_weights = $_POST['option_weight']; goto ahZmD; piTHb: pdo_update('mihua_mall_goods_option', $a, array("id" => $get_option_id)); goto uiVnx; cy3XC: $optionids[] = $option_id; goto mhTOb; oSnss: $spec_item_shows = $_POST['spec_item_show_' . $get_spec_id]; goto xzJBg; VaKGA: if (!is_array($piclist1)) { goto FmR9Q; } goto QG1NU; x8L4O: x776q: goto MZI_A; Si9Zk: if ($operation == 'post') { goto ScX1R; } goto zNc3K; aIVfn: $page = intval($_GPC['page']); goto s5NYx; K6zVZ: x10Z_: goto ezfrh; OGSVJ: $condition .= ' AND status = \'' . intval($_GPC['status']) . '\''; goto alfXD; QpuRA: $total = intval($_GPC['total']); goto fo8SJ; BHjRB: QxGd_: goto qFCV8; YH252: VDihN: goto gKGBn; kVDxt: qj47b: goto EitdS; NfvHt: model_good::editGoodWithEditPage($id, 'edit', $this); goto Dl1pi; oSTsh: if (empty($_GPC['keyword'])) { goto MZhtd; } goto HTtKF; mXzjO: hbic0: goto z6SRr; sD4KX: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}' and deleted=0 {$condition} ORDER BY  sort DESC  LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto Eveih; NekOM: $get_spec_id = $spec_ids[$k]; goto zv1yD; LgfMz: $options = pdo_fetchall('select * from ' . tablename('mihua_mall_goods_option') . ' where goodsid=:id order by id asc', array(":id" => $id)); goto EHTon; Lo7em: goto FhAkz; goto c2OLs; Uk7mg: $k = 0; goto f2vTT; QVXlQ: $rowspans = array(); goto LHag4; Svab_: $virtual_types = pdo_fetchall('select * from ' . tablename('mihua_mall_virtual_type') . ' where uniacid=:uniacid order by id asc', array(":uniacid" => $_W['uniacid'])); goto sRW2U; GN4WH: $piclist = unserialize($item['thumb_url']); goto ZOK0c; WKPQe: $html .= '<th><div class="input-append input-prepend"><span class="add-on">销售价格</span><input type="text" class="span1 option_marketprice_all"  VALUE=""/><span class="add-on"><a href="javascript:;" class="icon-hand-down" title="批量设置" onclick="setCol(\'option_marketprice\');"></a></span></div><br/></th>'; goto JttZo; z_Tog: global $_GPC, $_W; goto aIVfn; RyizT: exit; goto umhf2; suPXS: ekeaB: goto Vb0xI; bB7Vu: if (empty($_GPC['keyword'])) { goto K71sU; } goto T3PXl; y2fBm: $spec_item_ids = $_POST['spec_item_id_' . $get_spec_id]; goto DRuvF; tfd9V: unset($s); goto PCOOK; py4Ce: if (!isset($_GPC['status'])) { goto APPPZ; } goto S2hJ3; z6SRr: $pindex = max(1, intval($_GPC['page'])); goto VAfvi; H2dtt: if (count($optionids) > 0) { goto Afti5; } goto OfiGb; ahZmD: $len = count($option_idss); goto qUCti; p6Ifl: $paramids = array(); goto J8TAw; QBXYI: $data['xsthumb'] = $upload['path']; goto goVs4; dSPSa: $a = array("title" => $_GPC['option_title_' . $ids][0], "productprice" => $_GPC['option_productprice_' . $ids][0], "groupprice" => $_GPC['option_groupprice_' . $ids][0], "marketprice" => $_GPC['option_marketprice_' . $ids][0], "stock" => $_GPC['option_stock_' . $ids][0], "weight" => $_GPC['option_weight_' . $ids][0], "goodsid" => $id, "specs" => $newids); goto pIO69; MtdqV: if (!checksubmit('delete')) { goto oo61f; } goto Mmx9I; VkX2h: $this->adminMessage('抱歉，请您先添加商品分类！', $this->createWebUrl('category', array("op" => "post")), 'error'); goto M6IcR; yhWH3: FmR9Q: goto YA31X; r1Ems: if (!($n == $rowspan)) { goto aXgXv; } goto WgPyY; pjqmw: $k++; goto Lo7em; ugJ_6: qKpb9: goto CGecs; ZnLWr: KdxEJ: goto diyKC; c0mwI: $n++; goto r1Ems; mpCJF: $j = 0; goto Im3bl; IWKXA: goto mT1pX; goto mXzjO; p2kYb: OOxPY: goto D0KbI; GelaZ: $l = count($specs[$i]['items']); goto qgJQi; GyhCu: if (count($itemids) > 0) { goto wj8R1; } goto q3ayj; o2hFS: $option_id = pdo_insertid(); goto Wav52; IGUKW: goto mT1pX; goto suPXS; dn_Bo: $cur_index = $index + 1; goto oK2Ft; aJTSC: if ($operation == 'change') { goto r733v; } goto WR7Pj; gUBS7: $this->adminMessage('操作完成,成功删除' . $res[0] . '项，失败' . $res[1] . '项', referer(), 'success'); goto mIh9f; sI_sH: $condition .= " AND (g.ccate = '{$cid}' or o.cateid= '{$cid}')"; goto gfF0r; Y1pcv: $itemlen = 1; goto iauDg; HVsHv: goto OOxPY; goto z40Kq; taGrI: goto wUcd8; goto a63bL; yC69V: $files = $_FILES; goto ag5hV; FcdF1: $param_values = $_POST['param_value']; goto o1h_4; o1h_4: $param_displayorders = $_POST['param_displayorder']; goto iy4JH; lxsNV: pdo_query('delete from ' . tablename('mihua_mall_goods_option') . " where goodsid={$id} and id not in ( " . implode(',', $optionids) . ')'); goto ugJ_6; Z0hsB: yjWWy: goto jfkeF; FvCTm: h23FG: goto Z5U2J; sLau0: $spec_titles = $_POST['spec_title']; goto TcLmv; TcLmv: $specids = array(); goto kviBB; EBiJw: yCGSv: goto YFXIG; RNxTy: $k = 0; goto Pl1zZ; NqaUR: $hh = ''; goto AfOYx; i49Ri: k0Bdj: goto cKMm_; aQPbC: $hh .= '<input name="option_ids[]"  type="hidden" class="span1 option_ids option_ids_' . $ids . '" value="' . $ids . '"/>'; goto hqxZi; xKi8l: mQgfF: goto KOxeL; J8TAw: $k = 0; goto cy6Fb; FMEgB: if (!empty($category)) { goto oefMS; } goto VkX2h; Rv2VI: if (count($paramids) > 0) { goto VlmbO; } goto Nys0x; STI26: $this->adminMessage($upload['message'], '', 'error'); goto tm3Qr; OWcmK: goto GucQy; goto Cet8x; QZUa_: $list = pdo_fetchall('SELECT  distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . " o on g.othercate= o.othercate  WHERE  g.uniacid = '{$_W['uniacid']}' and g.deleted=0 {$condition} 
			 ORDER BY g.sort DESC  LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto ip5cX; WdL9f: goto SmTxY; goto L2aMj; kEPyU: if (!($k < $len)) { goto h23FG; } goto gfdXc; XCbpN: if (!($j < $len)) { goto Txhj8; } goto NouTX; hcbFs: $id = pdo_insertid(); goto BLZBr; U6c5R: $v = intval($_GPC['virtual']); goto bJBiP; mUjE9: $m++; goto HFU_p; GwTkS: $res = WebCommon::changeStatus($_GPC['checkid'], 'down'); goto OiFs8; G_0xW: $html .= '<th>' . $specs[$i]['title'] . '</th>'; goto K330o; NUaaj: if (!empty($item)) { goto Q4T8l; } goto Bbd5a; W_VDc: x0idB: goto K6zVZ; IDYac: $html .= $hh; goto rfeUK; QG1NU: foreach ($piclist1 as $p) { $piclist[] = is_array($p) ? $p['attachment'] : $p; SSSu7: } goto xH_Yg; L87u2: $param_id = pdo_insertid(); goto KYUtb; XEQ9A: $spec_items = array(); goto RNxTy; YMD1N: WODQu: goto vfnB0; N51WR: if ($j % $rowspan == 0) { goto FvDn0; } goto fgWgl; iTzeO: $option_marketprices = $_POST['option_marketprice']; goto qAAbj; konUy: CuDlZ: goto zSvNm; wuI1A: pdo_update('mihua_mall_goods_param', $a, array("id" => $get_param_id)); goto bEG4e; wMkWG: aXgXv: goto u0AWY; cPDCA: $data['totalcnf'] = 2; goto YH252; xzJBg: $spec_item_thumbs = $_POST['spec_item_thumb_' . $get_spec_id]; goto leHH1; V8HLr: $upload = file_upload($_FILES['thumb']); goto bd6Gh; A3md2: if (!($data['total'] === -1)) { goto VDihN; } goto TJ5aT; fnRmw: Util::deleteCache('goods', $id); goto NfvHt; iRkHa: foreach ($idsarr as $key => $ida) { goto ujfi4; r6D81: jKLja: goto Q50fm; ujfi4: foreach ($spec_items as $it) { goto v7zoZ; DvMwW: X5xUy: goto yryvP; ABQpn: $newids[] = $it['id']; goto CU0yh; v7zoZ: if (!($it['get_id'] == $ida)) { goto qirHX; } goto ABQpn; CU0yh: goto j6MOB; goto sif7E; sif7E: qirHX: goto DvMwW; yryvP: } goto l7P0c; l7P0c: j6MOB: goto r6D81; Q50fm: } goto kVDxt; xMI1d: if (!is_numeric($get_param_id)) { goto VP_Lf; } goto wuI1A; Vba0J: $red_packet = intval($_GPC['red_packet']); goto hnunV; hjLRq: P7tDo: goto YfMQh; gjW1p: $param_ids = $_POST['param_id']; goto adaG7; cy6Fb: GucQy: goto WvlFl; NG4Wh: if (!($itemlen <= 0)) { goto hsNe8; } goto Y1pcv; pY0Gj: $k++; goto olbTL; s7IE8: $this->adminMessage('操作成功！', referer(), 'success'); goto dw_T0; tZvq9: $specitemids = explode('_', $options[0]['specs']); goto dqfgE; Qtqwm: pdo_delete('mihua_mall_product', array("id" => $id)); goto j6alw; j3dvO: if (empty($get_option_id)) { goto x8BIw; } goto piTHb; N59yP: if (!$otheroption) { goto tDVp1; } goto lrM2g; YVijc: $this->adminMessage('返现金额不能小于1元或大于200元！'); goto dLrOq; AoChg: pdo_update('mihua_mall_spec_item', $d, array("id" => $get_item_id)); goto eqwyS; O4Lco: zWBnj: goto P7JF0; HhUmg: $hh .= '<input name="option_id_' . $ids . '[]"  type="hidden" class="span1 option_id option_id_' . $ids . '" value="' . $val['id'] . '"/>'; goto aQPbC; gQBlT: $this->adminMessage('请选择商品分类！'); goto Ciw4D; s5NYx: $this->__web2(); goto yAOyO; QQ8l7: if (empty($_GPC['piclist'])) { goto z5Bk5; } goto Jcqna; HXift: g5_KU: goto mUjE9; eqwyS: $item_id = $get_item_id; goto wEO6K; X8raJ: $upload = file_upload($_FILES['xsthumb']); goto RaDu_; e1skt: unset($data['createtime']); goto vPJBd; WvlFl: if (!($k < $len)) { goto C9n6o; } goto Kmhrb; qk1GI: if (!($k < $len)) { goto kOBqP; } goto SOJlM; L2aMj: FvDn0: goto BojMe; tikky: $hh .= '</tr>'; goto NeDWv; HHyso: v2Xfl: goto bB7Vu; SAm3x: if (!checksubmit('suborder')) { goto uqDWA; } goto WJXrA; J0tjW: if (empty($category)) { goto Z2RpZ; } goto vilHF; YFqdJ: goto efRM_; goto EBiJw; nVnlp: $j = 0; goto V8qjN; gmegI: $rowspan = $rowspans[$m]; goto N51WR; fGyrF: efRM_: goto A86qw; q_1Ok: sOyFJ: goto txR8v; b96jr: kayQZ: goto GelaZ; k7wC8: goto U0fgK; goto ddHnA; CPdAX: $cid = intval($_GPC['cate_2']); goto sI_sH; y7jD7: pdo_update('mihua_mall_spec', array("content" => serialize($itemids)), array("id" => $spec_id)); goto glg9l; ZlHfh: pdo_insert('mihua_mall_goods_param', $a); goto L87u2; tQiJh: m2iVC: goto hAvgb; k4ACR: $f = 'spec_item_thumb_' . $get_item_id; goto FKa5U; hQn1q: $rowspans[$i] *= count($specs[$j]['items']); goto O4Lco; CvCMW: pdo_update('mihua_mall_goods', array("total" => $totalstocks), array("id" => $id)); goto y7ja9; BYkys: $newlen *= $itemlen; goto G7BKo; ZBo76: $ids = $option_idss[$k]; goto VQQfy; wEO6K: bhOUw: goto XC2pH; zMIqZ: $newlen = 1; goto XFwCH; goVs4: oqVOR: goto N9kQl; NVOPU: $option_productprices = $_POST['option_productprice']; goto iTzeO; nljIN: if (empty($id)) { goto KgsTx; } goto fbXg6; ag5hV: $spec_ids = $_POST['spec_id']; goto sLau0; PCOOK: $params = pdo_fetchall('select * from ' . tablename('mihua_mall_goods_param') . ' where goodsid=:id order by displayorder asc', array(":id" => $id)); goto GN4WH; RaDu_: if (!is_error($upload)) { goto DQuqQ; } goto STI26; Nki8n: $words = explode('|', $_GPC['otheroption']); goto ewenV; D9roI: exit; goto O06oE; s2jnf: $h[$i][$j] = array(); goto VPqUQ; Z5U2J: if (count($specids) > 0) { goto gVCu1; } goto RDLYu; D41yL: goto emtnI; goto aL8bi; vPJBd: pdo_update('mihua_mall_goods', $data, array("id" => $id)); goto DWeYQ; XqmmL: if (!empty($row)) { goto RVpX1; } goto HfeVL; wdAEG: if (!empty($_GPC['cate_1'])) { goto XVOEM; } goto NmKNg; Pnsrj: pdo_insert('mihua_mall_spec', $a); goto ZO_4G; G7BKo: $h = array(); goto nVnlp; pC0Gd: $k++; goto OWcmK; oIPwg: $f = 'spec_item_thumb_' . $get_item_id; goto qduuc; QI8m_: $kid = 0; goto LvXEF; a63bL: DWv7Z: goto hjLRq; rxiet: Y_EaS: goto GyhCu; Sx5_K: if ($operation == 'productdelete') { goto s8U3y; } goto aJTSC; afMdc: $html .= '</tr>'; goto QCmcF; zSvNm: $n++; goto URVs9; M1V7Z: NAciS: goto y5hvU; Qoxj8: $this->adminMessage('删除成功！', referer(), 'success'); goto moceO; ZO_4G: $spec_id = pdo_insertid(); goto MK2He; LJiyC: qONxB: goto sekhh; gfdXc: $spec_id = ''; goto NekOM; ytzKZ: if (!empty($_GPC['goodsname'])) { goto DnWbA; } goto rPHaC; VPqUQ: yO7ra: goto HcXfS; aCznD: if (!checksubmit('downgood')) { goto U6Wfo; } goto GwTkS; ow7ws: pdo_insert('mihua_mall_goods_option', $a); goto o2hFS; JUtv4: goto ZdbF3; goto fXXbP; cmoi9: r733v: goto MtdqV; Oo0Dr: $this->adminMessage('排序更新成功！', referer(), 'success'); goto FblZJ; j9bkh: pdo_query('delete from ' . tablename('mihua_mall_spec') . " where uniacid={$_W['uniacid']} and goodsid={$id} and id not in (" . implode(',', $specids) . ')'); goto yn3ai; f2vTT: FhAkz: goto qk1GI; XwEVh: goto qKpb9; goto jkIPg; mIh9f: oo61f: goto Zl70I; kskRB: OKxYc: goto XUZVa; bd6Gh: if (!is_error($upload)) { goto WODQu; } goto iype7; Nys0x: pdo_query('delete from ' . tablename('mihua_mall_goods_param') . " where goodsid={$id}"); goto k7wC8; YH7py: $len = count($specs); goto zMIqZ; HfeVL: $this->adminMessage('抱歉，商品不存在或是已经被删除！'); goto xscGA; UTscv: foreach ($options as $o) { goto sDCGN; vSKDK: $val = array("id" => $o['id'], "title" => $o['title'], "stock" => $o['stock'], "groupprice" => $o['groupprice'], "productprice" => $o['productprice'], "marketprice" => $o['marketprice'], "weight" => $o['weight']); goto gIBPB; l_0I7: ZikDM: goto UDO9I; sDCGN: if (!($ids === $o['specs'])) { goto EZMt4; } goto vSKDK; gIBPB: goto m2iVC; goto QoKHE; QoKHE: EZMt4: goto l_0I7; UDO9I: } goto tQiJh; ZSHae: $newids = array(); goto iRkHa; lKPOq: if (!empty($_GPC['cate_1'])) { goto KEJV3; } goto YFqdJ; Vb0xI: $id = intval($_GPC['id']); goto HVsjZ; tMEJe: $this->adminMessage('操作成功！', referer(), 'success'); goto x8L4O; pIO69: $totalstocks += $a['stock']; goto j3dvO; YFXIG: $cid = intval($_GPC['cate_2']); goto FbNME; JttZo: $html .= '<th><div class="input-append input-prepend"><span class="add-on">市场价格</span><input type="text" class="span1 option_productprice_all"  VALUE=""/><span class="add-on"><a href="javascript:;" class="icon-hand-down" title="批量设置" onclick="setCol(\'option_productprice\');"></a></span></div></th>'; goto gRfWC; bkVB9: $hh .= '</td>'; goto GDcNc; LJKVr: pdo_query('delete from ' . tablename('mihua_mall_spec_item') . " where uniacid={$_W['uniacid']} and specid={$spec_id} and id not in (" . implode(',', $itemids) . ')'); goto hcthj; dWXn4: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto Si9Zk; xH_Yg: ZZD_Q: goto yhWH3; owTrl: $option_stocks = $_POST['option_stock']; goto iNZB0; BaF3V: $totalstocks = 0; goto gjW1p; dqfgE: foreach ($specitemids as $itemid) { goto TyIKB; MAW_a: LvfMp: goto ZqmbK; ZqmbK: qfhgy: goto hxx2d; TyIKB: foreach ($allspecs as $ss) { goto mZ19Y; mZ19Y: $items = $ss['items']; goto URs7O; URs7O: foreach ($items as $it) { goto CzocT; CzocT: if (!($it['id'] == $itemid)) { goto DC247; } goto liG3a; liG3a: $specs[] = $ss; goto ASmCN; ASmCN: goto u0r_9; goto iUrOi; R1YaV: Xa_6y: goto kdHaN; iUrOi: DC247: goto R1YaV; kdHaN: } goto A7vU8; kdLCO: gLSXe: goto Ckmby; A7vU8: u0r_9: goto kdLCO; Ckmby: } goto MAW_a; hxx2d: } goto iJCnb; z6E4r: $d = array("uniacid" => $_W['uniacid'], "specid" => $spec_id, "displayorder" => $n, "title" => $spec_item_titles[$n], "show" => $spec_item_shows[$n], "thumb" => $spec_item_thumbs[$n]); goto oIPwg; xscGA: RVpX1: goto GzeC1; Eagre: K71sU: goto hKqLZ; zNc3K: if ($operation == 'display') { goto hbic0; } goto bKI2C; BojMe: $h[$m][$j] = array("html" => '<td rowspan=\'' . $rowspan . '\'>' . $specs[$m]['items'][$kid]['title'] . '</td>', "id" => $specs[$m]['items'][$kid]['id']); goto WVu5W; cwLMR: $option_idss = $_POST['option_ids']; goto NVOPU; D0KbI: if (!($i < $newlen)) { goto n1r48; } goto h_8kH; wIgvf: if (empty($_GPC['otheroption2'])) { goto NAciS; } goto q9Y2n; QCmcF: $m = 0; goto MrvC_; t3D4W: wj8R1: goto LJKVr; XZ0Tc: $piclist = array(); goto VaKGA; T7nh3: $j = $i + 1; goto DyWoC; TJDTh: foreach ($allspecs as &$s) { $s['items'] = pdo_fetchall('select * from ' . tablename('mihua_mall_spec_item') . ' where specid=:specid order by displayorder asc', array(":specid" => $s['id'])); c59Tp: } goto u01uJ; rV6mu: if ($res == '1') { goto SpcV7; } goto SjY2l; FbK10: $ids = array(); goto mpCJF; Ciw4D: a1EQg: goto inwwC; WgPyY: $kid++; goto DW7sl; QtTKY: if (!($n < $itemlen)) { goto Y_EaS; } goto ZiEWx; j6alw: $this->adminMessage('删除成功！', '', 'success'); goto rFuH0; MDr1A: $condition = ''; goto gSv9L; mN3po: $otheroption = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_othercate') . ' WHERE othercate = :othercate and uniacid = :uniacid', array(":othercate" => $item['othercate'], ":uniacid" => $_W['uniacid'])); goto N59yP; CN6fh: $j = 0; goto xKi8l; pLbM0: $spec_id = $get_spec_id; goto fZ_98; RF_0b: $ids = implode('_', $ids); goto Vd_vk; OfiGb: pdo_query('delete from ' . tablename('mihua_mall_goods_option') . " where goodsid={$id}"); goto XwEVh; qFCV8: $j++; goto E8c3q; jcBfi: $i++; goto HVsHv; iauDg: hsNe8: goto BYkys; fYpJt: I2hd1: goto ytzKZ; bEG4e: $param_id = $get_param_id; goto D41yL; HTtKF: $condition .= " AND title LIKE '%{$_GPC['keyword']}%'"; goto KriOo; Cet8x: C9n6o: goto Rv2VI; Wav52: tH4br: goto cy3XC; connd: if (empty($id)) { goto yjWWy; } goto e1skt; hn4rf: if (empty($_GPC['attachment'])) { goto nkhai; } goto UTAas; Z5jGC: $n = 0; goto wMkWG; Bc9PP: $d['get_id'] = $get_item_id; goto YE3Jr; adaG7: $param_titles = $_POST['param_title']; goto FcdF1; rPHaC: $this->adminMessage('请输入商品名称！'); goto qXLHf; EVVXI: pdo_insert('mihua_mall_spec_item', $d); goto JAvzF; FblZJ: uqDWA: goto D9roI; qgJQi: $rowspans[$i] = 1; goto T7nh3; s7xeX: if (!($j < $newlen)) { goto kayQZ; } goto s2jnf; MK2He: goto mFxAv; goto bMZPT; XC2pH: $itemids[] = $item_id; goto Bc9PP; nr7zc: if (empty($item['storeids'])) { goto OKxYc; } goto B2Kk7; sekhh: $pager = pagination($total, $pindex, $psize); goto IGUKW; NT1VD: $hh .= '<td><input name="option_weight_' . $ids . '[]" type="text" class="span1 option_weight option_weight_' . $ids . '" " value="' . $val['weight'] . '"/></td>'; goto tikky; I7bel: $othercate = date('mdHis') . random(4, 1); goto sJ6UY; SOJlM: $option_id = ''; goto lBquu; h7Jtc: goto phmln; goto ZnLWr; R4SM1: if (!empty($_GPC['cate_2'])) { goto yCGSv; } goto lKPOq; KOxeL: if (!($j < $newlen)) { goto hPb01; } goto gmegI; Zjfzg: $get_param_id = $param_ids[$k]; goto zP_Bw; hRFng: $spec_items[] = $d; goto konUy; xvcLC: if (is_numeric($get_spec_id)) { goto yxigN; } goto Pnsrj; j4_0U: hPb01: goto HXift; BQOXZ: qCUfd: goto tfd9V; RhZ1C: file_delete($_GPC['thumb_old']); goto V8HLr; ro8d3: KkV6y: goto py4Ce; dw_T0: ZdbF3: goto BmRHY; O06oE: mT1pX: goto obBEl; bN4xp: goto DZtjg; goto t3D4W; V5kzi: $cid = intval($_GPC['cate_1']); goto ls1ml; P7JF0: $j++; goto taGrI; U8sLL: Z2RpZ: goto dWXn4; ip5cX: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . ' g left join ' . tablename('mihua_mall_othercate') . " o on g.othercate= o.othercate  WHERE  g.uniacid = '{$_W['uniacid']}' and g.deleted=0 {$condition}"); goto LJiyC; JKxpk: $kid = 0; goto X8_AS; oK2Ft: z5Bk5: goto hn4rf; BMmHk: n7NYr: goto IWKXA; HcXfS: $j++; goto fy7y0; NtrQc: if (!($i < $len)) { goto KdxEJ; } goto G_0xW; ufaCG: s8U3y: goto nPj06; JAvzF: $item_id = pdo_insertid(); goto KPcQq; yn3ai: Cm_r2: goto cwLMR; Bnxrh: $n = 0; goto jRPeQ; T3PXl: $condition .= " AND g.title LIKE '%{$_GPC['keyword']}%'"; goto Eagre; iy4JH: $len = count($param_ids); goto p6Ifl; LHag4: $i = 0; goto hxmCa; vNOKi: E4Ul5: goto pY0Gj; HFU_p: goto zPDqU; goto SSE0v; qAAbj: $option_groupprice = $_POST['option_groupprice']; goto owTrl; Bbd5a: $this->adminMessage('抱歉，商品不存在或是已经删除！', '', 'error'); goto RyDZ2; ewenV: foreach ($words as $key => $value) { goto s0C28; s0C28: $insert = array("uniacid" => $_W['uniacid'], "othercate" => $othercate, "cateid" => '' . $value . ''); goto RRQ7L; RRQ7L: pdo_insert('mihua_mall_othercate', $insert); goto biYfm; biYfm: MV5ky: goto H0KRz; H0KRz: } goto W_VDc; B5r1i: zlOTv: goto Vba0J; nRrf9: $refundtime = $this->getRefundtime(); goto Wpbjx; ny0fa: $k = 0; goto JKxpk; WJXrA: WebCommon::orderData($_GPC['sort'], 'mihua_mall_goods'); goto Oo0Dr; EitdS: $newids = implode('_', $newids); goto dSPSa; Fhhx8: $ids[] = $h[$j][$i]['id']; goto BHjRB; S2hJ3: $condition .= ' AND g.status = \'' . intval($_GPC['status']) . '\''; goto w2V1O; WVu5W: SmTxY: goto c0mwI; u01uJ: TLflc: goto hbU0j; SSE0v: UFJNq: goto NqaUR; UTAas: foreach ($_GPC['attachment'] as $index => $row) { goto lZ_AG; vrhV6: goto W8dJX; goto vOsdS; deYo_: W8dJX: goto C6sTt; a4P4j: $hsdata[$cur_index + $index] = array("attachment" => $_GPC['attachment'][$index]); goto deYo_; lZ_AG: if (!empty($row)) { goto Tl6qk; } goto vrhV6; vOsdS: Tl6qk: goto a4P4j; C6sTt: } goto q_1Ok; fZ_98: mFxAv: goto y2fBm; fbXg6: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id and uniacid = :uniacid', array(":id" => $id, ":uniacid" => $_W['uniacid'])); goto NUaaj; qUCti: $optionids = array(); goto Uk7mg; BJKFU: goto efRM_; goto bvRgh; glg9l: $specids[] = $spec_id; goto vNOKi; gRfWC: $html .= '<th><div class="input-append input-prepend"><span class="add-on">团购价格</span><input type="text" class="span1 option_groupprice_all"  VALUE=""/><span class="add-on"><a href="javascript:;" class="icon-hand-down" title="批量设置" onclick="setCol(\'option_groupprice\');"></a></span></div></th>'; goto AeRH_; YgONC: $itemids = array(); goto Bnxrh; j2saT: oKQCr: goto dn_Bo; ZOK0c: $html = ''; goto LgfMz; OWFCd: goto qONxB; goto HHyso; fy7y0: goto XYMgF; goto b96jr; leHH1: $spec_item_oldthumbs = $_POST['spec_item_oldthumb_' . $get_spec_id]; goto Mhud7; yyU33: $hh .= '<td><input name="option_groupprice_' . $ids . '[]" type="text" class="span1 option_groupprice option_groupprice_' . $ids . '" " value="' . $val['groupprice'] . '"/></td>'; goto NT1VD; YfMQh: $i++; goto h7Jtc; XUZVa: KgsTx: goto FMEgB; K330o: $itemlen = count($specs[$i]['items']); goto NG4Wh; iJCnb: z2vFE: goto Tq_AL; NeDWv: RcC_y: goto jcBfi; bj_nd: x8BIw: goto ow7ws; jfkeF: pdo_insert('mihua_mall_goods', $data); goto hcbFs; qduuc: $old = $spec_item_oldthumbs[$k]; goto k4ACR; ezfrh: $data = array("uniacid" => intval($_W['uniacid']), "thumb" => $_GPC['thumb'], "xsthumb" => $_GPC['xsthumb'], "displayorder" => intval($_GPC['displayorder']), "title" => $_GPC['goodsname'], "pcate" => intval($_GPC['pcate']), "ccate" => intval($_GPC['ccate']), "type" => intval($_GPC['type']), "isrecommand" => intval($_GPC['isrecommand']), "ishot" => intval($_GPC['ishot']), "isnew" => intval($_GPC['isnew']), "isdiscount" => intval($_GPC['isdiscount']), "istime" => intval($_GPC['istime']), "issendfree" => intval($_GPC['issendfree']), "timestart" => strtotime($_GPC['timestart']), "timeend" => strtotime($_GPC['timeend']), "description" => htmlspecialchars_decode($_GPC['description']), "content" => htmlspecialchars_decode($_GPC['content']), "goodssn" => $_GPC['goodssn'], "unit" => $_GPC['unit'], "createtime" => TIMESTAMP, "total" => $total, "totalcnf" => intval($_GPC['totalcnf']), "marketprice" => $_GPC['marketprice'], "weight" => $_GPC['weight'], "costprice" => $_GPC['costprice'], "productprice" => $_GPC['productprice'], "productsn" => $_GPC['productsn'], "credit" => intval($_GPC['credit']), "maxbuy" => intval($_GPC['maxbuy']), "commission" => intval($_GPC['commission']), "commission2" => intval($_GPC['commission2']), "commission3" => intval($_GPC['commission3']), "hasoption" => intval($_GPC['hasoption']), "status" => intval($_GPC['status']), "sales" => intval($_GPC['sales']), "deductible" => intval($_GPC['deductible']), "red_packet" => intval($_GPC['red_packet']), "astrict" => intval($_GPC['astrict']), "othercate" => $othercate, "fullShipping" => intval($_GPC['fullShipping']), "virtual" => intval($_GPC['type']) == 3 ? intval($_GPC['virtual']) : 0, "isverify" => intval($_GPC['isverify']), "storeids" => is_array($_GPC['storeids']) ? implode(',', $_GPC['storeids']) : '', "checkaddress" => intval($_GPC['checkaddress']), "checkname" => intval($_GPC['checkname']), "checkphone" => intval($_GPC['checkphone']), "showstone" => intval($_GPC['showstone']), "sort" => intval($_GPC['sort']), "iscard" => intval($_GPC['iscard']), "isgroup" => intval($_GPC['isgroup']), "groupprice" => $_GPC['groupprice'], "groupnum" => $_GPC['groupnum'], "groupendtime" => $_GPC['groupendtime'], "inco" => json_encode(iunserializer($_GPC['inco'])), "isshowgroup" => intval($_GPC['isshowgroup']), "backmoney" => $_GPC['backmoney'], "iscanrefund" => $_GPC['iscanrefund'], "show_distribution" => intval($_GPC['show_distribution']), "share_img" => $_GPC['share_img'], "share_title" => $_GPC['share_title'], "share_info" => $_GPC['share_info']); goto A3md2; KriOo: MZhtd: goto R4SM1; A86qw: if (!isset($_GPC['status'])) { goto U_bYR; } goto OGSVJ; bKI2C: if ($operation == 'delete') { goto ekeaB; } goto Sx5_K; Uq8pL: goto Cm_r2; goto lsur2; NlpTC: AxjjF: goto pC0Gd; DWeYQ: goto xRMl6; goto Z0hsB; NmKNg: goto KkV6y; goto aLAdX; DjCqf: goto x776q; goto QdUsN; DyWoC: wUcd8: goto t_jUX; KYUtb: emtnI: goto ZHSVz; igyin: file_delete($_GPC['xsthumb_old']); goto X8raJ; isqu5: YDnLx: goto AoChg; tm3Qr: DQuqQ: goto QBXYI; VAfvi: $psize = 15; goto MDr1A; PCfW7: goto tH4br; goto bj_nd; raPVu: ScX1R: goto nRrf9; RyDZ2: Q4T8l: goto FMOyS; DW7sl: if (!($kid > count($specs[$m]['items']) - 1)) { goto KQo_e; } goto QI8m_; lJFAJ: $res = WebCommon::changeStatus($_GPC['checkid'], 'up'); goto rV6mu; dLrOq: DT2ur: goto fYpJt; Tq_AL: $html = '<table  class="tb spectable" style="border:1px solid #ccc;"><thead><tr>'; goto YH7py; ZiEWx: $item_id = ''; goto g0iwI; oo9fM: pdo_query('delete from ' . tablename('mihua_mall_goods_param') . " where goodsid={$id} and id not in ( " . implode(',', $paramids) . ')'); goto RjpvB; sJ6UY: goto w76ap; goto QOrZF; BmRHY: QEjAC: goto aCznD; H4m0r: if (!checksubmit('submit')) { goto n7NYr; } goto QpuRA; QOrZF: pc1Vg: goto Nki8n; hqxZi: $hh .= '<input name="option_title_' . $ids . '[]"  type="hidden" class="span1 option_title option_title_' . $ids . '" value="' . $val['title'] . '"/>'; goto bkVB9; HVsjZ: $row = pdo_fetch('SELECT id, thumb FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id', array(":id" => $id)); goto XqmmL; moceO: goto mT1pX; goto ufaCG; hcthj: DZtjg: goto y7jD7; gKGBn: if (empty($_FILES['thumb']['tmp_name'])) { goto k0Bdj; } goto RhZ1C; CGecs: if (!($totalstocks > 0)) { goto I3BM9; } goto CvCMW; zP_Bw: $a = array("title" => $param_titles[$k], "value" => $param_values[$k], "displayorder" => $k, "goodsid" => $id); goto xMI1d; Cr0uL: $condition .= " AND (g.pcate = '{$cid}' or o.cateid= '{$cid}')"; goto ro8d3; OiFs8: if ($res == '1') { goto ZY9k0; } goto aDEHC; ZHSVz: $paramids[] = $param_id; goto NlpTC; Zl70I: if (!checksubmit('upgood')) { goto QEjAC; } goto lJFAJ; TJ5aT: $data['total'] = 0; goto cPDCA; hnunV: if (!$red_packet) { goto I2hd1; } goto WFGkz; hAvgb: $hh .= '<td>'; goto NYKrm; lsur2: gVCu1: goto j9bkh; bMZPT: yxigN: goto uEUSF; o87pt: OZqGK: goto XCioF; M6IcR: oefMS: goto H4m0r; qXLHf: DnWbA: goto o8Gz_; bJBiP: $total = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_virtual_data') . ' where typeid=:typeid and uniacid=:uniacid and openid=0 limit 1', array(":typeid" => $v, ":uniacid" => $_W['uniacid'])); goto B5r1i; MZI_A: U6Wfo: goto SAm3x; SjY2l: $this->adminMessage('操作失败！', referer(), 'error'); goto JUtv4; kviBB: $len = count($spec_ids); goto ENbG6; LvXEF: KQo_e: goto Z5jGC; Vd_vk: $val = array("id" => "", "title" => "", "stock" => "", "groupprice" => "", "productprice" => "", "marketprice" => "", "weight" => ""); goto UTscv; zCB9k: $stores = array(); goto nr7zc; u0AWY: Y1LFM: goto XdS_h; Dl1pi: $this->adminMessage('商品更新成功！', $this->createWebUrl('goods', array("op" => "display", "page" => $page)), 'success'); goto BMmHk; fo8SJ: if (!(intval($_GPC['type']) == 3)) { goto zlOTv; } goto U6c5R; z40Kq: n1r48: goto IDYac; FMOyS: $allspecs = pdo_fetchall('select * from ' . tablename('mihua_mall_spec') . ' where goodsid=:id order by displayorder asc', array(":id" => $id)); goto TJDTh; inwwC: if (!empty($_GPC['thumbs'])) { goto o2Pbr; } goto slpId; URVs9: goto Xzk0y; goto rxiet; g0iwI: $get_item_id = $spec_item_ids[$n]; goto z6E4r; XFwCH: $h = array(); goto QVXlQ; MTIHC: foreach ((array) $category as $cid => $cate) { goto n7JcT; NFf35: $children[$cate['parentid']][$cate['id']] = array($cate['id'], $cate['name']); goto xFYls; n7JcT: if (empty($cate['parentid'])) { goto p94n2; } goto NFf35; xFYls: p94n2: goto JQmVA; JQmVA: Tn8e9: goto yEQJ0; yEQJ0: } goto kmu3y; ecCWa: if (empty($_GPC['otheroption'])) { goto x10Z_; } goto wIgvf; FBDyb: $othercate = 0; goto ecCWa; EHTon: $specs = array(); goto IaVEt; o8Gz_: if (!empty($_GPC['pcate'])) { goto a1EQg; } goto gQBlT; Mhud7: $itemlen = count($spec_item_ids); goto YgONC; E8c3q: goto RXiR9; goto UpUbV; OzNHh: if (!($m < $len)) { goto UFJNq; } goto ny0fa; FbNME: $condition .= " AND ccate = '{$cid}'"; goto BJKFU; Im3bl: RXiR9: goto XCbpN; RjpvB: U0fgK: goto yC69V; diyKC: $html .= '<th><div class="input-append input-prepend"><span class="add-on">库存</span><input type="text" class="span1 option_stock_all"  VALUE=""/><span class="add-on"><a href="javascript:;" class="icon-hand-down" title="批量设置" onclick="setCol(\'option_stock\');"></a></span></div></th>'; goto WKPQe; RDLYu: pdo_query('delete from ' . tablename('mihua_mall_spec') . " where uniacid={$_W['uniacid']} and goodsid={$id}"); goto Uq8pL; BLZBr: xRMl6: goto BaF3V; XCioF: tDVp1: goto BQOXZ; Jcqna: foreach ($_GPC['piclist'] as $index => $row) { goto FPPhp; I2VlG: i6_PS: goto si4L1; FPPhp: if (!empty($row)) { goto i6_PS; } goto u616D; UkMGm: pp3as: goto AQqa4; si4L1: $hsdata[$index] = array("attachment" => $_GPC['piclist'][$index]); goto UkMGm; u616D: goto pp3as; goto I2VlG; AQqa4: } goto j2saT; hxmCa: phmln: goto NtrQc; YA31X: if (!(count($options) > 0)) { goto kJGEH; } goto tZvq9; MrvC_: zPDqU: goto OzNHh; lrM2g: foreach ($otheroption as $p => $o) { goto XtuM1; XtuM1: $optionlist .= $o['cateid'] . ','; goto dEyJY; hH1Kx: u8vr0: goto aTP5H; dEyJY: $otheroption2 = $o['othercate']; goto hH1Kx; aTP5H: } goto o87pt; slpId: $_GPC['thumbs'] = array(); goto xpH2K; q9Y2n: pdo_delete('mihua_mall_othercate', array("othercate" => $_GPC['otheroption2'])); goto M1V7Z; N9kQl: $cur_index = 0; goto QQ8l7; rFuH0: goto mT1pX; goto cmoi9; yAOyO: $cfg = $this->module['config']; goto Svab_; rfeUK: $html .= '</table>'; goto SdH7v; aL8bi: VP_Lf: goto ZlHfh; LYt9o: $data['thumb_url'] = serialize($hsdata); goto connd; V8qjN: XYMgF: goto s7xeX; p2JCY: if (!pdo_fetch('select id from ' . tablename('mihua_mall_othercate') . " where othercate='{$othercate}'")) { goto pc1Vg; } goto I7bel; zv1yD: $a = array("uniacid" => $_W['uniacid'], "goodsid" => $id, "displayorder" => $k, "title" => $spec_titles[$get_spec_id]); goto xvcLC; L88Ww: $cid = intval($_GPC['cate_1']); goto Cr0uL; umhf2: } public function doWebVirtual_temp() { goto F59nE; ktfd7: $insert = array("uniacid" => $_W['uniacid'], "cate" => intval($_GPC['cate']), "title" => trim($_GPC['tp_title']), "fields" => iserializer($data)); goto fzWt7; trtD7: pdo_update('mihua_mall_virtual_type', $insert, array("id" => $id)); goto uvHV5; ooQer: $pindex = max(1, intval($page)); goto Mdlfo; uvHV5: goto QYLsd; goto bVc62; UPb11: $category = pdo_fetchall('select * from ' . tablename('mihua_mall_virtual_category') . ' where uniacid=:uniacid order by id desc', array(":uniacid" => $_W['uniacid']), 'id'); goto pTMpH; F59nE: global $_GPC, $_W; goto Qepv9; lYAhV: $num = $_GPC['numlist']; goto eJjZs; h6AY9: Zgm6X: goto LXK7Q; fzWt7: if (empty($id)) { goto R9T0q; } goto trtD7; fXjt_: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE uniacid=:uniacid order by id desc ', array(":uniacid" => $_W['uniacid'])); goto xHfOh; xHfOh: $pager = pagination($total, $pindex, $psize); goto p88p8; o5i_Q: if ($operation == 'delete') { goto Ho1nk; } goto rBX4C; pTMpH: include $this->template('virtual_temp'); goto mvdyb; CSY4S: if ($operation == 'addtype') { goto W8nyO; } goto o5i_Q; mmGbb: $id = $_GPC['id']; goto ff17Z; DhH8H: $this->adminMessage('保存成功！', $this->createWebUrl('virtual_temp'), 'success'); goto i_WBM; As3ff: $datacount = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_virtual_data') . ' where typeid=:typeid and uniacid=:uniacid and openid=0 limit 1', array(":typeid" => $id, ":uniacid" => $_W['uniacid'])); goto fOrBN; i_WBM: lsMpo: goto HoOrl; dnJuQ: $item['fields'] = iunserializer($item['fields']); goto lYAhV; VmtDL: $names = $_GPC['tp_name']; goto etn0b; OMzGW: GfO8B: goto LG_6f; ZoetD: $kw = $_GPC['kw']; goto VJWyS; Tw_En: pdo_insert('mihua_mall_virtual_type', $insert); goto YMXMr; NrJRT: $keywords = $_GPC['tp_kw']; goto VmtDL; rBX4C: goto l9TYF; goto u0O_J; LXK7Q: pdo_delete('mihua_mall_virtual_type', array("id" => $id)); goto d4aFh; LOvvM: $page = empty($_GPC['page']) ? '' : $_GPC['page']; goto ooQer; ctgnd: CMQBn: goto neM45; Wu0us: $this->adminMessage('删除成功！', $this->createWebUrl('virtual_temp'), 'success'); goto GSXmB; ff17Z: if (!empty($id)) { goto Zgm6X; } goto a8qvV; etn0b: if (empty($keywords)) { goto BcU2l; } goto ctXdh; lU_Vn: exit; goto NGtIz; Onb4h: if (empty($id)) { goto cGuxX; } goto nuUVl; u0O_J: m31Ln: goto LOvvM; kMLyX: exit; goto NqwY4; E_Sj4: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $_GPC['typeid'], ":uniacid" => $_W['uniacid'])); goto qrVwg; LG_6f: $id = intval($_GPC['id']); goto Sj5To; NGtIz: l9TYF: goto UPb11; gJAWe: goto Tb6FV; goto JsZsU; IGSKq: $addt = $_GPC['addt']; goto ZoetD; qrVwg: $list = $item; goto dnJuQ; X4MBf: if ($operation == 'post') { goto GfO8B; } goto CSY4S; NqwY4: goto l9TYF; goto QGENL; bVc62: R9T0q: goto Tw_En; YMXMr: $id = pdo_insertid(); goto qaL7M; RNIgE: goto F3tGX; goto h6AY9; fOrBN: cGuxX: goto ov6Hb; qaL7M: QYLsd: goto DhH8H; G8Nqb: goto Tb6FV; goto r05QM; eJjZs: include $this->template('tp_data'); goto k5sDj; Sj5To: $datacount = 0; goto Onb4h; ShHJA: W8nyO: goto IGSKq; HoOrl: goto l9TYF; goto ShHJA; e939x: $item['fields'] = iunserializer($item['fields']); goto As3ff; t4agb: if ($addt == 'data') { goto Gdsib; } goto gJAWe; JsZsU: gvNG_: goto z_lQx; nuUVl: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $id, ":uniacid" => $_W['uniacid'])); goto e939x; r05QM: Gdsib: goto E_Sj4; Qepv9: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto kYNtf; S4QUq: $items = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE uniacid=:uniacid order by id desc limit ' . ($pindex - 1) * $psize . ',' . $psize, array(":uniacid" => $_W['uniacid'])); goto fXjt_; z_lQx: include $this->template('tp_type'); goto G8Nqb; ctXdh: $data = array(); goto Ppndo; d4aFh: pdo_delete('mihua_mall_virtual_data', array("typeid" => $id)); goto Wu0us; kYNtf: if ($operation == 'display') { goto m31Ln; } goto X4MBf; p88p8: goto l9TYF; goto OMzGW; QGENL: Ho1nk: goto mmGbb; VJWyS: if ($addt == 'type') { goto gvNG_; } goto t4agb; GSXmB: F3tGX: goto lU_Vn; Mdlfo: $psize = 12; goto S4QUq; ov6Hb: if (!$_W['ispost']) { goto lsMpo; } goto NrJRT; a8qvV: $this->adminMessage('Url参数错误！请重试！', $this->createWebUrl('virtual_temp'), 'error'); goto RNIgE; Ppndo: foreach ($keywords as $key => $val) { $data[$keywords[$key]] = $names[$key]; pwNlZ: } goto ctgnd; neM45: BcU2l: goto ktfd7; k5sDj: Tb6FV: goto kMLyX; mvdyb: } public function doWebVirtual_category() { goto McG8r; lfvXB: $id = intval($_GPC['id']); goto LT4wf; Y0rrm: goto Vv6SL; goto qkTrN; G1iq3: kGaJ5: goto A0fSe; GZTjw: if (!empty($item)) { goto QYulf; } goto a_Ub0; ETCw5: hb9Gq: goto C0pcA; TTJAf: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto vWD2F; qkTrN: PfOl1: goto USndG; X4VDC: $this->adminMessage('分类删除成功！', $this->createWebUrl('virtual_category', array("op" => "display")), 'success'); goto JtuDr; kvKmO: if ($operation == 'delete') { goto hYoRG; } goto Y0rrm; USndG: if (empty($_GPC['catname'])) { goto kGaJ5; } goto UlXjk; vWD2F: if ($operation == 'display') { goto PfOl1; } goto kvKmO; a_Ub0: $this->adminMessage('抱歉，分类不存在或是已经被删除！', $this->createWebUrl('virtual_category', array("op" => "display")), 'error'); goto c0HZ1; c0HZ1: QYulf: goto ReeNm; xAGSk: hYoRG: goto lfvXB; McG8r: global $_GPC, $_W; goto TTJAf; JtuDr: Vv6SL: goto YoCXw; ReeNm: pdo_delete('mihua_mall_virtual_category', array("id" => $id)); goto X4VDC; C0pcA: $this->adminMessage('分类更新成功！', $this->createWebUrl('virtual_category', array("op" => "display")), 'success'); goto G1iq3; eYL3j: goto Vv6SL; goto xAGSk; UlXjk: foreach ($_GPC['catname'] as $id => $catname) { goto pPYO1; b8cI0: $insert_id = pdo_insertid(); goto zKa5y; Oq3v0: pdo_insert('mihua_mall_virtual_category', array("name" => $catname, "uniacid" => $_W['uniacid'])); goto b8cI0; pPYO1: if ($id == 'new') { goto mJz3B; } goto hwasL; bjBRd: goto dag77; goto yQeom; rKVaQ: dlNxm: goto ge2K8; zKa5y: dag77: goto rKVaQ; yQeom: mJz3B: goto Oq3v0; hwasL: pdo_update('mihua_mall_virtual_category', array("name" => $catname), array("id" => $id)); goto bjBRd; ge2K8: } goto ETCw5; A0fSe: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_virtual_category') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY id DESC"); goto eYL3j; YoCXw: include $this->template('virtual_category'); goto w9x8y; LT4wf: $item = pdo_fetch('SELECT id,name FROM ' . tablename('mihua_mall_virtual_category') . " WHERE id = '{$id}' AND uniacid=" . $_W['uniacid'] . ''); goto GZTjw; w9x8y: } public function doWebVirtual_data() { goto uOAj2; afBo9: exit; goto H3NSu; JiVrb: $page = empty($_GPC['page']) ? '' : $_GPC['page']; goto WKW2Y; gzcoZ: unset($row); goto ulgeL; YBwhe: $data['edit'] = $editid; goto x21xB; ZL0fE: PcA9i: goto JiVrb; BqXTD: vLunj: goto hyAN8; A_kOy: exit; goto y8qRd; KSsj8: if (!$_W['ispost']) { goto xefq2; } goto ef4hV; Ow5rR: $this->adminMessage('Url参数错误！请重试！', $this->createWebUrl('virtual_temp'), 'error'); goto HzVW_; D7Ph7: $id = intval($_GPC['id']); goto T2eNX; OwApc: if (!($zerocount > 0)) { goto IxAdE; } goto nT9kG; gDyVH: $this->updateStock($typeid); goto sI2G6; xQ0xD: goto ACul5; goto Kc760; XOvUG: $this->adminMessage('部分数据保存成功！' . $tip, '', 'warning'); goto lgzEA; j2zmD: YqGwH: goto WBq5O; J_rCi: $items = pdo_fetchall('SELECT d.*,o.carrier,c.avatar,c.nickname,a.realname, a.mobile FROM ' . tablename('mihua_mall_virtual_data') . ' d ' . ' left join ' . tablename('mihua_mall_member') . ' m on m.from_user = d.openid and m.uniacid= d.uniacid ' . ' left join ' . tablename('mc_members') . ' c on c.uid = m.uid and c.uniacid= m.uniacid ' . ' left join ' . tablename('mihua_mall_order') . ' o on o.id = d.orderid and o.uniacid= d.uniacid' . ' left join ' . tablename('mihua_mall_address') . ' a on a.id = o.addressid and a.uniacid= o.uniacid' . " where  1 {$condition} order by openid desc,id limit " . ($pindex - 1) * $psize . ',' . $psize, $params); goto oOW2l; H3NSu: xefq2: goto ok2G3; ZBbyJ: if (!($_GPC['status'] == '1')) { goto E4oEc; } goto HWtet; lHz17: ACul5: goto g3kju; qB7wF: lNmTi: goto L9vGu; FWEhT: $zerocount = $maxlen - strlen($arr[$i]); goto OwApc; adJ8G: $pager = pagination($total, $pindex, $psize); goto SK2ig; bjTCB: NLKjy: goto ufu4l; nK0oR: hmkze: goto jNBjL; ihJCa: if (!empty($id)) { goto a0ADY; } goto UI7uR; UkGjn: vnkcs: goto eovbq; RMJ8z: if (!($i <= $len)) { goto W1XFe; } goto ZmyUv; BKYhV: MwD3G: goto GMA_g; GNL25: $addlen = strlen($add); goto YhELX; qa4gH: $i = 1; goto Cb7io; y8qRd: Vt0bO: goto eUsJt; v_WbM: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto ngDue; ok2G3: eMCIs: goto mQjBD; CSefM: pdo_update('mihua_mall_virtual_type', 'alldata=alldata-1', array("id" => $typeid)); goto gDyVH; YhELX: if (!($addlen > $maxlen)) { goto fDCb1; } goto Uw_y0; Vc0ki: VX5UI: goto B8cb9; UI7uR: $this->adminMessage('Url参数错误！请重试！', $this->createWebUrl('virtual_data', array("typeid" => $typeid)), 'error'); goto x8vRy; Wqhhk: $condition = ' and d.typeid=:typeid and d.uniacid=:uniacid'; goto UjnT5; ngDue: if ($operation == 'display') { goto vnkcs; } goto diHp9; v8thO: E4oEc: goto nyvem; nC_g0: a0ADY: goto jxF1K; aKJ2N: yPksa: goto N056I; HxT7Z: $arr = array($num); goto FrDe5; SK2ig: goto eMCIs; goto BqXTD; blaB6: if (empty($item)) { goto yPksa; } goto oR5Uo; lgzEA: Hs0fv: goto j2zmD; DewHR: eC31a: goto yTfoO; hyAN8: $typeid = $_GPC['typeid']; goto EECD_; eMdm6: if (!empty($typeid)) { goto Vt0bO; } goto vMnRG; FrDe5: $maxlen = strlen($num); goto qa4gH; mVmtv: exit; goto lHz17; x21xB: e6qs0: goto KSsj8; WBq5O: QkjGW: goto afBo9; T2eNX: $typeid = intval($_GPC['typeid']); goto ihJCa; sJ1M0: PvVdx: goto WY78M; Nst7F: fDCb1: goto ID3DD; GMA_g: $tip = '<br>未保存成功的数据：主键=' . $noinsert . '<br>失败原因：已经使用无法更改'; goto XOvUG; BslNP: z8e5c: goto YHBRd; jNBjL: $i++; goto PXQmh; SBN6N: IxAdE: goto klR1c; ZmyUv: $add = bcadd($num, $i) . ''; goto GNL25; WKW2Y: $pindex = max(1, intval($page)); goto oyfR1; x8vRy: goto Xhon2; goto nC_g0; DVYMP: W1XFe: goto CuJE2; ulgeL: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_virtual_data') . ' d ' . ' left join ' . tablename('mihua_mall_member') . ' m on m.from_user = d.openid and m.uniacid=d.uniacid ' . ' left join ' . tablename('mihua_mall_order') . ' o on o.id = d.orderid ' . " where 1 {$condition} ", $params); goto adJ8G; TvYLO: $type['fields'] = iunserializer($type['fields']); goto Wqhhk; oR5Uo: $item['fields'] = iunserializer($item['fields']); goto aKJ2N; qnk68: $len == 0 && ($len = 1); goto HxT7Z; oyfR1: $psize = 100; goto OswOu; Cb7io: hrFa0: goto RMJ8z; w5FRl: YGvrP: goto RY0B8; fTY1Q: if ($_GPC['status'] == '0') { goto YGvrP; } goto ZBbyJ; mYrDL: goto z8e5c; goto qB7wF; vDtkL: if ($operation == 'delete') { goto AtFtG; } goto yL9Lz; Uw_y0: $maxlen = $addlen; goto Nst7F; OIFF0: if (empty($type['openid'])) { goto PvVdx; } goto F7jW5; yazPZ: if (!empty($noinsert)) { goto MwD3G; } goto cO6oj; Jlebs: $i = 0; goto BslNP; eUsJt: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $_GPC['typeid'], ":uniacid" => $_W['uniacid'])); goto blaB6; AP4aK: Xhon2: goto mVmtv; o4udg: if (empty($typeid)) { goto QkjGW; } goto vKmPp; WY78M: pdo_delete('mihua_mall_virtual_data', array("id" => $id)); goto CSefM; a1RAG: $i++; goto mYrDL; PXQmh: goto hrFa0; goto DVYMP; YHBRd: if (!($i < $len)) { goto lNmTi; } goto FWEhT; klR1c: jQ35E: goto a1RAG; nT9kG: $arr[$i] = str_pad($arr[$i], $maxlen, '0', STR_PAD_LEFT); goto SBN6N; sI2G6: $this->adminMessage('删除成功！', $this->createWebUrl('virtual_data', array("typeid" => $typeid))); goto AP4aK; UjnT5: $params = array(":typeid" => $typeid, ":uniacid" => $_W['uniacid']); goto fTY1Q; F7jW5: $this->adminMessage('数据已使用，无法删除！', $this->createWebUrl('virtual_data', array("typeid" => $typeid)), 'error'); goto sJ1M0; dopCU: if (empty($item['fields'])) { goto YqGwH; } goto KxPqv; HWtet: $condition .= ' and d.openid<>\'\''; goto v8thO; yL9Lz: goto ACul5; goto DewHR; cO6oj: $this->adminMessage('保存成功！', $this->createWebUrl('virtual_data', array("typeid" => $typeid))); goto O1rnq; Kc760: AtFtG: goto D7Ph7; yHQ_d: $data = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_data') . ' WHERE id=:id and typeid=:typeid and uniacid=:uniacid ', array(":id" => $editid, ":typeid" => $typeid, ":uniacid" => $_W['uniacid'])); goto YBwhe; ufu4l: $address = pdo_fetch('SELECT realname,province,city,area,address,mobile FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id and uniacid = :uniacid', array(":id" => $order['addressid'], ":uniacid" => $_W['uniacid'])); goto J_rCi; B8cb9: $this->updateStock($typeid); goto yazPZ; diHp9: if ($operation == 'post') { goto vLunj; } goto HwE5o; KxPqv: $tpids = $_GPC['tp_id']; goto hM1aY; o1Wpo: if (!empty($typeid)) { goto PcA9i; } goto Ow5rR; vMnRG: $this->adminMessage('Url参数错误！请重试！', $this->createWebUrl('virtual_temp'), 'error'); goto A_kOy; OIYDv: HSI29: goto gzcoZ; yTfoO: $num = $_GPC['num']; goto eXrh7; mQjBD: include $this->template('virtual_data'); goto b_ORZ; O1rnq: goto Hs0fv; goto BKYhV; N056I: if (empty($editid)) { goto e6qs0; } goto yHQ_d; jxF1K: $type = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_data') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $id, ":uniacid" => $_W['uniacid'])); goto OIFF0; eovbq: $typeid = $_GPC['typeid']; goto o1Wpo; ef4hV: $typeid = intval($_GPC['typeid']); goto o4udg; HzVW_: exit; goto ZL0fE; UkMO1: $item['fields'] = iunserializer($item['fields']); goto dopCU; g3kju: goto eMCIs; goto UkGjn; RY0B8: $condition .= ' and d.openid=\'\''; goto bjTCB; EECD_: $editid = $_GPC['id']; goto eMdm6; vKmPp: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $typeid, ":uniacid" => $_W['uniacid'])); goto UkMO1; uOAj2: global $_W, $_GPC; goto v_WbM; nyvem: goto NLKjy; goto w5FRl; L9vGu: die(json_encode($arr)); goto xQ0xD; CuJE2: $len = count($arr); goto Jlebs; OswOu: $type = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_type') . ' WHERE id=:id and uniacid=:uniacid ', array(":id" => $typeid, ":uniacid" => $_W['uniacid'])); goto TvYLO; oOW2l: foreach ($items as &$row) { goto HwUzQ; mPD4r: JvVIp: goto g49s2; WreN5: if (!is_array($carrier)) { goto JvVIp; } goto ghIhN; ghIhN: $row['realname'] = $carrier['carrier_realname']; goto h2v2D; HwUzQ: $carrier = iunserializer($row['carrier']); goto WreN5; h2v2D: $row['mobile'] = $carrier['carrier_mobile']; goto mPD4r; g49s2: VZ5m2: goto Hg_W0; Hg_W0: } goto OIYDv; hM1aY: foreach ($tpids as $index => $id) { goto qLss0; iMvAW: if (empty($keydata)) { goto nzP2A; } goto EJGrv; LRc5p: pdo_insert('mihua_mall_virtual_data', $insert); goto SWP8t; FhN5o: pdo_update('mihua_mall_virtual_data', $insert, array("id" => $keydata['id'])); goto WMvKI; xSuME: nzP2A: goto RSjDT; RSjDT: pdo_update('mihua_mall_virtual_data', $insert, array("id" => $datas['id'])); goto kJzPY; SWP8t: pdo_update('mihua_mall_virtual_type', 'alldata=alldata+1', array("id" => $item['id'])); goto G4P_A; kQ3ww: l2zk_: goto LRc5p; kJzPY: IZ5ZA: goto pwgaU; Im7r2: $insert = array("typeid" => $_GPC['typeid'], "pvalue" => $values['key'], "fields" => iserializer($values), "uniacid" => $_W['uniacid']); goto TnBU2; pwgaU: goto gYzgh; goto Irinr; QdJg0: goto IZ5ZA; goto xSuME; Q5RdM: foreach ($item['fields'] as $key => $name) { $values[$key] = $_GPC['tp_value_' . $key][$index]; ecPvC: } goto jQ0sa; K5g6I: if (empty($keydata)) { goto l2zk_; } goto FhN5o; Ip3Q0: if (empty($datas)) { goto H381O; } goto Vnbj9; WMvKI: goto bM1As; goto kQ3ww; jQ0sa: PF1Eo: goto Im7r2; G4P_A: bM1As: goto Z2V1E; Irinr: H381O: goto ZSFal; TnBU2: $datas = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_data') . ' WHERE id=:id and typeid=:typeid and uniacid=:uniacid ', array(":id" => $id, ":typeid" => $typeid, ":uniacid" => $_W['uniacid'])); goto Ip3Q0; qLss0: $values = array(); goto Q5RdM; Z2V1E: gYzgh: goto pyR5t; Vnbj9: $keydata = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_data') . ' WHERE pvalue=:pvalue and id<>:id and typeid=:typeid and uniacid=:uniacid ', array(":pvalue" => $insert['pvalue'], ":id" => $id, ":typeid" => $typeid, ":uniacid" => $_W['uniacid'])); goto iMvAW; EJGrv: $noinsert .= $insert['pvalue'] . ','; goto QdJg0; ZSFal: $keydata = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_virtual_data') . ' WHERE pvalue=:pvalue  and typeid=:typeid and uniacid=:uniacid ', array(":pvalue" => $insert['pvalue'], ":typeid" => $typeid, ":uniacid" => $_W['uniacid'])); goto K5g6I; pyR5t: LNszk: goto qrVUE; qrVUE: } goto Vc0ki; eXrh7: $len = intval($_GPC['len']); goto qnk68; HwE5o: if ($operation == 'autonum') { goto eC31a; } goto vDtkL; ID3DD: $arr[] = $add; goto nK0oR; b_ORZ: } public function updateGoodsStock($id = 0) { goto SoZpG; yvZck: if (!empty($goods)) { goto F6vf1; } goto oUKQr; uhurn: goto WoVgi; goto wS69p; wS69p: k3SE3: goto Qssee; SoZpG: global $_W, $_GPC; goto gJfPL; WK5uo: $virtuals = array(); goto k2yRH; MKLuQ: WoVgi: goto V3QoX; t2yiT: foreach ($alloptions as $opt) { goto qnJuf; bmjL8: $stock += $c; goto V6Hsu; lH0kv: $c = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_virtual_data') . ' where typeid=:typeid and uniacid=:uniacid and openid=0 limit 1', array(":typeid" => $opt['virtual'], ":uniacid" => $_W['uniacid'])); goto XYuxy; p2el3: nQtRl: goto xEtaE; qnJuf: if (!empty($opt['virtual'])) { goto CgN4t; } goto RwcXi; WB_Jt: $virtuals[] = $opt['virtual']; goto bmjL8; XYuxy: pdo_update('mihua_mall_goods_option', array("stock" => $c), array("id" => $opt['id'])); goto PRFdA; PRFdA: if (in_array($opt['virtual'], $virtuals)) { goto QYrpT; } goto WB_Jt; RwcXi: goto nQtRl; goto ijGXu; ijGXu: CgN4t: goto lH0kv; V6Hsu: QYrpT: goto p2el3; xEtaE: } goto XPrX8; gJfPL: $goods = pdo_fetch('select virtual from ' . tablename('mihua_mall_goods') . ' where id=:id and type=3 and uniacid=:uniacid limit 1', array(":id" => $id, ":uniacid" => $_W['uniacid'])); goto yvZck; LHZ9j: $stock = 0; goto jSEFs; jSEFs: if (!empty($goods['virtual'])) { goto k3SE3; } goto WK5uo; XPrX8: ifSwu: goto uhurn; Qssee: $stock = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_virtual_data') . ' where typeid=:typeid and uniacid=:uniacid and openid=0 limit 1', array(":typeid" => $goods['virtual'], ":uniacid" => $_W['uniacid'])); goto MKLuQ; k2yRH: $alloptions = pdo_fetchall('select id, virtual from ' . tablename('mihua_mall_goods_option') . " where goodsid={$id}"); goto t2yiT; kqs29: F6vf1: goto LHZ9j; oUKQr: return; goto kqs29; V3QoX: pdo_update('mihua_mall_goods', array("total" => $stock), array("id" => $id)); goto Epx6N; Epx6N: } public function updateStock($typeid = 0) { goto SuCey; SuCey: global $_W; goto sh5ch; CwhvF: F5g9S: goto AciGi; sh5ch: $goodsids = array(); goto BX6hW; BX6hW: $goods = pdo_fetchall('select id from ' . tablename('mihua_mall_goods') . ' where type=3 and virtual=:virtual and uniacid=:uniacid limit 1', array(":virtual" => $typeid, ":uniacid" => $_W['uniacid'])); goto r5J7q; Uk3Ks: pbojB: goto TXcYO; Tm9r6: foreach ($alloptions as $opt) { goto iPGKK; IZWLQ: $goodsids[] = $opt['goodsid']; goto ZwIpY; iPGKK: if (in_array($opt['goodsid'], $goodsids)) { goto Z7dyH; } goto IZWLQ; ZwIpY: Z7dyH: goto rryTi; rryTi: KDayu: goto opAx3; opAx3: } goto Uk3Ks; q6QWy: gGvtw: goto pKX0h; pKX0h: $alloptions = pdo_fetchall('select id, goodsid from ' . tablename('mihua_mall_goods_option') . ' where virtual=:virtual and uniacid=:uniacid', array(":uniacid" => $_W['uniacid'], ":virtual" => $typeid)); goto Tm9r6; TXcYO: foreach ($goodsids as $gid) { $this->updateGoodsStock($gid); g9CbS: } goto CwhvF; r5J7q: foreach ($goods as $g) { $goodsids[] = $g['id']; komPv: } goto q6QWy; AciGi: } function createAutoNum($a, $b) { goto Afz7i; zoJKu: $t1 = 0; goto BbesA; BbesA: $t2 = 0; goto sf6rR; oZh0d: $result = $t % 10 . $result; goto eN3Yq; kD6cb: if (!($n > 0)) { goto SbR2D; } goto Yp08n; i0Cc8: if (!$num--) { goto Eh0As; } goto zoJKu; URWPE: $flag = 0; goto xDZy5; xDZy5: hqfn1: goto i0Cc8; lwTtb: return $result; goto Y2heN; mop_8: $result = ''; goto URWPE; Yp08n: $t2 = $b[--$n]; goto I62Zw; fZ9Ou: liGDO: goto kD6cb; ZwTp2: Eh0As: goto lwTtb; Afz7i: $m = strlen($a); goto uK1_M; I62Zw: SbR2D: goto yr7rq; DuI4X: $num = $m > $n ? $m : $n; goto mop_8; sf6rR: if (!($m > 0)) { goto liGDO; } goto jrBLK; B00Fx: $flag = $t / 10; goto oZh0d; eN3Yq: goto hqfn1; goto ZwTp2; yr7rq: $t = $t1 + $t2 + $flag; goto B00Fx; uK1_M: $n = strlen($b); goto DuI4X; jrBLK: $t1 = $a[--$m]; goto fZ9Ou; Y2heN: } function NumToStr($num) { goto mwhbJ; YlY2m: QB0fq: goto E8liW; sTRJg: goto hmZpw; goto APVs_; mpv91: $result = ''; goto XH6qh; J9gI6: $result = $v . $result; goto sTRJg; APVs_: Nl0DZ: goto H3iCd; mwhbJ: if (!(stripos($num, 'e') === false)) { goto QB0fq; } goto OA3K3; H3iCd: return $result; goto ftuUX; thhE0: $v = $num - floor($num / 10) * 10; goto HAlK4; OA3K3: return $num; goto YlY2m; E8liW: $num = trim(preg_replace('/[=\'"]/', '', $num, 1), '"'); goto mpv91; HAlK4: $num = floor($num / 10); goto J9gI6; NdaCf: if (!($num > 0)) { goto Nl0DZ; } goto thhE0; XH6qh: hmZpw: goto NdaCf; ftuUX: } public function doWebOrdermy() { goto hhbvH; sviBF: goto x5ne1; goto NZCYk; vsnFS: $this->changeWechatSend($id, 0, $_GPC['cancelreson']); goto PqEvM; I1dGY: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id', array(":id" => $id)); goto Q8kDH; zEVmE: qfBUF: goto Gobi4; Utdp2: $this->adminMessage('订单关闭操作成功！', referer(), 'success'); goto rRfaV; jT06s: $this->adminMessage('开启订单操作成功！', referer(), 'success'); goto NaeBJ; JJYMD: goto bkSZn; goto Ep1Tg; cBJ3w: foreach ($list as $key => $l) { goto iRedR; G0ZQR: foreach ($commissions as $commission) { goto qORPr; rfIZX: HPWYs: goto XmPTF; Ud1mo: if ($cfg['globalCommissionLevel'] >= 2) { goto UR1O5; } goto vjeHg; jyYJI: goto F7tNX; goto rfIZX; Vd9Ah: if ($cfg['globalCommissionLevel'] >= 3) { goto HPWYs; } goto yoPRv; yoPRv: $list[$key]['commission3'] = 0; goto jyYJI; qORPr: $list[$key]['commission'] = $commission['commission'] * $commission['total']; goto Ud1mo; Hm1UC: $list[$key]['commission2'] = $commission['commission2'] * $commission['total']; goto xHTAX; xHTAX: Uq5kq: goto Vd9Ah; HBNUm: goto Uq5kq; goto ZC2L9; ZC2L9: UR1O5: goto Hm1UC; PJwwj: F7tNX: goto NfxOs; XmPTF: $list[$key]['commission3'] = $commission['commission3'] * $commission['total']; goto PJwwj; vjeHg: $list[$key]['commission2'] = 0; goto HBNUm; NfxOs: WLVTh: goto KIBqZ; KIBqZ: } goto rVZiu; l1WA8: XI4um: goto lpq1C; rVZiu: KMnM2: goto l1WA8; iRedR: $commissions = pdo_fetchall('select total,commission as commission, commission2 as commission2, commission3 as commission3 from ' . tablename('mihua_mall_order_goods') . ' where orderid = ' . $l['id']); goto G0ZQR; lpq1C: } goto zEVmE; hCKGx: $condition .= ' AND sendtype = \'' . intval($sendtype) . '\' AND status != \'3\''; goto V_fen; bJneU: goto KsJMZ; goto r5Oyx; vX6xT: pdo_update('mihua_mall_order', array("status" => 2, "remark" => $_GPC['remark'], "express" => $_GPC['express'], "expresscom" => $_GPC['expresscom'], "expresssn" => $_GPC['expresssn']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto qOKNP; mUtZO: uhSsd: goto XQHSF; EEjsq: $address = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_address') . ' WHERE id IN (\'' . implode('\',\'', $addressids) . '\')', array(), 'id'); goto FxtMj; fc1FM: $count_ded = $item['deductible'] * $deductible; goto U4kL6; eF4hX: if (!checksubmit('finish')) { goto xZE2H; } goto wMxuB; HGcdA: $cfg = $this->module['config']; goto yelqT; Ma01y: $sendMsgTemplateid = $cfg['sendMsgTemplateid']; goto hhIsx; dPUgR: $condition = ''; goto vNbMj; LB7bd: $this->adminMessage('发货操作成功！', referer(), 'success'); goto DSzCS; IebxB: $this->adminMessage('订单完成操作成功！', referer(), 'success'); goto u3XkP; h21lc: goto x5ne1; goto STMpI; C8pFp: $this->changeWechatSend($id, 1); goto eJhD0; K9LQZ: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE from_user = '{$_GPC['from_user']}' AND uniacid = '{$_W['uniacid']}'{$condition}"); goto iPgGg; kzGZk: HZ629: goto nbQ1u; VXPyR: foreach ($goods as $good) { goto dRzn8; htXhJ: mfV2i: goto PblkT; dRzn8: $goodstitle .= $good['title']; goto TUFHK; TUFHK: if (!($good != end($goods))) { goto mfV2i; } goto DVxfC; DVxfC: $goodstitle .= '\\n'; goto htXhJ; PblkT: aWgxh: goto CCgxG; CCgxG: } goto YsPIN; YiMlJ: $this->adminMessage('订单备注成功！', referer(), 'success'); goto kzGZk; V94Wx: YmAdu: goto yfFFO; iPgGg: $pager = pagination($total, $pindex, $psize); goto a2QKc; lgD8k: q4RJT: goto jSBex; cLiNr: if (empty($sendtype)) { goto kielo; } goto hCKGx; iDMXM: hgA1Z: goto EtyW1; l8Ijr: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('myorder', array("orderid" => $id, "op" => "detail")); goto JVz2g; KDR8w: $transid = pdo_fetch('SELECT transid FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id', array(":id" => $orderid)); goto u1VlR; vzmpH: KsJMZ: goto Tc8hn; w8LbY: $goodstitle = ''; goto VXPyR; CCAPS: $id = intval($_GPC['id']); goto UvCuh; VVAbq: e4Acx: goto LB7bd; zsFES: $this->adminMessage('请输入快递单号！'); goto nSC9q; Q8kDH: $dispatch = pdo_fetch('select id,dispatchname,dispatchtype from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $item['dispatch'])); goto WayAL; DVxv3: if (!checksubmit('close')) { goto PWKYH; } goto K9RtY; Xrwtw: $condition .= ' and ( status=1 and sendtype =2 )'; goto GC6jR; yM4H8: if ($operation == 'detail') { goto hZHEn; } goto ju65r; PGczI: $this->setCommission($id); goto IebxB; sphVI: J6sn5: goto eF4hX; TPkGx: $deductible = $cfg['deductible']; goto vJ1fZ; nSC9q: ZYwZL: goto KDR8w; u3XkP: xZE2H: goto RUAXg; yfFFO: if (empty($addressids)) { goto UjWMx; } goto EEjsq; u1VlR: if (empty($transid)) { goto JH4TE; } goto C8pFp; Dl9tr: janen: goto Qxr_d; oY3eC: $this->__web2(); goto HGcdA; SFsWH: $dispatch = pdo_fetch('select id,dispatchname,dispatchtype from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $item['dispatch'])); goto eKipW; MAUOw: $this->setOrderCredit($id); goto hLHt7; Gobi4: surtx: goto fe7Ej; qOKNP: $goodsid = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . " WHERE orderid = '{$id}'", array(), 'goodsid'); goto CzFXf; zjlj7: O9K0i: goto tEzsX; GC6jR: goto bkSZn; goto vIuZC; cVfez: $sendtype = !isset($_GPC['sendtype']) ? 0 : $_GPC['sendtype']; goto tzFQs; A5tQ3: $this->adminMessage('确认订单付款操作成功！', referer(), 'success'); goto GPwt2; ju65r: if ($op == 'admin_remark') { goto pz14d; } goto h21lc; BU5f7: gkRPl: goto y5u_E; L5WqS: if (!empty($_GPC['uid'])) { goto uhSsd; } goto tFjHT; c3ZH2: if ($_GPC['isexpress'] == '1' && !empty($sendMsgTemplateid)) { goto mN4Qe; } goto Sa312; SqFrU: if ($today == '1') { goto J3GrR; } goto LQCX9; tFjHT: $this->adminMessage('请选择会员！', create_url('site/entry', array("do" => "charge", "op" => "list", "m" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto DBxQ4; DSzCS: LwcML: goto ofsit; rRfaV: PWKYH: goto icLjn; O674B: $this->adminMessage('取消发货操作成功！', referer(), 'success'); goto sphVI; Gf4sK: $dispatch = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . ' WHERE id = :id', array(":id" => $item['dispatch'])); goto CrVd0; tEzsX: NYjEk: goto JFIZ4; kRzhH: $count_ded = $item['ded_money']; goto zjlj7; o57b2: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE from_user = '{$_GPC['from_user']}' 
			AND uniacid = '{$_W['uniacid']}' {$condition} ORDER BY createtime DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto K9LQZ; eCHwo: $remark = '------------------------------\\n' . '商品信息：' . $goodstitle . '\\n' . '订单编号：' . $item['ordersn'] . '\\n' . '发货时间：' . $timestr; goto TZ3pq; DBxQ4: exit; goto mUtZO; ch8QH: $this->sendtmpmsg_deliver($item['from_user'], $sendMsgTemplateid, $url, '亲，您购买的宝贝已出库', '自提', '自提', $remark); goto kvNEg; hhIsx: if (!(!empty($_GPC['isexpress']) && empty($_GPC['expresssn']))) { goto ZYwZL; } goto zsFES; MdVSk: zKAwJ: goto iB7FT; kvNEg: auqcH: goto aNdvp; jFyDn: pMhZI: goto S9y0O; eRQ22: goto x5ne1; goto auC4L; k_YbO: v5uVM: goto cLiNr; pJYG2: unset($row); goto V94Wx; x8KqN: $psize = 20; goto GSdLl; e1U5H: $cid = intval($_GPC['cate_1']); goto fwX1Q; qJOgB: if (!empty($_GPC['cate_1'])) { goto YfyUX; } goto MCxXr; Bliw5: rDrCL: goto kRzhH; auC4L: hZHEn: goto Ym45w; YsPIN: AtLGy: goto c3ZH2; VNh6h: pdo_update('mihua_mall_order', array("status" => 3, "paytype" => 3, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto pq22R; TZ3pq: $this->sendtmpmsg_deliver($item['from_user'], $sendMsgTemplateid, $url, '亲，您购买的宝贝已经启程', $_GPC['express'], $_GPC['expresssn'], $remark); goto VVAbq; iB7FT: if (!($item['deductible'] > 0)) { goto NYjEk; } goto MdpoZ; hhbvH: global $_GPC, $_W; goto oY3eC; FxtMj: UjWMx: goto eRQ22; MdpoZ: if ($item['ded_money'] > 0) { goto rDrCL; } goto TPkGx; AyKtQ: $this->setCommission($id); goto A5tQ3; TgJN4: $red_packet = floatval($red_packet); goto Tku1t; JaMQc: $condition .= ' and DATE_FORMAT(FROM_UNIXTIME(createtime),\'%Y-%m-%d\') = DATE_FORMAT(NOW(),\'%Y-%m-%d\')'; goto rm1Od; NfxhP: $pindex = max(1, intval($_GPC['page'])); goto x8KqN; wMxuB: pdo_update('mihua_mall_order', array("status" => 3, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto AWAlf; sAOQ7: goto bkSZn; goto daCU9; Ep1Tg: Azplw: goto Xrwtw; wL705: foreach ($members as $m) { $member[$m['id']] = $m['realname']; YZcnC: } goto Dl9tr; ibFF2: $this->setOrderRed($id); goto PGczI; GPwt2: ap8uN: goto DVxv3; dMDMT: $this->setbackmoney($id); goto bBCLq; SHHtQ: $condition .= " AND title LIKE '%{$_GPC['keyword']}%'"; goto jFyDn; CzFXf: $goods = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit, g.marketprice,o.total,o.optionid FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$id}'"); goto l8Ijr; bBCLq: $this->setOrderRed($id); goto AyKtQ; y5u_E: $item['user'] = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_address') . " WHERE id = {$item['addressid']}"); goto hXgeX; LQCX9: $condition .= ' AND status = \'' . intval($status) . '\''; goto l9Szf; k4vrP: pdo_update('mihua_mall_order', array("admin_remark" => $admin_remark), array("id" => $id, "uniacid" => $_W['uniacid'])); goto YiMlJ; d4d22: if (empty($item['transid'])) { goto lr7Sy; } goto vsnFS; O2wUH: pdo_update('mihua_mall_order', array("status" => 0, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto jT06s; oi24X: $_GPC['from_user'] = $fansinfo['openid']; goto oIIXm; V_fen: kielo: goto o57b2; MCxXr: goto KsJMZ; goto lgD8k; rm1Od: bkSZn: goto ze9_2; bBB77: $shareid = $_GPC['shareid']; goto nvG5n; l9Szf: goto bkSZn; goto iDMXM; Sa312: if (!($_GPC['isexpress'] == '0' && !empty($sendMsgTemplateid))) { goto auqcH; } goto SFsWH; RL7AI: pdo_update('mihua_mall_order', array("status" => 1, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto O674B; bR_hp: pdo_update('mihua_mall_order', array("status" => 0, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto yUg5L; eKipW: $remark = '------------------------------\\n' . '商品信息：' . $goodstitle . '\\n' . '订单编号：' . $item['ordersn'] . '\\n' . '出库时间：' . $timestr; goto ch8QH; Qxr_d: $id = intval($_GPC['id']); goto I1dGY; ofsit: if (!checksubmit('cancelsend')) { goto J6sn5; } goto oRZj8; lggi2: if (!checksubmit('confrimpay')) { goto ap8uN; } goto VNh6h; gD3sP: pOTuG: goto lggi2; hLHt7: $this->setbackmoney($id); goto ibFF2; daCU9: xZ3VX: goto KXhl9; n1pxq: include $this->template($template); goto UisPC; fwX1Q: $condition .= " AND pcate = '{$cid}'"; goto vzmpH; hyXmR: pdo_update('mihua_mall_order', array("status" => -1, "remark" => $_GPC['remark']), array("id" => $id, "uniacid" => $_W['uniacid'])); goto Utdp2; vNbMj: if (empty($_GPC['keyword'])) { goto pMhZI; } goto SHHtQ; kVn28: foreach ($list as &$row) { goto WhCqq; WLr24: $row['dispatch'] = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . ' WHERE id = :id', array(":id" => $row['dispatch'])); goto Kaeq1; WhCqq: !empty($row['addressid']) && ($addressids[$row['addressid']] = $row['addressid']); goto WLr24; Kaeq1: b9Shy: goto M_UYP; M_UYP: } goto cPV9v; PempC: if (!($admin_remark && $id)) { goto HZ629; } goto k4vrP; AWAlf: $this->setOrderStock($id); goto MAUOw; Oe0XF: $express = pdo_fetch('select * from ' . tablename('mihua_mall_express') . ' WHERE id=:id limit 1', array(":id" => $dispatch['express'])); goto BU5f7; J0WOU: if (empty($_GPC['shareid'])) { goto v5uVM; } goto bBB77; Tku1t: if (!empty($item)) { goto zKAwJ; } goto Q7Ev8; PrfQ4: if ($status == 1 && $sendtype == 2) { goto Azplw; } goto SqFrU; K9RtY: $item = pdo_fetch('SELECT transid FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id', array(":id" => $id, "uniacid" => $_W['uniacid'])); goto XGy9v; b4Sn_: NPrLp: goto fc1FM; r5Oyx: YfyUX: goto e1U5H; nvG5n: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $shareid . ' and uniacid = ' . $_W['uniacid']); goto dGkIB; tzFQs: $dispatchPro = $_GPC['dispatchPro']; goto dPUgR; pq22R: $this->setOrderStock($id); goto qk6zw; JFIZ4: if (!checksubmit('confirmsend')) { goto LwcML; } goto Ma01y; EtyW1: $condition .= 'AND  o.dispatchPro = \'' . intval($dispatchPro) . '\''; goto sAOQ7; STMpI: Qb9Bs: goto NfxhP; NyrF7: $member = array(); goto wL705; yUg5L: $this->setOrderStock($id, false); goto JEINS; yelqT: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto L5WqS; aNdvp: goto e4Acx; goto i9Qkf; m4BsL: $template = $this->selectTemplate('ordermy'); goto n1pxq; Q7Ev8: $this->adminMessage('抱歉，订单不存在!', referer(), 'error'); goto MdVSk; X69aQ: $condition .= " AND ccate = '{$cid}'"; goto bJneU; a2QKc: if (empty($list)) { goto surtx; } goto cBJ3w; WayAL: $red_packet = pdo_fetchcolumn('select money from ' . tablename('mihua_mall_red') . ' where orderid=:id limit 1', array(":id" => $item['id'])); goto TgJN4; odXP5: $this->changeWechatSend($id, 0, $_GPC['reson']); goto KDhY9; ze9_2: KOBWk: goto J0WOU; GSdLl: $status = !isset($_GPC['status']) ? -1 : $_GPC['status']; goto cVfez; vIuZC: J3GrR: goto JaMQc; U4kL6: goto O9K0i; goto Bliw5; oIIXm: if ($operation == 'display') { goto Qb9Bs; } goto yM4H8; q8KWh: if ($status == '1' && empty($sendtype)) { goto xZ3VX; } goto PrfQ4; HvSgf: if (!empty($dispatchPro)) { goto hgA1Z; } goto q8KWh; JEINS: $this->adminMessage('取消订单付款操作成功！', referer(), 'success'); goto gD3sP; PVoq_: $deductible = 0.1; goto b4Sn_; KXhl9: $condition .= ' and ordertype=1 or (ordertype!=1 and iscomplete=1)'; goto lJZ1u; cPV9v: iTDI3: goto pJYG2; NaeBJ: teLDE: goto Gf4sK; jSBex: $cid = intval($_GPC['cate_2']); goto X69aQ; lJZ1u: $condition .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto JJYMD; UvCuh: $admin_remark = $_GPC['admin_remark']; goto PempC; fe7Ej: if (empty($list)) { goto YmAdu; } goto kVn28; XQHSF: $fansinfo = pdo_fetch('select * from ' . tablename('mc_mapping_fans') . ' where uid=:uid', array("uid" => $_GPC['uid'])); goto oi24X; Tc8hn: if (!($status != '-1')) { goto KOBWk; } goto HvSgf; S9y0O: if (!empty($_GPC['cate_2'])) { goto q4RJT; } goto qJOgB; XGy9v: if (empty($item['transid'])) { goto Jv3jI; } goto odXP5; vJ1fZ: if (!empty($deductible)) { goto NPrLp; } goto PVoq_; eJhD0: JH4TE: goto vX6xT; icLjn: if (!checksubmit('open')) { goto teLDE; } goto O2wUH; JVz2g: $timestr = date('Y-m-d H:i', TIMESTAMP); goto w8LbY; KDhY9: Jv3jI: goto hyXmR; NZCYk: pz14d: goto CCAPS; CrVd0: if (!(!empty($dispatch) && !empty($dispatch['express']))) { goto gkRPl; } goto Oe0XF; nbQ1u: x5ne1: goto m4BsL; S3oru: $item['goods'] = $goods; goto sviBF; qk6zw: $this->setOrderCredit($id); goto dMDMT; RUAXg: if (!checksubmit('cancelpay')) { goto pOTuG; } goto bR_hp; dGkIB: $condition .= ' AND shareid = \'' . intval($_GPC['shareid']) . '\' AND createtime>=' . $user['flagtime'] . ' AND from_user<>\'' . $user['from_user'] . '\''; goto k_YbO; PqEvM: lr7Sy: goto RL7AI; Ym45w: $members = pdo_fetchall('select id, realname from ' . tablename('mihua_mall_member') . ' where uniacid = ' . $_W['uniacid'] . ' and status = 1'); goto NyrF7; hXgeX: $goods = pdo_fetchall('SELECT g.id, g.title, g.status,g.thumb, g.unit,g.goodssn,g.productsn,g.marketprice,o.total,g.type,o.optionname,o.optionid,o.price as orderprice FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$id}'"); goto S3oru; oRZj8: $item = pdo_fetch('SELECT transid FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id', array(":id" => $id)); goto d4d22; i9Qkf: mN4Qe: goto eCHwo; UisPC: } public function domobileManagecenter() { goto P4VBZ; LQ6la: $total6 = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " o  where o.status=4 and  o.uniacid='{$_W['uniacid']}'"); goto wNprq; sfwtI: $shopname = $settings['shopname']; goto pt3m2; pt3m2: if ($openid != $noticeid) { goto U5iJ2; } goto s1iMN; wdRXf: $settings = $this->module['config']; goto qx9R7; ngPf0: $msg_count = count($this->web_msg()); goto SpT_p; IXI9M: goto CI7W4; goto fW2k9; Wq3iZ: $total4 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid ={$_W['uniacid']}" . ' and status=2 '); goto XTuu9; zp3GD: $template = $this->selectTemplate('managecenter'); goto pus1v; qx9R7: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto cZH5f; fW2k9: U5iJ2: goto d81wO; wNprq: $total6 = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . ' o left join  ' . tablename('mihua_mall_order_goods') . " g on g.orderid=o.id and o.uniacid=g.uniacid where g.order_status>=2  and o.uniacid='{$_W['uniacid']}'"); goto ngPf0; cZH5f: $commissionbutton = $settings['commissionbutton']; goto FKrHu; SpT_p: $total7 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . ' and remark !=\'\''); goto MzTVU; d81wO: message('您不是管理员', $this->createMobileUrl('list'), 'error'); goto Ndvbt; TS2bv: $total3 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . ' and status=0 '); goto Wq3iZ; MzTVU: $redrecord = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_red') . " WHERE uniacid ={$_W['uniacid']}", array(":uniacid" => $_W['uniacid'])); goto OPnp4; s1iMN: $total0 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . ' and DATE_FORMAT(FROM_UNIXTIME(createtime),\'%Y-%m-%d\') = DATE_FORMAT(NOW(),\'%Y-%m-%d\') '); goto nPNZY; Vzma1: $this->toflag(); goto bKrpy; bKrpy: $openid = $_W['openid']; goto wdRXf; XTuu9: $total5 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . ' and status=3'); goto LQ6la; FKrHu: $imgUrl = $_W['attachurl'] . $settings['logo']; goto sfwtI; kgs_B: $where .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto KIMJw; OPnp4: $total_commission = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_commissionPay') . ' where status=1'); goto IXI9M; nPNZY: $where .= ' and (ordertype=1 or (ordertype!=1 and iscomplete=1))'; goto kgs_B; KIMJw: $total1 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . $where); goto SY4tt; P4VBZ: global $_GPC, $_W; goto Vzma1; SY4tt: $total2 = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = {$_W['uniacid']}" . ' and ( status=1 or (status=0 and paytype=3) ) and sendtype=2'); goto TS2bv; Ndvbt: CI7W4: goto zp3GD; pus1v: include $this->template($template); goto w1MBx; w1MBx: } public function domobileOrderlist() { goto ugkP_; S0e6r: goto cFIm5; goto AnkFw; F5hGL: ML35m: goto Ow6Fm; x3yqn: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto oiev6; clYzM: $this->toflag(); goto w6e_n; bttb_: fvKMP: goto zeqcc; Q7OZT: $where .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto S0e6r; TW27u: $where .= " and status={$status}"; goto cIdyJ; Ow6Fm: $where .= ' and remark !=\'\''; goto liYOL; rQSx3: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE {$where}"); goto aSvKm; pVvuO: $odurl = 'orderdesc'; goto jfKax; jfKax: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto x3yqn; cIdyJ: goto cFIm5; goto Q1I3K; D6ZtK: $psize = 10; goto SL0_L; LCmHS: $where .= 'and DATE_FORMAT(FROM_UNIXTIME(createtime),\'%Y-%m-%d\') = DATE_FORMAT(NOW(),\'%Y-%m-%d\')'; goto b6t84; w6e_n: $openid = $_W['openid']; goto EbevV; MmuJC: if ($createtime == 1) { goto gzt2J; } goto UOViR; DgdVi: $sendtype = !isset($_GPC['sendtype']) ? 0 : $_GPC['sendtype']; goto S0QUi; vqTHO: goto cFIm5; goto Fj6rh; I89bx: if ($status == '1' && empty($sendtype)) { goto KmlEu; } goto xUArz; Zf1XX: include $this->template($template); goto dDbIR; zeqcc: $where .= ' and status in(0,1,2,3)'; goto vqTHO; AnkFw: ctibf: goto XTpKD; AL3UE: y3ppy: goto OwLpq; OI2r6: gz3UA: goto B9ZY4; S0QUi: if (empty($list)) { goto gz3UA; } goto TWULZ; dxUSf: $remark = intval($_GPC['remark']); goto od_WD; od_WD: $where = " uniacid = '{$_W['uniacid']}'"; goto aM7N8; liYOL: cFIm5: goto bKMvr; AieHP: message('抱歉，您没有权限访问！', $this->createMobileUrl('list'), 'error'); goto AL3UE; n_CN7: BFMOZ: goto FfwY9; FR_QO: KAdyB: goto OI2r6; Fj6rh: gzt2J: goto LCmHS; wOn1j: $template = $this->selectTemplate('orderlist'); goto Zf1XX; bKMvr: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE {$where} ORDER BY id DESC ", array(), 'id'); goto rQSx3; SL0_L: $status = intval($_GPC['status']); goto VsUgO; OwLpq: $settings = $this->module['config']; goto pVvuO; VsUgO: $createtime = intval($_GPC['createtime']); goto dxUSf; v0vzk: message('您不是管理员', $this->createMobileUrl('list'), 'error'); goto kb8fU; aM7N8: $sendtype = intval($_GPC['sendtype']); goto I89bx; Q1I3K: KmlEu: goto bWU4o; b6t84: goto cFIm5; goto F5hGL; bWU4o: $where .= ' and (ordertype=1 or (ordertype!=1 and iscomplete=1))'; goto Q7OZT; UOViR: if ($remark == 1) { goto ML35m; } goto TW27u; kb8fU: goto AGT4A; goto n_CN7; oiev6: if ($openid == $noticeid) { goto BFMOZ; } goto v0vzk; TWULZ: foreach ($list as &$row) { goto j5LUO; qHf7W: foreach ($goods as &$item) { goto CkxOS; BC8DP: Pg33l: goto BFlVc; LIZoG: $item['groupprice'] = $option['groupprice']; goto CN2Hs; TI0b5: $item['title'] = '[' . $option['title'] . ']' . $item['title']; goto VgtGQ; CkxOS: $option = pdo_fetch('select title,marketprice,weight,groupprice,stock from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $item['optionid'])); goto whjsZ; VgtGQ: $item['marketprice'] = $option['marketprice']; goto LIZoG; CN2Hs: DHTbz: goto BC8DP; whjsZ: if (!$option) { goto DHTbz; } goto TI0b5; BFlVc: } goto XgTcO; nIBmq: unset($item); goto kSjlq; wCuKo: vIhds: goto Ge3me; j5LUO: $goods = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit, g.marketprice,o.total,o.optionid,o.order_status FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$row['id']}'"); goto qHf7W; fsBi9: $row['total'] = $goods['total']; goto I1iy2; XgTcO: bqhPU: goto nIBmq; I1iy2: $row['dispatch'] = pdo_fetch('select id,dispatchname from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $row['dispatch'])); goto wCuKo; kSjlq: $row['goods'] = $goods; goto fsBi9; Ge3me: } goto FR_QO; EbevV: if (!empty($openid)) { goto y3ppy; } goto AieHP; xUArz: if ($status == 1 && $sendtype == 2) { goto ctibf; } goto yW2s5; iepb2: goto cFIm5; goto bttb_; FfwY9: $pindex = max(1, intval($_GPC['page'])); goto D6ZtK; kSGqd: AGT4A: goto wOn1j; B9ZY4: $carttotal = $this->getCartTotal(); goto kSGqd; ugkP_: global $_GPC, $_W; goto clYzM; XTpKD: $where .= ' and ( status=1 and sendtype =2 )'; goto iepb2; aSvKm: $pager = pagination($total, $pindex, $psize); goto DgdVi; yW2s5: if ($status == 6) { goto fvKMP; } goto MmuJC; dDbIR: } public function domobileOrderdesc() { goto yR6f0; RMtbr: exit; goto gO2w1; HvIXq: message('订单关闭操作成功！', referer(), 'success'); goto tJ14o; io48N: unset($g); goto l3WMJ; tbP8k: g6IRe: goto KxKMp; StBS3: $red_packet = floatval($red_packet); goto onLZc; Bulmz: $deductible = 0.1; goto HTEXg; Cpcd5: goto L8DdX; goto UgQcO; AFbrL: mc_credit_update($memberId, 'credit2', $item['price'], array($_W['uid'], "取消订单退款说明")); goto ow2oC; vLRQj: message('抱歉，您没有权限访问！', $this->createMobileUrl('list'), 'error'); goto U1Yri; ZD5jA: pdo_update('mihua_mall_order', array("status" => 3, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto oVzlj; MbY39: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto O3dO4; XSmfl: DpnvJ: goto lWNjx; NE5mH: vS0Pn: goto kgyy0; k3ZV_: die(json_encode(array("result" => 0, "str" => "订单备注成功"))); goto tKa_K; Cj5Nx: if ($admin_remark && $orderid) { goto RkNR0; } goto OlmWe; l62Cy: if (!checksubmit('confirmsend')) { goto vfgJT; } goto BH1al; ELdY_: if (!($item['sendtype'] == '2' && !empty($sendMsgTemplateid))) { goto DpnvJ; } goto tZ3eW; TABLu: $memberId = mc_openid2uid($item['from_user']); goto AFbrL; Brkf4: message('开启订单操作成功！', referer(), 'success'); goto dlDK2; VS6nw: foreach ($goods as $good) { goto kkwMM; iYq17: $goodstitle .= '\\n'; goto oM6b5; oM6b5: kwSdO: goto BcUIb; zSTaq: if (!($good != end($goods))) { goto kwSdO; } goto iYq17; BcUIb: MG2Ew: goto ZywQ5; kkwMM: $goodstitle .= $good['title']; goto zSTaq; ZywQ5: } goto T2vY6; cHmhn: if (!($tmp == 1)) { goto j2k30; } goto A5VNf; jW46V: foreach ($data as $key => $g) { goto VUi5L; j1hv3: $verifystore = pdo_fetch('select * from ' . tablename('mihua_mall_store') . ' where id=:id and uniacid=:uniacid  limit 1', array(":id" => $g['verifystoreid'], ":uniacid" => $_W['uniacid'])); goto nZAD8; Gd86x: $g['verifyopen'] = $verifyopen; goto gjSPu; pTn_c: $g['groupprice'] = $option['groupprice']; goto b5YHS; VUi5L: $option = pdo_fetch('select title,marketprice,weight,stock,groupprice from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $g['optionid'])); goto MRUXQ; Cpz21: if (!$comment) { goto tR110; } goto t2EkP; WuYk7: $g['marketprice'] = $option['marketprice']; goto pTn_c; gjSPu: $goods[] = $g; goto l9Lfe; s_Rrz: $comment = pdo_fetch('select * from ' . tablename('mihua_mall_comment') . ' where ordersn=:ordersn and goods_id=:goods_id and  uid=:uid ', array(":ordersn" => $item['ordersn'], ":goods_id" => $g['id'], ":uid" => $_W['member']['uid'])); goto Cpz21; MRUXQ: if (!$option) { goto VrdZO; } goto s2LXJ; t2EkP: $have_content[$g['id']] = $comment['comment_content']; goto c6j_1; nZAD8: $g['verifystore'] = $verifystore; goto jQkTC; l9Lfe: VB2_a: goto Z4G2T; s2LXJ: $g['optiontitle'] = '[' . $option['title'] . ']'; goto WuYk7; b5YHS: VrdZO: goto s_Rrz; jQkTC: $verifyopen = pdo_fetch('select * from ' . tablename('mihua_mall_saler') . ' where openid=:openid and uniacid=:uniacid  limit 1', array(":openid" => $g['verifyopenid'], ":uniacid" => $_W['uniacid'])); goto Gd86x; c6j_1: tR110: goto j1hv3; Z4G2T: } goto zZoZK; IwiGz: $this->changeWechatSend($orderid, 1); goto NE5mH; ZrJCX: vfgJT: goto mIbBm; oVzlj: $this->setOrderStock($orderid); goto zcpYW; gbar_: $this->toflag(); goto C0O8I; NDt8S: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('myorder', array("orderid" => $orderid, "op" => "detail")); goto bjMnO; A6gbB: exit; goto Cpcd5; NA0J6: message('取消发货操作成功！', referer(), 'success'); goto NpqCL; ryc3r: pdo_update('mihua_mall_order', array("status" => "-1"), array("id" => $item['id'], "uniacid" => $_W['uniacid'])); goto dgW8a; ACC7F: pIk2c: goto j_tpk; P6zPE: $dispatch = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . ' WHERE id = :id', array(":id" => $item['dispatch'])); goto yc5my; XMcuE: Ix7wT: goto VsVnL; Lflfr: $this->changeWechatSend($orderid, 0, $_GPC['reson']); goto mRwSX; ml3pD: load()->model('mc'); goto TABLu; M9HKw: if (empty($item['transid'])) { goto ICsrY; } goto Lflfr; A5VNf: die(json_encode(array("result" => 1, "str" => "已完成订单,红包发送失败"))); goto Qm0VZ; knG7R: $this->setOrderStock($orderid, false); goto i8vd9; KAVLQ: pdo_update('mihua_mall_order', array("status" => 0, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto Brkf4; rK7F2: $settings = $this->module['config']; goto MbY39; wYRNG: A5SFN: goto LfqJI; v3Avq: $this->setbackmoney($orderid); goto Eqa8D; tZ3eW: $remark = '------------------------------\\n' . '商品信息：' . $goodstitle . '\\n' . '订单编号：' . $item['ordersn'] . '\\n' . '出库时间：' . $timestr; goto OP22H; NhmpZ: $this->changeWechatSend($orderid, 0, $_GPC['cancelreson']); goto tbP8k; yR6f0: global $_GPC, $_W; goto gbar_; ZJTZF: $this->setOrderCredit($orderid); goto v3Avq; dgW8a: message('订单取消操作成功！', referer(), 'success'); goto tRMhu; vpIjz: exit; goto nCVOA; QGsCH: die(json_encode(array("result" => 1, "str" => "确认收货完成,红包发送失败"))); goto vEYC2; M0c3J: if (!($tmp == 1)) { goto YQBY9; } goto QGsCH; tKa_K: exit; goto uxDCA; NK24N: if (!($item['deductible'] > 0)) { goto Ix7wT; } goto Lu8he; L1Yf_: $tmp = $this->setOrderRed($orderid); goto cHmhn; B1_ze: message('请输入快递单号！'); goto wcAl2; Aey5d: $goods = array(); goto jW46V; uZSco: if ($openid == $noticeid) { goto A5SFN; } goto eY_xJ; zZoZK: wIoCC: goto io48N; dlDK2: f1Rzl: goto P6zPE; hVEiV: goto pIk2c; goto wYRNG; vDzxM: if (empty($item['transid'])) { goto vS0Pn; } goto IwiGz; eY_xJ: message('您不是管理员', $this->createMobileUrl('list'), 'success'); goto hVEiV; Ktm6Z: message('抱歉，您的订单不存或是已经被取消！', $this->createMobileUrl('myorder'), 'error'); goto rpWlt; rWz91: $admin_remark = $_GPC['admin_remark']; goto Cj5Nx; kgUFS: if (!empty($openid)) { goto wLIKR; } goto vLRQj; KxKMp: pdo_update('mihua_mall_order', array("status" => 1, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto NA0J6; gJ_O2: if ($op == 'admin_remark') { goto R0QK2; } goto xAA4T; uFXM2: pdo_update('mihua_mall_order', array("admin_remark" => $admin_remark), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto k3ZV_; dKB71: TizOx: goto mY0uU; ow2oC: e_6f2: goto ryc3r; NpqCL: jjLZQ: goto GtwKi; bjMnO: $timestr = date('Y-m-d H:i', TIMESTAMP); goto Re2iS; tJ14o: hmuKN: goto T5cMD; UX7sz: $express = pdo_fetch('select * from ' . tablename('mihua_mall_express') . ' WHERE id=:id limit 1', array(":id" => $dispatch['express'])); goto kEUAB; O3dO4: $sendMsgTemplateid = $settings['sendMsgTemplateid']; goto zx2wu; ZEfmZ: $deductible = $settings['deductible']; goto ttSsX; SzVHl: if ($op == 'finish') { goto SEoPd; } goto Vmjoc; OlmWe: die(json_encode(array("result" => 1, "str" => "订单备注失败"))); goto A6gbB; HxJrr: $this->setbackmoney($orderid); goto L1Yf_; U1Yri: wLIKR: goto rK7F2; jCCwu: if (!checksubmit('close')) { goto hmuKN; } goto yqY1B; Re2iS: $goodstitle = ''; goto VS6nw; f5FBt: $address = pdo_fetch('SELECT realname,province,city,area,address,mobile FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id', array(":id" => $item['addressid'])); goto l62Cy; vEYC2: exit; goto iCtCe; nCVOA: goto Q2s6r; goto JfhSI; HTEXg: aaKl9: goto rcufO; OBeOF: if (!checksubmit('open')) { goto f1Rzl; } goto KAVLQ; mIbBm: if (!checksubmit('cancelsend')) { goto jjLZQ; } goto j9ota; Lu8he: if ($item['ded_money'] > 0) { goto TizOx; } goto ZEfmZ; ZI_zl: pdo_update('mihua_mall_order', array("status" => 0, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto knG7R; zx2wu: $orderid = intval($_GPC['orderid']); goto fnMo4; TGCFg: goto BC2Vd; goto dKB71; lWNjx: goto Rslwt; goto zFub1; Eqa8D: $tmp = $this->setOrderRed($orderid); goto M0c3J; PQxxD: if ($item['sendtype'] == '0' && !empty($sendMsgTemplateid)) { goto dPX8H; } goto ELdY_; rpWlt: pFIEh: goto XaG2B; pTHiS: message('发货操作成功！', referer(), 'success'); goto ZrJCX; kgyy0: pdo_update('mihua_mall_order', array("status" => 2, "remark" => $_GPC['remark'], "express" => $_GPC['express'], "expresscom" => $_GPC['expresscom'], "expresssn" => $_GPC['expresssn']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto NDt8S; uIVRM: die(json_encode(array("result" => 0, "str" => "操作成功"))); goto RMtbr; NzyDh: BC2Vd: goto XMcuE; Qyp5W: Rslwt: goto pTHiS; Qm0VZ: exit; goto nHM65; mRwSX: ICsrY: goto JXqbd; i8vd9: message('取消订单付款操作成功！', referer(), 'success'); goto hF1oU; uxDCA: L8DdX: goto fLWkt; tDnGl: SEoPd: goto ZD5jA; LfqJI: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE id='{$orderid}'"); goto SzVHl; Ur2IS: R0QK2: goto rWz91; DTzMI: $this->sendtmpmsg_deliver($item['from_user'], $sendMsgTemplateid, $url, '亲，您购买的宝贝已经启程', $_GPC['expresscom'], $_GPC['expresssn'], $remark); goto Qyp5W; hF1oU: uKopw: goto jCCwu; ohq8L: $this->setOrderStock($orderid); goto ZJTZF; rUYpX: include $this->template($template); goto uwg4O; OP22H: $this->sendtmpmsg_deliver($item['from_user'], $sendMsgTemplateid, $url, '亲，您购买的宝贝已出库', $dispatch['dispatchname'], $dispatch['dispatchname'], $remark); goto XSmfl; iCtCe: YQBY9: goto VqnzU; sfLHw: die(json_encode(array("result" => 0, "str" => "操作成功"))); goto vpIjz; lobas: $this->setCommission($orderid); goto sfLHw; rcufO: $count_ded = $item['deductible'] * $deductible; goto TGCFg; UgQcO: RkNR0: goto uFXM2; nHM65: j2k30: goto lobas; ttSsX: if (!empty($deductible)) { goto aaKl9; } goto Bulmz; GtwKi: if (!checksubmit('cancelpay')) { goto uKopw; } goto ZI_zl; zFub1: dPX8H: goto EXcpQ; Vmjoc: if ($op == 'confrimpay') { goto r1Fx5; } goto gJ_O2; gTTk8: if (!($item['status'] == 1)) { goto e_6f2; } goto ml3pD; C0O8I: $openid = $_W['openid']; goto kgUFS; fLWkt: Q2s6r: goto NK24N; yqY1B: $item = pdo_fetch('SELECT transid FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id', array(":id" => $orderid, "uniacid" => $_W['uniacid'])); goto M9HKw; j_tpk: $template = $this->selectTemplate('orderdesc'); goto rUYpX; zuuPX: pdo_update('mihua_mall_order', array("status" => 3, "paytype" => 3, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto ohq8L; BH1al: if (!(!empty($_GPC['isexpress']) && empty($_GPC['expresssn']))) { goto BQSKs; } goto B1_ze; yc5my: if (!(!empty($dispatch) && !empty($dispatch['express']))) { goto p8HmJ; } goto UX7sz; JXqbd: pdo_update('mihua_mall_order', array("status" => -1, "remark" => $_GPC['remark']), array("id" => $orderid, "uniacid" => $_W['uniacid'])); goto HvIXq; VqnzU: $this->setCommission($orderid); goto uIVRM; JfhSI: r1Fx5: goto zuuPX; mY0uU: $count_ded = $item['ded_money']; goto NzyDh; l3WMJ: $dispatch = pdo_fetch('select * from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $item['dispatch'])); goto f5FBt; VsVnL: $red_packet = pdo_fetchcolumn('select money from ' . tablename('mihua_mall_red') . ' where orderid=:id limit 1', array(":id" => $item['id'])); goto StBS3; T2vY6: xU74k: goto PQxxD; EXcpQ: $remark = '------------------------------\\n' . '商品信息：' . $goodstitle . '\\n' . '订单编号：' . $item['ordersn'] . '\\n' . '发货时间：' . $timestr; goto DTzMI; gO2w1: goto Q2s6r; goto Ur2IS; onLZc: if (!empty($item)) { goto pFIEh; } goto Ktm6Z; tRMhu: Jz28w: goto OBeOF; zcpYW: $this->setOrderCredit($orderid); goto HxJrr; XaG2B: $goodsid = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . " WHERE orderid = '{$orderid}'", array(), 'goodsid'); goto wlU4_; j9ota: if (empty($item['transid'])) { goto g6IRe; } goto NhmpZ; wcAl2: BQSKs: goto vDzxM; fnMo4: $op = $_GPC['op']; goto uZSco; wlU4_: $data = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit, g.groupprice,g.marketprice,o.total,o.optionid ,o.qr_code,o.verifytime,o.verifyopenid,o.verified FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$orderid}'"); goto Aey5d; T5cMD: if (!checksubmit('cancelorder')) { goto Jz28w; } goto gTTk8; xAA4T: goto Q2s6r; goto tDnGl; kEUAB: p8HmJ: goto ACC7F; uwg4O: } public function doWebNotice() { goto d2tAr; CsyD8: sbJYI: goto K89fh; KJi_S: if (empty($keyword)) { goto EW_Ik; } goto e7dwf; uQhSs: $addresses = pdo_fetchall($sql, array(), 'id'); goto olbJT; hh7HH: $paras[':status'] = $status; goto ehoim; Wc7j0: U45Th: goto hvnZ9; olbJT: qXgoe: goto MUG7z; tqQqO: $endtime = empty($_GPC['endtime']) ? TIMESTAMP : strtotime($_GPC['endtime']) + 86399; goto Zi93k; LUFkB: $sql = 'SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE uniacid='{$_W['uniacid']}' AND transid IN ( '" . implode('\',\'', $transids) . '\' )'; goto nmM4v; HUp_S: Dh2z9: goto vSq_I; nmM4v: $orders = pdo_fetchall($sql, array(), 'transid'); goto Lu7Zt; eDRBE: $addresses = array(); goto xtNvh; CnAMz: $where .= ' AND `type`=:type'; goto e0QnA; vSq_I: if (empty($transids)) { goto VUcYw; } goto LUFkB; seKRV: $operation = in_array($operation, array("display")) ? $operation : 'display'; goto NSfqe; A_iwk: foreach ($list as $row) { $transids[] = $row['transid']; HLOfu: } goto HUp_S; WbVZ4: $type = intval($type); goto F7Le3; K89fh: include $this->template('notice'); goto yaS_o; W_TWI: $status = intval($status); goto p921q; yuXsZ: $keyword = $_GPC['keyword']; goto KJi_S; L3MRv: $psize = 50; goto WUQZK; E5InP: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_feedback') . $where . ' ORDER BY id DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, $paras); goto z9Mei; WfFdY: $operation = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto seKRV; Peko0: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_feedback') . $where, $paras); goto E5InP; NSfqe: $pindex = max(1, intval($_GPC['page'])); goto L3MRv; n7t1Z: foreach ($orders as $transid => $order) { $addressids[] = $order['addressid']; xZdJb: } goto SiXgE; z9Mei: $pager = pagination($total, $pindex, $psize); goto uWRZG; MUG7z: foreach ($list as &$feedback) { goto FrINH; oTU5K: $feedback['order'] = $order; goto sEBfZ; lSVjB: LUWcV: goto kw1lO; alxt1: $order = $orders[$transid]; goto oTU5K; FrINH: $transid = $feedback['transid']; goto alxt1; c1n_Z: $feedback['address'] = $addresses[$addressid]; goto lSVjB; sEBfZ: $addressid = $order['addressid']; goto c1n_Z; kw1lO: } goto CsyD8; d2tAr: global $_GPC, $_W; goto FS4IW; F7Le3: if (!($type != 0)) { goto U45Th; } goto CnAMz; SiXgE: ayvNz: goto eDRBE; Zi93k: $where .= ' WHERE `uniacid` = :uniacid AND `createtime` >= :starttime AND `createtime` < :endtime'; goto YvLLD; WUQZK: $starttime = empty($_GPC['starttime']) ? strtotime('-1 month') : strtotime($_GPC['starttime']); goto tqQqO; YSJzs: EW_Ik: goto SDjKR; xtNvh: if (empty($addressids)) { goto qXgoe; } goto gC9ad; gC9ad: $sql = 'SELECT * FROM ' . tablename('mihua_mall_address') . " WHERE uniacid='{$_W['uniacid']}' AND id IN ( '" . implode('\',\'', $addressids) . '\' )'; goto uQhSs; e0QnA: $paras[':type'] = $type; goto Wc7j0; hvnZ9: $status = empty($_GPC['status']) ? 0 : intval($_GPC['status']); goto W_TWI; ehoim: Sz17A: goto Peko0; p921q: if (!($status != -1)) { goto Sz17A; } goto uLCtM; SDjKR: $type = empty($_GPC['type']) ? 0 : $_GPC['type']; goto WbVZ4; uLCtM: $where .= ' AND `status` = :status'; goto hh7HH; O5Nxs: $paras[':feedbackid'] = $keyword; goto YSJzs; uWRZG: $transids = array(); goto A_iwk; YvLLD: $paras = array(":uniacid" => $_W['uniacid'], ":starttime" => $starttime, ":endtime" => $endtime); goto yuXsZ; e7dwf: $where .= ' AND `feedbackid`=:feedbackid'; goto O5Nxs; Lu7Zt: VUcYw: goto GKclb; GKclb: $addressids = array(); goto n7t1Z; FS4IW: $this->__web2(); goto WfFdY; yaS_o: } public function doMobileGoods_list() { goto SLJoE; KcX4o: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 AND status = '1'  ORDER BY {$sortfield}  "); goto NmYAV; QRmey: AMAfb: goto Vsd7K; uDt10: if ($sort == 2) { goto k9jZC; } goto VGiMl; kqEm3: $sortb33 = 'asc'; goto QRmey; VGiMl: if (!($sort == 3)) { goto Kigkw; } goto Xy0ZT; xO7tM: ep4hQ: goto oX40w; SLJoE: global $_GPC, $_W; goto fA8AE; Vsd7K: goto ep4hQ; goto QYOT4; Ecqi2: $sortb33 = 'asc'; goto ZGHAB; ZdUPa: $sortb22 = 'desc'; goto gNEsg; Xy0ZT: $sortb33 = $sortb3 == 'asc' ? 'desc' : 'asc'; goto daWHO; wIf0H: $sortb3 = empty($_GPC['sortb3']) ? 'asc' : $_GPC['sortb3']; goto RmKMw; pYkdR: $sortb11 = 'desc'; goto ZUnrW; ZUnrW: $sortb22 = 'desc'; goto Ecqi2; NmYAV: include $this->template('goods_list'); goto WAF1q; fA8AE: $sortfield = 'displayorder asc'; goto xh2mn; I422d: $sortb2 = empty($_GPC['sortb2']) ? 'desc' : $_GPC['sortb2']; goto wIf0H; OH4TY: goto AMAfb; goto jH5Lg; xh2mn: $sort = empty($_GPC['sort']) ? 0 : $_GPC['sort']; goto agn0b; ZNDFq: $sortb22 = $sortb2 == 'desc' ? 'asc' : 'desc'; goto KGMYi; agn0b: $sortb0 = empty($_GPC['sortb0']) ? 'desc' : $_GPC['sortb0']; goto eYpgD; xSXOo: if ($sort == 1) { goto hf1Sq; } goto uDt10; QYOT4: hf1Sq: goto Fk3jn; oX40w: goto Vx0ZM; goto HSAY9; J664k: $sortb11 = 'desc'; goto kqEm3; Q8UBK: $sortb00 = $sortb0 == 'desc' ? 'asc' : 'desc'; goto Q_32D; Fk3jn: $sortb11 = $sortb1 == 'desc' ? 'asc' : 'desc'; goto ZKyeL; FRZkF: $sortb00 = 'desc'; goto U4bCb; Q_32D: $sortfield = 'createtime ' . $sortb0; goto pYkdR; ZGHAB: Vx0ZM: goto KcX4o; Rgr1z: $sortb22 = 'desc'; goto UYev5; eYpgD: $sortb1 = empty($_GPC['sortb1']) ? 'desc' : $_GPC['sortb1']; goto I422d; ZKyeL: $sortfield = 'sales ' . $sortb1; goto KPzvT; pXk1M: $sortb00 = 'desc'; goto J664k; U4bCb: $sortb11 = 'desc'; goto Rgr1z; RmKMw: if ($sort == 0) { goto b_tRV; } goto xSXOo; gNEsg: $sortb33 = 'asc'; goto xO7tM; UYev5: Kigkw: goto OH4TY; daWHO: $sortfield = 'marketprice ' . $sortb3; goto FRZkF; HSAY9: b_tRV: goto Q8UBK; jH5Lg: k9jZC: goto ZNDFq; KGMYi: $sortfield = 'viewcount ' . $sortb2; goto pXk1M; KPzvT: $sortb00 = 'desc'; goto ZdUPa; WAF1q: } public function doMobileZan() { goto XW0SU; WI41B: $result = pdo_fetch('select * from ' . tablename('mihua_mall_zan') . ' where goods_id=:gid and uid=:uid ', array(":gid" => $gid, ":uid" => $_W['member']['uid'])); goto AmXmR; Xh3pa: $gid = intval($_GPC['gid']); goto XcE3I; W_E9y: RwoCe: goto valL1; WUOxR: $in['uid'] = $_W['member']['uid']; goto zMigC; DQ07D: $in['goods_id'] = $gid; goto WUOxR; KelXO: $zan_num = $zans['zans'] + 1; goto LFKNc; zMigC: $in['addtime'] = TIMESTAMP; goto w3zZr; LFKNc: pdo_update('mihua_mall_goods', array("zans" => $zan_num), array("id" => $gid)); goto c9qzJ; j0LUY: $zans = pdo_fetch('select * from ' . tablename('mihua_mall_goods') . " where id={$gid} "); goto hQdc6; hQdc6: if (!$zans) { goto uj5HL; } goto KelXO; w3zZr: pdo_insert('mihua_mall_zan', $in); goto j0LUY; XcE3I: if (!($gid && $_W['member']['uid'])) { goto fd_KO; } goto WI41B; M4ueD: uj5HL: goto W_E9y; AmXmR: if ($result) { goto RwoCe; } goto DQ07D; valL1: fd_KO: goto RW_Hz; XW0SU: global $_W, $_GPC; goto Xh3pa; c9qzJ: echo json_encode(array("status" => "success", "num" => $zan_num)); goto M4ueD; RW_Hz: } public function doMobileQiandao() { goto yv6iB; o36mU: $cfg = $this->module['config']; goto CBTDD; hZwgT: $this->sendtmpmsg_credit($from_user, $creditTemplateid, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $keyword4, $remark); goto SyfDY; iTC7m: $keyword3 = '每日签到'; goto OEy3o; xBTsV: if (!($qiandao_random == 1)) { goto k1TBc; } goto uwyqE; kKhHw: $openid = pdo_fetchcolumn('select openid from ' . tablename('mc_mapping_fans') . ' where uid=:uid ', array(":uid" => $uid)); goto u3IaU; U9fAh: $in['uid'] = $uid; goto lB6Ze; BrEde: pdo_insert('mihua_mall_qiandao', $in); goto o36mU; BlgtW: pdo_insert('core_paylog', $paylog); goto clPWZ; clPWZ: $fans = mc_credit_fetch($uid); goto vKz3k; deP5k: k1TBc: goto kKhHw; VufzY: $cfg = $this->module['config']; goto AePlN; Wyxk2: $keyword2 = $jifen . '积分'; goto iTC7m; tWjjn: $timestr = date('Y-m-d', TIMESTAMP); goto Q8Vph; psOE9: message('恭喜您,签到成功,获得' . $jifen . '积分', $this->createMobileUrl('list'), 'success'); goto KF1jC; QxuzW: ChmSP: goto U9fAh; vKz3k: if (empty($creditTemplateid)) { goto tsXL9; } goto Sqalx; yv6iB: global $_W, $_GPC; goto tp2iq; OvvVQ: $timestr = date('Y-m-d H:i', TIMESTAMP); goto oNBlt; CBTDD: $jifen = $cfg['qiandao_jifen']; goto v48qc; u3IaU: $paylog = array("type" => "credit1", "uniacid" => $_W['uniacid'], "openid" => $openid, "tid" => date('Y-m-d H:i:s'), "fee" => $jifen, "module" => "mihua_mall", "tag" => ' 签到' . $jifen . '积分'); goto aSeNi; ouwgf: $from_user = $this->getFromUser(); goto sciU_; uwyqE: $jifen = mt_rand(1, $jifen); goto deP5k; Sqalx: $user = mc_fetch($uid); goto OvvVQ; jw3Wb: message('您今日已经签到过了！', $this->createMobileUrl('list'), 'error'); goto E55XG; sciU_: $uid = mc_openid2uid($from_user); goto VufzY; oNBlt: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('fansindex'); goto PYdDC; aSeNi: pdo_query('update ' . tablename('mc_members') . ' SET credit1=credit1+\'' . $jifen . "' WHERE uid={$uid} "); goto BlgtW; TZDk2: tf47p: goto Et84P; KF1jC: i1Hka: goto TZDk2; tp2iq: load()->model('mc'); goto ouwgf; lB6Ze: $in['timestr'] = $timestr; goto BrEde; SyfDY: tsXL9: goto psOE9; low_G: $keyword1 = $timestr; goto Wyxk2; E55XG: goto i1Hka; goto QxuzW; tN6Nk: if (!$result) { goto ChmSP; } goto jw3Wb; lT6Ff: if (!$uid) { goto tf47p; } goto tWjjn; fSYHh: $remark = '感谢您的支持'; goto hZwgT; Q8Vph: $result = pdo_fetch('select * from ' . tablename('mihua_mall_qiandao') . ' where timestr=:timestr and uid=:uid', array(":timestr" => $timestr, ":uid" => $uid)); goto tN6Nk; AePlN: $creditTemplateid = $cfg['creditTemplateid']; goto lT6Ff; v48qc: $qiandao_random = $cfg['qiandao_random']; goto xBTsV; PYdDC: $goodstitle = '亲爱的：' . $user['nickname'] . ',您的积分账户有新的变动'; goto low_G; OEy3o: $keyword4 = $fans['credit1'] . '积分'; goto fSYHh; Et84P: message('签到失败！', $this->createMobileUrl('list'), 'error'); goto HARPO; HARPO: } public function getCartTotal() { goto XlTXi; XlTXi: global $_W; goto oteVT; stJiy: return empty($cartotal) ? 0 : $cartotal; goto AtCpx; oteVT: $from_user = $this->getFromUser(); goto BxBIw; BxBIw: $cartotal = pdo_fetchcolumn('select sum(total) from ' . tablename('mihua_mall_cart') . " where uniacid = '{$_W['uniacid']}' and from_user='" . $from_user . '\''); goto stJiy; AtCpx: } public function getFeedbackType($type) { $types = array(1 => "维权", 2 => "告警"); return $types[intval($type)]; } public function getFeedbackStatus($status) { $statuses = array("未解决", "用户同意", "用户拒绝"); return $statuses[intval($status)]; } public function doWebPhbmedal() { goto X0zkk; iG_ku: if (!empty($id)) { goto gIW8l; } goto q596Y; TtIgx: if ($operation == 'delete') { goto NfgbI; } goto rdo4G; YkrX3: $id = intval($_GPC['id']); goto WAyp_; VaBvT: tkfKY: goto rACK3; rdo4G: goto i5nhN; goto VaBvT; TS08u: SrHje: goto YkrX3; f18eg: $category = pdo_fetch('SELECT id FROM ' . tablename('mihua_mall_phb_medal') . " WHERE id = '{$id}'"); goto nadng; xzUCJ: pdo_update('mihua_mall_phb_medal', $data, array("id" => $id, "uniacid" => $_W['uniacid'])); goto dGGtg; vHtTG: IngHw: goto MoSh7; r23Re: if ($operation == 'post') { goto SrHje; } goto TtIgx; GXbMv: if (!empty($_GPC['medal_name'])) { goto jofgb; } goto VIIQA; jcTQ9: pdo_delete('mihua_mall_phb_medal', array("id" => $id, "uniacid" => $_W['uniacid'])); goto qSIgJ; LdjX4: include $this->template('phbmedal'); goto zyIpP; WAyp_: $phbmedal = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_phb_medal') . " WHERE id = '{$id}'"); goto NPCEB; d49f7: NfgbI: goto KtIWG; ILci7: goto XkAt9; goto fFZUu; yD7hk: $this->adminMessage('更新头衔成功！', $this->createWebUrl('phbmedal', array("op" => "display")), 'success'); goto vHtTG; rACK3: $children = array(); goto fRG3l; zyIpP: goto i5nhN; goto TS08u; vZnW5: i5nhN: goto s1zRr; FNf5n: goto i5nhN; goto d49f7; drLz0: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto sArsx; dGGtg: XkAt9: goto yD7hk; qVYeX: $this->__web2(); goto Xu5_0; QuLZ1: ZCNYr: goto jcTQ9; NPCEB: if (!checksubmit('submit')) { goto IngHw; } goto GXbMv; MoSh7: include $this->template('phbmedal'); goto FNf5n; VIIQA: $this->adminMessage('抱歉，请输入分类名称！'); goto JG5T7; JG5T7: jofgb: goto xBmBh; xBmBh: $data = array("uniacid" => $_W['uniacid'], "medal_name" => $_GPC['medal_name'], "fans_count" => intval($_GPC['fans_count'])); goto iG_ku; q596Y: pdo_insert('mihua_mall_phb_medal', $data); goto TCqgb; fFZUu: gIW8l: goto xzUCJ; KtIWG: $id = intval($_GPC['id']); goto f18eg; qSIgJ: $this->adminMessage('头衔删除成功！', $this->createWebUrl('phbmedal', array("op" => "display")), 'success'); goto vZnW5; GmQaq: if ($operation == 'display') { goto tkfKY; } goto r23Re; jPJaa: $this->adminMessage('抱歉，头衔不存在或是已经被删除！', $this->createWebUrl('phbmedal', array("op" => "display")), 'error'); goto QuLZ1; nadng: if (!empty($category)) { goto ZCNYr; } goto jPJaa; sArsx: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto GmQaq; X0zkk: global $_W, $_GPC; goto qVYeX; fRG3l: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_phb_medal') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY fans_count desc"); goto LdjX4; TCqgb: $id = pdo_insertid(); goto ILci7; Xu5_0: $uniacid = $_W['uniacid']; goto drLz0; s1zRr: } public function doWebfansmanager() { goto QYldK; jwwdQ: BisF8: goto F8Tak; WwrYl: if (!($op == 'list')) { goto hOkjp; } goto rmgg7; r58Yz: $sort = array("realname" => $_GPC['realname'], "mobile" => $_GPC['mobile']); goto yJ7XD; OHHqX: $from_user = $_GPC['from_user']; goto nCmFa; Ix5aX: $pager = pagination($total, $pindex, $psize); goto Z4X2l; ME69R: $commission = empty($commission) ? 0 : $commission; goto Qyivq; oUbbo: $list = pdo_fetchall('select o.*,user.realname from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where}   ORDER BY  o.createtime DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto Ks3ES; KsVQZ: $from_user = $_GPC['from_user']; goto BIg2u; K9nXb: if (!($op == 'delete')) { goto WG08w; } goto qClKw; eFUYt: hOkjp: goto qQBp8; fVrb3: bwtNm: goto aiqPR; SuREA: foreach ($mylist1 as $key => $value) { goto OvXZQ; jI4jD: OUg3s: goto pwJmI; OvXZQ: if (!$value['uid']) { goto Su26W; } goto f1ftl; CuKhY: $mylist1[$key]['avatar'] = $value['avatar']; goto iiN7x; f1ftl: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto CuKhY; iiN7x: $mylist1[$key]['createtime'] = $value['createtime']; goto ybHOz; ybHOz: Su26W: goto jI4jD; pwJmI: } goto fOW0p; p3k9w: $commissions = pdo_fetchall('select mid, sum(commission) as commission from ' . tablename('mihua_mall_commission') . ' where uniacid = ' . $_W['uniacid'] . ' and flag = 0  group by mid'); goto o7qJp; pPV90: exit; goto HOin2; VH6Rx: $status['flag'] = $_GPC['flag']; goto ApfDK; RxmEz: LwVGS: goto HSVmB; vOVmA: foreach ($commissions as $c) { $commission[$c['mid']] = $c['commission']; jzwQ1: } goto qmiG4; Opc36: $temp = pdo_insert('mihua_mall_commission', $recharged); goto vrrN7; FA4FN: $uniacid = $_W['uniacid']; goto ZYb3L; w0dF4: $where .= " or o.shareid2={$user_info['id']}  or o.shareid3={$user_info['id']} )"; goto eyC8c; Rw6fm: $condition3 = ''; goto tkp64; d1O0V: if (is_numeric($_GPC['commission'])) { goto GquPv; } goto yjwr8; PlW0G: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto urVuj; Z4X2l: include $this->template('fansmanager_list'); goto drkwj; Ip_C2: $rowindex = 0; goto B1uuv; o43ie: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto sLSAT; INMgt: urTGX: goto Ix5aX; VJKUN: $this->autoRegedit($modulephp); goto hkYM_; hJpPU: foreach ($mylist as $key => $value) { goto wv631; wv631: if (!$value['uid']) { goto uf9N2; } goto hSOog; qW0nF: HNW8c: goto VDq21; hSOog: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto ErfYN; yJ_Yx: $mylist[$key]['createtime'] = $value['createtime']; goto fCR1F; ErfYN: $mylist[$key]['avatar'] = $value['avatar']; goto yJ_Yx; fCR1F: uf9N2: goto qW0nF; VDq21: } goto otUV5; Wr2xl: $id = $_GPC['id']; goto iSSYt; gNvJC: $condition = ' left join ' . tablename('mihua_mall_order') . ' o on sale.from_user=o.from_user'; goto GK74P; bmwnu: $this->__web2(); goto FA4FN; G4sMI: $pindex = max(1, intval($_GPC['page'])); goto pIduo; rLJI3: if (!($op == 'display')) { goto MzAJA; } goto G4sMI; em4LD: $pindex = max(1, intval($_GPC['page'])); goto Xd92b; Mt52B: F8ELF: goto tQLah; CRFbm: foreach ($level3 as &$citem) { $str3 = $str3 . $citem['id'] . ','; CVbuw: } goto RxmEz; fp242: $condition3 = ' group by o.from_user HAVING sum(o.price)>=' . $commtime['promotermoney']; goto y7Z2c; ci4Qw: Q_c4M: goto igVqX; ixotR: if (empty($temp)) { goto Aej6t; } goto xrjIy; KdMU1: $this->adminMessage('设置用户权限成功！', $this->createWebUrl('fansmanager'), 'success'); goto Sl50x; RKPN8: pdo_update('mihua_mall_member', array("commission" => $commission + $_GPC['commission']), array("id" => $id)); goto FnslV; rmgg7: $this->toflag(); goto KsVQZ; h4Qsy: $count2 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto SIfbP; e93hX: foreach ($commissions as $c) { $commission[$c['mid']] = $c['commission']; h15WZ: } goto LmFoF; kCjvx: if (!empty($profile['id'])) { goto i3YtQ; } goto VJKUN; CE3Ik: $todaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime>={$today_begin_time_str} "); goto hvfIy; flXKq: $recharged = array("uniacid" => $_W['uniacid'], "mid" => $id, "flag" => 1, "content" => trim($_GPC['content']), "commission" => $_GPC['commission'], "createtime" => time()); goto Opc36; wv7iy: WG08w: goto rLJI3; zi4W3: $list = pdo_fetchall('select sale.*,mc_members.credit1,mc_members.avatar,mc_members.mobile  from ' . tablename('mihua_mall_member') . ' sale left join ' . tablename('mc_members') . ' mc_members on sale.uid=mc_members.uid where sale.flag = 0 and sale.uniacid = ' . $_W['uniacid'] . ' ORDER BY sale.id DESC limit ' . ($pindex - 1) * $psize . ',' . $psize); goto dLUlP; VGDVg: iiTWE: goto VybAi; OF2hr: if (!($op == 'user')) { goto tVKnf; } goto OHHqX; FAnma: fSVSE: goto td7UD; kxVsC: $opp = $_GPC['opp']; goto r58Yz; Ks3ES: $total = pdo_fetchcolumn('select  count(*)  from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where} "); goto Xg951; nYdDu: if (!($cfg['globalCommissionLevel'] < 2)) { goto uaLO_; } goto AeP4a; drkwj: exit; goto eFUYt; cNZlI: oFwd7: goto WwrYl; PIrOO: include $this->template('fansmanagered'); goto KGmiD; tkp64: $commtime = pdo_fetch('select promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto sJbtm; JEs15: Aej6t: goto ueNm1; yjwr8: $this->adminMessage('佣金请输入合法数字！', '', 'error'); goto F_yxC; ZYb3L: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto X3dir; B1uuv: $str = ''; goto r4YE6; vrrN7: $commission = pdo_fetchcolumn('select commission from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto nRBcB; N3TzK: if (!$mylist) { goto hKqXj; } goto hJpPU; F_yxC: GquPv: goto flXKq; FoFgO: foreach ($mylist3 as $key => $value) { goto FRVoz; FRVoz: if (!$value['uid']) { goto BGBfl; } goto pEyWE; pEyWE: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto eC9Hw; PFKWR: BGBfl: goto X0dNL; DvpJe: $mylist3[$key]['createtime'] = $value['createtime']; goto PFKWR; X0dNL: rRR9S: goto oF2Ek; eC9Hw: $mylist3[$key]['avatar'] = $value['avatar']; goto DvpJe; oF2Ek: } goto Mt52B; uzx8M: $this->adminMessage('设置用户权限失败，请重新设置！', $this->createWebUrl('fansmanager', array("op" => "detail", "opp" => "nocheck", "id" => $_GPC['id'])), 'error'); goto Axq7Y; hkYM_: $profile = $this->getProfile(); goto PYxnK; DJ9s_: if (!($op == 'recharge')) { goto oFwd7; } goto Wr2xl; td7UD: goto pkg11; goto JEs15; coeml: CJiCD: goto xP_FE; w1gpq: if (!(true && $cfg['globalCommissionLevel'] >= 3 && $mylist2)) { goto fLlDh; } goto zJnFe; wJj2n: $allcount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} "); goto CE3Ik; l5ZFr: $sql2_member = 'select mber2.from_user from ' . tablename('mihua_mall_member') . ' mber2 where  mber2.realname<>\'\' and mber2.id!=mber2.shareid and mber2.shareid in (' . $str . ')  '; goto h4Qsy; mT5kO: nndow: goto ze5b_; xwvy2: zCE11: goto b00IU; kXNp6: $condition3 = ' group by o.from_user HAVING count(o.from_user)>=1'; goto fVrb3; HOin2: m5tBR: goto nOAmC; Sl50x: goto fSVSE; goto xwvy2; zEG_Q: if (!($commtime['promotertimes'] == 3)) { goto seHj2; } goto T8w1S; Wa0Je: $cfg = $this->module['config']; goto nYdDu; ScniI: nWNk1: goto cGuiG; d2D87: MzAJA: goto ezUUq; X3dir: $cfg = $this->module['config']; goto K9nXb; KQinV: $pager = pagination($total, $pindex, $psize); goto N6x_c; fOW0p: xaobD: goto ci4Qw; AeP4a: $where .= ')'; goto ovzpH; iSSYt: if (!($_GPC['opp'] == 'recharged')) { goto CJiCD; } goto d1O0V; xP_FE: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto E_0Ll; Rr6Ym: $temp = pdo_update('mihua_mall_member', $status, array("id" => $_GPC['id'])); goto ixotR; gxBNX: pkg11: goto UvCtj; tQLah: PVsrm: goto AYyS7; Uwe0i: aoD_j: goto coeml; J28w3: FSl7G: goto gBQuW; lj22l: $commissions = pdo_fetchall('select mid, sum(commission) as commission from ' . tablename('mihua_mall_commission') . ' where uniacid = ' . $_W['uniacid'] . ' and flag = 0 group by mid'); goto IznnT; SZblo: $this->adminMessage('充值失败，请重新充值！', $this->createWebUrl('fansmanager', array("op" => "recharge", "id" => $_GPC['id'])), 'error'); goto Uwe0i; VDRYP: mwZEE: goto jVEnk; ovzpH: uaLO_: goto Nfgar; Xg951: foreach ($list as $key => $value) { goto E7YUK; E7YUK: $result = pdo_fetchall('select detail.*,goods.title,goods.thumb from ' . tablename('mihua_mall_order_goods') . ' detail left join ' . tablename('mihua_mall_goods') . " goods on goods.id=detail.goodsid  where orderid={$value['id']}"); goto sMmta; eJoXA: $list[$key]['jibie'] = '三级'; goto QI2lv; k4XBU: if (!($value['shareid3'] == $user_info['id'])) { goto P59GH; } goto eJoXA; SfFdK: $list[$key]['allmoney'] = $allmoney; goto pECQV; yBGND: P59GH: goto xZkZZ; n7yZW: LfwHV: goto wdjCi; LPVQb: $list[$key]['jibie'] = '二级'; goto iQ6ki; QI2lv: $jibie = 2; goto yBGND; pECQV: $list[$key]['allnum'] = $allnum; goto fIuuk; fIuuk: TAX5s: goto iLQdV; sMmta: if (!($value['shareid'] == $user_info['id'])) { goto LfwHV; } goto qTfTu; iQ6ki: $jibie = 1; goto HZfpL; qTfTu: $list[$key]['jibie'] = '一级'; goto BZMmS; wdjCi: if (!($value['shareid2'] == $user_info['id'])) { goto xJUpm; } goto LPVQb; De2Mp: $list[$key]['money'] = $commission; goto SfFdK; HZfpL: xJUpm: goto k4XBU; xZkZZ: foreach ($result as $k => $v) { goto GPqMT; ReKJE: Yjo9K: goto DaXF9; KD6tj: $allmoney += $v['price']; goto e5eCo; GPqMT: $commission += $v['commission' . $jibie . '']; goto KD6tj; e5eCo: $allnum += $v['total']; goto ReKJE; DaXF9: } goto B1F7F; TB5cq: $list[$key]['detail'] = $result; goto De2Mp; B1F7F: eAumf: goto TB5cq; BZMmS: $jibie = ''; goto n7yZW; iLQdV: } goto INMgt; Xd92b: $psize = 10; goto aWENq; b00IU: $this->adminMessage('设置用户权限成功！', $this->createWebUrl('fansmanager', array("op" => "nocheck")), 'success'); goto FAnma; nRBcB: if (empty($temp)) { goto hMPu5; } goto RKPN8; eyC8c: G2eqM: goto wJj2n; jEq2w: $status = array("status" => $_GPC['status'], "content" => trim($_GPC['content'])); goto xuSv2; SZrCk: $this->adminMessage('设置用户权限失败，请重新设置！', $this->createWebUrl('fansmanager', array("op" => "detail", "id" => $_GPC['id'])), 'error'); goto nb2T3; QdhSA: $sql3_member = 'select mber3.from_user from ' . tablename('mihua_mall_member') . ' mber3 where  mber3.realname<>\'\' and mber3.id!=mber3.shareid and mber3.shareid in (' . $str3 . ')  '; goto anzeW; otUV5: vvPbb: goto v1PTr; xuSv2: if (!($_GPC['opp'] == 'nocheck' && $_GPC['flag'] == 1)) { goto ufdOh; } goto VH6Rx; zRPcq: $status = 1; goto ACAB3; ACAB3: goto nndow; goto ScniI; iwHzD: $rowindex = 0; goto y2otR; Wi7QF: P8pg_: goto CYMGd; Nfgar: if (!($cfg['globalCommissionLevel'] < 3 && $cfg['globalCommissionLevel'] > 1)) { goto w3bbe; } goto DTi6R; a3QbY: if (!(true && $cfg['globalCommissionLevel'] >= 2 && $mylist1)) { goto rCkaa; } goto YQ380; nCmFa: $from_user = $_GET['from_user']; goto HpdfZ; SIfbP: $mylist2 = pdo_fetchall('	select * ,2 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto d4mZq; d4mZq: if (!$mylist2) { goto n5_BU; } goto dncEH; GK74P: $condition2 = ' and o.status=3'; goto nFHk0; F8Tak: include $this->template('clicklog'); goto gDoAO; Ru80X: exit; goto cNZlI; ftDYn: $user_info = pdo_fetch('select * from ' . tablename('mihua_mall_member') . " where from_user='{$openid}'"); goto g2vyi; FnslV: $this->adminMessage('充值成功！', $this->createWebUrl('fansmanager', array("op" => "recharge", "id" => $_GPC['id'])), 'success'); goto BBQjt; UvCtj: bgfxL: goto DJ9s_; hvfIy: $yestdaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime<{$today_begin_time_str} and o.createtime>={$yestday_begin_time_str} "); goto oUbbo; eYo4D: $yestday_begin_time_str = strtotime(date('Y-m', TIMESTAMP) . '-' . (date('d', TIMESTAMP) - 1)); goto xI8HL; yizUf: $profile = $this->getProfile(); goto lhC82; ZnXDc: AeAV_: goto z162x; cGuiG: $status = 0; goto mT5kO; TnY3l: $id = $_GPC['id']; goto o43ie; E_0Ll: $commission = pdo_fetchcolumn('select sum(commission) from ' . tablename('mihua_mall_commission') . ' where mid = ' . $id . ' and flag = 0 and uniacid = ' . $_W['uniacid']); goto ME69R; aIRre: $total = pdo_fetchcolumn('select count(id) from' . tablename('mihua_mall_member') . 'where flag = 1 and realname<>\'\' and uniacid =' . $_W['uniacid']); goto Hcmr6; GyUQa: $mylist1 = pdo_fetchall('	select *,1 as level from ' . tablename('mc_mapping_fans') . " fans where  openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}"); goto wAIat; zJnFe: $level3 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and shareid in( ' . $str . ')'); goto iwHzD; nFHk0: $condition3 = ' group by o.from_user HAVING count(o.from_user)>=' . $commtime['promotercount']; goto ksK9P; CYMGd: yU7ck: goto OF2hr; Ta87l: $condition2 = ''; goto Rw6fm; nOAmC: if (!($op == 'sort')) { goto yU7ck; } goto kxVsC; PYxnK: i3YtQ: goto jUXdb; Z6ZKm: n5_BU: goto vWBwY; wg7W3: if (!($_GPC['opp'] == 'nocheck')) { goto P8pg_; } goto PIrOO; BIg2u: $from_user = $_GET['from_user']; goto yizUf; dLUlP: $total = pdo_fetchcolumn('select count(id) from' . tablename('mihua_mall_member') . 'where flag = 0 and realname<>\'\' and uniacid =' . $_W['uniacid']); goto KQinV; sLSAT: if ($_GPC['opp'] == 'nocheck') { goto iiTWE; } goto WowI8; Vk0cb: $myheadimg = pdo_fetchcolumn('SELECT avatar FROM ' . tablename('mc_members') . 'mc_members left join ' . tablename('mc_mapping_fans') . ' fans on fans.uid=mc_members.uid WHERE  mc_members.uniacid = :uniacid
																			AND fans.openid = :from_user LIMIT 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Ik0ya; qClKw: pdo_update('mihua_mall_member', array("status" => intval($_GPC['isstatus'])), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto PzqE9; PzqE9: $op = 'display'; goto wv7iy; G0R5G: $commissions = pdo_fetchall('select * from ' . tablename('mihua_mall_commission') . ' where mid = ' . $id . ' and uniacid = ' . $_W['uniacid'] . ' and flag = 1'); goto Jyo4G; jVEnk: exit; goto ZnXDc; BBQjt: goto aoD_j; goto uh8G9; T2zVc: goto mwZEE; goto VGDVg; AUKie: if (!true) { goto pkZs0; } goto eYJGR; HpdfZ: $fans = pdo_fetch('SELECT mc_members.nickname,createtime,credit1 FROM ' . tablename('mc_members') . ' mc_members left join ' . tablename('mc_mapping_fans') . ' fans on fans.uid=mc_members.uid WHERE  mc_members.uniacid = :uniacid
																			AND fans.openid = :from_user LIMIT 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Vk0cb; q0VP_: EN18p: goto Oomqk; Oomqk: $mylist = pdo_fetchall('SELECT   nickname,b.uid  FROM ' . tablename('mihua_mall_share_history') . ' a LEFT JOIN ' . tablename('mc_mapping_fans') . ' b ON a.from_user = b.openid  and a.uniacid=b.uniacid WHERE a.sharemid = (select id from ' . tablename('mihua_mall_member') . ' c where c.from_user=:leader and c.uniacid=:uniacid  limit 1) and a.from_user!=:leader AND a.uniacid=:uniacid  ', array(":leader" => $from_user, ":uniacid" => $_W['uniacid'])); goto N3TzK; o7qJp: $commission = array(); goto e93hX; urVuj: if (!empty($profile['id'])) { goto EN18p; } goto O6vcH; ksK9P: WA7dm: goto zEG_Q; ApfDK: $status['flagtime'] = TIMESTAMP; goto D4sfO; g2vyi: $where = "   o.createtime>={$user_info['flagtime']} and o.from_user != '{$openid}'  and  (o.shareid={$user_info['id']}"; goto Wa0Je; aWENq: $today_begin_time_str = strtotime(date('Y-m-d', TIMESTAMP)); goto eYo4D; jUXdb: $signPackage = $this->getSignPackage($modulephp); goto em4LD; lhC82: load()->model('mc'); goto kCjvx; wEEtk: $count = $count1 + $count2 + $count3; goto jwwdQ; VybAi: include $this->template('fansmanagered_detail'); goto VDRYP; xrjIy: if ($_GPC['opp'] == 'nocheck') { goto zCE11; } goto KdMU1; xoZFm: $condition = ' left join ' . tablename('mihua_mall_order') . ' o on sale.from_user=o.from_user'; goto LORbX; y7Z2c: seHj2: goto wg4yu; r4YE6: foreach ($level2 as &$citem) { $str = $str . $citem['id'] . ','; tSCFu: } goto J28w3; gDoAO: exit; goto llv38; eylNB: $count = 0; goto AUKie; v1PTr: hKqXj: goto eylNB; nb2T3: goto arM5e; goto xv3t2; gBQuW: $str = trim($str, ','); goto l5ZFr; wg4yu: $list = pdo_fetchall('select sale.*,mc_members.credit1,mc_members.avatar,mc_members.mobile from ' . tablename('mihua_mall_member') . ' sale ' . ' left join ' . tablename('mc_mapping_fans') . ' m on sale.from_user = m.openid and sale.uniacid= m.uniacid ' . ' left join ' . tablename('mc_members') . ' mc_members on m.uid=mc_members.uid ' . $condition . ' where sale.flag = 1 ' . $condition2 . ' and sale.realname!=\'\' and sale.uniacid = ' . $_W['uniacid'] . $condition3 . ' ORDER BY sale.id DESC  limit ' . ($pindex - 1) * $psize . ',' . $psize); goto aIRre; x8C6l: $psize = 20; goto zi4W3; z162x: if (!($op == 'status')) { goto bgfxL; } goto jEq2w; QYldK: global $_W, $_GPC; goto bmwnu; eYJGR: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where    mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto DxLhK; W5Y0s: goto BisF8; goto q0VP_; REqDi: if (!($cfg['globalCommissionLevel'] > 2)) { goto G2eqM; } goto w0dF4; llv38: tVKnf: goto KGDEQ; xv3t2: CKFKJ: goto uzx8M; dncEH: foreach ($mylist2 as $key => $value) { goto wkuTg; PppNl: $mylist2[$key]['avatar'] = $value['avatar']; goto sPYaZ; wkuTg: if (!$value['uid']) { goto bNfmT; } goto Rz9Qf; VnBdI: kx3r9: goto ofy98; xQbOY: bNfmT: goto VnBdI; Rz9Qf: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto PppNl; sPYaZ: $mylist2[$key]['createtime'] = $value['createtime']; goto xQbOY; ofy98: } goto RmvFk; YQ380: $level2 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and  shareid = ' . $profile['id']); goto Ip_C2; kkIao: w3bbe: goto REqDi; boDYY: $condition2 = ' and o.status=3'; goto fp242; uh8G9: hMPu5: goto SZblo; ezUUq: if (!($op == 'nocheck')) { goto m5tBR; } goto l1GBu; KGmiD: exit; goto Wi7QF; WowI8: include $this->template('fansmanager_detail'); goto T2zVc; l1GBu: $pindex = max(1, intval($_GPC['page'])); goto x8C6l; xI8HL: $openid = $from_user; goto ftDYn; LmFoF: AiIzg: goto wg7W3; sJbtm: if (!($commtime['promotertimes'] == 0)) { goto bwtNm; } goto xoZFm; DxLhK: $count1 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto GyUQa; igVqX: pkZs0: goto a3QbY; N6x_c: include $this->template('fansmanagered'); goto pPV90; IznnT: $commission = array(); goto vOVmA; HSVmB: $str3 = trim($str3, ','); goto QdhSA; anzeW: $count3 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto fjuzx; AYyS7: fLlDh: goto wEEtk; Jyo4G: include $this->template('fansmanager_recharge'); goto Ru80X; RmvFk: rnfEX: goto Z6ZKm; ueNm1: if ($_GPC['opp'] == 'nocheck') { goto CKFKJ; } goto SZrCk; ze5b_: $list = pdo_fetchall('select qmxk.*,fans.*, mc_members.avatar from ' . tablename('mihua_mall_member') . ' qmxk left join ' . tablename('mc_mapping_fans') . ' fans on qmxk.from_user=fans.openid left join ' . tablename('mc_members') . ' mc_members  on qmxk.uid=mc_members.uid  and qmxk.uniacid=fans.uniacid where qmxk.flag = ' . $status . ' and qmxk.uniacid =' . $_W['uniacid'] . ' and qmxk.realname like \'%' . $sort['realname'] . '%\' and qmxk.mobile like \'%' . $sort['mobile'] . '%\' group by fans.openid ORDER BY qmxk.id DESC'); goto p3k9w; O6vcH: $count = 0; goto W5Y0s; qmiG4: oLSL0: goto d2D87; LORbX: $condition2 = ' and o.status=3'; goto kXNp6; sCH64: if (!$mylist3) { goto PVsrm; } goto FoFgO; qQBp8: include $this->template('fansmanager'); goto oD2Gv; vWBwY: rCkaa: goto w1gpq; Qyivq: $commission = $commission - $user['commission']; goto G0R5G; aiqPR: if (!($commtime['promotertimes'] == 2)) { goto WA7dm; } goto gNvJC; y2otR: $str3 = ''; goto CRFbm; Hcmr6: $pager = pagination($total, $pindex, $psize); goto lj22l; Axq7Y: arM5e: goto gxBNX; T8w1S: $condition = ' left join ' . tablename('mihua_mall_order') . ' o on sale.from_user=o.from_user'; goto boDYY; DTi6R: $where .= " or o.shareid2={$user_info['id']} )"; goto kkIao; yJ7XD: if ($_GPC['opp'] == 'nocheck') { goto nWNk1; } goto zRPcq; Ik0ya: $fans['avatar'] = $myheadimg; goto PlW0G; KGDEQ: if (!($op == 'detail')) { goto AeAV_; } goto TnY3l; zWd5Z: $condition = ''; goto Ta87l; D4sfO: ufdOh: goto Rr6Ym; pIduo: $psize = 20; goto zWd5Z; fjuzx: $mylist3 = pdo_fetchall('	select * ,3 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and ( fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto sCH64; wAIat: if (!$mylist1) { goto Q_c4M; } goto SuREA; oD2Gv: } public function domobileCheckAdmin() { goto AAmJm; H_p4a: return true; goto SpuRc; SX1xC: return false; goto BX6gg; ZjVYm: $openid = $_W['openid']; goto Txhao; iRoFp: if ($openid != $noticeid) { goto HL575; } goto H_p4a; AAmJm: global $_W, $_GPC; goto ZjVYm; Txhao: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto iRoFp; BX6gg: qf0tH: goto OCG1O; rxKHx: HL575: goto SX1xC; SpuRc: goto qf0tH; goto rxKHx; OCG1O: } public function commissionPro($template) { goto II1dG; BWzYw: exit; goto NDiKJ; C_46b: goto k8EMk; goto Susf7; eZOvJ: goto XAtAH; goto MY6ht; Qvmhx: y0cgH: goto om3MC; N8oOJ: pdo_update('mihua_mall_commissionPay', array("status" => 3, "flagtime" => time()), array("id" => $id, "from_user" => $from_user, "uniacid " => $_W['uniacid'])); goto BmbWO; iNE1n: if (!(intval($item['status']) != 1)) { goto f2DWS; } goto WPdl3; zV8zl: if ($item['applyType'] == 1) { goto sxzbi; } goto POlY2; xC6bj: goto X1vid; goto dqwP8; pApGn: f2DWS: goto LqfLV; j_myb: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('fansindex2'); goto wMAiD; WEu9l: $condition = ' and (a.status=2 or a.status=3) '; goto ecNUU; iv5_Q: $uid = mc_openid2uid($from_user); goto vhA3P; RdJM7: $yestdaycount = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_commissionPay') . ' where status=2 or status =3'); goto vceVj; RlrEZ: $pager = pagination($total, $pindex, $psize); goto rHV3l; BM7Q8: $url2 = $_W['siteroot'] . 'app/' . $this->createMobileUrl('commission'); goto zV8zl; Fy0Vy: $commissionMoney = pdo_fetchcolumn('select commission from ' . tablename('mihua_mall_member') . ' where from_user=:from_user and uniacid=:uniacid  ', array("from_user" => $from_user, "uniacid" => $_W['uniacid'])); goto Bvayy; DkwdN: $result_mc = pdo_update('mc_members', array("credit2" => $new), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto RFmfs; g4kGP: exit; goto D7Ox7; TLF4a: die(json_encode(array("result" => 0, "str" => "操作成功"))); goto RiB6M; TLa5g: if (!empty($id)) { goto KmdEk; } goto mSWGJ; T0zad: $this->adminMessage('获取用户信息失败', referer(), 'error'); goto C_46b; qXD_4: goto KOiNS; goto cokri; P3in9: pdo_update('mihua_mall_member', array("commission" => $commission), array("from_user" => $from_user, "uniacid " => $_W['uniacid'])); goto G9Qi0; CDiAG: $class_redBao->money = $applyMoney; goto guTbK; YWARb: $settings = $this->module['config']; goto pMAE7; r4HiN: if ($template == 'mb_commissionPay') { goto VZ4M4; } goto Nrsm9; vceVj: $todaycount = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_commissionPay') . ' where status=1'); goto RlrEZ; RFmfs: if (empty($result_mc)) { goto MVAgq; } goto N8oOJ; i2ZAj: goto OXcHO; goto wXUiU; om3MC: $profile = $this->getProfile($from_user); goto BM7Q8; VG__b: $item = pdo_fetch('select * from ' . tablename('mihua_mall_commissionPay') . ' where uniacid = ' . $_W['uniacid'] . ' and id =  ' . $id); goto iNE1n; LqfLV: $applyMoney = $item['applyMoney']; goto kpRw3; cbznj: die(json_encode(array("result" => 0, "str" => "红包返现操作成功"))); goto DlR3K; AfYEM: $psize = 10; goto dTyXU; U_pkR: exit; goto t52SS; eEpyz: goto SozTg; goto DrzAm; r34ra: die(json_encode(array("result" => 1, "str" => "红包发送失败"))); goto g4kGP; wXUiU: mkVqU: goto zQRTs; OF0M4: $class_redBao->openid = $from_user; goto CDiAG; zQRTs: pdo_update('mihua_mall_commissionPay', array("status" => 3, "flagtime" => time()), array("id" => $id, "from_user" => $from_user, "uniacid " => $_W['uniacid'])); goto eAqn8; MY6ht: sxzbi: goto bvp4m; aLB43: KiDsh: goto WEu9l; rHV3l: if (!($op == 'applyed')) { goto yNIa3; } goto QE1TV; kpRw3: $from_user = $item['from_user']; goto JnVUn; S6L1n: epOsg: goto RdJM7; t52SS: EC12F: goto pApGn; d4ANk: Hk_Ve: goto iv5_Q; eVvm1: pdo_update('mihua_mall_member', array("commission" => $commission), array("from_user" => $from_user, "uniacid " => $_W['uniacid'])); goto d89Zh; Q1m1p: exit; goto thrSs; cokri: E6jax: goto DdqfP; wMAiD: $this->sendCommissionMsg('微信红包', $applyMoney, $from_user, $url); goto VoSOR; DdqfP: die(json_encode(array("result" => 1, "str" => "处理失败"))); goto BWzYw; lnlb2: $this->adminMessage('处理失败', referer(), 'error'); goto qXD_4; c2nOY: gbnDR: goto TLF4a; ld30b: $this->sendCommissionMsg('存入余额\\n现有余额：' . $new . '元', $applyMoney, $from_user, $url); goto qNWQ7; zNFGt: include $this->template($template); goto bNLlA; bieVz: X1vid: goto bRePc; vhA3P: $balance = pdo_fetchcolumn('select credit2 from ' . tablename('mc_members') . " where uid={$uid}"); goto RRlj9; G9Qi0: pdo_insert('mihua_mall_red', array("openid" => $from_user, "commission_flag" => 1, "money" => $applyMoney, "addtime" => TIMESTAMP, "uniacid" => $_W['uniacid'])); goto j_myb; fC0KY: die(json_encode(array("result" => 1, "str" => "获取用户信息失败"))); goto Q1m1p; VoSOR: $this->sendsjytktz($applyMoney, $url2, $from_user); goto RsTfN; dTyXU: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_commissionPay') . ' a left join ' . tablename('mc_members') . ' f on a.uid=f.uid ' . ' WHERE a.uniacid = :uniacid ' . $condition . ' order by id desc  LIMIT  ' . ($pindex - 1) * $psize . ',' . $psize, array(":uniacid" => $_W['uniacid'])); goto CkL4t; LnYoc: goto cwHfR; goto c2nOY; JnVUn: if (!empty($from_user)) { goto y0cgH; } goto sMk0f; Bvayy: $commission = floatval($commissionMoney) + floatval($applyMoney); goto eVvm1; rqWWa: load()->model('mc'); goto YWARb; dIbn3: $commission = floatval($commissionMoney) + floatval($applyMoney); goto P3in9; pMAE7: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto fsKwG; eAqn8: $commissionMoney = pdo_fetchcolumn('select commission from ' . tablename('mihua_mall_member') . ' where from_user=:from_user and uniacid=:uniacid  ', array("from_user" => $from_user, "uniacid" => $_W['uniacid'])); goto dIbn3; bvp4m: $class_redBao = C('redBao'); goto OF0M4; Susf7: cKjd6: goto fC0KY; dqfda: $this->adminMessage($re, referer(), 'error'); goto eEpyz; WPdl3: if ($template == 'mb_commissionPay') { goto BsRpj; } goto Cqr8r; bNLlA: exit; goto spGGT; Ubhc2: BsRpj: goto UqrHy; II1dG: global $_W, $_GPC; goto rqWWa; rgkoi: $this->adminMessage('操作成功', referer(), 'success'); goto LnYoc; UqrHy: die(json_encode(array("result" => 1, "str" => "申请不存在或已处理"))); goto U_pkR; NDiKJ: KOiNS: goto ZJKhy; jwf6s: pdo_insert('mihua_mall_red', array("openid" => $from_user, "commission_flag" => 3, "money" => $applyMoney, "addtime" => TIMESTAMP, "uniacid" => $_W['uniacid'])); goto ky9Ve; d89Zh: $this->sendsjytktz($applyMoney, $url2, $from_user); goto Gh2ys; ZJKhy: KmdEk: goto VG__b; mSWGJ: if ($template == 'mb_commissionPay') { goto E6jax; } goto lnlb2; CtMGx: goto EC12F; goto Ubhc2; tAG2n: if ($re == 1) { goto mkVqU; } goto jwf6s; RiB6M: exit; goto xLDrk; POlY2: if ($item['applyType'] == 2) { goto Hk_Ve; } goto z0Vf9; guTbK: $re = $class_redBao->send(); goto tAG2n; fsKwG: $status = $_GPC['status']; goto zpjrF; ky9Ve: if ($template == 'mb_commissionPay') { goto G9cpt; } goto dqfda; qNWQ7: CrQHL: goto Fy0Vy; Gh2ys: if ($template == 'mb_commissionPay') { goto gbnDR; } goto rgkoi; sMk0f: if ($template == 'mb_commissionPay') { goto cKjd6; } goto T0zad; thrSs: k8EMk: goto Qvmhx; JENyf: $pindex = max(1, intval($_GPC['page'])); goto AfYEM; CkL4t: $total = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_commissionPay') . ' a left join ' . tablename('mc_members') . ' f on a.uid=f.uid ' . ' WHERE a.uniacid = :uniacid ' . $condition . ' order by id desc ', array(":uniacid" => $_W['uniacid'])); goto LNdEX; Vlwe1: goto kFYXY; goto aLB43; ecNUU: kFYXY: goto JENyf; BmbWO: MVAgq: goto qu1fK; NsZy7: yNIa3: goto zNFGt; tWdW5: goto CrQHL; goto d4ANk; EbAxb: $condition = ' and a.status=1 '; goto Vlwe1; Cqr8r: $this->adminMessage('申请不存在或已处理', referer(), 'error'); goto CtMGx; dqwP8: VZ4M4: goto cbznj; bRePc: XAtAH: goto NsZy7; RRlj9: $new = floatval($balance) + floatval($applyMoney); goto DkwdN; QE1TV: $id = $_GPC['id']; goto TLa5g; qu1fK: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('redrecord_manage'); goto ld30b; DrzAm: G9cpt: goto r34ra; z0Vf9: pdo_update('mihua_mall_commissionPay', array("status" => 3, "flagtime" => time()), array("id" => $id, "from_user" => $from_user, "uniacid " => $_W['uniacid'])); goto tWdW5; xLDrk: cwHfR: goto eZOvJ; LNdEX: foreach ($list as $key => $row) { goto Cg_aX; RgAyf: tjkTy: goto USldh; Sezes: $list[$key]['parent'] = pdo_fetchcolumn('SELECT case when realname<>\'\' then realname else nickname end realname FROM ' . tablename('mc_members') . ' WHERE uid=(SELECT uid FROM ' . tablename('mihua_mall_member') . " WHERE id={$shareid['shareid']} )"); goto QImQZ; cN8l6: if (!$shareid) { goto YjCh8; } goto Sezes; Cg_aX: $shareid = pdo_fetch('SELECT shareid from ' . tablename('mihua_mall_member') . " where from_user='{$row['from_user']}'"); goto cN8l6; QImQZ: YjCh8: goto RgAyf; USldh: } goto S6L1n; D7Ox7: SozTg: goto i2ZAj; DlR3K: exit; goto bieVz; zpjrF: if ($status == 2) { goto KiDsh; } goto EbAxb; RsTfN: OXcHO: goto r4HiN; Nrsm9: $this->adminMessage('红包返现操作成功', referer(), 'success'); goto xC6bj; spGGT: } public function doWebCommission() { goto WBWxl; RhorV: return $this->commissionPro('applying'); goto XCow4; WBWxl: global $_W, $_GPC; goto RhorV; XCow4: exit; goto DbFvt; DbFvt: } public function domobileCommissionPay() { goto cFR5v; x8Yrb: $openid = $_W['openid']; goto EMOLP; y22Q7: message('您不是管理员', $this->createMobileUrl('list'), 'error'); goto vESri; ppcwy: fyHcr: goto VEHjC; VEHjC: return $this->commissionPro('mb_commissionPay'); goto btMr2; GOWCv: if ($isadmin) { goto fyHcr; } goto y22Q7; EMOLP: $isadmin = $this->domobileCheckAdmin(); goto GOWCv; vESri: exit; goto ppcwy; cFR5v: global $_W, $_GPC; goto x8Yrb; btMr2: } public function doMobileFansorderByid() { goto i8pFZ; i8pFZ: global $_W, $_GPC; goto zv3EY; C8R4_: EscJj: goto R_uVm; R_uVm: return $this->commissionOrderPro('fansorder3'); goto BOTFX; zv3EY: $isadmin = $this->domobileCheckAdmin(); goto E8pna; E8pna: if ($isadmin) { goto EscJj; } goto R9Nvv; R9Nvv: message('您不是管理员', $this->createMobileUrl('list'), 'error'); goto lJPI5; lJPI5: exit; goto C8R4_; BOTFX: } public function doWebFansorderByid() { global $_W, $_GPC; return $this->commissionOrderPro('apply_fansorder'); } public function commissionOrderPro($template) { goto xtS0Q; baYP4: $cfg = $this->module['config']; goto wnAnP; alJ4i: $where .= ')'; goto MdleA; xtS0Q: global $_W, $_GPC; goto uQR6u; iMEW4: if (!($cfg['globalCommissionLevel'] < 3 && $cfg['globalCommissionLevel'] > 1)) { goto oQ2zx; } goto aZZZT; Sg3ss: $where .= " or o.shareid2={$user_info['id']}  or o.shareid3={$user_info['id']} )"; goto Dl169; uQR6u: $signPackage = $this->getSignPackage($modulephp); goto kxTUD; zKil3: if (!empty($uid)) { goto ljYLd; } goto FEMoN; jd0hu: $uid = $_GPC['uid']; goto zKil3; imXZE: ljYLd: goto RXNa1; aZZZT: $where .= " or o.shareid2={$user_info['id']} )"; goto MYTww; Dl169: WCAF2: goto c1SVZ; FEMoN: message('未获得用户数据', $this->createMobileUrl('commissionPay'), 'error'); goto ucF2E; kxTUD: $pindex = max(1, intval($_GPC['page'])); goto K_7lU; K_7lU: $psize = 10; goto HNdb7; GZvoA: foreach ($list as $key => $value) { goto EaUwU; X7ofW: foreach ($result as $k => $v) { goto euYcn; XbwfC: $allnum += $v['total']; goto E2MqM; E2MqM: CAfAD: goto y8lGx; FekfY: $allmoney += $v['price']; goto XbwfC; euYcn: $commission += $v['commission' . $jibie . '']; goto FekfY; y8lGx: } goto FasPZ; tXOYY: if (!($value['shareid'] == $user_info['id'])) { goto SVf4Q; } goto fR_56; jurP2: $list[$key]['jibie'] = '二级'; goto Lxe95; FasPZ: E1lFF: goto l5jcI; qMxbz: $jibie = ''; goto QvJiI; CEQ44: if (!($value['shareid3'] == $user_info['id'])) { goto XsC5D; } goto gtB72; r77ug: F2RZh: goto CEQ44; XJ69l: XsC5D: goto X7ofW; QvJiI: SVf4Q: goto SGLfi; Lxe95: $jibie = 1; goto r77ug; fR_56: $list[$key]['jibie'] = '一级'; goto qMxbz; l5jcI: $list[$key]['detail'] = $result; goto xzzXq; JsXnr: $jibie = 2; goto XJ69l; SGLfi: if (!($value['shareid2'] == $user_info['id'])) { goto F2RZh; } goto jurP2; gtB72: $list[$key]['jibie'] = '三级'; goto JsXnr; snaGe: oRK5G: goto KnCKr; xzzXq: $list[$key]['money'] = $commission; goto emvse; K9stY: $list[$key]['allnum'] = $allnum; goto snaGe; emvse: $list[$key]['allmoney'] = $allmoney; goto K9stY; EaUwU: $result = pdo_fetchall('select detail.*,goods.title,goods.thumb from ' . tablename('mihua_mall_order_goods') . ' detail left join ' . tablename('mihua_mall_goods') . " goods on goods.id=detail.goodsid  where orderid={$value['id']}"); goto tXOYY; KnCKr: } goto qh78k; MdleA: hPkoD: goto iMEW4; MYTww: oQ2zx: goto wHcEJ; dZe0A: $fans = pdo_fetch('SELECT realname ,nickname ,avatar  FROM ' . tablename('mc_members') . " where uid={$uid}"); goto baYP4; Exzme: $yestday_begin_time_str = strtotime(date('Y-m', TIMESTAMP) . '-' . (date('d', TIMESTAMP) - 1)); goto jd0hu; tuBSM: $where = "   o.createtime>={$user_info['flagtime']} and o.from_user != '{$user_info['from_user']}'  and  (o.shareid={$user_info['id']}"; goto dZe0A; c1SVZ: $allcount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} "); goto U1jJS; WKRnJ: $total = pdo_fetchcolumn('select  count(*)  from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where} "); goto GZvoA; HNdb7: $today_begin_time_str = strtotime(date('Y-m-d', TIMESTAMP)); goto Exzme; ANdba: $pager = pagination($total, $pindex, $psize); goto kZazG; wnAnP: if (!($cfg['globalCommissionLevel'] < 2)) { goto hPkoD; } goto alJ4i; ycWwt: $list = pdo_fetchall('select  o.*,user.realname from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where}   ORDER BY  o.createtime DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto WKRnJ; NR7Vx: $yestdaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime<{$today_begin_time_str} and o.createtime>={$yestday_begin_time_str} "); goto ycWwt; ucF2E: exit; goto imXZE; wHcEJ: if (!($cfg['globalCommissionLevel'] > 2)) { goto WCAF2; } goto Sg3ss; RXNa1: $user_info = pdo_fetch('select * from ' . tablename('mihua_mall_member') . " where uid='{$uid}'"); goto tuBSM; qh78k: Ed1GV: goto ANdba; U1jJS: $todaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime>={$today_begin_time_str} "); goto NR7Vx; kZazG: include $this->template($template); goto Rf2V5; Rf2V5: } public function sendCommissionMsg($keyword3, $applyMoney, $from_user, $url) { goto nL153; rGHt1: $realname = pdo_fetchcolumn('select realname from ' . tablename('mihua_mall_member') . " where from_user='{$from_user}'"); goto RREgb; SCnG2: $settings = $this->module['config']; goto wtxt2; TaYY6: f3rAq: goto s75y5; nL153: global $_W, $_GPC; goto SCnG2; RREgb: $goodstitle = '用户：' . $realname . ',获得返佣'; goto pU87Q; c7Itl: if (!(!empty($noticeid) && !empty($sendMsgred))) { goto HiPmX; } goto rGHt1; KdCNl: $keyword2 = $applyMoney . '元'; goto hL0yX; pU87Q: $keyword1 = '会员佣金'; goto KdCNl; wtxt2: $sendMsgred = $settings['sendMsgred']; goto cr_HM; hL0yX: foreach ($noticeid as &$adminid) { $this->sendtmpmsg_red($adminid['from_user'], $sendMsgred, $url, $goodstitle, $keyword1, $keyword2, $keyword3, ''); ImAzA: } goto TaYY6; s75y5: HiPmX: goto KOQoc; cr_HM: $noticeid = pdo_fetchall('select from_user from ' . tablename('mihua_mall_admin') . '  where msg_flag=\'0\'  and uniacid = ' . $_W['uniacid']); goto c7Itl; KOQoc: } public function doWebOutCommission() { goto RW_4l; kdzDC: foreach ($commissionList as $k => $v) { goto bXi3U; WGqzb: $list[$k]['content'] = $info['content']; goto sQxOf; K7ahx: $list[$k]['mobile'] = $v['mobile']; goto q2YNI; LF2sB: pdo_update('mihua_mall_commission', array("isout" => 1), array("id" => $v['id'])); goto FrPV9; FrPV9: $list[$k]['realname'] = $v['realname']; goto K7ahx; q2YNI: $list[$k]['bankcard'] = $v['bankcard']; goto jmjdV; kRcpV: $list[$k]['checktime'] = date('Y-m-d H:m:s', $info['checktime']); goto YIbLj; sQxOf: Q3WV1: goto x1Yq1; KCQN9: $list[$k]['wxhao'] = $v['wxhao']; goto kRcpV; bXi3U: $ogid = $v['ogid']; goto z6NeO; YIbLj: $list[$k]['commissiontotal'] = $v['commission']; goto WGqzb; z6NeO: $info = pdo_fetch('select og.id, og.checktime, og.content from ' . tablename('mihua_mall_order_goods') . ' as og left join ' . tablename('mihua_mall_goods') . ' as g on og.goodsid = g.id and og.uniacid = g.uniacid where og.id = ' . $ogid); goto LF2sB; jmjdV: $list[$k]['alipay'] = $v['alipay']; goto KCQN9; x1Yq1: } goto nHZys; z5KXZ: $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(18); goto wH1xd; Rc10q: foreach ($list as $i => $v) { goto Se9lp; Se9lp: $i = $i + 2; goto ebZm8; wFcfG: kyIGX: goto VUqM5; ebZm8: $objPHPExcel->setActiveSheetIndex(0)->setCellValue('A' . $i, $v['realname'])->setCellValue('B' . $i, $v['mobile'])->setCellValue('C' . $i, $v['checktime'])->setCellValue('D' . $i, $v['commissiontotal'])->setCellValue('E' . $i, ' ' . $v['bankcard'] . ' ')->setCellValue('F' . $i, ' ' . $v['alipay'] . ' ')->setCellValue('G' . $i, ' ' . $v['wxhao'] . ' ')->setCellValue('H' . $i, $v['content']); goto wFcfG; VUqM5: } goto k7TU4; WP2TX: $objPHPExcel = new PHPExcel(); goto oGNZh; w7jhB: $list = array(); goto kdzDC; zdhUC: $this->__web2(); goto F3u8f; ZkbDQ: $info = pdo_fetch('select og.id, og.total, og.price, og.status, og.commission, og.applytime, og.content, g.title from ' . tablename('mihua_mall_order_goods') . ' as og left join ' . tablename('mihua_mall_goods') . ' as g on og.goodsid = g.id and og.uniacid = g.uniacid WHERE og.createtime>= ' . $starttime . ' AND og.createtime<=' . $endtime . ' '); goto JAVjS; wH1xd: $objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30); goto JD0dH; JD0dH: $objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30); goto iBzOv; tFFWb: exit; goto jqFSE; Ad82J: $objWriter->save('php://output'); goto uH28N; M5L5d: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto gqj4w; hx6zU: if (!(PHP_SAPI == 'cli')) { goto IvexW; } goto JWLz8; ccVyW: IvexW: goto hcTVk; u1k8_: if (!empty($commissionList)) { goto yMTMZ; } goto wNWQG; Kzxh_: header('Cache-Control: max-age=0'); goto m0ADQ; JWLz8: die('This example should only be run from a Web Browser'); goto ccVyW; M2H8Y: $objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getFont()->setBold(true); goto djKjG; F3u8f: $uniacid = $_W['uniacid']; goto M5L5d; oNB0d: $endtime = strtotime($_GPC['end_time']); goto ZkbDQ; UlLLf: header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'); goto xAvVj; hoFYV: $objPHPExcel->setActiveSheetIndex(0); goto UlLLf; djKjG: $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(12); goto XHSkw; I_gti: $objPHPExcel->setActiveSheetIndex(0)->setCellValue('A1', '真实姓名')->setCellValue('B1', '手机号码')->setCellValue('C1', '审核时间')->setCellValue('D1', '申请佣金')->setCellValue('E1', '银行卡号')->setCellValue('F1', '支付宝号')->setCellValue('G1', '微信号码')->setCellValue('H1', '备注'); goto Rc10q; xAvVj: header('Content-Disposition: attachment;filename="moon_' . $time . '.xlsx"'); goto Kzxh_; XE7fk: $time = time(); goto a3GKB; jqFSE: yMTMZ: goto w7jhB; gqj4w: $starttime = strtotime($_GPC['start_time']); goto oNB0d; m0ADQ: $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007'); goto Ad82J; L_3PF: $objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(30); goto XE7fk; oGNZh: $objPHPExcel->getProperties()->setCreator('米花')->setLastModifiedBy('米花')->setTitle('Office 2007 XLSX Test Document')->setSubject('Office 2007 XLSX Test Document')->setDescription('Test document for Office 2007 XLSX, generated using PHP classes.')->setKeywords('office 2007 openxml php')->setCategory('Test result file'); goto I_gti; k7TU4: lin0m: goto M2H8Y; uH28N: exit; goto H_VWI; a3GKB: $objPHPExcel->getActiveSheet()->setTitle('微商城佣金充值' . $time); goto hoFYV; RW_4l: global $_GPC, $_W; goto zdhUC; wNWQG: $this->adminMessage('已没有需要导出的数据了！'); goto tFFWb; nHZys: BE7yB: goto hx6zU; iBzOv: $objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(30); goto L_3PF; JAVjS: $commissionList = pdo_fetchall('SELECT c.*,m.realname,m.mobile,m.bankcard,m.alipay,m.wxhao FROM ' . tablename('mihua_mall_commission') . ' AS c LEFT JOIN ' . tablename('mihua_mall_member') . ' AS m ON c.mid=m.id WHERE c.createtime>=' . $starttime . ' AND c.createtime<=' . $endtime . ' AND c.isout = 0 AND c.flag = 0 AND c.uniacid=' . $_W['uniacid'] . '  '); goto u1k8_; XHSkw: $objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20); goto z5KXZ; hcTVk: require IA_ROOT . '/framework/library/phpexcel/PHPExcel.php'; goto WP2TX; H_VWI: } public function doWebRules() { goto YxTY2; ElFvi: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "tjrtzewm", "template" => $_GPC['tjrtzewm'], "tenable" => intval($_GPC['tjrtzewmenable'])); goto bcuIr; PKD2p: if (empty($tmsgtemplate['id'])) { goto Djqqs; } goto CMmbJ; LumLT: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "sjytktz")); goto BWHen; vn6aM: DnMiK: goto v1lhA; eaktG: OAcs6: goto ZCs9h; FlsgY: $msgtemplate['gmsptzenable'] = $tmsgtemplate['tenable']; goto OgGnc; s3p1T: X0bLg: goto tZMGP; i5reA: $this->adminMessage('达到金额请输入合法数字！'); goto f0eJ4; Cyhf0: $id = $theone['id']; goto EXcvF; clo3Q: In9XQ: goto ngGEh; ZjIOB: if (empty($id)) { goto jugxT; } goto azIOU; h5XVp: $msgtemplate['gmsptz'] = $tmsgtemplate['template']; goto FlsgY; LGv1v: if (is_numeric($_GPC['promotermoney'])) { goto Ozl2n; } goto i5reA; qd2AK: goto f0Fa4; goto C4CFc; sVLSc: if (!($_GPC['promotertimes'] == '3')) { goto w1sK5; } goto LGv1v; vv1Ph: $msgtemplate['tjrtzdlenable'] = $tmsgtemplate['tenable']; goto aM4h0; AsvsC: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto aiQIv; YdJQ7: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtz")); goto cBNi4; kQtaM: if (!(checksubmit('submit') || checksubmit('submit2'))) { goto OAcs6; } goto BciYJ; rqLfE: GqPNa: goto Wpxiw; OL06O: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "yjsqtz")); goto cBlvh; kpG7b: OkS7o: goto ElFvi; o5xHc: $msgtemplate['yjsqtz'] = $tmsgtemplate['template']; goto i319l; Ejx0Z: $datas = array("template" => $_GPC['xjdlshtz'], "tenable" => intval($_GPC['xjdlshtzenable'])); goto AsvsC; aauGU: oQUmF: goto n_0Zs; f0eJ4: Ozl2n: goto kZO9A; lSilM: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "tjrtz", "template" => $_GPC['tjrtz'], "tenable" => intval($_GPC['tjrtzenable'])); goto yCJDs; n_0Zs: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzdl")); goto NjSYj; OgGnc: isXk7: goto mFS6D; aiQIv: goto wVssS; goto s3p1T; Wpxiw: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "xjdlshtz")); goto Faz_K; tZMGP: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "xjdlshtz", "template" => $_GPC['xjdlshtz'], "tenable" => intval($_GPC['xjdlshtzenable'])); goto gQGVZ; a3e8y: goto uUs3f; goto kpG7b; hkaVW: $datas = array("template" => $_GPC['gmsptz'], "tenable" => intval($_GPC['gmsptzenable'])); goto OA9vD; I1r6T: $this->__web2(); goto yyUOg; lVSaa: $msgtemplate['tjrtzenable'] = $tmsgtemplate['tenable']; goto QpetQ; uEBIP: goto In9XQ; goto tfu0v; gQGVZ: pdo_insert('mihua_mall_msg_template', $datas); goto gh5I6; uDfru: Djqqs: goto xRUSC; OyHdH: pdo_insert('mihua_mall_msg_template', $datas); goto rqLfE; nAqMV: $datas = array("template" => $_GPC['tjrtzdl'], "tenable" => intval($_GPC['tjrtzdlenable'])); goto j_dya; i319l: $msgtemplate['yjsqtzenable'] = $tmsgtemplate['tenable']; goto Szqqx; rPVW4: R2BA0: goto Ggfp5; fPzC8: $msgtemplate['sjytktzenable'] = $tmsgtemplate['tenable']; goto ehwO6; LuKri: if (empty($tmsgtemplate['id'])) { goto NhBtF; } goto nAqMV; Faz_K: if (empty($tmsgtemplate['id'])) { goto X0bLg; } goto Ejx0Z; TvXRe: pdo_insert('mihua_mall_msg_template', $datas); goto Oe4nW; DNXCX: NhBtF: goto D00hF; aoCum: pdo_insert('mihua_mall_rules', $insert); goto d3BOz; NI3GV: $msgtemplate['sjytktz'] = $tmsgtemplate['template']; goto fPzC8; azIOU: if (!(pdo_update('mihua_mall_rules', $insert, array("id" => $id)) === false)) { goto DnMiK; } goto Sz_NZ; TbmrK: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzewm")); goto fSIwJ; U98c2: l0Byz: goto JVBFC; YxTY2: global $_GPC, $_W; goto I1r6T; I55Yb: eVYqj: goto sVLSc; cBNi4: if (empty($tmsgtemplate['id'])) { goto fSxJm; } goto UBLAa; Kw3kx: goto DEUUx; goto rPVW4; CMmbJ: $datas = array("template" => $_GPC['yjsqtz'], "tenable" => intval($_GPC['yjsqtzenable'])); goto A_yny; ZCs9h: include $this->template('rules'); goto DDKJu; k3nzR: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto qd2AK; uxyRg: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "sjytktz", "template" => $_GPC['sjytktz'], "tenable" => intval($_GPC['sjytktzenable'])); goto pmQqy; LOUsK: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "yjsqtz")); goto PKD2p; D00hF: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "tjrtzdl", "template" => $_GPC['tjrtzdl'], "tenable" => intval($_GPC['tjrtzdlenable'])); goto OyHdH; e4B73: jIekW: goto OL06O; Szqqx: Hujzd: goto LumLT; CEShN: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto uEBIP; eVBtX: $msgtemplate['xjdlshtz'] = $tmsgtemplate['template']; goto ilbYD; b8x5q: goto Pblaz; goto uDfru; ngGEh: $insert = array("uniacid" => $_W['uniacid'], "clickcredit" => $clickcredit, "rule" => htmlspecialchars_decode($_GPC['rule']), "terms" => htmlspecialchars_decode($_GPC['terms']), "commtime" => 0, "promotertimes" => $_GPC['promotertimes'], "promotermoney" => $_GPC['promotermoney'], "promotercount" => $_GPC['promotercount'], "ischeck" => 1, "createtime" => TIMESTAMP); goto ZjIOB; EXcvF: $msgtemplate = array(); goto oOwSE; oOwSE: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "gmsptz")); goto Xz3CL; yyUOg: $uniacid = $_W['uniacid']; goto xk2st; CmToW: $msgtemplate['tjrtz'] = $tmsgtemplate['template']; goto lVSaa; pmQqy: pdo_insert('mihua_mall_msg_template', $datas); goto clo3Q; Y3ihu: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzewm")); goto Rz8pw; bcuIr: pdo_insert('mihua_mall_msg_template', $datas); goto oW3K8; OA9vD: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto Kw3kx; d3BOz: !pdo_insertid() ? $this->adminMessage('保存失败, 请稍后重试.', 'error') : ''; goto U98c2; xk2st: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto ZQQGQ; QpetQ: Eqewf: goto TbmrK; BWHen: if (empty($tmsgtemplate['id'])) { goto ZRjnY; } goto NI3GV; gh5I6: wVssS: goto LOUsK; ZshfA: $datas = array("template" => $_GPC['tjrtzewm'], "tenable" => intval($_GPC['tjrtzewmenable'])); goto AJ19s; Xz3CL: if (empty($tmsgtemplate['id'])) { goto isXk7; } goto h5XVp; kZO9A: w1sK5: goto BSLBp; SyFSp: if (empty($tmsgtemplate['id'])) { goto R2BA0; } goto hkaVW; tfu0v: LFZEk: goto uxyRg; nlm0q: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "xjdlshtz")); goto o5uJU; ZQQGQ: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto Cyhf0; o5uJU: if (empty($tmsgtemplate['id'])) { goto jIekW; } goto eVBtX; JVBFC: $this->adminMessage('更新成功！', $this->createWebUrl('rules'), 'success'); goto eaktG; aM4h0: RZzmm: goto nlm0q; HXGit: if (!($_GPC['promotertimes'] == '2')) { goto eVYqj; } goto fbBEg; NjSYj: if (empty($tmsgtemplate['id'])) { goto RZzmm; } goto bHPUp; oW3K8: uUs3f: goto EAGon; ilbYD: $msgtemplate['xjdlshtzenable'] = $tmsgtemplate['tenable']; goto e4B73; fbBEg: if (is_numeric($_GPC['promotercount'])) { goto QTYzn; } goto VzyIe; C4CFc: fSxJm: goto lSilM; BSLBp: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "gmsptz")); goto SyFSp; BciYJ: $clickcredit = $_GPC['clickcredit']; goto HXGit; ZvFpX: $msgtemplate['tjrtzewm'] = $tmsgtemplate['template']; goto EUM_P; cFWLa: Pblaz: goto LjIYu; mlUgD: if (empty($tmsgtemplate['id'])) { goto LFZEk; } goto X469h; Oe4nW: DEUUx: goto YdJQ7; Sz_NZ: $this->adminMessage('更新失败, 请稍后重试.', 'error'); goto vn6aM; mFS6D: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtz")); goto LLUSA; ehwO6: ZRjnY: goto kQtaM; EwTNy: jugxT: goto aoCum; v1lhA: goto l0Byz; goto EwTNy; fSIwJ: if (empty($tmsgtemplate['id'])) { goto oQUmF; } goto ZvFpX; Up9K_: goto GqPNa; goto DNXCX; xRUSC: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "yjsqtz", "template" => $_GPC['yjsqtz'], "tenable" => intval($_GPC['yjsqtzenable'])); goto UzfNU; X469h: $datas = array("template" => $_GPC['sjytktz'], "tenable" => intval($_GPC['sjytktzenable'])); goto CEShN; UBLAa: $datas = array("template" => $_GPC['tjrtz'], "tenable" => intval($_GPC['tjrtzenable'])); goto k3nzR; UzfNU: pdo_insert('mihua_mall_msg_template', $datas); goto cFWLa; A_yny: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto b8x5q; LjIYu: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "sjytktz")); goto mlUgD; EAGon: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzdl")); goto LuKri; AJ19s: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto a3e8y; Rz8pw: if (empty($tmsgtemplate['id'])) { goto OkS7o; } goto ZshfA; j_dya: pdo_update('mihua_mall_msg_template', $datas, array("id" => $tmsgtemplate['id'])); goto Up9K_; bHPUp: $msgtemplate['tjrtzdl'] = $tmsgtemplate['template']; goto vv1Ph; LLUSA: if (empty($tmsgtemplate['id'])) { goto Eqewf; } goto CmToW; cBlvh: if (empty($tmsgtemplate['id'])) { goto Hujzd; } goto o5xHc; VzyIe: $this->adminMessage('达到单数请输入合法数字！'); goto rJ5Hn; rJ5Hn: QTYzn: goto I55Yb; mp4nN: f0Fa4: goto Y3ihu; EUM_P: $msgtemplate['tjrtzewmenable'] = $tmsgtemplate['tenable']; goto aauGU; Ggfp5: $datas = array("uniacid" => $_W['uniacid'], "tkey" => "gmsptz", "template" => $_GPC['gmsptz'], "tenable" => intval($_GPC['gmsptzenable'])); goto TvXRe; yCJDs: pdo_insert('mihua_mall_msg_template', $datas); goto mp4nN; DDKJu: } public function doWebSpread() { goto AFnrH; xsJ6V: $op = 'leaflet'; goto ld0N7; bnKBF: $rid = pdo_insertid(); goto VknjM; YIQlq: include $this->template('spread'); goto Q6wIB; AnnrS: Ovsp5: goto xsJ6V; FW1c3: goto Ovsp5; goto vX8K5; VdGUS: fMYQo: goto lSE6T; DHAJZ: Yrp9e: goto hr4iB; cvUH7: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mc_mapping_fans') . ' a WHERE a.uniacid=:uniacid ', array(":uniacid" => $_W['uniacid'])); goto Ki3LW; LeTdX: erdw4: goto V4Osh; N46op: $this->adminMessage('传单背景图必须是jpg格式。不支持png等其他格式。', referer(), 'error'); goto WLrFB; VsoVB: hnKUv: goto HswYQ; FhWCi: $my_follows_sql = 'select a.createtime createtime, a.nickname, a.avatar,count(b.from_user) follower_count from ' . tablename('mc_members') . ' a left join  ' . tablename('mihua_mall_share_history') . '  b on b.uniacid=a.uniacid and b.sharemid=(select x.id from ' . tablename('mihua_mall_member') . ' x where x.uniacid=:uniacid and x.from_user=a.from_user  limit 1)  and b.from_user!=a.from_user  where a.from_user in(
				select openid from ' . tablename('mc_mapping_fans') . '  where uniacid=:uniacid and follow=1 UNION (select from_user from ' . tablename('mihua_mall_share_history') . ' where uniacid=:uniacid )
				UNION (select m.from_user from ' . tablename('mihua_mall_member') . ' m where m.uniacid = :uniacid)  )   group by b.from_user  ORDER BY follower_count DESC LIMIT ' . ($pindex - 1) * $psize . ",{$psize}"; goto RoQxh; LJU_N: $words = explode(',', $_GPC['keywords_three']); goto yCMZh; gscO4: $this->adminMessage('更新成功', referer(), 'success'); goto y3wKY; yCMZh: foreach ($words as $key => $value) { goto xbUQx; xbUQx: $insert = array("uniacid" => $_W['uniacid'], "rid" => $rid, "module" => "mihua_mall", "content" => '' . $value . '', "type" => 1, "displayorder" => 0, "status" => 1); goto O3STJ; O3STJ: pdo_insert('rule_keyword', $insert); goto PCIG3; PCIG3: SzwO5: goto AyyNr; AyyNr: } goto dTPj9; VHdOp: wV0Fs: goto b3Yzd; iK5nS: goto IGcYy; goto iKT7s; dp2Lq: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_channel') . ' WHERE uniacid=:uniacid AND channel=:channel', array(":uniacid" => $_W['uniacid'], ":channel" => $_GPC['channel'])); goto sjCa3; AFnrH: global $_GPC, $_W; goto hNj_u; u1f9c: if (!empty($_GPC['boolrule_2'])) { goto Cjqsw; } goto FW1c3; ACRTu: if (!checksubmit('submit')) { goto vGdZa; } goto azlVI; cl669: AeCZZ: goto vOnSH; luRRL: goto sjLfe; goto oF22l; f5Lbt: yIalS: goto YIQlq; NuaYZ: if (!($boolrule == true)) { goto kVAYA; } goto KvDyT; Q0XbL: $backg = end($ar); goto wvUym; VqIvS: pdo_delete('rule_keyword', array("module" => "mihua_mall", "uniacid" => $_W['uniacid'], "content" => "分销专属二维码")); goto NoxDQ; HugNP: if (!($_GPC['keywords_three'] != $_GPC['title'])) { goto TMYov; } goto n62Y4; mEdTa: if ($op == 'log') { goto F_j0B; } goto B_1qt; kW22b: if ($_GPC['keywords_three']) { goto egJaQ; } goto FnrC5; oApap: $bgparam = $this->encode_channel_param($_GPC); goto xrD1a; KS1KW: $this->adminMessage('操作成功', referer(), 'success'); goto szdcz; v1P6T: $active = $list_count == 0; goto lC9p0; DktHa: $channel_id = pdo_insertid(); goto vNbq0; ozhOc: pdo_insert('rule', $insert); goto bnKBF; IMGui: $list_count = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_channel') . ' WHERE uniacid=:uniacid and isdel=0', array(":uniacid" => $_W['uniacid'])); goto GjGay; bGHG8: $this->adminMessage('新建成功', $this->createWebUrl('spread', array("op" => "leaflet")), 'success'); goto eIkx2; ld0N7: XbifT: goto u1NfW; Ni3AF: pdo_insert('rule_keyword', $insert); goto QFfYU; HbN0S: if (!empty($_GPC['boolrule'])) { goto fW_3B; } goto J8H5f; Bn5U4: if (empty($mylist)) { goto YKpuk; } goto cvUH7; toCiL: if ($op == 'active') { goto Pd0k2; } goto hMahi; A9LBe: Aj6P4: goto VqIvS; qEpY6: foreach ($rulekeywordcount as $k => $v) { pdo_delete('rule', array("id" => $v['rid'], "uniacid" => $_W['uniacid'], "module" => "mihua_mall")); y3mq5: } goto LeTdX; V4Osh: pdo_delete('rule_keyword', array("module" => "mihua_mall", "uniacid" => $_W['uniacid'], "content" => "分销专属二维码")); goto DWVg8; QFfYU: $this->adminMessage('设置成功,请进入自定义菜单绑定关键字\'分销专属二维码\'！', referer(), 'success'); goto mHuLR; ldv6Z: c3_i7: goto I3NP_; TAIMp: if ($op == 'leaflet') { goto tYvuk; } goto toCiL; myq_c: if (!($rulekeywordcount >= 1)) { goto yU2fA; } goto hphJb; Na_s3: RCYHe: goto KonK2; IdpJq: pdo_update('mihua_mall_qr', array("expiretime" => 1), array("channel" => $_GPC['channel'])); goto gscO4; CRfgZ: adDbc: goto uSPyb; qQMM0: if (empty($_GPC['channel'])) { goto YZwhV; } goto dp2Lq; oF22l: NEuqo: goto SbLAq; G0wgg: $boolrule = false; goto myq_c; zZhz8: goto yIalS; goto ifbk9; vL47D: if (!checksubmit('submit')) { goto pZIAq; } goto EuL8t; w_Y1W: EjfQB: goto UQm02; J8H5f: if ($_GPC['boolrule']) { goto p_tNX; } goto evaxL; mf3Fl: pdo_insert('rule_keyword', $insert); goto VsoVB; iqBpF: $this->adminMessage('error!', '', 'error'); goto MG2cr; Qio1x: $this->adminMessage('设定当前活跃传单成功', referer(), 'success'); goto JfCnJ; aAUlA: pZIAq: goto DHAJZ; dTPj9: TnDlr: goto THFkR; tvszF: goto fMYQo; goto w_Y1W; hr4iB: goto EJ3lO; goto uYoFJ; v90Pd: $fans['avatar'] = $myheadimg['avatar']; goto q7s15; Q10n3: Cjqsw: goto AnnrS; f8fv8: $from_user = $_GPC['from_user']; goto C48JO; EuL8t: if ($_GPC['title']) { goto RCYHe; } goto GXU84; rmCkp: if (!empty($_GPC['boolrule_2'])) { goto pk0eS; } goto u1f9c; u1NfW: if ($op == 'delete') { goto Yq32i; } goto TAIMp; Z5hHG: pdo_update('mihua_mall_channel', array("createtime" => time()), array("uniacid" => $_W['uniacid'], "channel" => $item['channel'])); goto WM4EV; uYoFJ: F_j0B: goto IFfN7; eIkx2: goto WTBL5; goto ygH6O; JRMK4: $rid = pdo_insertid(); goto iK5nS; wvUym: if (!(strcasecmp('jpg', end(explode('.', $_GPC['bg']))) != 0)) { goto pLb7y; } goto m5Sl0; yygHs: goto Yrp9e; goto cBaHN; DeTav: if (!(strcasecmp('jpg', end(explode('.', $_GPC['bg']))) != 0)) { goto ehdEf; } goto N46op; HwJ8x: $list_count = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_channel') . ' WHERE uniacid=:uniacid and isdel=0', array(":uniacid" => $_W['uniacid'])); goto NIf1I; HswYQ: $this->adminMessage('操作成功', referer(), 'success'); goto qeqfa; vNbq0: goto wV0Fs; goto cl669; fvq1E: $channel_id = pdo_insertid(); goto tvszF; NIf1I: $active = $list_count == 0; goto gpX61; Xy3cz: OJa1m: goto f8fv8; RoQxh: $mylist = pdo_fetchall($my_follows_sql, array(":uniacid" => $_W['uniacid'])); goto Bn5U4; SpPcV: $myheadimg = mc_fetch($uid, array("avatar")); goto v90Pd; sjCa3: YZwhV: goto YP3i8; LiES0: pdo_insert('rule', $insert); goto PPzIH; boRCi: $uid = mc_openid2uid($from_user); goto SpPcV; J3FmP: if ($op == 'post_goods_in') { goto UD83Y; } goto iqBpF; XU2uW: pdo_update('mihua_mall_channel', array("isdel" => 1, "createtime" => time()), array("channel" => $_GPC['channel'], "uniacid" => $_W['uniacid'])); goto NWr7D; C48JO: $fans = fans_search($from_user, array("nickname", "createtime", "credit1")); goto boRCi; mTQwZ: if (!($op == 'checkspreadrule')) { goto XbifT; } goto HbN0S; DWVg8: $this->adminMessage('系统已去除\'分销专属二维码\'关键字触发', referer(), 'success'); goto OJJHU; I3NP_: if (!checksubmit('submit')) { goto MChpQ; } goto kW22b; KvDyT: $rulekeywordcount = pdo_fetchall('SELECT rid FROM ' . tablename('rule_keyword') . ' WHERE uniacid=:uniacid and module=\'mihua_mall\' and content=\'分销专属二维码\'', array(":uniacid" => $_W['uniacid'])); goto qEpY6; xrD1a: if (!empty($_GPC['channel'])) { goto AeCZZ; } goto KK6jj; MG2cr: goto Yrp9e; goto Xy3cz; ppByc: $rule = pdo_fetch('select * from ' . tablename('rule') . ' where name=:name and uniacid=:uniacid', array("name" => "进入产品(产品+产品名)", "uniacid" => $_W['uniacid'])); goto KItFK; nuEmM: $this->adminMessage('传单背景图必须是jpg格式。不支持png等其他格式。', referer(), 'error'); goto SnHfQ; SDULs: goto ymBWO; goto iqP2W; q7s15: $mylist = pdo_fetchall('SELECT b.createtime createtime, nickname, avatar FROM ' . tablename('mihua_mall_share_history') . ' a LEFT JOIN ' . tablename('mc_mapping_fans') . ' b ON a.uniacid=b.uniacid and a.from_user = b.openid WHERE a.sharemid = (select id from ' . tablename('mihua_mall_member') . ' c where c.from_user=:leader and c.uniacid=:uniacid  limit 1) and a.from_user!=:leader AND a.uniacid=:uniacid  ', array(":leader" => $from_user, ":uniacid" => $_W['uniacid'])); goto rJ3Jd; UQm02: pdo_update('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "bg" => $_GPC['bg'], "msgtype" => 11, "bgparam" => $bgparam, "notice" => $_GPC['notice'], "uniacid" => $_W['uniacid']), array("channel" => $_GPC['channel'])); goto cpt7v; HNGJU: pdo_update('mihua_mall_qr', array("expiretime" => 1), array("channel" => $_GPC['channel'])); goto VHdOp; J58rI: goto A7EG3; goto zg9Ds; vHsHE: yU2fA: goto mTQwZ; KItFK: if ($rule) { goto fVvpn; } goto yTt2K; tYCrs: EJ3lO: goto luRRL; cpt7v: pdo_update('mihua_mall_qr', array("expiretime" => 1), array("channel" => $_GPC['channel'])); goto VdGUS; GLcMI: $op = empty($_GPC['op']) ? 'leaflet' : $_GPC['op']; goto RmI9_; yTt2K: $insert = array("uniacid" => $_W['uniacid'], "cid" => 0, "name" => "进入产品(产品+产品名)", "module" => "mihua_mall", "displayorder" => 0, "status" => 1); goto LiES0; SbLAq: $item = array(); goto qQMM0; EKs3l: $rule = pdo_fetch('select * from ' . tablename('rule') . ' where name=:name and uniacid=:uniacid', array("name" => "进入公众号(系统维护)", "uniacid" => $_W['uniacid'])); goto rP5q9; IFfN7: $pindex = max(1, intval($_GPC['page'])); goto AD2Fv; THFkR: HCE2I: goto KS1KW; iqP2W: Pd0k2: goto mhZ16; NWr7D: $this->adminMessage('删除成功', referer(), 'success'); goto f5Lbt; iKT7s: m2AeO: goto Af0jJ; FXnew: foreach ($rulekeywordcount as $k => $v) { pdo_delete('rule', array("id" => $v['rid'], "uniacid" => $_W['uniacid'], "module" => "mihua_mall")); YLjFV: } goto A9LBe; lSE6T: if (!$channel_id) { goto hnKUv; } goto ppByc; cYeyt: $mylist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_channel') . ' WHERE uniacid=:uniacid and isdel=0', array(":uniacid" => $_W['uniacid'])); goto gdI_a; evaxL: goto ra0zy; goto bwxhi; vOnSH: pdo_update('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "bg" => $_GPC['bg'], "msgtype" => 10, "bgparam" => $bgparam, "notice" => $_GPC['notice'], "uniacid" => $_W['uniacid']), array("channel" => $_GPC['channel'])); goto HNGJU; PPzIH: $rid = pdo_insertid(); goto aGV6y; lHLQ7: MChpQ: goto yygHs; H5zir: goto vaSn_; goto aJTPM; AD2Fv: $psize = 100; goto FhWCi; B_1qt: if ($op == 'user') { goto OJa1m; } goto e188O; x_QFr: goto Ovsp5; goto Q10n3; bwxhi: fW_3B: goto ApC8w; JUvxZ: $bgparam = $this->encode_channel_param($_GPC); goto gTsIV; b3Yzd: if (!$channel_id) { goto HCE2I; } goto EKs3l; EarZj: sjLfe: goto SDULs; fXIJK: vGdZa: goto EarZj; sTPHd: goto spJka; goto Na_s3; OJJHU: kVAYA: goto V_BY1; Af0jJ: $rid = $rule['id']; goto F2nod; hphJb: $boolrule = true; goto vHsHE; lC9p0: pdo_insert('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "notice" => $_GPC['notice'], "msgtype" => 10, "bg" => $_GPC['bg'], "bgparam" => $bgparam, "active" => $active, "isdel" => 0, "uniacid" => $_W['uniacid'])); goto DktHa; aGV6y: goto adDbc; goto lWLhF; vX8K5: pk0eS: goto x_QFr; Ja6r5: $bgparam = $this->encode_channel_param($_GPC); goto U0EGp; GjGay: $active = $list_count == 0; goto avIWK; rP5q9: if ($rule) { goto m2AeO; } goto haXhT; JfCnJ: ymBWO: goto H5zir; KK6jj: $list_count = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_channel') . ' WHERE uniacid=:uniacid and isdel=0', array(":uniacid" => $_W['uniacid'])); goto v1P6T; ApC8w: $rulekeywordcount = pdo_fetchall('SELECT rid FROM ' . tablename('rule_keyword') . ' WHERE uniacid=:uniacid and module=\'mihua_mall\' and content=\'分销专属二维码\'', array(":uniacid" => $_W['uniacid'])); goto FXnew; lWLhF: fVvpn: goto OXpq9; szdcz: A7EG3: goto lHLQ7; e188O: if ($op == 'post_in') { goto c3_i7; } goto J3FmP; VknjM: $insert = array("uniacid" => $_W['uniacid'], "rid" => $rid, "module" => "mihua_mall", "content" => "分销专属二维码", "type" => 1, "displayorder" => 0, "status" => 1); goto Ni3AF; SnHfQ: FWpto: goto Ja6r5; YP3i8: $item = Qr_code::decode_channel_param($item, $item['bgparam']); goto ACRTu; KonK2: if (!(strcasecmp('jpg', end(explode('.', $_GPC['bg']))) != 0)) { goto FWpto; } goto nuEmM; jOJGl: p_tNX: goto NuaYZ; WLrFB: ehdEf: goto oApap; cDCuf: $ar = explode('.', $_GPC['bg']); goto Q0XbL; gpX61: pdo_insert('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "notice" => $_GPC['notice'], "msgtype" => 11, "bg" => $_GPC['bg'], "bgparam" => $bgparam, "active" => $active, "isdel" => 0, "uniacid" => $_W['uniacid'])); goto fvq1E; Ki3LW: $pager = pagination($total, $pindex, $psize); goto S0_CL; ygH6O: wchJf: goto aY8yD; qeqfa: spJka: goto aAUlA; avIWK: pdo_insert('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "notice" => $_GPC['notice'], "msgtype" => $_GPC['msgtype'], "bg" => $_GPC['bg'], "bgparam" => $bgparam, "active" => $active, "isdel" => 0, "uniacid" => $_W['uniacid'])); goto bGHG8; FnrC5: $this->adminMessage('必须传入关键字', '', 'error'); goto J58rI; y3wKY: WTBL5: goto fXIJK; F2nod: IGcYy: goto LJU_N; uSPyb: $insert = array("uniacid" => $_W['uniacid'], "rid" => $rid, "module" => "mihua_mall", "content" => "产品", "type" => 3, "displayorder" => 0, "status" => 1); goto mf3Fl; WM4EV: pdo_update('mihua_mall_channel', array("createtime" => time(), "active" => 1), array("uniacid" => $_W['uniacid'], "channel" => $channel)); goto Qio1x; ZqmTz: TMYov: goto DeTav; S0_CL: YKpuk: goto tYCrs; m5Sl0: $this->adminMessage('传单背景图必须是jpg格式。不支持png等其他格式。', referer(), 'error'); goto I_EpT; rJ3Jd: goto Yrp9e; goto ldv6Z; I_EpT: pLb7y: goto JUvxZ; U0EGp: if (!empty($_GPC['channel'])) { goto EjfQB; } goto HwJ8x; mHuLR: goto ra0zy; goto jOJGl; gdI_a: vaSn_: goto zZhz8; OXpq9: $rid = $rule['id']; goto CRfgZ; hNj_u: $this->__web2(); goto GLcMI; NoxDQ: $insert = array("uniacid" => $_W['uniacid'], "cid" => 0, "name" => "分销专属二维码(系统维护)", "module" => "mihua_mall", "displayorder" => 0, "status" => 1); goto ozhOc; zg9Ds: egJaQ: goto HugNP; n62Y4: $this->adminMessage('此模式下（关键字和标题）两项必须相同', '', 'error'); goto ZqmTz; D01KR: pdo_update('mihua_mall_channel', array("active" => 0), array("uniacid" => $_W['uniacid'])); goto Z5hHG; V_BY1: ra0zy: goto rmCkp; aJTPM: tYvuk: goto cYeyt; mhZ16: $channel = intval($_GPC['channel']); goto D01KR; aY8yD: pdo_update('mihua_mall_channel', array("title" => $_GPC['title'], "createtime" => time(), "bg" => $_GPC['bg'], "bgparam" => $bgparam, "notice" => $_GPC['notice'], "uniacid" => $_W['uniacid']), array("channel" => $_GPC['channel'])); goto IdpJq; gTsIV: if (!empty($_GPC['channel'])) { goto wchJf; } goto IMGui; hMahi: if ($op == 'post') { goto NEuqo; } goto mEdTa; RmI9_: $rulekeywordcount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('rule_keyword') . ' WHERE uniacid=:uniacid and module=\'mihua_mall\' and content=\'分销专属二维码\'', array(":uniacid" => $_W['uniacid'])); goto G0wgg; cBaHN: UD83Y: goto vL47D; haXhT: $insert = array("uniacid" => $_W['uniacid'], "cid" => 0, "name" => "进入公众号(系统维护)", "module" => "mihua_mall", "displayorder" => 0, "status" => 1); goto cNRgx; ifbk9: Yq32i: goto XU2uW; cNRgx: pdo_insert('rule', $insert); goto JRMK4; GXU84: $this->adminMessage('必须传入名称', '', 'error'); goto sTPHd; azlVI: $backg = end(); goto cDCuf; Q6wIB: } public function doWebExpress() { goto Y95Zq; qMjeA: if (!empty($id)) { goto QgzFE; } goto PzJ9D; aVrmY: goto T1A2I; goto GkNXF; Y8hPE: goto T1A2I; goto P2i0M; uZWAG: if (!empty($_GPC['express_name'])) { goto XBcTp; } goto AgFp4; bDka2: $express = pdo_fetch('SELECT id  FROM ' . tablename('mihua_mall_express') . " WHERE id = '{$id}' AND uniacid=" . $_W['uniacid'] . ''); goto JmEhk; N9N0a: include $this->template('express'); goto CgMGk; L8VDw: if ($operation == 'display') { goto yr3M1; } goto hCL01; gb9ia: QgzFE: goto H8209; rNGwo: PbY8R: goto tNG4U; M04B0: $express = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_express') . " WHERE id = '{$id}' and uniacid = '{$_W['uniacid']}'"); goto Y8hPE; fgGvc: if ($operation == 'delete') { goto s_y44; } goto a4mDZ; SzJ93: pdo_update('mihua_mall_express', $data, array("id" => $id)); goto I9EQO; i33qD: goto WlMi_; goto gb9ia; JmEhk: if (!empty($express)) { goto PbY8R; } goto m9_9O; YeeM3: goto T1A2I; goto O10ND; m9_9O: $this->adminMessage('抱歉，物流方式不存在或是已经被删除！', $this->createWebUrl('express', array("op" => "display")), 'error'); goto rNGwo; hCL01: if ($operation == 'post') { goto HPESp; } goto fgGvc; D95w6: $id = intval($_GPC['id']); goto r9BhG; k0fij: $id = pdo_insertid(); goto i33qD; PzJ9D: pdo_insert('mihua_mall_express', $data); goto k0fij; hAIN6: $id = intval($_GPC['id']); goto bDka2; A_iGa: XBcTp: goto WcWYV; a4mDZ: $this->adminMessage('请求方式不存在'); goto aVrmY; nJQSl: $this->adminMessage('物流方式删除成功！', $this->createWebUrl('express', array("op" => "display")), 'success'); goto dkI6_; r9BhG: if (!checksubmit('submit')) { goto hmJHj; } goto uZWAG; GkNXF: yr3M1: goto rRG2I; WcWYV: $data = array("uniacid" => $_W['uniacid'], "displayorder" => intval($_GPC['express_name']), "express_name" => $_GPC['express_name'], "express_url" => $_GPC['express_url'], "express_area" => $_GPC['express_area']); goto qMjeA; ImNDW: $this->__web2(); goto vqAxJ; H8209: unset($data['parentid']); goto SzJ93; P2i0M: s_y44: goto hAIN6; Ap9PR: hmJHj: goto M04B0; O10ND: HPESp: goto D95w6; vqAxJ: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto L8VDw; AgFp4: $this->adminMessage('抱歉，请输入物流名称！'); goto A_iGa; dkI6_: T1A2I: goto N9N0a; Y95Zq: global $_GPC, $_W; goto ImNDW; hQlMJ: $this->adminMessage('更新物流成功！', $this->createWebUrl('express', array("op" => "display")), 'success'); goto Ap9PR; rRG2I: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_express') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY displayorder DESC"); goto YeeM3; I9EQO: WlMi_: goto hQlMJ; tNG4U: pdo_delete('mihua_mall_express', array("id" => $id)); goto nJQSl; CgMGk: } public function doWebDispatch() { goto ZGcAi; BIQXS: r04Hg: goto YChD9; rR97h: $this->adminMessage('抱歉，配送方式不存在或是已经被删除！', $this->createWebUrl('dispatch', array("op" => "display")), 'error'); goto Fs4W4; U6E1E: load()->model('account'); goto U1K57; MTzHy: if (!empty($id)) { goto xJOMm; } goto kGnJ5; oOJ01: $id = intval($_GPC['id']); goto MXn_a; YFkvk: goto XEP7s; goto nrJDi; JLYa6: $id = pdo_insertid(); goto e5vLS; V50O8: rSJJ6: goto oOJ01; hY0im: if ($operation == 'delete') { goto rSJJ6; } goto GbPos; Nz8Yr: pdo_delete('mihua_mall_dispatch', array("id" => $id)); goto gBVB6; U1K57: $setting = uni_setting($_W['uniacid'], array("payment")); goto fjOPO; GvIT4: $this->__web2(); goto menK4; nrJDi: S8OXS: goto MdxSn; Xm0uM: goto XEP7s; goto V50O8; jSBdO: zwP4F: goto YF5Zu; ld6iC: include $this->template('dispatch'); goto u4xSP; a4tQd: pdo_update('mihua_mall_dispatch', $data, array("id" => $id)); goto jSBdO; MdxSn: $id = intval($_GPC['id']); goto x_9iU; kGnJ5: pdo_insert('mihua_mall_dispatch', $data); goto JLYa6; MXn_a: $dispatch = pdo_fetch('SELECT id  FROM ' . tablename('mihua_mall_dispatch') . " WHERE id = '{$id}' AND uniacid=" . $_W['uniacid'] . ''); goto eWiwZ; YF5Zu: $this->adminMessage('更新配送方式成功！', $this->createWebUrl('dispatch', array("op" => "display")), 'success'); goto BIQXS; Fs4W4: LZz2y: goto Nz8Yr; x_9iU: if (!checksubmit('submit')) { goto r04Hg; } goto JcfuX; WOe9G: ngwE1: goto fGUIR; VGiqO: goto XEP7s; goto WOe9G; bYO3m: XEP7s: goto ld6iC; rdUPM: $express = pdo_fetchall('select * from ' . tablename('mihua_mall_express') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY displayorder DESC"); goto Xm0uM; menK4: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto U6E1E; fGUIR: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_dispatch') . " WHERE uniacid = '{$_W['uniacid']}' ORDER BY displayorder "); goto YFkvk; YChD9: $dispatch = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . " WHERE id = '{$id}' and uniacid = '{$_W['uniacid']}'"); goto rdUPM; GbPos: $this->adminMessage('请求方式不存在'); goto VGiqO; JcfuX: $data = array("uniacid" => $_W['uniacid'], "displayorder" => intval($_GPC['displayorder']), "dispatchtype" => intval($_GPC['dispatchtype']), "dispatchname" => $_GPC['dispatchname'], "express" => $_GPC['express'], "firstprice" => $_GPC['firstprice'], "firstweight" => $_GPC['firstweight'], "secondprice" => $_GPC['secondprice'], "secondweight" => $_GPC['secondweight'], "description" => $_GPC['description'], "enabled" => $_GPC['enabled']); goto MTzHy; gBVB6: $this->adminMessage('配送方式删除成功！', $this->createWebUrl('dispatch', array("op" => "display")), 'success'); goto bYO3m; ZGcAi: global $_W, $_GPC; goto GvIT4; MgLzC: xJOMm: goto a4tQd; fjOPO: if ($operation == 'display') { goto ngwE1; } goto UEgzp; eWiwZ: if (!empty($dispatch)) { goto LZz2y; } goto rR97h; UEgzp: if ($operation == 'post') { goto S8OXS; } goto hY0im; e5vLS: goto zwP4F; goto MgLzC; u4xSP: } public function doWebAward() { goto nFAw8; Dy46x: $amount = intval($_GPC['amount']); goto t012j; Qn59j: sRNwi: goto AaPLo; zfQRX: if (!empty($row)) { goto sahTp; } goto r6LLj; Pxjv5: Qmnn8: goto VUGz8; zPvlF: $this->adminMessage('请输入兑换商品名称！'); goto zE6iO; hMWlP: WwLX_: goto mUYW5; IMRO8: $price = intval($_GPC['price']); goto Dy46x; pBjpQ: goto ctCUW; goto Pxjv5; VUGz8: $award_id = intval($_GPC['award_id']); goto ddEeZ; Y4301: $this->__web2(); goto oBbom; KGQ0X: include $this->template('credit_award'); goto II5vP; nNGiS: if ($operation == 'delete') { goto VVbhM; } goto cSUth; q8FXD: pdo_delete('mihua_mall_credit_award', array("award_id" => $award_id)); goto pZiGF; X2P65: $row = pdo_fetch('SELECT award_id FROM ' . tablename('mihua_mall_credit_award') . ' WHERE award_id = :award_id', array(":award_id" => $award_id)); goto zfQRX; MKGto: $this->adminMessage('商品更新成功！', create_url('site/entry', array("m" => "mihua_mall", "op" => "display", "do" => "award")), 'success'); goto y9yaJ; RaV9r: zQwNM: goto MKGto; zE6iO: BPQbG: goto mUHkK; hHpH_: goto zQwNM; goto NSj06; r55au: if (!empty($_GPC['price'])) { goto WwLX_; } goto xMPsK; jsQBK: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_credit_award') . " WHERE uniacid = '{$_W['uniacid']}' {$condition} ORDER BY createtime DESC"); goto Qn59j; pZiGF: $this->adminMessage('删除成功！', referer(), 'success'); goto tLEN2; Lzqkd: pdo_update('mihua_mall_credit_award', $data, array("award_id" => $award_id)); goto RaV9r; yoQ8w: if ($operation == 'post') { goto Qmnn8; } goto nNGiS; R4xCt: ctCUW: goto KGQ0X; vJwfm: $award_id = intval($_GPC['award_id']); goto X2P65; nFAw8: global $_W, $_GPC; goto Y4301; xMPsK: $this->adminMessage('请输入商品实际价值！'); goto hMWlP; t012j: $data = array("uniacid" => $_W['uniacid'], "title" => $_GPC['title'], "logo" => $_GPC['logo'], "deadline" => $_GPC['deadline'], "amount" => $amount, "credit_cost" => $credit_cost, "price" => $price, "content" => $_GPC['content'], "createtime" => TIMESTAMP); goto HRT2V; HRT2V: if (!empty($award_id)) { goto EnGMR; } goto ICdRQ; mUHkK: if (!empty($_GPC['credit_cost'])) { goto OppiB; } goto NIqeX; oBbom: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto yoQ8w; AaPLo: goto aXRdi; goto WKt6w; vhtdz: if (!checksubmit('submit')) { goto PoC5X; } goto h6KQQ; vKSlw: if (!empty($item)) { goto GpzD1; } goto R4v2E; zeAbO: sahTp: goto q8FXD; OiWsJ: NNvsj: goto vhtdz; r6LLj: $this->adminMessage('抱歉，商品' . $award_id . '不存在或是已经被删除！'); goto zeAbO; PSVpH: GpzD1: goto OiWsJ; h6KQQ: if (!empty($_GPC['title'])) { goto BPQbG; } goto zPvlF; TpTwI: $condition = ''; goto jsQBK; tcUEq: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_credit_award') . ' WHERE award_id = :award_id', array(":award_id" => $award_id)); goto vKSlw; ddEeZ: if (empty($award_id)) { goto NNvsj; } goto tcUEq; NSj06: EnGMR: goto Lzqkd; ICdRQ: pdo_insert('mihua_mall_credit_award', $data); goto hHpH_; WKt6w: VVbhM: goto vJwfm; JXffk: OppiB: goto r55au; tLEN2: aXRdi: goto pBjpQ; y9yaJ: PoC5X: goto R4xCt; cSUth: if (!($operation == 'display')) { goto sRNwi; } goto TpTwI; R4v2E: $this->adminMessage('抱歉，兑换商品不存在或是已经删除！', '', 'error'); goto PSVpH; NIqeX: $this->adminMessage('请输入兑换商品需要消耗的积分数量！'); goto JXffk; mUYW5: $credit_cost = intval($_GPC['credit_cost']); goto IMRO8; II5vP: } public function doWebCredit() { goto bESOP; yBijD: pI_vE: goto Nx_oy; egJeS: $condition = ''; goto gaqUW; UUZi0: ncmca: goto ZuY6G; bESOP: global $_GPC, $_W; goto G1ja_; DtNCM: $arrayAR = array_keys($ar); goto WclVH; QGuiN: if (!($operation == 'display')) { goto coKEe; } goto egJeS; yt1Np: include $this->template('credit_request'); goto JLn02; WclVH: foreach ($arrayAR as $key => $value) { $arrayAR[$key] = mc_openid2uid($value); vjHZz: } goto UUZi0; ZoPSd: goto SupQ7; goto KEVQn; lxxY4: Hkf9c: goto I0eFJ; G1ja_: $this->__web2(); goto rTAO9; JFmJc: $list = pdo_fetchall($sql); goto RxAZM; gaqUW: $sql = 'SELECT * FROM ' . tablename('mihua_mall_credit_award') . ' as t1,' . tablename('mihua_mall_credit_request') . "as t2 WHERE t1.award_id=t2.award_id AND t1.uniacid = '{$_W['uniacid']}' ORDER BY t2.createtime DESC"; goto JFmJc; obaJi: t7lsB: goto qqCwf; a2pZQ: $this->adminMessage('抱歉，编号为' . $id . '的兑换请求不存在或是已经被删除！'); goto yBijD; rTAO9: $operation = !empty($_GPC['op']) ? $_GPC['op'] : 'display'; goto Su7Co; Rc0YJ: SupQ7: goto yt1Np; KEVQn: Z7U4Q: goto nh_sI; mrYN2: $row = pdo_fetch('SELECT id FROM ' . tablename('mihua_mall_credit_request') . ' WHERE id = :id', array(":id" => $id)); goto EGb0e; sjID8: if ($operation == 'delete') { goto Z7U4Q; } goto QGuiN; ZuY6G: $fans = mc_fetch($arrayAR, array("realname", "mobile", "credit1", "residedist")); goto eHXs4; nh_sI: $id = intval($_GPC['id']); goto mrYN2; qQ9Lu: $this->adminMessage('删除成功！', referer(), 'success'); goto Rc0YJ; qqCwf: coKEe: goto ZoPSd; Su7Co: $modules = 'credit'; goto sjID8; EGb0e: if (!empty($row)) { goto pI_vE; } goto a2pZQ; I0eFJ: $ar = pdo_fetchall($sql, array(), 'from_user'); goto DtNCM; eHXs4: foreach ($list as $key => $value) { goto VUzr8; Ch0sj: rovbd: goto kU6oI; kU6oI: fExt5: goto LaFw8; VUzr8: foreach ($fans as $k => $v) { goto M0wnu; ap8bR: U0wwx: goto D6HPc; M0wnu: if (!($v['uid'] == $value['uid'])) { goto UMiTk; } goto ZR1Mg; ZR1Mg: $outarr[$v['uid']] = $v; goto jyiiz; jyiiz: UMiTk: goto ap8bR; D6HPc: } goto Ch0sj; LaFw8: } goto obaJi; RxAZM: foreach ($list as $key => $value) { $list[$key]['uid'] = mc_openid2uid($value['from_user']); A0lKV: } goto lxxY4; Nx_oy: pdo_delete('mihua_mall_credit_request', array("id" => $id)); goto qQ9Lu; JLn02: } public function domobileCommission_manage() { goto X04zl; rZjh8: include $this->template('commission_manage'); goto pwb5l; A34_z: foreach ($commissions as $c) { $commission[$c['mid']] = $c['commission']; K7J9S: } goto OaSf7; qQmmg: load()->model('mc'); goto gHdf6; hYIob: $mylist2 = pdo_fetchall('	select * ,2 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto sXQPf; AoJZ1: $commissions = pdo_fetchall('select mid, sum(commission) as commission from ' . tablename('mihua_mall_commission') . ' where uniacid = ' . $_W['uniacid'] . ' and flag = 0  group by mid'); goto dgqbV; r7zgM: if (!checksubmit()) { goto LRFN9; } goto f7PuH; y3R63: message('充值成功！', $this->createWebUrl('fansmanager', array("op" => "recharge", "id" => $_GPC['id'])), 'success'); goto rkHQ5; IjXWB: $fans = pdo_fetch('SELECT mc_members.nickname,createtime,credit1 FROM ' . tablename('mc_members') . ' mc_members left join ' . tablename('mc_mapping_fans') . ' fans on fans.uid=mc_members.uid WHERE  mc_members.uniacid = :uniacid
																			AND fans.openid = :from_user LIMIT 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto gVOhJ; IqN6l: $pager = pagination($total, $pindex, $psize); goto GVXC1; rxJ38: if (!$mylist3) { goto VIGPm; } goto nhatA; r1lG1: f9BT3: goto LR1yM; mNjHo: include $this->template('fansmanager_detail'); goto Z_zdx; N75Oh: aGyMU: goto Hartn; T7mX9: $mylist = pdo_fetchall('SELECT   nickname,b.uid  FROM ' . tablename('mihua_mall_share_history') . ' a LEFT JOIN ' . tablename('mc_mapping_fans') . ' b ON a.from_user = b.openid  and a.uniacid=b.uniacid WHERE a.sharemid = (select id from ' . tablename('mihua_mall_member') . ' c where c.from_user=:leader and c.uniacid=:uniacid  limit 1) and a.from_user!=:leader AND a.uniacid=:uniacid  ', array(":leader" => $from_user, ":uniacid" => $_W['uniacid'])); goto nVfqd; TxWoF: yZY1U: goto Yqoav; tWd2B: $psize = 20; goto eWeiH; t05Qa: $total = pdo_fetchcolumn('select count(id) from' . tablename('mihua_mall_member') . 'where flag = 0 and realname<>\'\' and uniacid =' . $_W['uniacid']); goto GtKkQ; BqFdD: QLobw: goto F7QbL; LXg9N: $paylog = array("type" => "zhifu", "uniacid" => $uniacid, "openid" => $_GPC['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $chargenum, "module" => "mihua_mall", "tag" => ' 后台打款' . $chargenum . '元'); goto UpYN2; B4ELj: message('佣金请输入合法数字！', '', 'error'); goto FV1Ra; n5tWe: $count = $count1 + $count2 + $count3; goto m5vhq; cBmr5: P8s7g: goto OhKHU; gXWss: if (!($op == 'status')) { goto NAb9C; } goto Pq75w; WuXae: exit; goto qNxe3; Vr3Cn: $str3 = trim($str3, ','); goto cIwgr; vQCFO: Wu5sz: goto y1XYt; p18uE: $commissions = pdo_fetchall('select * from ' . tablename('mihua_mall_commission') . ' where mid = ' . $id . ' and uniacid = ' . $_W['uniacid'] . ' and flag = 1'); goto yETd0; wmO6j: if ($_GPC['opp'] == 'nocheck') { goto NaHtc; } goto mNjHo; GtKkQ: $pager = pagination($total, $pindex, $psize); goto xUMY_; JNlrZ: VAqUt: goto lLXc2; OhKHU: if (!($op == 'detail')) { goto fclrO; } goto ZWDyW; tU_D9: $sort = array("realname" => $_GPC['realname'], "mobile" => $_GPC['mobile']); goto GEmZh; nhatA: foreach ($mylist3 as $key => $value) { goto oIihL; VKuRm: $mylist3[$key]['avatar'] = $value['avatar']; goto FRpZZ; FRpZZ: $mylist3[$key]['createtime'] = $value['createtime']; goto tGQN8; o9DAo: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto VKuRm; tGQN8: BRM6L: goto i3Mhv; i3Mhv: kQ_Hk: goto u98nJ; oIihL: if (!$value['uid']) { goto BRM6L; } goto o9DAo; u98nJ: } goto iN1AJ; t936Q: QjP3Z: goto Vr3Cn; Yqoav: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('paylog') . ' WHERE  openid=\'' . $_GPC['from_user'] . '\' AND type=\'zhifu\' AND `uniacid` = ' . $_W['uniacid']); goto G38ky; Jj2wp: include $this->template('commission_manage'); goto bZjEC; rHOFI: $str = ''; goto PorZE; e71UM: message('设置用户权限成功！', $this->createWebUrl('fansmanager', array("op" => "nocheck")), 'success'); goto Vc6mQ; BXHLP: RiSdC: goto T7mX9; dJpoO: if (!($op == 'recharge')) { goto i9p0x; } goto hw2cK; gHdf6: $uniacid = $_W['uniacid']; goto Kk6ns; QxloQ: NAb9C: goto dJpoO; M7zc7: if (!$chargenum) { goto zVV5l; } goto F5IKz; Y_E4w: $sql2_member = 'select mber2.from_user from ' . tablename('mihua_mall_member') . ' mber2 where  mber2.realname<>\'\' and mber2.id!=mber2.shareid and mber2.shareid in (' . $str . ')  '; goto lQXXm; h1_yX: $cfg = $this->module['config']; goto pF9s_; zcb1k: QLSsG: goto n5tWe; jbyV8: if (!true) { goto fu0sv; } goto yp09D; gRnJ2: $count = 0; goto ebd59; TRcrJ: foreach ($mylist2 as $key => $value) { goto MOexP; TMnq1: $mylist2[$key]['avatar'] = $value['avatar']; goto JL_DI; JL_DI: $mylist2[$key]['createtime'] = $value['createtime']; goto ZaNdQ; MOexP: if (!$value['uid']) { goto S7aXd; } goto zXapf; zXapf: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto TMnq1; ZaNdQ: S7aXd: goto zCqc3; zCqc3: OY9pz: goto sgaCx; sgaCx: } goto ziMTh; Kk6ns: $op = $operation = $_GPC['op'] ? $_GPC['op'] : 'display'; goto h1_yX; sXQPf: if (!$mylist2) { goto rVUm2; } goto TRcrJ; S8i13: $status = 1; goto dttXR; MGUGT: if (!$mylist1) { goto YgEPB; } goto Q4kAj; Ffo1m: fu0sv: goto GVFcu; RFoGw: message('请选择会员！', create_url('site/module', array("do" => "zhifu", "op" => "list", "name" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto UyYBg; B1BVK: $status['flag'] = $_GPC['flag']; goto Nee4z; pF9s_: if (!($op == 'delete')) { goto IkTvp; } goto ga1sA; Vc6mQ: pTqj5: goto vhFPU; OOTbl: if (!($_GPC['opp'] == 'recharged')) { goto VAqUt; } goto zlxDb; GVFcu: if (!(true && $cfg['globalCommissionLevel'] >= 2 && $mylist1)) { goto e0CSy; } goto qLZQP; GVXC1: $commissions = pdo_fetchall('select mid, sum(commission) as commission from ' . tablename('mihua_mall_commission') . ' where uniacid = ' . $_W['uniacid'] . ' and flag = 0 group by mid'); goto NRM2d; tRAUx: foreach ($commissions as $c) { $commission[$c['mid']] = $c['commission']; olpaV: } goto vQCFO; vhFPU: goto S0faS; goto BqFdD; ziMTh: Crc7L: goto EAdVj; M1dDI: exit; goto cBmr5; T5c17: foreach ($level3 as &$citem) { $str3 = $str3 . $citem['id'] . ','; Ppp9q: } goto t936Q; sqbbD: $total = pdo_fetchcolumn('select count(id) from' . tablename('mihua_mall_member') . 'where flag = 1 and realname<>\'\' and uniacid =' . $_W['uniacid']); goto IqN6l; SF1DC: bQ4ou: goto Jj2wp; EAdVj: rVUm2: goto mN5Vj; ZTyp6: foreach ($mylist as $key => $value) { goto ZPwp6; ZUL3G: xZ4gB: goto gWFRP; aNlmM: $mylist[$key]['avatar'] = $value['avatar']; goto y6O1q; y6O1q: $mylist[$key]['createtime'] = $value['createtime']; goto VwOwk; zXGI1: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto aNlmM; VwOwk: moO4S: goto ZUL3G; ZPwp6: if (!$value['uid']) { goto moO4S; } goto zXGI1; gWFRP: } goto kPTvy; ORhPH: $commission = $commission - $user['commission']; goto p18uE; Z_zdx: goto Wvgbv; goto untfD; vC4Br: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto elc5z; UpYN2: pdo_insert('paylog', $paylog); goto enxzK; EbOFe: $temp = pdo_insert('mihua_mall_commission', $recharged); goto yIUWU; nVfqd: if (!$mylist) { goto kuJuq; } goto ZTyp6; vwndO: xMOmS: goto T74Fq; Vxo8v: $pindex = max(1, intval($_GPC['page'])); goto tWd2B; T74Fq: YgEPB: goto Ffo1m; OaSf7: Bwz12: goto ZRHWA; n7Tzq: if (!empty($_GPC['from_user'])) { goto lR5vo; } goto RFoGw; cIwgr: $sql3_member = 'select mber3.from_user from ' . tablename('mihua_mall_member') . ' mber3 where  mber3.realname<>\'\' and mber3.id!=mber3.shareid and mber3.shareid in (' . $str3 . ')  '; goto w0X_Z; US6aB: if ($_GPC['opp'] == 'nocheck') { goto Z2gsW; } goto lj_cA; tax8n: tWk81: goto AMuen; BBoe9: if (!($op == 'display')) { goto wzRs_; } goto Vxo8v; hIBjg: $count1 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto Nc6LG; ebd59: goto paNE6; goto BXHLP; eg4BY: $pindex = max(1, intval($_GPC['page'])); goto pigo1; f7PuH: $chargenum = round($_GPC['chargenum'], 2); goto M7zc7; buXhZ: slVXs: goto JNlrZ; SFf7R: $fans['avatar'] = $myheadimg; goto vC4Br; AMuen: message('充值失败，请重新充值！', $this->createWebUrl('fansmanager', array("op" => "recharge", "id" => $_GPC['id'])), 'error'); goto buXhZ; m5vhq: paNE6: goto w3rOE; A3cVg: YDMGt: goto TgntB; elc5z: if (!empty($profile['id'])) { goto RiSdC; } goto gRnJ2; jxoTh: om8XG: goto DNsd7; ga1sA: pdo_update('mihua_mall_member', array("status" => intval($_GPC['isstatus'])), array("id" => $_GPC['id'], "uniacid" => $_W['uniacid'])); goto TL637; zlxDb: if (is_numeric($_GPC['commission'])) { goto JCJGS; } goto B4ELj; w3rOE: include $this->template('clicklog'); goto M1dDI; EmuGH: VIGPm: goto zcb1k; Pq75w: $status = array("status" => $_GPC['status'], "content" => trim($_GPC['content'])); goto EwoUK; ZRHWA: wzRs_: goto vxtYl; F5IKz: message('已过期'); goto TH52l; qLZQP: $level2 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and  shareid = ' . $profile['id']); goto WfMvr; untfD: NaHtc: goto x8oLM; x0g_Y: $mlist = pdo_fetchall('SELECT `name`,`title` FROM ' . tablename('modules')); goto KNXKQ; EJ7th: if (!($op == 'user')) { goto P8s7g; } goto LPnB7; UyYBg: lR5vo: goto r7zgM; OmOB7: fclrO: goto gXWss; ejYAA: exit; goto Z5f24; hBE3S: $rowindex = 0; goto mTFS7; yIUWU: $commission = pdo_fetchcolumn('select commission from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto azzJ5; Al_U9: $from_user = $_GET['from_user']; goto IjXWB; nUrGZ: message('设置用户权限失败，请重新设置！', $this->createWebUrl('fansmanager', array("op" => "detail", "id" => $_GPC['id'])), 'error'); goto J6Zd4; X04zl: global $_W, $_GPC; goto qQmmg; DNsd7: S0faS: goto QxloQ; yVoQU: exit; goto r1lG1; mN5Vj: e0CSy: goto Omtnm; PDIhb: $from_user = $_GPC['from_user']; goto EZ88z; F7QbL: if ($_GPC['opp'] == 'nocheck') { goto YDMGt; } goto nUrGZ; GEmZh: if ($_GPC['opp'] == 'nocheck') { goto aGyMU; } goto S8i13; nzEhp: H9aVz: goto p3_Mw; QWKhP: $str = trim($str, ','); goto Y_E4w; hw2cK: $id = $_GPC['id']; goto OOTbl; kwHQE: $count = 0; goto jbyV8; G38ky: $pager = pagination($total, $pindex, $psize); goto flA3d; J6Zd4: goto om8XG; goto A3cVg; pW6pi: Z2gsW: goto e71UM; eWeiH: $list = pdo_fetchall('select sale.*,mc_members.credit1,mc_members.avatar,mc_members.mobile from ' . tablename('mihua_mall_member') . ' sale left join ' . tablename('mc_members') . ' mc_members on sale.uid=mc_members.uid where sale.flag = 1 and sale.uniacid = ' . $_W['uniacid'] . ' ORDER BY sale.id DESC limit ' . ($pindex - 1) * $psize . ',' . $psize); goto sqbbD; TH52l: return; goto LXg9N; p3_Mw: $temp = pdo_update('mihua_mall_member', $status, array("id" => $_GPC['id'])); goto yMzum; enxzK: message('打款成功！', referer(), 'success'); goto GoA5H; GoA5H: zVV5l: goto n9zbV; oAHqL: $level3 = pdo_fetchall('select id from ' . tablename('mihua_mall_member') . ' where id!=shareid and shareid in( ' . $str . ')'); goto hBE3S; pwb5l: if (!($op == 'post')) { goto Nu9nG; } goto n7Tzq; EZ88z: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto w1RUu; w0X_Z: $count3 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto PbBjg; GWPPd: foreach ($mlist as $k => $v) { $mtype[$v['name']] = $v['title']; MfGfH: } goto SF1DC; PbEsd: pdo_update('mihua_mall_member', array("commission" => $commission + $_GPC['commission']), array("id" => $id)); goto y3R63; Omtnm: if (!(true && $cfg['globalCommissionLevel'] >= 3 && $mylist2)) { goto QLSsG; } goto oAHqL; yETd0: include $this->template('fansmanager_recharge'); goto ejYAA; Kzt66: IkTvp: goto BBoe9; PbBjg: $mylist3 = pdo_fetchall('	select * ,3 as level from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and ( fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto rxJ38; dttXR: goto tyF0m; goto N75Oh; w1RUu: if ($profile) { goto yZY1U; } goto zHXuK; azzJ5: if (empty($temp)) { goto tWk81; } goto PbEsd; kPTvy: PzV9G: goto I1xvM; Nc6LG: $mylist1 = pdo_fetchall('	select *,1 as level from ' . tablename('mc_mapping_fans') . " fans where  openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}"); goto MGUGT; FV1Ra: JCJGS: goto y0__M; lQXXm: $count2 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ")) and fans.uniacid={$_W['uniacid']}"); goto hYIob; yvbIe: $list = pdo_fetchall('select qmxk.*,fans.*, mc_members.avatar from ' . tablename('mihua_mall_member') . ' qmxk left join ' . tablename('mc_mapping_fans') . ' fans on qmxk.from_user=fans.openid left join ' . tablename('mc_members') . ' mc_members  on qmxk.uid=mc_members.uid  and qmxk.uniacid=fans.uniacid where qmxk.flag = ' . $status . ' and qmxk.uniacid =' . $_W['uniacid'] . ' and qmxk.realname like \'%' . $sort['realname'] . '%\' and qmxk.mobile like \'%' . $sort['mobile'] . '%\' group by fans.openid ORDER BY qmxk.id DESC'); goto AoJZ1; dgqbV: $commission = array(); goto tRAUx; NRM2d: $commission = array(); goto A34_z; QVKsY: $commission = empty($commission) ? 0 : $commission; goto ORhPH; Z5f24: i9p0x: goto rZjh8; lj_cA: message('设置用户权限成功！', $this->createWebUrl('fansmanager'), 'success'); goto RaoAW; jtyV8: include $this->template('fansmanagered'); goto WuXae; x8oLM: include $this->template('fansmanagered_detail'); goto y0PvB; PZaQ_: gSa1Z: goto QWKhP; KNXKQ: $mtype = array(); goto GWPPd; flA3d: $list = pdo_fetchall('SELECT * FROM ' . tablename('paylog') . ' WHERE openid=\'' . $_GPC['from_user'] . '\' AND type=\'zhifu\' AND uniacid=' . $_W['uniacid'] . ' ORDER BY plid DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto x0g_Y; yp09D: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where    mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto hIBjg; JDy1x: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto wmO6j; rInS8: exit; goto OmOB7; zHXuK: message('请选择会员！', create_url('site/module', array("do" => "zhifu", "op" => "list", "name" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto TxWoF; pigo1: $psize = 20; goto jXlAe; WfMvr: $rowindex = 0; goto rHOFI; TL637: $op = 'display'; goto Kzt66; bZjEC: Nu9nG: goto MIMez; TgntB: message('设置用户权限失败，请重新设置！', $this->createWebUrl('fansmanager', array("op" => "detail", "opp" => "nocheck", "id" => $_GPC['id'])), 'error'); goto jxoTh; y0__M: $recharged = array("uniacid" => $_W['uniacid'], "mid" => $id, "flag" => 1, "content" => trim($_GPC['content']), "commission" => $_GPC['commission'], "createtime" => time()); goto EbOFe; qNxe3: QtDo5: goto Rt6BL; Hartn: $status = 0; goto n1TR6; EwoUK: if (!($_GPC['opp'] == 'nocheck' && $_GPC['flag'] == 1)) { goto H9aVz; } goto B1BVK; gVOhJ: $myheadimg = pdo_fetchcolumn('SELECT avatar FROM ' . tablename('mc_members') . 'mc_members left join ' . tablename('mc_mapping_fans') . ' fans on fans.uid=mc_members.uid WHERE  mc_members.uniacid = :uniacid
																			AND fans.openid = :from_user LIMIT 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto SFf7R; y1XYt: if (!($_GPC['opp'] == 'nocheck')) { goto QtDo5; } goto jtyV8; Q4kAj: foreach ($mylist1 as $key => $value) { goto fTllf; XiH3l: c0pjU: goto VBVJP; gvDj5: $mylist1[$key]['avatar'] = $value['avatar']; goto hgjw6; eHfJ6: $value = mc_fetch($value['uid'], array("avatar", "createtime")); goto gvDj5; fTllf: if (!$value['uid']) { goto c0pjU; } goto eHfJ6; VBVJP: JoimN: goto v0Mnb; hgjw6: $mylist1[$key]['createtime'] = $value['createtime']; goto XiH3l; v0Mnb: } goto vwndO; lLXc2: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $id); goto vAWz_; rkHQ5: goto slVXs; goto tax8n; xUMY_: include $this->template('fansmanagered'); goto yVoQU; Nee4z: $status['flagtime'] = TIMESTAMP; goto nzEhp; n1TR6: tyF0m: goto yvbIe; vAWz_: $commission = pdo_fetchcolumn('select sum(commission) from ' . tablename('mihua_mall_commission') . ' where mid = ' . $id . ' and flag = 0 and uniacid = ' . $_W['uniacid']); goto QVKsY; mTFS7: $str3 = ''; goto T5c17; ZWDyW: $id = $_GPC['id']; goto JDy1x; n9zbV: LRFN9: goto PDIhb; obkjw: $opp = $_GPC['opp']; goto tU_D9; I1xvM: kuJuq: goto kwHQE; PorZE: foreach ($level2 as &$citem) { $str = $str . $citem['id'] . ','; H_d1E: } goto PZaQ_; jXlAe: $list = pdo_fetchall('select sale.*,mc_members.credit1,mc_members.avatar,mc_members.mobile  from ' . tablename('mihua_mall_member') . ' sale left join ' . tablename('mc_members') . ' mc_members on sale.uid=mc_members.uid where sale.flag = 0 and sale.uniacid = ' . $_W['uniacid'] . ' ORDER BY sale.id DESC limit ' . ($pindex - 1) * $psize . ',' . $psize); goto t05Qa; RaoAW: goto pTqj5; goto pW6pi; iN1AJ: jd3sF: goto EmuGH; LPnB7: $from_user = $_GPC['from_user']; goto Al_U9; LR1yM: if (!($op == 'sort')) { goto Xcnpk; } goto obkjw; vxtYl: if (!($op == 'nocheck')) { goto f9BT3; } goto eg4BY; Rt6BL: Xcnpk: goto EJ7th; yMzum: if (empty($temp)) { goto QLobw; } goto US6aB; y0PvB: Wvgbv: goto rInS8; MIMez: } public function doWebZhifu() { goto YfQng; lDYLr: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE zhifu>0 and uniacid=' . $_W['uniacid'] . '  AND status = 1 and flag = 1  ORDER BY commission DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto HTwNb; lxeFD: $mlist = pdo_fetchall('SELECT `name`,`title` FROM ' . tablename('modules')); goto UNnLR; HTwNb: goto w28IK; goto W8sHC; WsDse: w28IK: goto YbHcj; hCRfB: if (!($op == 'list')) { goto yoAkk; } goto MrshY; oHFyz: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_member') . ' WHERE zhifu>0 and status = 1 and flag = 1 and uniacid = :uniacid ', array(":uniacid" => $_W['uniacid'])); goto ee1XM; QS_tr: $this->adminMessage('请先在参数设置，设置佣金打款限额！', $this->createWebUrl('Commission'), 'success'); goto zg60H; g0uvf: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto ayO68; W1atI: $op = trim($_GPC['op']) ? trim($_GPC['op']) : 'list'; goto WrVM9; YbHcj: include $this->template('zhifu'); goto xlDba; DYZWN: $uniacid = $_W['uniacid']; goto KNlOi; YfQng: global $_W, $_GPC; goto lrocp; xQcxn: if ($zhifucommission) { goto RNT9x; } goto QS_tr; GxLi2: $psize = 20; goto DYZWN; FakGV: $zhifucommission = $cfg['zhifuCommission']; goto xQcxn; q3Uqw: Jz_NM: goto uPJLA; mwi0q: gIv3i: goto uoJPA; LJTAd: $chargenum = round($_GPC['chargenum'], 2); goto VNQ75; vREH_: if (!empty($_GPC['from_user'])) { goto beKXd; } goto ABxPX; Gvv_s: g8uKT: goto sY4id; dmU29: TPzxz: goto afFDO; ayO68: if ($profile) { goto TPzxz; } goto WR4go; ABxPX: $this->adminMessage('请选择会员！', create_url('site/module', array("do" => "zhifu", "op" => "list", "name" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto gKoi2; WqoBi: if (!($op == 'post')) { goto ZR2Cg; } goto vREH_; FatZC: $realname = $_GPC['realname']; goto l4Gke; MrshY: if (!($_GPC['submit'] == '搜索')) { goto LpbY2; } goto LHf0D; RlysX: LpbY2: goto M0wKU; WR4go: $this->adminMessage('请选择会员！', create_url('site/module', array("do" => "zhifu", "op" => "list", "name" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto dmU29; l4Gke: goto U687W; goto Gvv_s; ee1XM: $pager = pagination($total, $pindex, $psize); goto PEFfU; T4oqe: $total = count($list); goto mm0W0; tnhP9: $this->adminMessage('打款成功！', referer(), 'success'); goto q3Uqw; Li9Xg: if (empty($_GPC['realname'])) { goto g8uKT; } goto FatZC; fehx7: $pindex = max(1, intval($_GPC['page'])); goto GxLi2; uCig1: U687W: goto hCRfB; mm0W0: include $this->template('zhifu'); goto FQoC8; N7yQv: $paylog = array("type" => "zhifu", "uniacid" => $uniacid, "openid" => $_GPC['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $chargenum, "module" => "mihua_mall", "tag" => ' 后台打款' . $chargenum . '元'); goto LUSvL; LHf0D: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_member') . ' where realname = "' . $realname . '" and zhifu>0 and status = 1 and flag = 1  and uniacid = ' . $_W['uniacid'] . ' order by commission desc'); goto T4oqe; KNlOi: $from_user = $_GPC['from_user']; goto W1atI; afFDO: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('paylog') . ' WHERE  openid=\'' . $_GPC['from_user'] . '\' AND type=\'zhifu\' AND `uniacid` = ' . $_W['uniacid']); goto KKdjd; UNnLR: $mtype = array(); goto FIEZQ; TUW9V: if (!checksubmit()) { goto SsSAm; } goto LJTAd; W8sHC: MS3U1: goto oHFyz; gKoi2: beKXd: goto TUW9V; M0wKU: if (intval($_GPC['so']) == 1) { goto MS3U1; } goto vXeNb; FQoC8: exit; goto RlysX; VNQ75: if (!$chargenum) { goto Jz_NM; } goto eECBJ; O0zeZ: return; goto N7yQv; eECBJ: $this->adminMessage('已过期'); goto O0zeZ; KKdjd: $pager = pagination($total, $pindex, $psize); goto YBvog; vXeNb: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_member') . ' WHERE zhifu>0 and status = 1 and flag = 1  AND `uniacid` = :uniacid', array(":uniacid" => $_W['uniacid'])); goto WkNGr; uoJPA: include $this->template('zhifu_post'); goto E07O8; sY4id: $realname = 0; goto uCig1; lrocp: $this->__web2(); goto fehx7; YBvog: $list = pdo_fetchall('SELECT * FROM ' . tablename('paylog') . ' WHERE openid=\'' . $_GPC['from_user'] . '\' AND type=\'zhifu\' AND uniacid=' . $_W['uniacid'] . ' ORDER BY plid DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto lxeFD; LUSvL: pdo_insert('paylog', $paylog); goto tnhP9; WkNGr: $pager = pagination($total, $pindex, $psize); goto lDYLr; uPJLA: SsSAm: goto sX3Km; sX3Km: $from_user = $_GPC['from_user']; goto g0uvf; FIEZQ: foreach ($mlist as $k => $v) { $mtype[$v['name']] = $v['title']; kZ9kY: } goto mwi0q; xlDba: yoAkk: goto WqoBi; PEFfU: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_member') . '  WHERE zhifu>0 and uniacid=' . $_W['uniacid'] . '  AND status = 1 and flag = 1 ORDER BY commission DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto WsDse; zg60H: RNT9x: goto Li9Xg; WrVM9: $cfg = $this->module['config']; goto FakGV; E07O8: ZR2Cg: goto Yq3dS; Yq3dS: } public function doWebRedpack_send() { goto IYKYs; oN5W3: pdo_insert('mihua_mall_red', array("openid" => $_GPC['from_user'], "commission_flag" => 1, "money" => $send_money, "addtime" => TIMESTAMP, "uniacid" => $_W['uniacid'])); goto q2Wm_; J3CyZ: if ($user_result['balance'] >= 200) { goto jYN3G; } goto X20I2; c0xPR: $user_result = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where from_user=:from_user  ', array("from_user" => $_GPC['from_user'])); goto mb3Uo; IYKYs: global $_GPC, $_W; goto c0xPR; m38Q3: $send_money = 200; goto HjKNr; lNIIp: RYpuE: goto nJAhw; USBI7: goto pCJ02; goto OYbbE; tWGfg: $send_money = $user_result['balance']; goto USBI7; ehF8H: $have_send = $user_result['zhifu'] + $send_money; goto zFd3W; u2FNt: if (!($send_money < 1)) { goto eJhHx; } goto M1Nkf; oTeNw: $class_redBao->openid = $_GPC['from_user']; goto Wf7FU; hg7wC: $this->adminMessage($re, '', 'error'); goto yAbjp; geNJr: Y3viR: goto ehF8H; yAbjp: goto RYpuE; goto geNJr; zFd3W: pdo_update('mihua_mall_member', array("zhifu" => $have_send, "commission" => $have_send, "balance" => $balance), array("from_user" => $_GPC['from_user'])); goto oN5W3; GoxGL: if ($re == 1) { goto Y3viR; } goto hg7wC; M1Nkf: $this->adminMessage('红包金额小于1元'); goto kkjeR; mb3Uo: if (!(!$user_result || $user_result['balance'] <= 0)) { goto P2vnJ; } goto ahOEt; HjKNr: pCJ02: goto u2FNt; X20I2: $balance = 0; goto tWGfg; Wf7FU: $class_redBao->money = $send_money; goto gYwnv; u9YNo: $class_redBao = C('redBao'); goto oTeNw; q2Wm_: $this->adminMessage('红包发送成功', '', 'success'); goto lNIIp; ahOEt: $this->adminMessage('没有此用户或者用户佣金为0', '', 'error'); goto kS0xf; OYbbE: jYN3G: goto nWzTY; gYwnv: $re = $class_redBao->send(); goto GoxGL; kkjeR: eJhHx: goto u9YNo; nWzTY: $balance = $user_result['balance'] - 200; goto m38Q3; kS0xf: P2vnJ: goto J3CyZ; nJAhw: } public function doMobileRedpack_send() { $this->doWebRedpack_send(); } public function dowebprocessFile() { goto Hf1Yt; OdsxW: $dir = MODULE_ROOT . '/cert/' . $_W['uniacid'] . '/'; goto erje7; Hf1Yt: global $_GPC, $_W; goto u14k1; aQzhy: $ret['file'] = $fileName; goto JzoOj; HV32w: if (is_array($_FILES['myfile']['name'])) { goto zr0fJ; } goto UztqF; UztqF: $fileName = $_FILES['myfile']['name']; goto E686n; FR6AD: $ret = array(); goto OdsxW; erje7: file_exists($dir) || mkdir($dir, 0777, true) && chmod($dir, 0777); goto HV32w; u14k1: if (!isset($_FILES['myfile'])) { goto jI0Vl; } goto FR6AD; JzoOj: zr0fJ: goto JZve6; JZve6: echo json_encode($ret); goto nTsD8; E686n: move_uploaded_file($_FILES['myfile']['tmp_name'], $dir . $fileName); goto aQzhy; nTsD8: jI0Vl: goto BrxGK; BrxGK: } public function doWebCharge() { goto hvAji; zE3JG: B_JRK: goto p7uAe; bIq6z: goto QnnbW; goto NVXck; zJRCG: $this->adminMessage('充值积分不能为负数或者0', referer(), 'error'); goto kdFCh; PexVo: include $this->template('charge'); goto hry_k; GsmXl: JxJAA: goto Rx9cY; Tl6Fx: l2SmZ: goto hBgPh; cJOsl: if (!checksubmit()) { goto Lbz2d; } goto V3ezo; IfPmE: $pager = pagination($total, $pindex, $psize); goto bGBm2; l0Tsr: eFJgp: goto GplSK; CWTH7: iRcHD: goto eiGuG; uGqEA: $this->adminMessage('请选择会员！', create_url('site/entry', array("do" => "charge", "op" => "list", "m" => "mihua_mall", "uniacid" => $_W['uniacid'])), 'success'); goto aEdNK; tD6QF: DhK5N: goto ua82L; POaaQ: $op = trim($_GPC['op']) ? trim($_GPC['op']) : 'list'; goto MAPT0; AUBYH: S1crm: goto lGWMh; Jepi8: $list = pdo_fetchall('SELECT * FROM ' . tablename('core_paylog') . ' WHERE openid=\'' . $mapping_fans['openid'] . '\' AND type=\'' . $_GPC['chargeType'] . '\' AND uniacid=' . $_W['uniacid'] . ' ORDER BY plid DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto tr9ec; kypfp: die(json_encode(array("result" => 1, "str" => "上级不能是同一用户"))); goto EtEIZ; DGvJy: $list = pdo_fetchall('SELECT * FROM ' . tablename('mc_members') . '  WHERE uniacid=' . $_W['uniacid'] . '  AND mobile = \'' . $_GPC['mobile'] . '\' '); goto bIq6z; K_KDO: include $this->template('charge'); goto xR6i1; Edfhn: $this->adminMessage('请选择会员！', $this->createWebUrl('charge', array("op" => "list")), 'error'); goto ZEkDr; uWh_e: if ($profile) { goto iRcHD; } goto IPqy2; IPqy2: create_url('site/entry', array("do" => "charge", "op" => "list", "m" => "mihua_mall", "uniacid" => $_W['uniacid']), 'success'); goto CWTH7; AYgHv: $uniacid = $_W['uniacid']; goto POaaQ; l8n4j: $pager = pagination($total, $pindex, $psize); goto Jepi8; Rx9cY: if (!($shareid > 0 && $uid > 0)) { goto imIk2; } goto y3N3Y; hgL7_: Kxt80: goto vgY7u; NVXck: Y5HkP: goto U8CEU; A4r89: $paylog = array("type" => "charge", "uniacid" => $uniacid, "openid" => $mapping_fans['openid'], "tid" => date('Y-m-d H:i:s'), "fee" => $chargenum, "module" => "mihua_mall", "tag" => ' 后台充值' . $chargenum . '元', "encrypt_code" => $_W['uid']); goto zLru3; tMANZ: if (!($_GPC['submit'] == '搜索')) { goto xA7t7; } goto nShOS; aEdNK: d4ZyH: goto gKQ9w; rxor_: die(json_encode(array("result" => 1, "str" => '获取信息失败,shareid:' . $shareid . ', uid:' . $uid))); goto QY3Bb; kZwzA: if (!($op == 'exchangeLevel')) { goto B_JRK; } goto IT1nj; gvUXy: if (!($op == 'delete')) { goto ZQX1d; } goto pymUl; XmlpU: foreach ($mlist as $k => $v) { $mtype[$v['name']] = $v['title']; eGRVl: } goto AUBYH; c7lMU: $this->adminMessage('充值成功！', referer(), 'success'); goto pujz2; QY3Bb: exit; goto zE3JG; T5HsW: exit; goto SiJdI; dZ5ey: if (!$credit1num) { goto Z1FRj; } goto rh1L5; EtEIZ: exit; goto GsmXl; VlVTm: $paylog = array("type" => "credit1", "uniacid" => $uniacid, "openid" => $mapping_fans['openid'], "tid" => date('Y-m-d H:i:s'), "fee" => $credit1num, "module" => "mihua_mall", "tag" => ' 充值' . $credit1num . '积分', "encrypt_code" => $_W['uid']); goto M80yd; pymUl: if (!empty($_GPC['uid'])) { goto ZUpa7; } goto Edfhn; y3N3Y: pdo_update('mihua_mall_member', array("shareid" => $shareid), array("id" => $uid, "uniacid" => $_W['uniacid'])); goto wwRwF; xRC7d: $pindex = max(1, intval($_GPC['page'])); goto lXndE; hry_k: exit; goto y4Kdk; ZEkDr: ZUpa7: goto srGaO; fwrni: $this->__web2(); goto mKiQb; pISpp: ZQX1d: goto kZwzA; SiJdI: imIk2: goto rxor_; nU10i: if ($_GPC['realname']) { goto Y5HkP; } goto b1VBb; tdhp3: if (!($_GPC['chargeType'] == 'credit1')) { goto Kxt80; } goto Y3YVr; vgY7u: Bnnq1: goto gvUXy; lXndE: $psize = 20; goto AYgHv; MPTEn: foreach ($list as $key => $row) { goto mjicN; xrhWf: if ($shareid) { goto D2LYQ; } goto sPJ4E; mjicN: $shareid = pdo_fetch('SELECT id,shareid from ' . tablename('mihua_mall_member') . ' where uniacid=' . $_W['uniacid'] . " and uid={$row['uid']}"); goto jyB_I; UiPhP: DhWWd: goto cmj2B; YzL7c: D2LYQ: goto m4RFQ; mDADQ: goto TXI76; goto YzL7c; HtPaE: $list[$key]['adminflag'] = pdo_fetchcolumn('SELECT COUNT(*) from ' . tablename('mihua_mall_admin') . ' where uniacid=' . $_W['uniacid'] . " and uid={$row['uid']}"); goto xrhWf; sPJ4E: unset($list[$key]); goto mDADQ; Ojm2c: TXI76: goto UiPhP; m4RFQ: $list[$key]['parent'] = pdo_fetchcolumn('SELECT case when realname<>\'\' then realname else nickname end realname FROM ' . tablename('mc_members') . ' WHERE uid=(SELECT uid FROM ' . tablename('mihua_mall_member') . ' WHERE uniacid=' . $_W['uniacid'] . " and id={$shareid['shareid']} )"); goto Ojm2c; jyB_I: $list[$key]['mid'] = $shareid['id']; goto HtPaE; cmj2B: } goto NHjv_; T1AaQ: if (!$chargenum) { goto l2SmZ; } goto DZv2h; nShOS: if ($_GPC['mobile']) { goto NbywX; } goto nU10i; TNUgQ: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid  and  realname !=\'\'  ', array(":uniacid" => $_W['uniacid'])); goto IfPmE; hvAji: global $_W, $_GPC; goto fwrni; ui5b5: Ug7P5: goto bNjLD; LmmOK: $profile = fans_search($_GPC['uid']); goto uWh_e; U8CEU: $gprealname = $_GPC['realname']; goto KRdfb; bNjLD: if (!(intval($_GPC['credit1num']) <= 0)) { goto uzFfP; } goto zJRCG; gLAa8: if (!($_GPC['chargeType'] == 'charge')) { goto nsetl; } goto YdITE; kdFCh: uzFfP: goto rjsD1; M80yd: pdo_insert('core_paylog', $paylog); goto c7lMU; vMrlZ: if (!($shareid == $uid)) { goto JxJAA; } goto kypfp; NHjv_: cjI5A: goto MISs8; bGBm2: if (!($total > 0)) { goto kzL17; } goto BHOey; srGaO: $fans_result = pdo_fetch('select * from ' . tablename('mc_mapping_fans') . ' where uid=:uid ', array(":uid" => $_GPC['uid'])); goto adb7t; xR6i1: exit; goto tD6QF; mKiQb: load()->model('user'); goto xRC7d; adb7t: $user_result = pdo_fetch('select * from ' . tablename('mc_members') . ' where uid=:uid ', array(":uid" => $_GPC['uid'])); goto CSVfC; MISs8: $total = count($list); goto PexVo; w_oGe: goto QnnbW; goto XGw9c; GplSK: kzL17: goto K_KDO; mSou0: Lbz2d: goto LmmOK; DdxZL: include $this->template('charge_post'); goto p9udt; LSb6E: $this->adminMessage('删除成功', $this->createWebUrl('charge', array("op" => "list")), 'success'); goto pISpp; ZkEb0: QnnbW: goto MPTEn; gKQ9w: $mapping_fans = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE `uid` = :uid', array(":uid" => $_GPC['uid'])); goto cJOsl; hBgPh: nsetl: goto d2tBh; tr9ec: $mlist = pdo_fetchall('SELECT `name`,`title` FROM ' . tablename('modules')); goto tUrjd; ua82L: if (!($op == 'post')) { goto Bnnq1; } goto MSALt; KRdfb: $list = pdo_fetchall('SELECT * FROM ' . tablename('mc_members') . '  WHERE uniacid=' . $_W['uniacid'] . "  AND (realname like '%{$_GPC['realname']}%' or nickname like '%{$_GPC['realname']}%' )"); goto ZkEb0; iUFrC: bxeqO: goto mSou0; eiGuG: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('core_paylog') . ' WHERE  openid=\'' . $mapping_fans['openid'] . '\' AND type=\'' . $_GPC['chargeType'] . '\' AND `uniacid` = ' . $_W['uniacid']); goto l8n4j; DZv2h: pdo_update('mc_members', array("credit2" => $user_result['credit2'] + $chargenum), array("uid" => $_GPC['uid'], "uniacid" => $_W['uniacid'])); goto A4r89; rh1L5: pdo_update('mc_members', array("credit1" => $user_result['credit1'] + $credit1num), array("uid" => $_GPC['uid'], "uniacid" => $_W['uniacid'])); goto VlVTm; fO5GF: if (!is_int($_GPC['credit1num'])) { goto Ug7P5; } goto dUtFN; lwNJw: $this->adminMessage('打款成功！', referer(), 'success'); goto Tl6Fx; vTUZ7: foreach ($list as $key => $row) { goto S0zM6; PlkK5: Sy1ZG: goto YYtmJ; cbbUs: $list[$key]['parent'] = pdo_fetchcolumn('SELECT case when realname<>\'\' then realname else nickname end realname FROM ' . tablename('mc_members') . ' WHERE uid=(SELECT uid FROM ' . tablename('mihua_mall_member') . " WHERE id={$row['shareid']} )"); goto PlkK5; NNRt0: if (!$row['shareid']) { goto Sy1ZG; } goto cbbUs; LYWrh: $list[$key]['nickname'] = $mc_data['nickname']; goto S8g_c; S8g_c: $list[$key]['avatar'] = $mc_data['avatar']; goto tJVKS; Whtax: gUCoS: goto pDIcv; DHcnV: $list[$key]['mid'] = $shareid['id']; goto Whtax; EJuvz: $list[$key]['uid'] = $mc_data['uid']; goto NNRt0; S0zM6: $mc_data = pdo_fetch('SELECT m.nickname,m.uid,m.avatar,m.realname FROM ' . tablename('mc_members') . ' m 	WHERE m.uid=:uid', array(":uid" => $row['uid'])); goto LYWrh; tJVKS: $list[$key]['realname'] = $mc_data['realname']; goto EJuvz; YYtmJ: $shareid = pdo_fetch('SELECT id,shareid from ' . tablename('mihua_mall_member') . ' where uniacid=:uniacid and uid=:uid', array(":uniacid" => $_W['uniacid'], ":uid" => $row['uid'])); goto DHcnV; pDIcv: } goto l0Tsr; J8Xmn: $gpmobile = $_GPC['mobile']; goto DGvJy; V3ezo: $user_result = pdo_fetch('select * from ' . tablename('mc_members') . ' where uid=:uid and uniacid=:uniacid ', array("uid" => $_GPC['uid'], "uniacid" => $_W['uniacid'])); goto gLAa8; MAPT0: if (!($op == 'list')) { goto DhK5N; } goto tMANZ; zLru3: pdo_insert('core_paylog', $paylog); goto lwNJw; wwRwF: die(json_encode(array("result" => 0))); goto T5HsW; kD3E2: $uid = intval($_GPC['uid']); goto vMrlZ; YdITE: $chargenum = round($_GPC['chargenum'], 2); goto T1AaQ; lGWMh: if (!($_GPC['chargeType'] == 'charge')) { goto AclPC; } goto DdxZL; b1VBb: $list = pdo_fetchall('SELECT * FROM ' . tablename('mc_members') . '  WHERE uniacid=' . $_W['uniacid'] . '  and nickname >0  LIMIT 20'); goto w_oGe; p9udt: AclPC: goto tdhp3; BHOey: $list = pdo_fetchall('SELECT m.* FROM ' . tablename('mihua_mall_member') . ' m  
				WHERE m.uniacid=' . $_W['uniacid'] . '   and m.realname !=\'\'   ORDER BY m.id DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto vTUZ7; CSVfC: pdo_delete('mihua_mall_member', array("from_user" => $fans_result['openid'], "uniacid" => $_W['uniacid'])); goto LSb6E; MSALt: if (!empty($_GPC['uid'])) { goto d4ZyH; } goto uGqEA; y4Kdk: xA7t7: goto TNUgQ; pujz2: Z1FRj: goto iUFrC; IT1nj: $shareid = intval($_GPC['shareid']); goto kD3E2; XGw9c: NbywX: goto J8Xmn; d2tBh: if (!($_GPC['chargeType'] == 'credit1')) { goto bxeqO; } goto fO5GF; rjsD1: $credit1num = intval($_GPC['credit1num']); goto dZ5ey; dUtFN: $this->adminMessage('充值积分必须是整数！', referer(), 'error'); goto ui5b5; tUrjd: $mtype = array(); goto XmlpU; Y3YVr: include $this->template('charge_post_credit1'); goto hgL7_; p7uAe: } public function doWebSetAdmin() { goto Koaho; iuul7: $this->adminMessage('操作失败！', referer(), 'error'); goto hVdrC; JAyhm: QrTW6: goto B2c9j; VKDK1: if (!($op == 'manage')) { goto QrTW6; } goto P4TOW; jMf7e: $result = pdo_delete('mihua_mall_admin', array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto a4sLg; i6OYD: NNFto: goto VKDK1; KjfSq: $this->adminMessage('设置管理员成功！', $this->createWebUrl('setAdmin', array("op" => "list", "uniacid" => $_W['uniacid'])), 'success'); goto yhi3s; a4sLg: if ($result) { goto J4Dd7; } goto LDTyD; pM7eM: $this->adminMessage('请选择会员！'); goto i6OYD; GX_RF: if (!empty($from_user['uuid'])) { goto oA3Xh; } goto abXRU; nzQ8Q: EeyRW: goto L5V4W; qkNu1: $from_user = pdo_fetch('select a.from_user,a.uid as uuid,m.uid from ' . tablename('mihua_mall_member') . 'a' . ' left join ' . tablename('mc_mapping_fans') . ' m on a.from_user = m.openid and a.uniacid= m.uniacid ' . "where m.uid='{$uid}' and m.uniacid = " . $_W['uniacid']); goto Idq2p; E4p9H: $op = trim($_GPC['op']) ? trim($_GPC['op']) : 'list'; goto PMFEj; xn2O1: DTI2W: goto qkNu1; CmHM3: Z2XVT: goto y_fdH; gT6Lm: $result = pdo_update('mihua_mall_admin', array("msg_flag" => 0), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto WXSqX; uf4aW: $this->adminMessage('该会员已是管理员！'); goto xn2O1; Aw7Ln: oA3Xh: goto ipNID; iihsx: ytX3U: goto zDVwU; rIMnm: J4Dd7: goto ilJoJ; u3l1P: HAAJ9: goto n9A6Q; ujl6f: PUXoT: goto nzQ8Q; zDVwU: $this->adminMessage('取消管理员消息通知成功！', $this->createWebUrl('setAdmin', array("op" => "list", "uniacid" => $_W['uniacid'])), 'success'); goto H7vzQ; ipNID: $data = array("uniacid" => $_W['uniacid'], "uid" => $uid, "from_user" => $from_user['from_user'], "addtime" => TIMESTAMP); goto lnYQt; N4QcO: include $this->template('admin_manage'); goto snBL4; tsrOW: if (!($op == 'list')) { goto HAAJ9; } goto ZU8Z6; ZU8Z6: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_admin') . ' a ' . ' left join ' . tablename('mc_mapping_fans') . ' m on a.from_user = m.openid and a.uniacid= m.uniacid ' . ' left join ' . tablename('mc_members') . ' f on m.uid=f.uid ' . ' WHERE a.uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto rjtKT; H7vzQ: t7P02: goto Mg5JS; PMFEj: $uid = $_GPC['uid']; goto tsrOW; E5cxo: goto VIitE; goto rIMnm; UV2OJ: $this->adminMessage('添加管理员消息通知成功！', $this->createWebUrl('setAdmin', array("op" => "list", "uniacid" => $_W['uniacid'])), 'success'); goto ujl6f; br9Jd: goto t7P02; goto iihsx; YNHr2: if (!($isadmin > 0)) { goto DTI2W; } goto uf4aW; lnYQt: $result = pdo_insert('mihua_mall_admin', $data); goto WSvTl; kAgij: if ($result) { goto ytX3U; } goto Oorf0; y_fdH: if (!($op == 'msg_cancel')) { goto IRxtG; } goto yQ9tV; yhi3s: oqEpj: goto JAyhm; xbR_3: a0IVS: goto UV2OJ; Idq2p: if (!empty($from_user['from_user'])) { goto O8zW9; } goto Gm13v; H472H: O8zW9: goto GX_RF; n9A6Q: if (!empty($uid)) { goto NNFto; } goto pM7eM; ilJoJ: $this->adminMessage('取消管理员成功！', $this->createWebUrl('setAdmin', array("op" => "list", "uniacid" => $_W['uniacid'])), 'success'); goto FaTkS; VNWmN: C6MP5: goto N4QcO; Oorf0: $this->adminMessage('操作失败！', referer(), 'error'); goto br9Jd; P4TOW: $isadmin = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_admin') . "  where uid='{$uid}'  and uniacid = " . $_W['uniacid']); goto YNHr2; WSvTl: if (empty($result)) { goto oqEpj; } goto KjfSq; Gm13v: $this->adminMessage('管理员设置失败！', $this->createWebUrl('charge', array("uniacid" => $_W['uniacid'])), 'error'); goto H472H; FaTkS: VIitE: goto CmHM3; rjtKT: foreach ($list as $key => $row) { goto LwOll; e6nIo: ai9t4: goto vYAP3; Ei8p3: QW0B5: goto e6nIo; LwOll: if (!$row['uid']) { goto QW0B5; } goto iL67s; LIjMj: if (!$shareid) { goto BIz11; } goto dO7mZ; dO7mZ: $list[$key]['parent'] = pdo_fetchcolumn('SELECT case when realname<>\'\' then realname else nickname end realname FROM ' . tablename('mc_members') . ' WHERE uid=(SELECT uid FROM ' . tablename('mihua_mall_member') . " WHERE id={$shareid['shareid']} )"); goto fZSth; iL67s: $shareid = pdo_fetch('SELECT shareid from ' . tablename('mihua_mall_member') . " where uid={$row['uid']}"); goto LIjMj; fZSth: BIz11: goto Ei8p3; vYAP3: } goto VNWmN; yQ9tV: $result = pdo_update('mihua_mall_admin', array("msg_flag" => 1), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto kAgij; o55tp: if (!($op == 'msg_add')) { goto EeyRW; } goto gT6Lm; hVdrC: goto PUXoT; goto xbR_3; Mg5JS: IRxtG: goto o55tp; snBL4: exit; goto u3l1P; B2c9j: if (!($op == 'manage_cancel')) { goto Z2XVT; } goto jMf7e; WXSqX: if ($result) { goto a0IVS; } goto iuul7; Koaho: global $_W, $_GPC; goto E4p9H; LDTyD: $this->adminMessage('取消管理员失败！', $this->createWebUrl('setAdmin', array("op" => "list", "uniacid" => $_W['uniacid'])), 'error'); goto E5cxo; abXRU: pdo_update('mihua_mall_member', array("uid" => $from_user['uid']), array("from_user" => $from_user['from_user'], "uniacid" => $_W['uniacid'])); goto Aw7Ln; L5V4W: } public function setOrderStock($id = "") { goto c3rKW; c3rKW: global $_W, $_GPC; goto m0UoJ; INJIu: foreach ($goods as $item) { goto Er6h_; eYZTc: $data['sales'] = $item['sales'] + $item['total']; goto OVSR1; vcd9B: $data['total'] = $item['goodstotal'] - $item['total']; goto D6fBz; xnsfP: if (!(!empty($item['goodstotal']) && $item['goodstotal'] != -1)) { goto YJe_X; } goto vcd9B; FqtIo: $item['orderstatus'] = 1; goto LVTSw; D6fBz: YJe_X: goto eYZTc; xKuld: Muyqs: goto blmu0; Er6h_: if (!($item['orderstatus'] >= 2)) { goto GSXYi; } goto FqtIo; LVTSw: GSXYi: goto zqTqM; GLlKH: $data = array(); goto xnsfP; OVSR1: pdo_update('mihua_mall_goods', $data, array("id" => $item['id'])); goto E9wwL; zqTqM: if (!($item['totalcnf'] <= 2 && $item['totalcnf'] == $item['orderstatus'])) { goto Dmlcv; } goto HK2Dc; X92hx: pdo_query('update ' . tablename('mihua_mall_goods_option') . ' set stock=stock-:stock where id=:id', array(":stock" => $item['total'], ":id" => $item['optionid'])); goto PDLuN; E9wwL: Dmlcv: goto xKuld; HK2Dc: if (empty($item['optionid'])) { goto Ce6jn; } goto X92hx; PDLuN: Ce6jn: goto GLlKH; blmu0: } goto IIpqu; IIpqu: jzMaV: goto qrnet; wgdKg: $goods = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit, g.marketprice,g.total as 
		goodstotal,o.total,o.optionid,g.sales,g.totalcnf,r.status as orderstatus FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id and  o.uniacid= g.uniacid' . ' left join ' . tablename('mihua_mall_order') . ' r on r.id=o.orderid and  r.uniacid=o.uniacid' . " WHERE o.orderid='{$id}' and g.uniacid='{$uniacid}' "); goto INJIu; m0UoJ: $uniacid = $_W['uniacid']; goto wgdKg; qrnet: } public function sendgmsptz($ordersn, $orderprice, $agentname, $to_from_user) { goto CSUw7; aprOm: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "gmsptz")); goto FfNRE; QTRLB: $message2 = str_replace('{order_sn}', $ordersn, $message1); goto gQ587; jWfNf: $this->sendcustomMsg($to_from_user, $message); goto nyTSL; DwurV: $message = str_replace('{time}', $time, $message3); goto jWfNf; NFSxD: $time = date('Y-m-d H:i:s'); goto aprOm; gQ587: $message3 = str_replace('{agent_name}', $agentname, $message2); goto DwurV; CSUw7: global $_W; goto NFSxD; F9OTP: $message1 = str_replace('{order_price}', $orderprice, $tmsgtemplate['template']); goto QTRLB; nyTSL: EfK0b: goto dzuwW; FfNRE: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto EfK0b; } goto F9OTP; dzuwW: } public function sendtmpmsg($openid, $template_id, $url, $goodstitle, $keyword1, $remark) { $data = '{
                "touser":"' . $openid . '",
                "template_id":"' . $template_id . '",
                "url":"' . $url . '",
                "topcolor":"#000000",
                "data":{
                    "name": {
                        "value":"' . $goodstitle . '",
                        "color":"#000000"   
                    },
                    "keyword1":{
                        "value":"' . $keyword1 . '",
                        "color":"#000000"
                    },                  
                    "remark":{
                        "value":"' . $remark . '",
                        "color":"#fb5100"
                    }
                }
            }'; $this->sendwxmsg($data); } public function sendtmpmsg_deliver($openid, $template_id, $url, $goodstitle, $keyword1, $keyword2, $remark) { $data = '{
                "touser":"' . $openid . '",
                "template_id":"' . $template_id . '",
                "url":"' . $url . '",
                "topcolor":"#000000",
                "data":{
                    "first": {
                        "value":"' . $goodstitle . '",
						"color":"#000000"
                    },
                    "delivername":{
                        "value":"' . $keyword1 . '",
						"color":"#000000"
                    }, 
					"ordername":{
                        "value":"' . $keyword2 . '",
						"color":"#000000"
                    },                  
                    "remark":{
                        "value":"' . $remark . '",
                        "color":"#000000"
                    }
                }
            }'; $this->sendwxmsg($data); } public function sendtmpmsg_red($openid, $template_id, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $remark) { $data = '{
                "touser":"' . $openid . '",
                "template_id":"' . $template_id . '",
                "url":"' . $url . '",
                "topcolor":"#000000",
                "data":{
                    "first": {
                        "value":"' . $goodstitle . '",
						"color":"#000000"
                    },
                   "keyword1":{
                        "value":"' . $keyword1 . '",
						"color":"#000000"
                    }, 
					"keyword2":{
                        "value":"' . $keyword2 . '",
						"color":"#000000"
                    }, 
					"keyword3":{
                        "value":"' . $keyword3 . '",
						"color":"#000000"
                    },           
                    "remark":{
                        "value":"' . $remark . '",
                        "color":"#000000"
                    }
                }
            }'; $this->sendwxmsg($data); } public function sendtmpmsg_order($openid, $template_id, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $keyword4, $keyword5, $remark) { $data = '{
                "touser":"' . $openid . '",
                "template_id":"' . $template_id . '",
                "url":"' . $url . '",
                "topcolor":"#000000",
                "data":{
                    "first": {
                        "value":"' . $goodstitle . '",
						"color":"#EA0913"
                    },
                    "keyword1":{
                        "value":"' . $keyword1 . '",
						"color":"#000000"
                    }, 
					"keyword2":{
                        "value":"' . $keyword2 . '",
						"color":"#000000"
                    }, 
					"keyword3":{
                        "value":"' . $keyword3 . '",
						"color":"#000000"
                    }, 
					"keyword4":{
                        "value":"' . $keyword4 . '",
						"color":"#000000"
                    },  
					"keyword5":{
                        "value":"' . $keyword5 . '",
						"color":"#000000"
                    },                  
                    "remark":{
                        "value":"' . $remark . '",
                        "color":"#000000"
                    }
                }
            }'; $this->sendwxmsg($data); } public function sendtmpmsg_credit($openid, $template_id, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $keyword4, $remark) { $data = '{
                "touser":"' . $openid . '",
                "template_id":"' . $template_id . '",
                "url":"' . $url . '",
                "topcolor":"#000000",
                "data":{
                    "first": {
                        "value":"' . $goodstitle . '",
						"color":"#000000"
                    },
                    "keyword1":{
                        "value":"' . $keyword1 . '",
						"color":"#000000"
                    }, 
					"keyword2":{
                        "value":"' . $keyword2 . '",
						"color":"#000000"
                    }, 
					"keyword3":{
                        "value":"' . $keyword3 . '",
						"color":"#000000"
                    }, 
					"keyword4":{
                        "value":"' . $keyword4 . '",
						"color":"#000000"
                    },              
                    "remark":{
                        "value":"' . $remark . '",
                        "color":"#000000"
                    }
                }
            }'; $this->sendwxmsg($data); } public function sendwxmsg($data) { goto Drww7; ohfnS: $token = $account_api->getAccessToken(); goto qE5Wf; f2BGT: curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE); goto E08Gk; Ycg8r: message('获取access token 失败'); goto nDu7g; oLVfw: $sendurl = 'https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=' . $access_token; goto TBFJh; hm7ui: if (!is_error($token)) { goto RfseI; } goto Ycg8r; ujiK6: if (!is_error($response)) { goto i5ClG; } goto twQXt; qE5Wf: i5ClG: goto kBo0F; Drww7: global $_W; goto Ov40w; Ov40w: $token = $access_token = $this->get_weixin_token(); goto hm7ui; bllOV: $response = ihttp_request($url, urldecode(json_encode($data))); goto ujiK6; QdlPN: $output = curl_exec($curl); goto uzjhf; ktN5f: $reply = json_decode($output, true); goto avrmV; Jybd3: message('消息发送失败，失败原因：' . $reply['errmsg'], $this->createMobileUrl('myorder'), 'error'); goto nOQ8L; Ui149: curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); goto QdlPN; t7r_1: curl_setopt($curl, CURLOPT_URL, $sendurl); goto f2BGT; foz1A: $url = "https://api.weixin.qq.com/cgi-bin/material/add_news?access_token={$token}"; goto bllOV; E08Gk: curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE); goto Ez6JL; nOQ8L: ZbgYe: goto T7QHp; nDu7g: RfseI: goto foz1A; TBFJh: $curl = curl_init(); goto t7r_1; uzjhf: curl_close($curl); goto ktN5f; kBo0F: $access_token = $token; goto oLVfw; twQXt: $account_api->clearAccessToken(); goto ohfnS; Ez6JL: curl_setopt($curl, CURLOPT_POST, 1); goto HNim5; HNim5: curl_setopt($curl, CURLOPT_POSTFIELDS, $data); goto Ui149; avrmV: if (!($reply['errmsg'] != 'ok')) { goto ZbgYe; } goto Jybd3; T7QHp: } public function sendtjrtz($agentname, $to_from_user) { goto yw0QZ; njAfr: $time = date('Y-m-d H:i:s'); goto UYFZO; yw0QZ: global $_W; goto njAfr; mOxLP: $this->sendcustomMsg($to_from_user, $message); goto J_dil; IvUtK: $message = str_replace('{time}', $time, $message2); goto mOxLP; J_dil: GVkub: goto OykeG; IXmQ5: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto GVkub; } goto OVTBE; UYFZO: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtz")); goto IXmQ5; OVTBE: $message2 = str_replace('{agent_name}', $agentname, $tmsgtemplate['template']); goto IvUtK; OykeG: } public function sendtjrtzewm($agentname, $to_from_user) { goto XTfud; ytr2C: TjSmX: goto c3yfn; qFzmW: $message = str_replace('{time}', $time, $message2); goto qdcq9; zKs75: $time = date('Y-m-d H:i:s'); goto PTVgs; PTVgs: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzewm")); goto jyIKj; qdcq9: $this->sendcustomMsg($to_from_user, $message); goto ytr2C; qNxfa: $message2 = str_replace('{agent_name}', $agentname, $tmsgtemplate['template']); goto qFzmW; XTfud: global $_W; goto zKs75; jyIKj: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto TjSmX; } goto qNxfa; c3yfn: } public function sendtjrtzdl($agentname, $to_from_user) { goto R0v8Q; FQCAD: $message = str_replace('{time}', $time, $message2); goto yqg1A; P1bHS: $time = date('Y-m-d H:i:s'); goto Nqi6A; prE05: N17CS: goto y4tP5; zlzbb: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto N17CS; } goto d5Exw; Nqi6A: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "tjrtzdl")); goto zlzbb; R0v8Q: global $_W; goto P1bHS; d5Exw: $message2 = str_replace('{agent_name}', $agentname, $tmsgtemplate['template']); goto FQCAD; yqg1A: $this->sendcustomMsg($to_from_user, $message); goto prE05; y4tP5: } public function sendxjdlshtz($ordersn, $orderprice, $agentname, $to_from_user) { goto Tge53; BdVqF: coiSb: goto YwCfx; tKEfC: $message1 = str_replace('{order_price}', $orderprice, $tmsgtemplate['template']); goto h1HrH; h1HrH: $message2 = str_replace('{order_sn}', $ordersn, $message1); goto wToV1; cwmnz: $time = date('Y-m-d H:i:s'); goto nEY9u; GKGRJ: $this->sendcustomMsg($to_from_user, $message); goto BdVqF; wToV1: $message3 = str_replace('{agent_name}', $agentname, $message2); goto Xc4wl; ErMpS: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto coiSb; } goto tKEfC; nEY9u: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "xjdlshtz")); goto ErMpS; Tge53: global $_W; goto cwmnz; Xc4wl: $message = str_replace('{time}', $time, $message3); goto GKGRJ; YwCfx: } public function sendsjytktz($agent_money, $url, $to_from_user) { goto IZJe_; IZJe_: global $_W; goto wYFpp; OK4RA: $tmsgtemplate = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_msg_template') . ' WHERE  uniacid = :uniacid and tkey = :key', array(":uniacid" => $_W['uniacid'], ":key" => "sjytktz")); goto Oeyao; LbXvc: $message = '

 <a href=\'' . $url . '\'>' . '点击查看详情' . '</a>'; goto AQJ6U; Oeyao: if (!(!empty($tmsgtemplate['id']) && !empty($tmsgtemplate['template']) && $tmsgtemplate['tenable'] == 1)) { goto sx0RZ; } goto gsCtt; gsCtt: $message1 = str_replace('{agent_money}', $agent_money, $tmsgtemplate['template']); goto QW_1p; QW_1p: $message2 = str_replace('{time}', $time, $message1); goto LbXvc; RUquC: sx0RZ: goto MZVfH; AQJ6U: $this->sendcustomMsg($to_from_user, $message2 . $message); goto RUquC; wYFpp: $time = date('Y-m-d H:i:s'); goto OK4RA; MZVfH: } public function doWebOption() { goto uMUTf; uMUTf: $tag = random(32); goto Avihh; xFN1S: include $this->template('option'); goto o80t5; Avihh: global $_GPC; goto xFN1S; o80t5: } public function doWebSpec() { goto quKQs; quKQs: global $_GPC; goto edKcU; luYFX: include $this->template('spec'); goto mrvCQ; edKcU: $spec = array("id" => random(32), "title" => $_GPC['title']); goto luYFX; mrvCQ: } public function doWebSpecItem() { goto Yr8OX; FIS1g: include $this->template('spec_item'); goto DojY0; Yr8OX: global $_GPC; goto o9MBF; Nje3Z: $spec = array("id" => $_GPC['specid']); goto SdLjv; o9MBF: load()->func('tpl'); goto Nje3Z; SdLjv: $specitem = array("id" => random(32), "title" => $_GPC['title'], "show" => 1); goto FIS1g; DojY0: } public function doWebParam() { goto kG75E; fEBpc: global $_GPC; goto U_ogZ; kG75E: $tag = random(32); goto fEBpc; U_ogZ: include $this->template('param'); goto LDIcV; LDIcV: } public function __mobile($f_name) { goto xIbPU; j5rT6: $signPackage = $this->getSignPackage($modulephp); goto LveLy; zGw9X: $profile = $this->getProfile(); goto cPJsI; LAo4d: if (!empty($profile['id'])) { goto kNzd3; } goto OyXmJ; AJikO: load()->model('mc'); goto Pj8GO; Pj8GO: $modulephp = strtolower(substr($f_name, 8)); goto LAo4d; bnr76: $this->toflag(); goto UmKlZ; DvG8s: $profile = $this->getProfile(); goto AJikO; cPJsI: kNzd3: goto j5rT6; xIbPU: global $_W, $_GPC; goto bnr76; OyXmJ: $this->autoRegedit($modulephp); goto zGw9X; LveLy: include 'class/mobile/' . $modulephp . '.php'; goto rFXIP; UmKlZ: $from_user = $this->getFromUser(); goto DvG8s; rFXIP: } public function toflag() { goto H7_o_; H7_o_: global $_W, $_GPC; goto m3u6m; m3u6m: $openid = $_W['openid']; goto Q7tnK; p0QYJ: xmN7P: goto S8Eh0; fTwgT: $flag = pdo_fetchcolumn('select flag from ' . tablename('mihua_mall_member') . " where from_user='{$openid}' "); goto k8ldn; k8ldn: if (!($result && !$flag)) { goto xmN7P; } goto Brgc4; Brgc4: pdo_update('mihua_mall_member', array("flag" => 1, "flagtime" => TIMESTAMP), array("from_user" => $openid)); goto p0QYJ; Q7tnK: $result = pdo_fetch('select * from ' . tablename('mihua_mall_order') . " where from_user='{$openid}' and status>0  "); goto fTwgT; S8Eh0: } public function doMobileRedrecord() { goto p3Snv; wLmCw: foreach ($list as &$l) { goto T5Ll5; ayyXY: $i += 1; goto mWBqk; mWBqk: i5dP2: goto AzKKr; T5Ll5: $money += $l['money']; goto ayyXY; AzKKr: } goto XfvJf; XfvJf: rj0im: goto RJhV3; fs9mN: include $this->template($template); goto orHSL; RJhV3: $template = $this->selectTemplate('redrecord'); goto fs9mN; p3Snv: global $_W, $_GPC; goto V1C7G; f_YnT: $i = 0; goto wLmCw; V1C7G: load()->model('mc'); goto sBPRX; sBPRX: $openid = $_W['openid']; goto EMFEb; GWfhp: $money = ''; goto f_YnT; EMFEb: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_red') . ' where uniacid=:uniacid and openid=:openid and commission_flag=0 
		 order by red_id desc', array(":openid" => $openid, ":uniacid" => $_W['uniacid'])); goto GWfhp; orHSL: } public function doMobileRedrecord_manage() { goto OTGAt; eazK5: include $this->template($template); goto cIoYg; zEMfD: $i = 0; goto N03Em; OTGAt: global $_W, $_GPC; goto ltbZW; zLQUN: $money = ''; goto zEMfD; ohII2: u1J2k: goto qmphh; ltbZW: load()->model('mc'); goto ROOH8; kMbsE: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_red') . ' where uniacid=:uniacid  order by red_id desc ', array(":uniacid" => $_W['uniacid'])); goto zLQUN; N03Em: foreach ($list as &$l) { goto Ip0e6; kCStR: JuR4_: goto Mu7vC; Ip0e6: $money += $l['money']; goto SP1JB; SP1JB: $i += 1; goto kCStR; Mu7vC: } goto ohII2; qmphh: $template = $this->selectTemplate('redrecord_manage'); goto eazK5; ROOH8: $openid = $_W['openid']; goto kMbsE; cIoYg: } public function doMobileReset_red() { goto B09pJ; AB6dO: $class_redBao = C('redBao'); goto huFYv; aKaXu: message($re); goto hpI1t; gMYF_: if (!($red['commission_flag'] == 3)) { goto mEIvu; } goto tUG9o; huFYv: $class_redBao->openid = $red['openid']; goto bFmOn; bFmOn: $class_redBao->money = $red['money']; goto kD0F5; Xufgb: rRfk4: goto BcLPg; hpI1t: goto rRfk4; goto pTFA3; kl4fg: $flag = 0; goto lIsh7; kD0F5: $re = $class_redBao->send(); goto AVn2B; pTFA3: kONbL: goto kl4fg; nOT4q: mEIvu: goto bXE_8; tUG9o: $flag = 1; goto nOT4q; qPSai: i9GNO: goto W9P1V; B09pJ: global $_W, $_GPC; goto wH130; dG88d: pdo_update('mihua_mall_red', array("commission_flag" => $flag), array("red_id" => $red_id, "uniacid" => $_W['uniacid'])); goto yeJf8; AVn2B: if ($re == 1) { goto kONbL; } goto aKaXu; W9P1V: $flag = 0; goto SWfLo; SWfLo: rKa9u: goto dG88d; wH130: load()->model('mc'); goto FRin3; n81xH: $red = pdo_fetch('select * from ' . tablename('mihua_mall_red') . ' where uniacid=:uniacid and red_id=:red_id
		  order by red_id desc ', array(":uniacid" => $_W['uniacid'], ":red_id" => $red_id)); goto AB6dO; bXE_8: goto rKa9u; goto qPSai; lIsh7: if ($red['commission_flag'] == 2) { goto i9GNO; } goto gMYF_; yeJf8: message('重发成功！', $this->createMobileUrl('redrecord_manage'), 'success'); goto Xufgb; FRin3: $red_id = $_W['red_id']; goto n81xH; BcLPg: } public function doMobilePhb() { goto i69jI; mDJPI: $template = $this->selectTemplate('phb'); goto lMvBl; fbIdk: $str = $str . '-1'; goto r8JLv; gtsaZ: $str = ''; goto HwYnL; lMvBl: include $this->template($template); goto scJv4; HwYnL: foreach ($ranklist as &$citem) { $str = $str . $citem['sharemid'] . ','; uEjK1: } goto anxvF; r8JLv: $list = pdo_fetchall('SELECT member.*,(select avatar from ' . tablename('mc_members') . ' fs where fs.uid=member.uid and avatar<>\'\' limit 1) avatar,(select count(his.sharemid) from ' . tablename('mihua_mall_share_history') . ' his where his.sharemid=member.id) fanscount FROM ' . tablename('mihua_mall_member') . ' member  WHERE member.uniacid = :uniacid and member.id in(' . $str . ') order by fanscount desc', array(":uniacid" => $_W['uniacid'])); goto mDJPI; anxvF: Qnocf: goto fbIdk; i69jI: global $_W, $_GPC; goto SVHBx; SVHBx: $ranklist = pdo_fetchall('select bqsh.sharemid from ' . tablename('mihua_mall_share_history') . ' bqsh left join ' . tablename('mihua_mall_member') . ' member on   bqsh.sharemid=member.id  where  member.status=1 and bqsh.uniacid=:uniacid group by bqsh.sharemid having  count(bqsh.sharemid)  > 0 order by  count(bqsh.sharemid)  desc limit 30', array(":uniacid" => $_W['uniacid'])); goto gtsaZ; scJv4: } public function doMobileFansIndex() { goto l9NwP; XmN8p: $fanscount = pdo_fetch('select count(his.sharemid) count from ' . tablename('mihua_mall_share_history') . ' his where his.sharemid=:sharemid', array(":sharemid" => $profile['id'])); goto f6j2w; D7M2Q: $tmsg = '购买' . ($commtime['promotercount'] - $total) . '单才升级为代理'; goto NhzT7; o4gxm: goto NI2yx; goto LC5Ut; nXEQ6: $shownotice = $this->checkUser(); goto ysrfG; c0ktB: $fanscount = 0; goto df9Jm; oHKad: global $_W, $_GPC; goto wXZoy; yC6zF: include $this->template($template); goto UGQ0p; n0lkS: if (!($shownotice != 1)) { goto NbgLP; } goto lyt9e; JZN4y: $this->setuid($from_user); goto mkYwK; gtaO2: $myheadimg['tag'] = mc_credit_fetch($uid); goto vykfM; WNo4H: $myfansx = $account_api->fansQueryInfo($from_user); goto sVrOr; ysrfG: $this->checkisAgent($from_user, $profile); goto n0lkS; XZ7Ox: $order['all'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " where  from_user='{$from_user}' " . $andun); goto pLRYU; BRm1l: if (!empty($infos['avatar'])) { goto P8r8S; } goto rYHAc; lhSlO: $profile = $this->getProfile(); goto Nd1ze; k28qQ: oDTW0: goto cRgPF; l9NwP: $this->checkAuth(); goto oHKad; ZymH6: $order['payed'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " where status=1 and from_user='{$from_user}'  " . $where . $andun); goto CsZdj; t2Wp7: $profile['flag'] = 0; goto nx1CL; sVrOr: pdo_update('mc_mapping_fans', array("nickname" => $myfansx['nickname']), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto HpVDS; OLbdl: include $this->template($template); goto t1XCq; THxUX: $cfg = $this->module['config']; goto lhSlO; E1MnU: $infos = mc_fetch($uid, array("avatar")); goto A1W30; Mw2Nz: if (!($commtime['promotermoney'] > $totalmoney && $commtime['promotertimes'] == 3)) { goto oDTW0; } goto DprQ3; XZbe8: if (!empty($commissioningpe)) { goto t2MAD; } goto lYoJk; CsZdj: $order['shou'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " where  status=2 and from_user='{$from_user}' " . $andun); goto Icquq; u2m32: $modulephp = 'fansIndex'; goto ep28S; lRr22: if (!empty($profile['id'])) { goto WuwvE; } goto jJSLD; LC5Ut: fWLcM: goto Yd1nt; lYoJk: $commissioningpe = 0; goto OOmFP; mkYwK: $qr_code = $this->getQr_code(); goto XhbN5; xrA1W: NbgLP: goto hb6TO; hJYDh: $signPackage = $this->getSignPackage($modulephp); goto GLqqV; A81wQ: if (!($profile['status'] == 0)) { goto TZZ7l; } goto t2Wp7; zNGxy: WuwvE: goto XzFNd; ByaV3: $medal_name = '普通代理'; goto npHzX; cRgPF: $msg_count = count($this->web_msg()); goto xrA1W; hb6TO: $template = $this->selectTemplate('newhome'); goto yC6zF; jJSLD: $template = $this->selectTemplate('forbidden'); goto OLbdl; XzFNd: $where .= ' and (ordertype=1 or (ordertype!=1 and iscomplete=1))'; goto o5NyP; A1W30: P8r8S: goto gtaO2; NhzT7: bDXIS: goto Mw2Nz; Yd1nt: $commissioningpe = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE o.shareid = ' . $id . ' and o.uniacid = ' . $_W['uniacid'] . ' and (g.status = 0 or g.status = 1) and o.status >= 3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto XmN8p; FCKio: if (!($commtime['promotercount'] > $total && $commtime['promotertimes'] == 2)) { goto bDXIS; } goto D7M2Q; nx1CL: TZZ7l: goto Nz7FO; vykfM: if (!empty($profile['id']) && $profile['flag'] == 1) { goto fWLcM; } goto c0ktB; df9Jm: $medal_name = '普通会员'; goto o4gxm; HpVDS: pdo_update('mc_members', array("avatar" => $myfansx['headimgurl'], "nickname" => $myfansx['nickname']), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto ZpoX6; XhbN5: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto nXEQ6; SvuEC: $refund = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . ' o left join  ' . tablename('mihua_mall_order_goods') . " g on g.orderid=o.id and o.uniacid=g.uniacid where g.order_status>=2 and  o.from_user='{$from_user}' and o.uniacid='{$_W['uniacid']}'"); goto WFuFn; DprQ3: $tmsg = '购买' . ($commtime['promotermoney'] - $totalmoney) . '金额升级为代理'; goto k28qQ; nmD3x: $andun = ' and uniacid=' . $_W['uniacid']; goto XZ7Ox; npHzX: aFuWt: goto vYk7E; qAToa: $uid = mc_openid2uid($from_user); goto hJYDh; fPxZx: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto FprsB; lyt9e: $isagent = $this->checkAgent($from_user, $profile, 3); goto u2m32; ZpoX6: mc_update($uid, array("avatar" => $myfansx['headimgurl'], "nickname" => $myfansx['nickname'])); goto E1MnU; GLqqV: $uniacid = $_W['uniacid']; goto LXGDE; cvnLt: $infos = mc_fetch($uid, array("avatar")); goto BRm1l; Le7zt: if (!(!empty($ushareid) && $ushareid != 0)) { goto LmtB2; } goto GWuB3; nuIwY: $tmsg = '购买一单升级为代理'; goto FCKio; ACCCV: $total = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . ' WHERE status= \'3\' AND  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto IaZp7; rYHAc: $account_api = WeAccount::create(); goto WNo4H; FprsB: $isverify = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_saler') . " WHERE  uniacid = '{$_W['uniacid']}' and openid = '{$from_user}' and status =1 "); goto qAToa; wXZoy: load()->model('mc'); goto THxUX; f6j2w: $medal_name = pdo_fetchcolumn('SELECT medal_name FROM ' . tablename('mihua_mall_phb_medal') . ' WHERE uniacid = :uniacid and fans_count>=:fans_count  and fans_count<=:fans_count order by fans_count   limit 1', array(":uniacid" => $_W['uniacid'], ":fans_count" => $fanscount)); goto yZv_B; GWuB3: $shareprofile = $this->getMember($ushareid); goto XOXaX; WFuFn: $uid = mc_openid2uid($from_user); goto cvnLt; T_YN0: $ushareid = $this->getShareId(); goto Le7zt; vYk7E: NI2yx: goto XZbe8; pLRYU: $order['notpay'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " where status=0 and from_user='{$from_user}' {$andun}" . $andun); goto ZymH6; XOXaX: LmtB2: goto A81wQ; hL83t: $commtime = pdo_fetch('select promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto ACCCV; LXGDE: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto T_YN0; t1XCq: exit; goto zNGxy; OOmFP: t2MAD: goto hL83t; Nz7FO: $id = $profile['id']; goto lRr22; o5NyP: $where .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto nmD3x; ep28S: $openid = $_W['openid']; goto fPxZx; Nd1ze: $from_user = $this->getFromUser(); goto JZN4y; Icquq: $order['done'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_order') . " where  status=3 and from_user='{$from_user}' " . $andun); goto SvuEC; IaZp7: $totalmoney = pdo_fetchcolumn('SELECT sum(price) FROM ' . tablename('mihua_mall_order') . ' WHERE status= \'3\' AND  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto nuIwY; yZv_B: if (!empty($medal_name)) { goto aFuWt; } goto ByaV3; UGQ0p: } public function doMobileFansIndex2() { goto LnrCU; Z1AGX: $signPackage = $this->getSignPackage($modulephp); goto kxCaI; OlX2T: FIX9q: goto Q20pe; IRZzn: $count1_1 = pdo_fetchcolumn('	select  count(*) from ' . tablename('mihua_mall_member') . " fans where from_user!='{$from_user}' and ( fans.from_user in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']} order by fans.createtime desc"); goto ZGexj; c3PBG: $str = array(-1); goto qq2Bv; XAWfU: B_Pq5: goto vur9U; TKG86: $price2_1 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE  o.shareid2=' . $profile['id'] . ' and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3  and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto kKMtZ; fQYwb: $commissioningpex2 = 0; goto u_xBW; dfK0z: $refundtimectro = ' and g.createtime <= (now() - 86400 * ' . $fundtime . ')'; goto TK2Ge; WQVX0: $commissioningpe = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE o.shareid = ' . $id . ' and o.uniacid = ' . $_W['uniacid'] . ' and (g.status = 0 or g.status = 1) and o.status >= 3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto UeOik; FUux8: if (!($settings['globalCommissionLevel'] < 2)) { goto Nht6j; } goto W4Xdk; U9eC8: $fanscount = 0; goto oQuXT; LHvFN: $commissioningpe = 0; goto YOUCA; Fjirp: if (!($commtime['promotermoney'] > $totalmoney && $commtime['promotertimes'] == 3)) { goto PudqF; } goto a5W8O; bbeRF: $cfg = $settings = $this->module['config']; goto SYOMF; ElJCP: include $this->template($template); goto SY6s3; P0YYy: $commission3_1 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE  o.shareid3=' . $profile['id'] . '  and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto u8Xq5; Ca240: $tmsg = '购买一单升级为代理'; goto JQ6_3; qq2Bv: foreach ($p22 as $row) { $str[] = $row['id']; YhIAk: } goto ypk3S; JEOyj: $count = 0; goto NKKwe; hri0B: $str = 0; goto npDuE; O1Rna: $this->checkisAgent($from_user, 1); goto D1arM; jdfqa: if (!empty($commissioningpe)) { goto lalHI; } goto LHvFN; OSPDI: $infos = mc_fetch($uid, array("avatar")); goto UXPG2; UQn90: $uid = mc_openid2uid($from_user); goto OSPDI; GU7Iu: $shownotice = $this->checkUser(); goto Al0so; sVIA5: $openid = $_W['openid']; goto Zv1eP; w6mqU: $fundtime = $this->getRefundtime(); goto dfK0z; YgVAa: if (!empty($profile['id'])) { goto ChMsd; } goto NGWac; Yy4qx: $profile = $this->getProfile(); goto CIm0l; ciUNK: if ($cfg['globalCommissionLevel'] >= 2) { goto riSxc; } goto hri0B; ye6S8: if (!empty($profile['id'])) { goto OtbNv; } goto ty2A5; pPkQT: $p22 = pdo_fetchall('SELECT id FROM ' . tablename('mihua_mall_member') . " WHERE id!=shareid AND shareid={$profile['id']}"); goto c3PBG; LI9LE: $qr_code = $this->getQr_code(); goto u1v8_; h2hwL: $shareprofile = $this->getMember($ushareid); goto K5Gcw; RtGSX: $count2 = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . ' WHERE id!=shareid AND shareid IN(' . implode(',', $str) . ') AND flag=0'); goto QNKRQ; vur9U: $commissioningpe_now = $commissioningpe + $commissioningpex2 + $commissioningpex3 + $commissioningpe_re; goto sAIJ9; zcJRh: $goods_num = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_goods') . ' where status=1 '); goto QvXd0; mcwTh: foreach ($p33 as $row) { $str[] = $row['id']; C2uOg: } goto C4lgB; kxCaI: $uniacid = $_W['uniacid']; goto DvJUO; G70gd: $profile = $this->getProfile(); goto FUux8; Guhb2: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto IRZzn; K6jWA: $commissioningpex2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid2 = ' . $profile['id'] . ' and g.status2 = 0)  ) and o.uniacid = ' . $_W['uniacid'] . " and  o.status = 3  {$level2enable}  and  g.createtime>=" . $profile['flagtime'] . $refundtimectro); goto VB_OQ; u_xBW: KC2KT: goto jdfqa; RoUUb: OtbNv: goto UQn90; LddT5: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto G70gd; yKYnB: oi0Gh: goto bUWrH; u1v8_: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto CVKV7; W4Xdk: $level2enable = ' and 1!=1 '; goto QL2pF; C4lgB: smaCR: goto GUAVd; xnAPv: $userinfo_id = $userinfo['id']; goto GU7Iu; Y68S1: $id = $profile['id']; goto ye6S8; knflA: $price1_1 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE  o.shareid=' . $profile['id'] . ' and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto Wn88j; wC527: $medal_name = '普通代理'; goto Oxiap; PY2rX: jQXqB: goto Fjirp; K8NUJ: if (!empty($commissioningpex3)) { goto qNiuI; } goto O0djF; iiRdO: $commissioningpe_re = '0.00'; goto XAWfU; lHJ38: $noticeid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_admin') . "  where from_user='{$openid}'  and uniacid = " . $_W['uniacid']); goto vOSG_; GEQPq: $total = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . ' WHERE status= \'3\' AND  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto ghtlO; TQheV: $commission2_1 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE o.shareid2=' . $profile['id'] . ' and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto TKG86; b1WPr: if (!empty($profile['id']) && $profile['flag'] == 1) { goto iLcvd; } goto U9eC8; oQuXT: $medal_name = '普通会员'; goto d_098; zCcMg: if (!($profile['status'] == 0)) { goto Fz6t2; } goto Coece; Zv1eP: $this->setuid($openid); goto bbeRF; U3nNA: if (!($settings['globalCommissionLevel'] < 3)) { goto FIX9q; } goto L52FA; QQNVY: Fz6t2: goto OcMt0; zumQ5: $commissioningpe = 0; goto FRLNl; mkkcq: $count = $count1 + $count2 + $count3; goto WyM0b; QvXd0: VaiKR: goto fOJ4q; Wn88j: uUpOp: goto ciUNK; xVRHf: qNiuI: goto gw1GY; CVKV7: $userinfo = Util::getSingelDataInSingleTable('mihua_mall_user', array("openid" => $from_user)); goto xnAPv; O0djF: $commissioningpex3 = 0; goto xVRHf; vOSG_: $uid = mc_openid2uid($from_user); goto LddT5; sAIJ9: $isagent = $this->checkAgent($from_user, $profile); goto qM3SE; a9iC2: dMU_m: goto TGP7O; CIm0l: ChMsd: goto Z1AGX; UeOik: $fanscount = pdo_fetch('select count(his.sharemid) count from ' . tablename('mihua_mall_share_history') . ' his where his.sharemid=:sharemid', array(":sharemid" => $profile['id'])); goto Dn6YN; fP46J: $followcount = pdo_fetchcolumn('	select  count(*) from ' . tablename('mihua_mall_member') . " fans where from_user!='{$from_user}' and ( fans.from_user in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']} order by fans.createtime desc"); goto oa2P8; VB_OQ: $commissioningpex3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid3 = ' . $profile['id'] . ' and g.status3 = 0)  ) and o.uniacid = ' . $_W['uniacid'] . " and  o.status = 3 {$level3enable}  and  g.createtime>=" . $profile['flagtime'] . $refundtimectro); goto K8NUJ; L52FA: $level3enable = ' and 1!=1 '; goto OlX2T; Oxiap: EmtVI: goto a9iC2; oa2P8: KJdjO: goto Y68S1; jexkR: $count1 = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . " WHERE id!=shareid AND shareid={$profile['id']} AND flag=0"); goto Guhb2; jgFFl: $priceTotal = $price1_1 + $price2_1 + $price3_1; goto Q35GR; Q35GR: $clickcount = $profile['clickcount']; goto fP46J; yuseQ: load()->model('mc'); goto sVIA5; WyM0b: $count = $count + $count1_1 + $count2_1 + $count3_1; goto FOSDr; CYKQZ: $cfg = $this->module['config']; goto O1Rna; a5W8O: $tmsg = '购买' . ($commtime['promotermoney'] - $totalmoney) . '金额升级为代理'; goto ze25y; Coece: $profile['flag'] = 0; goto QQNVY; FRLNl: ulQyd: goto up1FL; SY6s3: exit; goto RoUUb; woJKS: $tmsg = '购买' . ($commtime['promotercount'] - $total) . '单才升级为代理'; goto PY2rX; ezNbg: include $this->template($template); goto OXr3J; rU_Ax: $count3_1 = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . ' WHERE id!=shareid AND shareid IN(' . implode(',', $str) . ') AND flag=1'); goto P0YYy; Kk6eo: goto KJdjO; goto BMPBQ; ghtlO: $totalmoney = pdo_fetchcolumn('SELECT sum(price) FROM ' . tablename('mihua_mall_order') . ' WHERE status= \'3\' AND  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto Ca240; npDuE: goto OUyr7; goto dv_Lg; ybX0e: if (!(!empty($ushareid) && $ushareid != 0)) { goto HDvi3; } goto h2hwL; XdS9V: $count = 0; goto R9T74; ZGexj: $commission1_1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_member') . ' as o left join ' . tablename('mihua_mall_order_goods') . " as g on o.id=g.orderid and o.uniacid=g.uniacid WHERE o.shareid={$profile['id']} and o.uniacid={$_W['uniacid']} and o.status=3 and g.createtime>={$profile['flagtime']} and o.from_user<>'{$from_user}'"); goto knflA; TK2Ge: $commissioningpe = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . ' and g.status = 0)  ) and o.uniacid = ' . $_W['uniacid'] . ' and   o.status = 3  and  g.createtime>=' . $profile['flagtime'] . $refundtimectro); goto K6jWA; FOSDr: $commissionTotal = $commission1_1 + $commission2_1 + $commission3_1; goto jgFFl; SYOMF: $from_user = $this->getFromUser(); goto LI9LE; bREv5: $modulephp = 'fansIndex2'; goto YgVAa; iQRey: $zt_list = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_zt') . ' where status=1 '); goto zcJRh; C2Yhb: goto Dy_Gi; goto yKYnB; bUWrH: $p33 = pdo_fetchall('SELECT id FROM ' . tablename('mihua_mall_member') . ' WHERE id!=shareid AND shareid IN (' . implode(',', $str) . ')'); goto MWwFP; ypk3S: EMDR6: goto RtGSX; d_098: goto dMU_m; goto VtdaV; oqC7L: Dy_Gi: goto mkkcq; gw1GY: if (!empty($commissioningpex2)) { goto KC2KT; } goto fQYwb; JQ6_3: if (!($commtime['promotercount'] > $total && $commtime['promotertimes'] == 2)) { goto jQXqB; } goto woJKS; BMPBQ: XjKdd: goto XdS9V; VtdaV: iLcvd: goto WQVX0; ty2A5: $template = $this->selectTemplate('forbidden'); goto ElJCP; R9T74: if (!true) { goto uUpOp; } goto jexkR; qM3SE: load()->model('mc'); goto bREv5; vGCJV: if ($cfg['globalCommissionLevel'] >= 3) { goto oi0Gh; } goto w7yEJ; u8Xq5: $price3_1 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE  o.shareid3=' . $profile['id'] . ' and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime']); goto oqC7L; LnrCU: global $_W, $_GPC; goto yuseQ; QL2pF: Nht6j: goto U3nNA; GUAVd: $count3 = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . ' WHERE id!=shareid AND shareid IN(' . implode(',', $str) . ') AND flag=0'); goto rU_Ax; NGWac: $this->autoRegedit($modulephp); goto Yy4qx; kKMtZ: OUyr7: goto vGCJV; D1arM: $ushareid = $this->getShareId(); goto ybX0e; ze25y: PudqF: goto hZHJh; dv_Lg: riSxc: goto pPkQT; UXPG2: $myheadimg['tag'] = mc_credit_fetch($uid); goto b1WPr; YOUCA: lalHI: goto qsOqO; MWwFP: $str = array(-1); goto mcwTh; QNKRQ: $count2_1 = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_member') . ' WHERE id!=shareid AND shareid IN(' . implode(',', $str) . ') AND flag=1'); goto TQheV; hZHJh: $msg_count = count($this->web_msg()); goto iQRey; fOJ4q: $template = $this->selectTemplate('newhome2'); goto ezNbg; Dn6YN: $medal_name = pdo_fetchcolumn('SELECT medal_name FROM ' . tablename('mihua_mall_phb_medal') . ' WHERE uniacid = :uniacid and fans_count>=:fans_count  and fans_count<=:fans_count order by fans_count   limit 1', array(":uniacid" => $_W['uniacid'], ":fans_count" => $fanscount)); goto K7DQ5; K5Gcw: HDvi3: goto zCcMg; Q20pe: $commissioningpe_re = pdo_fetchcolumn('select balance from ' . tablename('mihua_mall_member') . " where id={$profile['id']} "); goto w6mqU; qsOqO: if (!($commissioningpe_re == 0)) { goto B_Pq5; } goto iiRdO; OcMt0: if (!empty($profile['id']) && $profile['flag'] == 1) { goto XjKdd; } goto JEOyj; up1FL: $commtime = pdo_fetch('select promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto GEQPq; NKKwe: $followcount = 0; goto Kk6eo; K7DQ5: if (!empty($medal_name)) { goto EmtVI; } goto wC527; DvJUO: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto CYKQZ; w7yEJ: $str3 = 0; goto C2Yhb; Al0so: if (!($shownotice != 1)) { goto VaiKR; } goto lHJ38; TGP7O: if (!empty($commissioningpe)) { goto ulQyd; } goto zumQ5; OXr3J: } public function doMobileZt_list() { goto N447A; rBKzW: if (!($result['status'] == 0)) { goto zTJ7_; } goto Gx7hq; SDNhf: SPVjp: goto rGOLj; L7DpT: include $this->template($template); goto ef8Ou; QLjrq: $imgs = $result_header['img']; goto j_Hu6; irtPF: $from_user = $this->getFromUser(); goto UYHd0; rGOLj: $template = $this->selectTemplate('zt_list'); goto L7DpT; TeK2Q: $id = (int) $_GPC['id']; goto irtPF; ysEmp: $content_id = unserialize($result['zt_content_id']); goto tRXPG; pxUSU: zTJ7_: goto uSrRk; N447A: global $_W, $_GPC; goto TeK2Q; IxD6v: $result = pdo_fetch('select * from ' . tablename('mihua_zt') . ' where zt_id=:id and uniacid=:uniacid', array(":id" => $id, ":uniacid" => $_W['uniacid'])); goto rBKzW; tRXPG: if (!$content_id) { goto SPVjp; } goto jT1Lx; UYHd0: $shownotice = $this->checkUser(); goto k8pOM; js8rO: $rlist = pdo_fetchall('select * from ' . tablename('mihua_mall_goods') . " where id in({$content_id}) and uniacid={$_W['uniacid']} order by field(id,{$content_id}) "); goto SDNhf; Gx7hq: message('该专题已经关闭', '', 'error'); goto pxUSU; uSrRk: $result_header = unserialize($result['zt_head_img']); goto QLjrq; jT1Lx: $content_id = implode(',', $content_id); goto js8rO; j_Hu6: $urls = $result_header['url']; goto ysEmp; k8pOM: $qr_code = $this->getQr_code(); goto IxD6v; ef8Ou: } public function doMobileZtall() { goto Mfrzq; Mfrzq: global $_W, $_GPC; goto zhagG; zhagG: $from_user = $this->getFromUser(); goto NdD_V; NdD_V: $shownotice = $this->checkUser(); goto wmZg9; ZTIPB: $list = pdo_fetchall('select * from ' . tablename('mihua_zt') . " where status=1 and uniacid={$_W['uniacid']} order by zt_order desc "); goto NToY5; NToY5: include $this->template('ztall'); goto fuNc9; wmZg9: $qr_code = $this->getQr_code(); goto ZTIPB; fuNc9: } public function doMobileUp_comment() { goto bwxfo; inPYG: $fans = mc_credit_fetch($uid); goto kKuDH; npiLY: $from_user = $this->getFromUser(); goto h3jbg; nsSV6: $openid = $_W['openid']; goto OIKEv; ShG2M: mEqLr: goto KP00k; MADVB: $in['ordersn'] = $_GPC['ordersn']; goto hYXjx; s9BRR: $in['comment_content'] = $_GPC['content']; goto DQ3Zt; q0OgS: if (!(!empty($fans) && !empty($comment_jifen))) { goto mEqLr; } goto oKOTg; ljImB: if ($_GPC['ordersn'] && $_GPC['content'] && $_GPC['gid']) { goto EoodG; } goto EUbM5; TYv1D: echo json_encode(array("msg" => "非法访问")); goto KMkEy; H7Xd0: $comment_result = pdo_fetch('select * from ' . tablename('mihua_mall_comment') . " where uid={$uid} and goods_id=:goods_id and ordersn=:ordersn ", array(":goods_id" => $_GPC['gid'], ":ordersn" => $_GPC['ordersn'])); goto cN09v; DA80n: $in['uniacid'] = $_W['uniacid']; goto gWIOK; RexWl: EoodG: goto nsSV6; cN09v: if (!$comment_result) { goto yxRnj; } goto uO1MK; h3jbg: $uid = mc_openid2uid($from_user); goto inPYG; OIKEv: $result = pdo_fetch('select * from ' . tablename('mihua_mall_order') . ' where from_user=:from_user and ordersn=:ordersn ', array("from_user" => $openid, "ordersn" => $_GPC['ordersn'])); goto dhIeV; dlztC: $comment_jifen = $settings['comment_jifen']; goto q0OgS; ZM2lv: goto bcPu5; goto RexWl; ux1R2: mc_oauth_userinfo(); goto qRdbt; snnRE: XNn2A: goto DyJsR; kMiAq: echo json_encode(array("msg" => '恭喜，评论成功，获赠' . $comment_jifen . '积分', "status" => "success")); goto w21wm; bwxfo: global $_W, $_GPC; goto ATAW0; uO1MK: echo json_encode(array("msg" => "您已经评论过了！")); goto V1Acb; KJj3H: $in['goods_id'] = $_GPC['gid']; goto MADVB; V1Acb: goto qggyQ; goto szBKz; KMkEy: goto XNn2A; goto cCeRa; UgLtv: $uid = $fans_info['uid']; goto ljImB; WdLEE: qggyQ: goto snnRE; hYXjx: $in['uid'] = $uid; goto s9BRR; ATAW0: load()->model('mc'); goto ux1R2; XomIo: pdo_update('mc_members', array("credit1" => $new_credit), array("uid" => $uid, "uniacid" => $_W['uniacid'])); goto kMiAq; szBKz: yxRnj: goto KJj3H; oKOTg: $new_credit = $comment_jifen + $fans['credit1']; goto XomIo; DQ3Zt: $in['addtime'] = TIMESTAMP; goto DA80n; DyJsR: bcPu5: goto frwLo; KP00k: echo json_encode(array("msg" => "评论成功", "status" => "success")); goto WdLEE; cCeRa: OF2Pd: goto H7Xd0; dhIeV: if ($result) { goto OF2Pd; } goto TYv1D; EUbM5: echo json_encode(array("msg" => "请按需填写内容")); goto ZM2lv; gWIOK: pdo_insert('mihua_mall_comment', $in); goto npiLY; qRdbt: $fans_info = $_W['fans']; goto UgLtv; kKuDH: $settings = $this->module['config']; goto dlztC; w21wm: return; goto ShG2M; frwLo: } public function doMobileErwema() { goto s34A6; wUZ80: $useid = intval($_GPC['uid']); goto EHiY5; Ie12g: $description = $cfg['description']; goto tdrWs; tdrWs: $description = $cfg['description']; goto mQPQG; ZIA4o: include $this->template($template); goto aQh2a; Jribw: $uniacid = $_W['uniacid']; goto YD4jj; pwwok: $userinfo = model_user::initUserInfo(); goto wUZ80; s34A6: global $_W, $_GPC; goto PrtR4; ipcQF: $userinfo = Util::getSingelDataInSingleTable('mihua_mall_user', array("id" => $useid)); goto Up500; mQPQG: $this->memberQrcode($from_user); goto wEv4E; fvZfk: $title = $cfg['shopname']; goto Ie12g; wEv4E: $template = $this->selectTemplate('homeerwema'); goto ZIA4o; PrtR4: $cfg = $this->module['config']; goto pwwok; EHiY5: if (!($useid > 0)) { goto Wyj30; } goto ipcQF; Up500: $from_user = $userinfo['openid']; goto Jribw; YD4jj: Wyj30: goto fvZfk; aQh2a: } public function doMobileRegister() { goto I73ki; vFlW7: exit; goto LoFuS; GLqLM: $opp = $_GPC['opp']; goto pFzwA; Yoyp_: pdo_insert('mihua_mall_member', $data); goto T30VS; C43js: Zz_Ea: goto vIfjL; jx0Do: exit; goto Z13BK; t3bXy: QyYEm: goto l8QJp; oM6lm: if (!empty($shareids['sharemid'])) { goto F4AzE; } goto lnc9L; lixWZ: if (!(empty($myfansx['nickname']) && !empty($_GPC['realname']))) { goto SBmei; } goto Bw0w6; iFHMG: k65ic: goto XOXMa; Jxxej: F4AzE: goto Mi9RU; SNPNq: exit; goto BB4Hw; lAPVk: $cfg = $this->module['config']; goto sNnYm; XZ2SK: exit; goto iFHMG; h4YTA: if (!($seid > 0)) { goto DbrMZ; } goto ngx9Z; ngx9Z: $sharemember = pdo_fetch('SELECT from_user,id FROM ' . tablename('mihua_mall_member') . ' WHERE `uniacid` = :uniacid AND id=:id ', array(":uniacid" => $_W['uniacid'], ":id" => $seid)); goto j50QH; K5KZl: $uniacid = $_W['uniacid']; goto OlxEI; I73ki: global $_W, $_GPC; goto mJxGg; LoFuS: R321D: goto SSFFy; Psa60: $profile['realname'] = $fans['realname']; goto zfkXb; bQxwm: $data = array("realname" => $_GPC['realname'], "mobile" => $_GPC['mobile'], "pwd" => $_GPC['password'], "bankcard" => $_GPC['bankcard'], "banktype" => $_GPC['banktype'], "alipay" => $_GPC['alipay'], "wxhao" => $_GPC['wxhao']); goto EmEkW; cwjKQ: $this->sendtjrtzdl($joinfans['nickname'], $sharemember['from_user']); goto JrHGr; qN61o: $fans = pdo_fetch('SELECT realname FROM ' . tablename('mc_members') . 'mc left join ' . tablename('mc_mapping_fans') . ' fans on fans.uid=mc.uid  WHERE  mc.uniacid = :uniacid  AND fans.openid = :from_user LIMIT 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto FaR5H; NIdUP: if (!empty($from_user)) { goto QoDTj; } goto AEMsp; Z13BK: BL6rt: goto bQxwm; jdfD9: echo -1; goto jx0Do; Eap9z: if (!empty($profile['id'])) { goto f3OR7; } goto EAgWn; WM6gY: ssP4K: goto h4YTA; SVxrc: $profile = $this->getProfile(); goto EbjhP; FaR5H: if (!empty($profile['realname'])) { goto EDjo2; } goto Psa60; OlxEI: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto e5ZN0; AEMsp: return; goto Z6OtW; vIfjL: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $_GPC['realname'], "bankcard" => $_GPC['bankcard'], "banktype" => $_GPC['banktype'], "mobile" => $_GPC['mobile'], "pwd" => $_GPC['password'], "alipay" => $_GPC['alipay'], "wxhao" => $_GPC['wxhao'], "createtime" => TIMESTAMP, "flagtime" => TIMESTAMP, "shareid" => $seid, "status" => 1, "flag" => 1); goto T38Pr; wZP7l: if (!($op == 'display')) { goto R321D; } goto GLqLM; R41pI: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto obtVg; JEuj6: include $this->template($template); goto vFlW7; M3srT: $shareids = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_share_history') . ' WHERE  from_user=:from_user and uniacid=:uniacid limit 1', array(":from_user" => $from_user, ":uniacid" => $_W['uniacid'])); goto oM6lm; aMnOj: if ($data['from_user'] == $profile['from_user']) { goto FOkK_; } goto Yoyp_; U04_5: goto Mpmto; goto C43js; wZH61: $member = $this->getMember($shareids['sharemid']); goto o1zlp; Z6OtW: QoDTj: goto SVxrc; lnc9L: $seid = 0; goto as1Em; zfkXb: EDjo2: goto lAPVk; dA3eT: FOkK_: goto Xiu0O; mJxGg: $this->toflag(); goto PuQ12; o1zlp: if (!($member['flag'] != 1)) { goto QyYEm; } goto sXM9P; I04_4: $profile = $this->getProfile(); goto zAqTR; EmEkW: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto tFsHx; H4jYQ: DbrMZ: goto R41pI; PuQ12: $from_user = $_W['openid']; goto NIdUP; n1WBz: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "realname" => $_GPC['realname'], "bankcard" => $_GPC['bankcard'], "banktype" => $_GPC['banktype'], "mobile" => $_GPC['mobile'], "pwd" => $_GPC['password'], "alipay" => $_GPC['alipay'], "wxhao" => $_GPC['wxhao']); goto U04_5; Mi9RU: $seid = $shareids['sharemid']; goto wZH61; Eyjy0: $signPackage = $this->getSignPackage($modulephp); goto K5KZl; BB4Hw: Zem7h: goto Yse0M; Y4qUf: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto mIc7G; JrHGr: rhDlO: goto H4jYQ; EAgWn: $this->autoRegedit($modulephp); goto I04_4; Xiu0O: pdo_update('mihua_mall_member', $data, array("id" => $profile['id'])); goto WM6gY; Bw0w6: pdo_update('mc_mapping_fans', array("nickname" => $_GPC['realname']), array("fanid" => $myfansx['fanid'])); goto Kejdh; as1Em: goto wThE4; goto Jxxej; T38Pr: Mpmto: goto aMnOj; pFzwA: $rule = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE `uniacid` = :uniacid ', array(":uniacid" => $_W['uniacid'])); goto qN61o; tFsHx: echo 2; goto SNPNq; j50QH: $joinfans = pdo_fetch('SELECT openid,nickname FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto FHi1I; Kejdh: SBmei: goto EssPY; puUC1: $modulephp = 'register'; goto Eap9z; EssPY: if (empty($profile['bankcard'])) { goto Zem7h; } goto hFg9Z; SSFFy: $myfansx = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE `uniacid` = :uniacid AND openid=:from_user limit 1', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto lixWZ; EbjhP: load()->model('mc'); goto puUC1; T30VS: goto ssP4K; goto dA3eT; FHi1I: if (!(!empty($sharemember) && !empty($sharemember['id']) && !empty($joinfans['nickname']) && $theone['promotertimes'] == 1)) { goto rhDlO; } goto cwjKQ; Yse0M: if (!($op == 'add')) { goto k65ic; } goto M3srT; zAqTR: f3OR7: goto Eyjy0; e5ZN0: $id = $profile['id']; goto wZP7l; obtVg: echo 1; goto XZ2SK; l8QJp: wThE4: goto Y4qUf; mIc7G: if ($theone['promotertimes'] == 1) { goto Zz_Ea; } goto n1WBz; hFg9Z: if (!(empty($_GPC['bankcard']) || empty($_GPC['banktype']))) { goto BL6rt; } goto jdfD9; sNnYm: $ydyy = $cfg['ydyy']; goto d2Qt1; sXM9P: $seid = 0; goto t3bXy; d2Qt1: $template = $this->selectTemplate('register'); goto JEuj6; XOXMa: } public function doMobileCommission() { goto TZLEE; hNH6Y: $commission5 = $commission5 + $commission5x2 + $commission5x3; goto wauAN; U5x_4: $template = $this->selectTemplate('page_commissionDetail'); goto h5nQq; gVdmA: $commission7 = '0.00'; goto K0y1r; mjBIk: $query_condition = "SELECT bjog.order_status,orders.status,orders.createtime,orders.ordersn,bjog.status as status1,
					bjog.commission*bjog.total as commission,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . ' orders left join  ' . tablename('mihua_mall_order_goods') . " bjog on bjog.orderid=orders.id WHERE  
					orders.uniacid = '{$_W['uniacid']}' and bjog.commission!=0" . $condition1; goto ZX3WB; CkM3j: $result = pdo_update('mihua_mall_member', array("balance" => $lastMoney), array("uid" => $uid, "uniacid " => $_W['uniacid'])); goto mM1kk; K0y1r: hm95P: goto TCyis; eMatv: if (!empty($tmp)) { goto P0hAK; } goto yhEW_; DdCW_: if (!($commission6 == 0)) { goto mMpv9; } goto bCLyg; sqahV: if (!pdo_fetch('select * from ' . tablename('mihua_mall_commissionPay') . " where id='{$commissionid}'")) { goto RgfCQ; } goto bA1T9; Th8jK: i3zVY: goto W1wtu; qL_of: gCP6I: goto efpCn; O3Enb: if (!(!empty($noticeid) && !empty($sendMsgApply))) { goto mZNuR; } goto jiWp6; ajIf1: $commission1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . ' and g.order_status = 0)   )  and o.uniacid = ' . $_W['uniacid'] . ' and (o.status =1 or o.status =2)  and  g.createtime>=' . $profile['flagtime']); goto v5pNb; UQG2r: Uz2zB: goto gjxgG; DB4Z3: if (!empty($commissioningpex2)) { goto tGI2I; } goto tQvob; aPCIm: $commission4_1 = $commission4_1 + $commission4_1x2 + $commission4_1x3; goto PAx4M; xozty: jbLB0: goto Qmgm9; f_NrJ: rlpfa: goto Whr7N; r3pS1: exit; goto Vvb6h; w3kTw: $commissioningpe_re = pdo_fetchcolumn('select balance from ' . tablename('mihua_mall_member') . " where id={$profile['id']} "); goto aqlqc; wJAdu: $from_user = $_W['openid']; goto Huml4; rZfTn: $uid = mc_openid2uid($from_user); goto h69OI; dTOuG: if (!empty($commission6_1)) { goto jTwr0; } goto xysQA; Ksllw: if (!empty($commission2x3)) { goto mkgiy; } goto qt4Dw; xE1Qc: foreach ($goods as $g) { $good[$g['id']] = $g['title']; CzRzQ: } goto ZLmzK; Qasnx: SQn94: goto fxysw; zVPRc: $commission5_1x3 = 0; goto CullL; tuxfT: $commission5_1x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto VwqY2; rKoJ5: $commission4 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0))  and  g.createtime>=' . $profile['flagtime']); goto Z454C; TLUqg: guV3e: goto QEt7P; qiebS: if (!empty($commission4x3)) { goto aNYWD; } goto Vmgpr; rgnla: sZWTB: goto RMDn2; xwtAW: if (!($profile['flag'] == 0 || empty($from_user) || !is_numeric($applyMoney) || $applyMoney < 0)) { goto QSk7e; } goto ffGX4; gFAtc: $commission1x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ( (o.shareid3 = ' . $profile['id'] . ' and g.status3 = 0)  )  and o.uniacid = ' . $_W['uniacid'] . " and (o.status =1 or o.status =2) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto RNWvl; eMvzm: c10Et: goto LBIcL; Wixmr: $conditionMember = 'select m.realname from ' . tablename('mihua_mall_member') . ' m where m.from_user=orders.from_user and m.uniacid=' . $_W['uniacid']; goto lNZQi; L6Emq: exit; goto C4Z8Z; ZLmzK: hIfxl: goto UHzx0; lQVBE: DgYfa: goto c9LTL; uzH2I: $commission8x2 = 0; goto Abv22; qy6ru: $applyMoney = $_GPC['applyMoney']; goto oXeE0; Qm26S: $commissioningpex3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid3 = ' . $profile['id'] . ' and g.order_status = 0 and g.status3=0)  ) and o.uniacid = ' . $_W['uniacid'] . " and   o.status = 3  {$level3enable}  and  g.createtime>=" . $profile['flagtime'] . $refundtimectro); goto KENHf; opaZU: Ii50c: goto tdCOe; CP64O: GjcxR: goto u83fi; q9y48: G8oHr: goto FEHQ8; pSMty: if (!empty($commission9)) { goto jTyeP; } goto h5EMG; QHGGT: $listx = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_commissionPay') . ' WHERE from_user=\'' . $from_user . '\' AND uniacid=' . $_W['uniacid']); goto z4x0D; xysQA: $commission6_1 = 0; goto pG1LP; k3_cv: if (!empty($commission8x2)) { goto lgIH2; } goto uzH2I; o5Gc4: $commission9_1x2 = 0; goto qL_of; Q_zeT: $goods = pdo_fetchall('select id, title from ' . tablename('mihua_mall_goods') . ' where uniacid = ' . $_W['uniacid']); goto idEPS; c9LTL: $data = array("commissionid" => $commissionid, "uniacid" => $_W['uniacid'], "uid" => $uid, "from_user" => $from_user, "applyType" => $applyType, "applyMoney" => $applyMoney, "totalMoney" => $totalmoney, "lastMoney" => $lastMoney, "time" => time(), "status" => 1); goto Izexi; qt4Dw: $commission2x3 = 0; goto FZb62; mamuo: $list = pdo_fetchall('select co.isshare,co.commission, co.createtime, og.orderid, og.goodsid, og.total,oo.ordersn from ' . tablename('mihua_mall_commission') . ' as co left join ' . tablename('mihua_mall_order_goods') . ' as og on co.ogid = og.id and co.uniacid = og.uniacid left join ' . tablename('mihua_mall_order') . ' as oo on oo.id = og.orderid and co.uniacid = og.uniacid where co.mid =' . $profile['id'] . ' and co.flag = 0 ORDER BY co.createtime DESC limit ' . ($pindex - 1) * $psize . ',' . $psize); goto ek29s; Hdw6I: if (!($commission3 == 0)) { goto ZkIQZ; } goto CNlum; nc8wi: zSMks: goto MTLoh; UwHze: $pindex = max(1, intval($_GPC['page'])); goto L86mf; gYT8P: if (!empty($commission5x2)) { goto qU7Ud; } goto qIPxA; v6uVS: qU7Ud: goto gM_8y; YNvQC: if (!($op == 'display')) { goto WSen0; } goto ajIf1; rq09Y: $totalmoney = $almoney; goto TuR20; WucQK: YOp2G: goto YjpnM; Md402: CNGQV: goto Q_zeT; sKmWQ: Mf4FC: goto AKZ2K; hO1GS: $this->toflag(); goto JTSTs; gWze8: XK1uu: goto o3R39; TjUcK: if (!($op == 'commapply')) { goto SQn94; } goto Wixmr; IB20j: if (!empty($commission9x2)) { goto k_zUD; } goto ZV9P7; Gk9jU: goto VTuvZ; goto lQVBE; lKZjX: $query_condition = "SELECT bjog.order_status,orders.status,orders.createtime,orders.ordersn,bjog.status2 as status1,
					bjog.commission2*bjog.total as commission,( {$conditionMember}) realname  FROM " . tablename('mihua_mall_order') . ' orders left join  ' . tablename('mihua_mall_order_goods') . " bjog on bjog.orderid=orders.id  WHERE 
					 orders.uniacid = '{$_W['uniacid']}' and bjog.commission!=0" . $condition2; goto vviol; sDX3X: if (!($applyType == 1)) { goto fMeuD; } goto dM2u8; uLKx7: $commission6_1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =2)) or ((o.paytype=1 or o.paytype=2 ) and o.status =2))  and  g.createtime>=' . $profile['flagtime']); goto qGgKl; rbQzF: $commission9_1 = $commission9_1 + $commission9_1x2 + $commission9_1x3; goto kq_mS; lti_e: dBW8L: goto X2m0C; Q2ANN: if (!empty($commission6)) { goto EFWZc; } goto KMH3D; kCadp: $commission7x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto C_rr9; ENGyd: die(json_encode(array("result" => 0, "str" => "申请佣金成功"))); goto EZvy6; AUg_6: if (!empty($commission8)) { goto jxMSI; } goto dfrzL; QMgNg: $commission8x3 = 0; goto zyxQR; aqI2X: dGHhK: goto frKG5; idEPS: $good = array(); goto xE1Qc; KMH3D: $commission6 = 0; goto smc9d; UAQCs: if (!empty($commission3x2)) { goto apX5b; } goto C3E5G; Wi1CU: if (!($commission8 == 0)) { goto oF1jP; } goto e7yD8; mkAMz: $query_condition = "SELECT bjog.order_status,orders.status,orders.createtime,orders.ordersn,bjog.status3 as status1,
					bjog.commission3*bjog.total as commission,( {$conditionMember}) realname  FROM " . tablename('mihua_mall_order') . ' orders left join  ' . tablename('mihua_mall_order_goods') . " bjog on bjog.orderid=orders.id   
					WHERE  orders.uniacid = '{$_W['uniacid']}' and bjog.commission!=0" . $condition3; goto WK6fM; MTLoh: $commissioned = $profile['commission']; goto NfEAL; cmK97: if (!empty($commission7)) { goto dXe5C; } goto YdoTZ; nzftz: $commission4 = $commission4 + $commission4x2 + $commission4x3; goto m82gA; D6gc2: if (!empty($commission6_1x2)) { goto x4TQW; } goto juE8J; cLuSL: die(json_encode(array("result" => 1, "str" => "申请佣金失败，请您重新提交申请"))); goto Xas0z; lhglz: if (!($commission9 == 0)) { goto xOU3K; } goto NNt8P; s_RtH: WrV24: goto GDlOU; L05e3: if (!($commission1 == 0)) { goto rlpfa; } goto W22R9; Whr7N: $commission2 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . ' and g.status = 1)  )   and o.uniacid = ' . $_W['uniacid'] . '  and o.status >=3  and  g.createtime>=' . $profile['flagtime']); goto Qnq7o; L0Kc4: $listx = pdo_fetchall($query_condition); goto ivwrW; ivwrW: mnMa0: goto iIDsc; PcfxU: $total = sizeof($listx); goto RHixM; DPjT3: exit; goto HehHl; tTXR5: if (!empty($commission9_1)) { goto G8oHr; } goto b_ris; ZeWYf: dXe5C: goto oMEjI; A0utd: $commission4_1x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto gqJa2; FZb62: mkgiy: goto O5FIN; WtnQL: SPj5u: goto gYT8P; ZX3WB: $list = pdo_fetchall($query_condition . ' ORDER BY createtime DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto DG9vg; ZpQAB: if (!empty($commission5_1x2)) { goto i3zVY; } goto d06As; RHixM: $pager = pagination($total, $pindex, $psize); goto U5x_4; eUuSE: if (!($commission5_1 == 0)) { goto KFb6C; } goto ckJ5x; X6UVS: if (!empty($commission3x3)) { goto YOp2G; } goto lzTSY; WS_gP: HDoSf: goto kUJvh; d06As: $commission5_1x2 = 0; goto Th8jK; w7O1F: $commission8x3 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto AUg_6; C_rr9: $commission7x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto cmK97; XWZGA: if (!($op == 'commissionList')) { goto XMfaI; } goto JdnZ5; leVd1: hSuDb: goto hNH6Y; RQczs: $condition1 = $condition . ' AND (orders.shareid = \'' . $profile['id'] . '\') AND orders.createtime>=' . $profile['flagtime'] . ' AND orders.from_user<>\'' . $from_user . '\''; goto qUgAv; Hf4Wd: $commission4x2 = 0; goto UC0SM; ey52D: ccL6z: goto PcfxU; SdQJ9: k_zUD: goto A3aEi; HfevY: $template = $this->selectTemplate('page_commissionList'); goto Efbtl; BjBO3: $commissioningpe = 0; goto CvEKQ; fhdI3: $commission9_1x3 = 0; goto WqV7U; y_mCE: $commission6x3 = 0; goto CP64O; vSzyN: $profile = $this->getProfile(); goto jCa3P; zx6Ki: M_snI: goto QMLw8; AhtTY: uj7SC: goto MXNpK; ydSlU: $psize = 10; goto nQZWW; zjwc5: $template = $this->selectTemplate('forbidden'); goto wHF5I; dM2u8: if (!($applyMoney < $settings['zhifuCommission'] && $applyMoney > $settings['maxCommission'])) { goto gOfPM; } goto WzSAd; ckgwj: $commission8x2 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto w7O1F; NfEAL: $total = pdo_fetchcolumn('select count(id) from ' . tablename('mihua_mall_commission') . ' where mid =' . $profile['id'] . ' and flag = 0'); goto biwJi; TZLEE: global $_W, $_GPC; goto hO1GS; ndHFh: $commission6 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1))  and  g.createtime>=' . $profile['flagtime']); goto w43at; tdCOe: $commission4_1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0))  and  g.createtime>=' . $profile['flagtime']); goto hYtJt; ga91M: uWyU6: goto Ksllw; w43at: $commission6x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto Oom1q; Oom1q: $commission6x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto Q2ANN; wHF5I: include $this->template($template); goto L6Emq; OXqYQ: $commissioningpex2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid2 = ' . $profile['id'] . ' and g.order_status = 0 and g.status2=0)  ) and o.uniacid = ' . $_W['uniacid'] . " and  o.status = 3  {$level2enable}  and  g.createtime>=" . $profile['flagtime'] . $refundtimectro); goto Qm26S; W1wtu: if (!empty($commission5_1x3)) { goto Hdupf; } goto zVPRc; uxxiN: if (!empty($commission3)) { goto nGG2f; } goto L3RVJ; lzTSY: $commission3x3 = 0; goto WucQK; RXNOO: if (!empty($commission4x2)) { goto wDfx7; } goto Hf4Wd; MAFgW: if (!($commission7 == 0)) { goto hm95P; } goto gVdmA; WOC_N: $commission9_1 = '0.00'; goto nc8wi; uhIrJ: $lastMoney = floatval($totalmoney) - floatval($applyMoney); goto cwwhs; KENHf: if (!empty($commissioningpex3)) { goto Ze22m; } goto G6EcA; gRp91: y_eBn: goto IMCno; TlEFx: $id = $profile['id']; goto FKwQn; x13yu: $commissioningpe = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . ' and g.order_status = 1 and g.status=0)  ) and o.uniacid = ' . $_W['uniacid'] . ' and   o.status = 3  and  g.createtime>=' . $profile['flagtime'] . $refundtimectro); goto OXqYQ; oXeE0: $applyType = $_GPC['applyType']; goto wJAdu; ffGX4: die(json_encode(array("result" => 1, "str" => "申请佣金失败，请您重新提交申请"))); goto I6r11; NbI69: exit; goto Qasnx; FvlT6: jxMSI: goto k3_cv; q3pmM: $commission7x2 = 0; goto xPxlI; rm4p3: Cm6tQ: goto w3kTw; z4x0D: $total = sizeof($listx); goto UuRMP; QQ6OI: P0hAK: goto slQ1J; Gllsf: $commission4_1x2 = 0; goto nGS5v; LBIcL: mZNuR: goto ENGyd; L3RVJ: $commission3 = 0; goto ZTI29; nGS5v: qS0_n: goto P9mWM; Oxa5r: $commission4_1 = '0.00'; goto mldjV; se2Vy: JBiZ_: goto gWze8; LO31k: message('未登录', $this->createMobileUrl('list'), 'error'); goto yxcQf; spAey: goto mnMa0; goto Gr0wu; hQhEe: etQjD: goto mjBIk; boGOg: foreach ($orders as $order) { goto ggbl_; NDBlu: if (!($order['level'] == 3)) { goto K2K54; } goto TS0B9; HNBgB: if (!($order['level'] == 2)) { goto g30u8; } goto PHiMv; TS0B9: $update = array("status3" => 1, "commissionid" => $commissionid, "applytime3" => time()); goto DdsNN; TmkoW: $update = array("status" => 1, "commissionid" => $commissionid, "applytime" => time()); goto bb0T6; o6XR0: LLlYK: goto HIXZM; FuAZ7: if (!($order['level'] == 1)) { goto CR_E4; } goto TmkoW; rC0ng: D0Qs3: goto gi8Dr; h04av: g30u8: goto NDBlu; ggbl_: if (!($order['shareid'] == $profile['id'])) { goto Z0T_0; } goto E3Y_8; DdsNN: K2K54: goto apGWo; bb0T6: CR_E4: goto HNBgB; E3Y_8: if (!(!empty($order['commission']) && $order['commission'] > 0 && $order['createtime'] >= $profile['flagtime'])) { goto D0Qs3; } goto FuAZ7; gi8Dr: Z0T_0: goto o6XR0; apGWo: pdo_update('mihua_mall_order_goods', $update, array("id" => $order['id'], "uniacid " => $_W['uniacid'])); goto oQr8I; oQr8I: $almoney = $almoney + $order['commission'] * $order['total']; goto rC0ng; PHiMv: $update = array("status2" => 1, "commissionid" => $commissionid, "applytime2" => time()); goto h04av; HIXZM: } goto cS3Tz; ek29s: $pager = pagination($total, $pindex, $psize); goto sKmWQ; ZTI29: nGG2f: goto UAQCs; fCHMr: if (!empty($from_user)) { goto ULpq_; } goto LO31k; q2kOO: $commission1x3 = 0; goto rgnla; HehHl: OilPu: goto uhIrJ; Izexi: $tmp = pdo_insert('mihua_mall_commissionPay', $data); goto eMatv; lkwNN: ZBSlM: goto YuouR; oLqIs: if (!empty($commission6x2)) { goto jbLB0; } goto qYUUS; QKmbp: $level2enable = ' and 1!=1 '; goto WAvpA; VemOD: $this->setuid($from_user); goto rZfTn; IMCno: $commission7 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3   and  g.createtime>=' . $profile['flagtime']); goto kCadp; CePpc: if (!empty($commission2)) { goto W7dKZ; } goto mWajQ; jHbo4: Ze22m: goto DB4Z3; oyWjh: $address = array(); goto KvLtm; G6EcA: $commissioningpex3 = 0; goto jHbo4; e8eBZ: if (!($settings['globalCommissionLevel'] < 3)) { goto Cm6tQ; } goto VsO3o; PXbQg: QSk7e: goto sDX3X; efpCn: if (!empty($commission9_1x3)) { goto wed_0; } goto fhdI3; TCyis: $commission8 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =1 or o.status =0)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1))  and  g.createtime>=' . $profile['flagtime']); goto ckgwj; kASkY: $commission5 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ')  and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status >1)) or ((o.paytype=1 or o.paytype=2 ) and o.status >0))  and  g.createtime>=' . $profile['flagtime']); goto jmFS_; gM_8y: if (!empty($commission5x3)) { goto hSuDb; } goto Ob5Cd; gqJa2: if (!empty($commission4_1)) { goto uj7SC; } goto pTfue; k3scd: $commission5x3 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ')  and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status >1)) or ((o.paytype=1 or o.paytype=2 ) and o.status >0)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto vafkW; JTSTs: $from_user = $_W['openid']; goto fCHMr; J1nLX: goto M_snI; goto QQ6OI; mldjV: hDQTD: goto kASkY; iIDsc: goto ccL6z; goto hQhEe; cwwhs: $uid = mc_openid2uid($from_user); goto CkM3j; VsO3o: $level3enable = ' and 1!=1 '; goto rm4p3; EZvy6: exit; goto zx6Ki; Cj_U6: $commission2x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ( (o.shareid3 = ' . $profile['id'] . ' and g.status3 = 1)  )   and o.uniacid = ' . $_W['uniacid'] . "  and o.status >=3  {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto CePpc; fxysw: if (!($op == 'applyed')) { goto dBW8L; } goto qy6ru; YdoTZ: $commission7 = 0; goto ZeWYf; pmS0R: uC8hV: goto RXNOO; m82gA: if (!($commission4 == 0)) { goto Ii50c; } goto RmOZf; zyxQR: IkRHm: goto YJf3c; MXNpK: if (!empty($commission4_1x2)) { goto qS0_n; } goto Gllsf; ZSCu_: RguJV: goto EGH81; lNZQi: $template = $this->selectTemplate('page_commapply'); goto QQKqN; JdnZ5: $pindex = max(1, intval($_GPC['page'])); goto DHEGD; nQZWW: $condition = ' and orders.status >= 0 '; goto RQczs; oUNvL: $commission6_1x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =2)) or ((o.paytype=1 or o.paytype=2 ) and o.status =2)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto dTOuG; aA6Sm: ZkIQZ: goto rKoJ5; nqQME: if (!empty($commission8x3)) { goto IkRHm; } goto QMgNg; Rd4kE: foreach ($orders as $order) { goto hMABU; V92S7: if (!(!empty($order['commission']) && $order['commission'] > 0 && $order['createtime'] >= $profile['flagtime'])) { goto uyXll; } goto ZW2tv; W2nJW: pdo_update('mihua_mall_order_goods', $update, array("id" => $order['id'], "uniacid " => $_W['uniacid'])); goto Oldqo; YNiVH: $update = array("status3" => 0, "commissionid" => 0, "applytime3" => time()); goto QjO5w; LNwFg: if (!($order['level'] == 3)) { goto B5jYH; } goto YNiVH; QjO5w: B5jYH: goto W2nJW; Oldqo: uyXll: goto trLAn; hMABU: if (!($order['shareid'] == $profile['id'])) { goto jDawX; } goto V92S7; fbiFL: G4LMQ: goto YuMTk; trLAn: jDawX: goto pAC99; ZW2tv: if (!($order['level'] == 1)) { goto G4LMQ; } goto iZ_jZ; Ig3PK: GARev: goto LNwFg; u50z2: $update = array("status2" => 0, "commissionid" => 0, "applytime2" => time()); goto Ig3PK; YuMTk: if (!($order['level'] == 2)) { goto GARev; } goto u50z2; iZ_jZ: $update = array("status" => 0, "commissionid" => 0, "applytime" => time()); goto fbiFL; pAC99: oU7xV: goto FQ7rt; FQ7rt: } goto se2Vy; dyLa8: $commissionid = date('mdHis') . random(4, 1); goto Q1K4P; RCH0D: RgfCQ: goto TFXfM; ImhUd: if (!empty($commission4)) { goto uC8hV; } goto A212O; Efbtl: include $this->template($template); goto g_5P4; L86mf: $psize = 15; goto mamuo; vviol: $list = pdo_fetchall($query_condition . ' ORDER BY createtime DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto L0Kc4; RmOZf: $commission4 = '0.00'; goto opaZU; qI_zw: CgHLv: goto ZpQAB; Xas0z: exit; goto J1nLX; hYtJt: $commission4_1x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto A0utd; h69OI: $myheadimg['tag'] = mc_credit_fetch($uid); goto o81Vk; DQj07: $listx = pdo_fetchall($query_condition); goto Vxyd5; KvLtm: foreach ($addresss as $adr) { $address[$adr['id']] = $adr['realname']; ubx2p: } goto Md402; QQKqN: include $this->template($template); goto NbI69; Qnq7o: $commission2x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid2 = ' . $profile['id'] . ' and g.status2 = 1) )   and o.uniacid = ' . $_W['uniacid'] . "  and o.status >=3  {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto Cj_U6; tnrg6: if ($level == 2) { goto fBfUS; } goto mpIf7; lrUS5: $list = pdo_fetchall('select co.isshare,co.commission, co.createtime, og.orderid, og.goodsid, og.total,oo.ordersn from ' . tablename('mihua_mall_commission') . ' as co left join ' . tablename('mihua_mall_order_goods') . ' as og on co.ogid = og.id and co.uniacid = og.uniacid left join ' . tablename('mihua_mall_order') . ' as oo on oo.id = og.orderid and co.uniacid = og.uniacid where co.mid =' . $profile['id'] . ' and co.flag = 0 ORDER BY co.createtime DESC limit 10'); goto Fxb9r; BfwHQ: M1PJy: goto GyevF; FKwQn: if (!(intval($profile['id']) && $profile['status'] == 0)) { goto E80Uw; } goto zjwc5; EGH81: $commission3 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . ' and g.status = -1) ) and o.uniacid = ' . $_W['uniacid'] . '   and  g.createtime>=' . $profile['flagtime']); goto QvIzl; yE06v: aNYWD: goto nzftz; ckJ5x: $commission5_1 = '0.00'; goto vIaYU; xYTKJ: goto MyfUg; goto RCH0D; Vvb6h: Dm60l: goto XWZGA; yxhzL: $opp = 'more'; goto UwHze; O9iKv: $pindex = max(1, intval($_GPC['page'])); goto ydSlU; vafkW: if (!empty($commission5)) { goto SPj5u; } goto qP3uM; Z454C: $commission4x2 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto gdvYY; W22R9: $commission1 = '0.00'; goto f_NrJ; vIaYU: KFb6C: goto ndHFh; XEdHd: $commission7x3 = 0; goto cvwkn; nBLZN: if (!empty($commission2x2)) { goto uWyU6; } goto JfdHV; YjpnM: $commission3 = $commission3 + $commission3x2 + $commission3x3; goto Hdw6I; I6r11: exit; goto PXbQg; AjgJ2: if (!($commission6_1 == 0)) { goto y_eBn; } goto beBq_; b2cJZ: die(json_encode(array("result" => 1, "str" => "获取余额失败，请您重新提交申请"))); goto keCHi; Y4oQc: if (!empty($commissioningpe)) { goto oJE3_; } goto BjBO3; WK6fM: $list = pdo_fetchall($query_condition . ' ORDER BY createtime DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto DQj07; cvwkn: Px3yq: goto FjST4; RBXQG: $commission5_1 = $commission5_1 + $commission5_1x2 + $commission5_1x3; goto eUuSE; VeJ5R: $level = intval($_GPC['level']) ? intval($_GPC['level']) : 1; goto O9iKv; kNJje: HcoEi: goto aPCIm; DuGx1: if (!$orders) { goto XK1uu; } goto Rd4kE; m2Ug9: gOfPM: goto emBrD; JfdHV: $commission2x2 = 0; goto ga91M; tX5Mt: if (!($op == 'commissionDetail')) { goto Dm60l; } goto VeJ5R; kS43q: $list2 = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_commissionPay') . ' WHERE from_user=\'' . $from_user . '\' AND uniacid=' . $_W['uniacid'] . ' ORDER BY id DESC  LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto QHGGT; juE8J: $commission6_1x2 = 0; goto qBodY; g5jZD: $commission4_1x3 = 0; goto kNJje; TuR20: goto M1PJy; goto aqI2X; re0bK: apX5b: goto X6UVS; jCa3P: $settings = $this->module['config']; goto VemOD; hpqvv: $commission1x2 = 0; goto lkwNN; bA1T9: $commissionid = date('mdHis') . random(4, 1); goto xYTKJ; xPxlI: sIHoN: goto BDbIh; Q1K4P: MyfUg: goto sqahV; DHEGD: $psize = 10; goto kS43q; o81Vk: load()->model('mc'); goto Y4DBq; j5Sqh: if (!$orders) { goto guV3e; } goto boGOg; UHzx0: WSen0: goto tX5Mt; TxSqY: k9oWu: goto poU7B; gdvYY: $commission4x3 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =0 or o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =0)) {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto ImhUd; U2sqf: $commission9x3 = 0; goto UQG2r; jiWp6: foreach ($noticeid as &$adminid) { $this->sendtmpmsg_red($adminid['from_user'], $sendMsgApply, $url, $goodstitle, $profile['realname'], $applyMoney . '元', $time, ''); P4kcZ: } goto eMvzm; qGgKl: $commission6_1x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =2)) or ((o.paytype=1 or o.paytype=2 ) and o.status =2)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto oUNvL; b0mT8: mMpv9: goto uLKx7; ZV9P7: $commission9x2 = 0; goto SdQJ9; UuRMP: $pager = pagination($total, $pindex, $psize); goto HfevY; UY9Of: $goodstitle = '您有新的提现申请，请及时审核'; goto N2EM0; qUgAv: $condition2 = $condition . ' AND (orders.shareid2 = \'' . $profile['id'] . '\') AND orders.createtime>=' . $profile['flagtime'] . " {$level2enable} AND orders.from_user<>'" . $from_user . '\''; goto XxfJJ; B0HtC: W7dKZ: goto nBLZN; LGb79: $profile = $this->getProfile(); goto HvXvr; wBGwG: $commission9x2 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto cMMWE; qP3uM: $commission5 = 0; goto WtnQL; kgjfS: $commissioningpe_now = $commissioningpe + $commissioningpex2 + $commissioningpex3; goto Fte3r; Fxb9r: goto Mf4FC; goto AUqla; Y1SaV: tGI2I: goto Y4oQc; yGZsx: $commission9 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3  and  g.createtime>=' . $profile['flagtime']); goto wBGwG; O5FIN: $commission2 = $commission2 + $commission2x2 + $commission2x3; goto RCVeV; CullL: Hdupf: goto RBXQG; lynMG: if (!($settings['globalCommissionLevel'] < 2)) { goto d3cIv; } goto QKmbp; sr0_F: $conditionMember = 'select m.realname from ' . tablename('mihua_mall_member') . ' m where m.from_user=orders.from_user 
				and m.uniacid=' . $_W['uniacid'] . ' limit 1 '; goto gnAUU; mzmdu: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto TlEFx; GDlOU: if (!empty($commission1x2)) { goto ZBSlM; } goto hpqvv; gjxgG: $commission9 = $commission9 + $commission9x2 + $commission9x3; goto lhglz; CvEKQ: oJE3_: goto kgjfS; FEHQ8: if (!empty($commission9_1x2)) { goto gCP6I; } goto o5Gc4; AKZ2K: $addresss = pdo_fetchall('select id, realname from ' . tablename('mihua_mall_address') . ' where uniacid = ' . $_W['uniacid']); goto oyWjh; Huml4: $sendMsgApply = $settings['sendMsgApply']; goto xwtAW; YJf3c: $commission8 = $commission8 + $commission8x2 + $commission8x3; goto Wi1CU; bCLyg: $commission6 = '0.00'; goto b0mT8; AUqla: maJGs: goto yxhzL; DG9vg: $listx = pdo_fetchall($query_condition); goto ey52D; TI9Na: $commission9_1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid = ' . $profile['id'] . '  and g.status=1)) and o.uniacid = ' . $_W['uniacid'] . ' and o.status =3   and  g.createtime>=' . $profile['flagtime']); goto pcBRY; RMDn2: $commission1 = $commission1 + $commission1x2 + $commission1x3; goto L05e3; QMLw8: VTuvZ: goto lti_e; vJF6l: jTyeP: goto IB20j; g_5P4: exit; goto PgNur; slQ1J: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('commissionPay'); goto Le0vh; Y4DBq: $modulephp = 'commission'; goto xXO0l; Abv22: lgIH2: goto nqQME; yhEW_: $result = pdo_update('mihua_mall_member', array("balance" => $totalmoney), array("uid" => $uid, "uniacid " => $_W['uniacid'])); goto cLuSL; keCHi: exit; goto Gk9jU; o3R39: die(json_encode(array("result" => 1, "str" => "申请的金额不能大于现有佣金总金额"))); goto DPjT3; C3E5G: $commission3x2 = 0; goto re0bK; WAvpA: d3cIv: goto e8eBZ; WqV7U: wed_0: goto rbQzF; nizbO: $commission5 = '0.00'; goto WS_gP; Vxyd5: KOZl6: goto spAey; qYUUS: $commission6x2 = 0; goto xozty; CNlum: $commission3 = '0.00'; goto aA6Sm; jmFS_: $commission5x2 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ')  and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status >1)) or ((o.paytype=1 or o.paytype=2 ) and o.status >0)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto k3scd; dfrzL: $commission8 = 0; goto FvlT6; mpIf7: if (!($level == 3)) { goto KOZl6; } goto mkAMz; hSImy: if (!empty($commission6_1x3)) { goto k9oWu; } goto VuboI; A212O: $commission4 = 0; goto pmS0R; QEt7P: if ($commissioningpe_re > 0) { goto dGHhK; } goto rq09Y; rDT3V: $signPackage = $this->getSignPackage($modulephp); goto Dm9kl; biwJi: if ($_GPC['opp'] == 'more') { goto maJGs; } goto lrUS5; ZRyZS: $commission3x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid3 = ' . $profile['id'] . ' and g.status3 = -1) ) and o.uniacid = ' . $_W['uniacid'] . "   {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto uxxiN; X2m0C: $template = $this->selectTemplate('page_commission'); goto IRk0S; Vmgpr: $commission4x3 = 0; goto yE06v; yxcQf: ULpq_: goto vSzyN; Qmgm9: if (!empty($commission6x3)) { goto GjcxR; } goto y_mCE; Ob5Cd: $commission5x3 = 0; goto leVd1; pG1LP: jTwr0: goto D6gc2; wauAN: if (!($commission5 == 0)) { goto HDoSf; } goto nizbO; e7yD8: $commission8 = '0.00'; goto nehej; beBq_: $commission6_1 = '0.00'; goto gRp91; pTfue: $commission4_1 = 0; goto AhtTY; poU7B: $commission6_1 = $commission6_1 + $commission6_1x2 + $commission6_1x3; goto AjgJ2; W6aLQ: xOU3K: goto TI9Na; cMMWE: $commission9x3 = pdo_fetchcolumn('SELECT sum((o.price)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto pSMty; tw7jt: $commission5_1x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . " and ( (o.paytype=3 and (o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1)) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto tuxfT; kUJvh: $commission5_1 = pdo_fetchcolumn('SELECT sum((g.commission*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ') and o.uniacid = ' . $_W['uniacid'] . ' and ( (o.paytype=3 and (o.status =1)) or ((o.paytype=1 or o.paytype=2 ) and o.status =1))  and  g.createtime>=' . $profile['flagtime']); goto tw7jt; TFXfM: $orders = pdo_fetchall('SELECT 1 as level,g.id,g.commission as commission,g.total,g.createtime,o.shareid as shareid FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid = ' . $profile['id'] . ' and g.status= 0) and o.uniacid = ' . $_W['uniacid'] . '  and o.status = 3 and o.from_user != \'' . $from_user . '\' and  g.createtime>=' . $profile['flagtime'] . ' union all (' . 'SELECT 2 as level,g.id,g.commission2 as commission,g.total,g.createtime,o.shareid2 as shareid FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid2 = ' . $profile['id'] . ' and g.status2 = 0) and o.uniacid = ' . $_W['uniacid'] . "  and o.status = 3 {$level2enable} and o.from_user != '" . $from_user . '\' and  g.createtime>=' . $profile['flagtime'] . ')' . ' union all (' . 'SELECT 3 as level,g.id,g.commission3 as commission,g.total,g.createtime,o.shareid3 as shareid FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE (o.shareid3 = ' . $profile['id'] . ' and g.status3 = 0) and o.uniacid = ' . $_W['uniacid'] . "  and o.status = 3 {$level3enable} and o.from_user != '" . $from_user . '\' and  g.createtime>=' . $profile['flagtime'] . ')'); goto bOoIE; C4Z8Z: E80Uw: goto lynMG; h0Vot: $commission5_1 = 0; goto qI_zw; smc9d: EFWZc: goto oLqIs; cS3Tz: Ox07k: goto TLUqg; v5pNb: $commission1x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ( (o.shareid2 = ' . $profile['id'] . ' and g.order_status = 0)  )  and o.uniacid = ' . $_W['uniacid'] . " and (o.status =1 or o.status =2) {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto gFAtc; mM1kk: if (!empty($result) || $result == 0) { goto DgYfa; } goto b2cJZ; u83fi: $commission6 = $commission6 + $commission6x2 + $commission6x3; goto DdCW_; sV_US: $commission9_1x3 = pdo_fetchcolumn('SELECT sum((g.commission3*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid3 = ' . $profile['id'] . '  and g.status3=1)) and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level3enable}  and  g.createtime>=" . $profile['flagtime']); goto tTXR5; mWajQ: $commission2 = 0; goto B0HtC; aR3xw: exit; goto m2Ug9; UC0SM: wDfx7: goto qiebS; bOoIE: $almoney = 0; goto j5Sqh; oMEjI: if (!empty($commission7x2)) { goto sIHoN; } goto q3pmM; kq_mS: if (!($commission9_1 == 0)) { goto zSMks; } goto WOC_N; GyevF: if (!($applyMoney > $totalmoney)) { goto OilPu; } goto DuGx1; BDbIh: if (!empty($commission7x3)) { goto Px3yq; } goto XEdHd; RNWvl: if (!empty($commission1)) { goto WrV24; } goto ASSV8; VwqY2: if (!empty($commission5_1)) { goto CgHLv; } goto h0Vot; emBrD: fMeuD: goto dyLa8; HvXvr: VRe0y: goto qvjAC; h5EMG: $commission9 = 0; goto vJF6l; nehej: oF1jP: goto yGZsx; j0BBn: $refundtimectro = ' and g.createtime <= (now() - 86400 * ' . $fundtime . ')'; goto x13yu; xXO0l: if (!empty($profile['id'])) { goto VRe0y; } goto dEAQ1; XxfJJ: $condition3 = $condition . ' AND (orders.shareid3 = \'' . $profile['id'] . '\') AND orders.createtime>=' . $profile['flagtime'] . " {$level3enable} AND orders.from_user<>'" . $from_user . '\''; goto sr0_F; A3aEi: if (!empty($commission9x3)) { goto Uz2zB; } goto U2sqf; frKG5: $totalmoney = floatval($almoney) + floatval($commissioningpe_re); goto BfwHQ; Dm9kl: $uniacid = $_W['uniacid']; goto mzmdu; aqlqc: $fundtime = $this->getRefundtime(); goto j0BBn; Fte3r: $commissioningpe = $commissioningpe_now + $commissioningpe_re; goto YNvQC; PAx4M: if (!($commission4_1 == 0)) { goto hDQTD; } goto Oxa5r; FjST4: $commission7 = $commission7 + $commission7x2 + $commission7x3; goto MAFgW; NNt8P: $commission9 = '0.00'; goto W6aLQ; WzSAd: die(json_encode(array("result" => 1, "str" => '申请提现失败！单笔提现金额需大于' . $settings['zhifuCommission'] . '，小于' . $settings['maxCommission']))); goto aR3xw; PgNur: XMfaI: goto TjUcK; VuboI: $commission6_1x3 = 0; goto TxSqY; IRk0S: include $this->template($template); goto hMciI; Le0vh: $noticeid = pdo_fetchall('select from_user from ' . tablename('mihua_mall_admin') . '  where msg_flag=\'0\'  and uniacid = \'' . $_W['uniacid'] . '\''); goto UY9Of; pcBRY: $commission9_1x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid2 = ' . $profile['id'] . '  and g.status2=1)) and o.uniacid = ' . $_W['uniacid'] . " and o.status =3 {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto sV_US; qIPxA: $commission5x2 = 0; goto v6uVS; ASSV8: $commission1 = 0; goto s_RtH; P9mWM: if (!empty($commission4_1x3)) { goto HcoEi; } goto g5jZD; dEAQ1: $this->autoRegedit($modulephp); goto LGb79; RCVeV: if (!($commission2 == 0)) { goto RguJV; } goto dhTZc; YuouR: if (!empty($commission1x3)) { goto sZWTB; } goto q2kOO; b_ris: $commission9_1 = 0; goto q9y48; gnAUU: if ($level == 1) { goto etQjD; } goto tnrg6; tQvob: $commissioningpex2 = 0; goto Y1SaV; qBodY: x4TQW: goto hSImy; dhTZc: $commission2 = '0.00'; goto ZSCu_; QvIzl: $commission3x2 = pdo_fetchcolumn('SELECT sum((g.commission2*g.total)) FROM ' . tablename('mihua_mall_order') . ' as o left join ' . tablename('mihua_mall_order_goods') . ' as g on o.id = g.orderid and o.uniacid = g.uniacid WHERE ((o.shareid2 = ' . $profile['id'] . ' and g.status2 = -1) ) and o.uniacid = ' . $_W['uniacid'] . "   {$level2enable}  and  g.createtime>=" . $profile['flagtime']); goto ZRyZS; N2EM0: $time = date('Y-m-d H:i:s'); goto O3Enb; h5nQq: include $this->template($template); goto r3pS1; qvjAC: $user_result = pdo_fetch('select * from ' . tablename('mihua_mall_member') . " where from_user='{$_W['openid']}' "); goto rDT3V; Gr0wu: fBfUS: goto lKZjX; hMciI: } public function doMobileBankcard() { goto Iwq1g; LJGC4: IzvLz: goto WuCkK; HomAM: RIQYY: goto M7wYu; OwFu8: exit; goto NCZlD; RmUIt: exit; goto LJGC4; ZI8Hf: include $this->template($template); goto QhILc; wEvDZ: if (!empty($profile['id'])) { goto GD1yW; } goto Xxrqv; ESbkd: echo 0; goto sTYkr; hcYV5: $signPackage = $this->getSignPackage($modulephp); goto MhEOM; cdkeF: load()->model('mc'); goto KmTz9; NCZlD: h_Y55: goto PoBie; xNE3a: $this->toflag(); goto KeqHD; KeqHD: $from_user = $_W['openid']; goto QlzgG; tFNfF: if (!empty($from_user)) { goto pH5yq; } goto C6Byv; Nyzen: if (!empty($profile['id'])) { goto kA6do; } goto i848b; BAySL: $rule = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rule') . ' WHERE `uniacid` = :uniacid ', array(":uniacid" => $_W['uniacid'])); goto tFNfF; Xxrqv: $this->autoRegedit($modulephp); goto BZ_VX; uoI1Y: sHFOC: goto j4b1P; fINph: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto BAySL; oaGpe: exit; goto uoI1Y; j4b1P: if (!($op == 'edit')) { goto h_Y55; } goto u2iLZ; Iwq1g: global $_W, $_GPC; goto xNE3a; gEOjJ: include $this->template($template); goto Rp5mS; i848b: $template = $this->selectTemplate('forbidden'); goto ZI8Hf; lqRmm: $id = $profile['id']; goto Nyzen; KmTz9: $modulephp = 'bankcard'; goto wEvDZ; TinER: message('请先注册', $this->createMobileUrl('register'), 'error'); goto oaGpe; BZ_VX: $profile = $this->getProfile(); goto HY7dI; Wbf32: if (!empty($profile)) { goto sHFOC; } goto TinER; Je4pQ: if (!($_GPC['opp'] == 'complated')) { goto IzvLz; } goto v5mTl; g1y5r: SXSZT: goto OwFu8; u2iLZ: $data = array("bankcard" => $_GPC['bankcard'], "banktype" => $_GPC['banktype'], "alipay" => $_GPC['alipay'], "wxhao" => $_GPC['wxhao']); goto IrqKa; Os2mL: kA6do: goto Wbf32; PoBie: $template = $this->selectTemplate('bankcard'); goto gEOjJ; IrqKa: if (!empty($data['bankcard']) && !empty($data['banktype'])) { goto RIQYY; } goto ESbkd; TVxk7: exit; goto hJzlq; HY7dI: GD1yW: goto hcYV5; MhEOM: $uniacid = $_W['uniacid']; goto fINph; sTYkr: goto SXSZT; goto HomAM; QhILc: exit; goto Os2mL; C6Byv: message('你想知道怎么加入么?', $rule['gzurl'], 'sucessr'); goto TVxk7; WuCkK: echo 1; goto g1y5r; v5mTl: echo 3; goto RmUIt; M7wYu: pdo_update('mihua_mall_member', $data, array("from_user" => $from_user)); goto Je4pQ; QlzgG: $profile = $this->getProfile(); goto cdkeF; hJzlq: pH5yq: goto lqRmm; Rp5mS: } public function doMobileFansorder() { goto SD77a; xPpdi: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto G0U0f; G0U0f: $cfg = $this->module['config']; goto j6x6h; cQi9R: $level3enable = ' and 1!=1 '; goto MHSlJ; ONyF2: $signPackage = $this->getSignPackage($modulephp); goto mVkLP; bgTHY: WYYB3: goto tBfQv; sBr7R: $psize = 30; goto lxgv7; H9f7k: $conditionMember = 'select m.realname from ' . tablename('mihua_mall_member') . ' m where m.from_user=o.from_user and m.uniacid=' . $_W['uniacid']; goto YeDx5; yL7nE: include $this->template($template); goto mvwyl; XwBiL: $this->toflag(); goto cjjjd; ddI1F: $condition1 = $conditionx . ' AND (o.shareid = \'' . $profile['id'] . '\')  AND o.createtime>=' . $profile['flagtime'] . ' AND o.from_user<>\'' . $from_user . '\''; goto XFASY; tBtRc: $template = $this->selectTemplate('fansorder'); goto fLzJE; TBEtr: $id = $profile['id']; goto eFvES; VIbgG: $address = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_address') . ' WHERE id IN (\'' . implode('\',\'', $addressids) . '\')', array(), 'id'); goto ZQq3N; sER9G: if (empty($addressids)) { goto Hq98U; } goto VIbgG; SGPcm: $user = pdo_fetch('select * from ' . tablename('mihua_mall_member') . ' where id = ' . $profile['id'] . ' and uniacid = ' . $_W['uniacid']); goto Onc7B; uhZAS: if (!($cfg['globalCommissionLevel'] < 3)) { goto yDA_U; } goto cQi9R; fLzJE: include $this->template($template); goto ODZgz; hz7YL: foreach ($list as $lkey => $l) { goto oFqRH; HBTD5: $list[$lkey]['commissions'] = $commissions; goto PYvEq; AuwYB: R615T: goto HBTD5; uQxYx: foreach ($commissions as $key => $commission) { goto R5oOp; yDg79: mIU3U: goto Pvh6e; JYb7s: C61vg: goto l93ZS; R5oOp: $goods = pdo_fetch('select title,thumb from ' . tablename('mihua_mall_goods') . ' where id = ' . $commission['goodsid']); goto lCcVL; l7NC3: $commissions[$key]['commission'] = $commission['commission3'] * $commission['total']; goto JYb7s; G2W7x: $commissions[$key]['commission'] = $commission['commission'] * $commission['total']; goto yDg79; PmNIU: VE4QH: goto U2H8C; l93ZS: p0j_i: goto ZXoxI; lCcVL: $commissions[$key]['thumb'] = $goods['thumb']; goto uEE1L; M9XTN: if (!($l['level'] == 1)) { goto mIU3U; } goto G2W7x; uEE1L: $commissions[$key]['title'] = $goods['title']; goto M9XTN; SEFBj: $commissions[$key]['commission'] = $commission['commission2'] * $commission['total']; goto PmNIU; U2H8C: if (!($l['level'] == 3)) { goto C61vg; } goto l7NC3; Pvh6e: if (!($l['level'] == 2)) { goto VE4QH; } goto SEFBj; ZXoxI: } goto AuwYB; oFqRH: $commissions = pdo_fetchall('select *,\'\' as title,\'\' as thumb from ' . tablename('mihua_mall_order_goods') . ' where orderid = ' . $l['id']); goto uQxYx; PYvEq: qKfIF: goto fmLMU; fmLMU: } goto lbzPn; tBfQv: $status = 0; goto Z2_Lm; s3WI6: if (empty($list)) { goto QDgat; } goto hz7YL; WxKR7: if (!empty($profile)) { goto WYYB3; } goto pjKvZ; xVnf1: unset($row); goto PnhBF; Nw4zC: $allcount = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " 	WHERE uniacid = '{$_W['uniacid']}' {$condition}  ORDER BY status ASC, createtime DESC"); goto B5JJF; OnD_B: QDgat: goto NRkmB; VoN63: $level2enable = ' and 1!=1 '; goto rrZ5N; SD77a: global $_W, $_GPC; goto XwBiL; j6x6h: if (!($cfg['globalCommissionLevel'] < 2)) { goto uGuLn; } goto VoN63; kM4WG: $modulephp = 'fansorder'; goto ioeGc; cjjjd: $from_user = $_W['openid']; goto GZvYj; YNx2f: $total = sizeof($listx); goto vD4lP; XFASY: $condition2 = $conditionx . ' AND (o.shareid2 = \'' . $profile['id'] . '\') AND o.createtime>=' . $profile['flagtime'] . " {$level2enable} AND o.from_user<>'" . $from_user . '\''; goto iza_X; PnhBF: fEeU2: goto sER9G; ioeGc: if (!empty($profile['id'])) { goto kqmSq; } goto JIgUt; BHBZd: exit; goto bgTHY; ZQq3N: Hq98U: goto tBtRc; PKzFt: foreach ($list as &$row) { goto StPrB; StPrB: !empty($row['addressid']) && ($addressids[$row['addressid']] = $row['addressid']); goto HeofH; mcuI9: RxOSO: goto Dfsro; HeofH: $row['dispatch'] = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_dispatch') . ' WHERE id = :id', array(":id" => $row['dispatch'])); goto mcuI9; Dfsro: } goto ufzHH; Ycvyr: $listx = pdo_fetchall("SELECT o.*,'' as commissions,1 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition1}  union all (SELECT o.*,'' as commissions,2 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition2} ) union all (SELECT o.*,'' as commissions,3 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition3} )  "); goto YNx2f; MHSlJ: yDA_U: goto TBEtr; mvwyl: exit; goto wMhJ8; Z2_Lm: $condition = ''; goto Y4jcD; Y4jcD: $condition .= ' AND status >= \'' . intval($status) . '\''; goto SGPcm; GZvYj: $profile = $this->getProfile(); goto SpqVm; A0Lmq: $template = $this->selectTemplate('forbidden'); goto yL7nE; SpqVm: load()->model('mc'); goto kM4WG; wMhJ8: SA0S6: goto WxKR7; NRkmB: if (empty($list)) { goto fEeU2; } goto PKzFt; B5JJF: $countYestay = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}' {$condition} and createtime>=" . strtotime(date('Y-m-d 00:00:00', strtotime('-1 day'))) . ' and createtime<=' . strtotime(date('Y-m-d 23:59:59', strtotime('-1 day'))) . '  ORDER BY status ASC, createtime DESC'); goto ZUzzf; iza_X: $condition3 = $conditionx . ' AND (o.shareid3 = \'' . $profile['id'] . '\') AND o.createtime>=' . $profile['flagtime'] . " {$level3enable} AND o.from_user<>'" . $from_user . '\''; goto qF1FO; YeDx5: $pindex = max(1, intval($_GPC['page'])); goto sBr7R; JIgUt: $this->autoRegedit($modulephp); goto qpeZc; ufzHH: Pa3h2: goto xVnf1; qpeZc: $profile = $this->getProfile(); goto nuHk7; qF1FO: $condition .= ' AND (shareid = \'' . $profile['id'] . '\' or (shareid2 = \'' . $profile['id'] . "' {$level2enable}) or (shareid3 = '" . $profile['id'] . "' {$level3enable})) AND createtime>=" . $profile['flagtime'] . ' AND from_user<>\'' . $from_user . '\''; goto H9f7k; nuHk7: kqmSq: goto ONyF2; rrZ5N: uGuLn: goto uhZAS; ZUzzf: $countToday = pdo_fetchcolumn('SELECT count(id) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}' {$condition} and createtime>=" . strtotime(date('Y-m-d 00:00:00', strtotime('0 day'))) . ' and createtime<=' . strtotime(date('Y-m-d 23:59:59', strtotime('0 day'))) . '  ORDER BY status ASC, createtime DESC'); goto s3WI6; lxgv7: $list = pdo_fetchall("SELECT o.*,'' as commissions,1 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition1}  union all (SELECT o.*,'' as commissions,2 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition2} ) union all (SELECT o.*,'' as commissions,3 as level,( {$conditionMember}) realname FROM " . tablename('mihua_mall_order') . " o WHERE o.uniacid = '{$_W['uniacid']}' {$condition3} )  ORDER BY  createtime DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto Ycvyr; pjKvZ: message('请先注册', $this->createMobileUrl('register'), 'error'); goto BHBZd; eFvES: if (!(intval($profile['id']) && $profile['status'] == 0)) { goto SA0S6; } goto A0Lmq; lbzPn: mTDId: goto OnD_B; mVkLP: $uniacid = $_W['uniacid']; goto xPpdi; vD4lP: $pager = pagination($total, $pindex, $psize); goto Nw4zC; Onc7B: $conditionx = ' AND o.status >= \'' . intval($status) . '\''; goto ddI1F; ODZgz: } public function doMobileFansorder2() { goto WoTEb; ld2gH: $pindex = max(1, intval($_GPC['page'])); goto z1oV4; nbjir: $cfg = $this->module['config']; goto i0A6v; lMOqh: EtHnP: goto Xp0_Z; KxANb: Eqli5: goto WVcTs; Ur96_: include $this->template($template); goto GF4zT; WoTEb: global $_W, $_GPC; goto V4yEV; l5bED: $signPackage = $this->getSignPackage($modulephp); goto ld2gH; CiRFW: foreach ($list as $key => $value) { goto zWgSy; F01yv: $list[$key]['money'] = $commission; goto DNP1j; VCD7d: if (!($value['shareid'] == $user_info['id'])) { goto nx8u6; } goto rAo5r; DNP1j: $list[$key]['allmoney'] = $allmoney; goto yxIvA; gLkBP: $list[$key]['jibie'] = '三级'; goto iMsP7; whc_t: $jibie = 1; goto hFRkV; hFRkV: lMCwF: goto SPNaG; nwMaH: nx8u6: goto vxEI2; gGvzx: foreach ($result as $k => $v) { goto Q4HrO; bUePf: $allnum += $v['total']; goto TtDzX; TtDzX: OFCeG: goto XoZ1X; Q4HrO: $commission += $v['commission' . $jibie . '']; goto TY9ql; TY9ql: $allmoney += $v['price']; goto bUePf; XoZ1X: } goto dHv2S; dHv2S: bFsYi: goto dCqI9; zWgSy: $result = pdo_fetchall('select detail.*,goods.title,goods.thumb from ' . tablename('mihua_mall_order_goods') . ' detail left join ' . tablename('mihua_mall_goods') . " goods on goods.id=detail.goodsid  where orderid={$value['id']}"); goto VCD7d; dCqI9: $list[$key]['detail'] = $result; goto F01yv; OK8sN: $list[$key]['jibie'] = '二级'; goto whc_t; VbcxK: QxbJi: goto gGvzx; iMsP7: $jibie = 2; goto VbcxK; tHsLU: $jibie = ''; goto nwMaH; SPNaG: if (!($value['shareid3'] == $user_info['id'])) { goto QxbJi; } goto gLkBP; Me_Px: VzOTf: goto Zymvz; rAo5r: $list[$key]['jibie'] = '一级'; goto tHsLU; yxIvA: $list[$key]['allnum'] = $allnum; goto Me_Px; vxEI2: if (!($value['shareid2'] == $user_info['id'])) { goto lMCwF; } goto OK8sN; Zymvz: } goto UEuG0; D7AhU: if (!empty($uid)) { goto FiZNF; } goto O_MJW; I8DRs: $allcount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} "); goto rHXfe; VUX7r: exit; goto hVrA1; mPLuJ: $where = "   o.createtime>={$user_info['flagtime']} and o.from_user != '{$openid}'  and  (o.shareid={$user_info['id']}"; goto nbjir; A3C1U: $profile = $this->getProfile(); goto tusTd; X12rD: $this->autoRegedit($modulephp); goto QtxVz; V4yEV: $this->toflag(); goto X6670; q3M4x: $where .= ')'; goto lMOqh; Q94zX: $uid = $_W['member']['uid']; goto D7AhU; VNwxM: $yestday_begin_time_str = strtotime(date('Y-m', TIMESTAMP) . '-' . (date('d', TIMESTAMP) - 1)); goto j4VJl; Akgjo: $total = pdo_fetchcolumn('select  count(*)  from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where} "); goto CiRFW; Li2xd: $template = $this->selectTemplate('fansorder2'); goto Ur96_; WPhiA: $where .= " or o.shareid2={$user_info['id']} )"; goto KxANb; ZUKwU: $today_begin_time_str = strtotime(date('Y-m-d', TIMESTAMP)); goto VNwxM; j4VJl: $openid = $_W['openid']; goto Q94zX; hQ_q0: V8szJ: goto I8DRs; hPh3h: $where .= " or o.shareid2={$user_info['id']}  or o.shareid3={$user_info['id']} )"; goto hQ_q0; i0A6v: if (!($cfg['globalCommissionLevel'] < 2)) { goto EtHnP; } goto q3M4x; rHXfe: $todaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime>={$today_begin_time_str} "); goto poi71; qpVnE: if (!empty($profile['id'])) { goto rF1j3; } goto X12rD; tusTd: load()->model('mc'); goto zJiDI; McclN: $user_info = pdo_fetch('select * from ' . tablename('mihua_mall_member') . " where from_user='{$openid}'"); goto mPLuJ; UEuG0: gTZx0: goto IYTDf; WVcTs: if (!($cfg['globalCommissionLevel'] > 2)) { goto V8szJ; } goto hPh3h; hVrA1: FiZNF: goto McclN; X6670: $from_user = $_W['openid']; goto A3C1U; QtxVz: $profile = $this->getProfile(); goto SqO73; Xp0_Z: if (!($cfg['globalCommissionLevel'] < 3 && $cfg['globalCommissionLevel'] > 1)) { goto Eqli5; } goto WPhiA; poi71: $yestdaycount = pdo_fetchcolumn('select count(*) as num from ' . tablename('mihua_mall_order') . " o where {$where} and  o.createtime<{$today_begin_time_str} and o.createtime>={$yestday_begin_time_str} "); goto Sayqe; Sayqe: $list = pdo_fetchall('select  o.*,user.realname from ' . tablename('mihua_mall_order') . ' o left join ' . tablename('mihua_mall_member') . " user on 
							user.from_user=o.from_user where {$where}   ORDER BY  o.createtime DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto Akgjo; zJiDI: $modulephp = 'fansorder2'; goto qpVnE; O_MJW: message('请先注册', $this->createMobileUrl('register'), 'error'); goto VUX7r; IYTDf: $pager = pagination($total, $pindex, $psize); goto Li2xd; z1oV4: $psize = 10; goto ZUKwU; SqO73: rF1j3: goto l5bED; GF4zT: } public function doMobileRule() { goto CecNP; UCkJL: $template = $this->selectTemplate('rule'); goto oA8l6; mJ3Z3: $settings = $this->module['config']; goto qNqJI; XyJit: $uniacid = $_W['uniacid']; goto mJ3Z3; CecNP: global $_W, $_GPC; goto RYSl3; qNqJI: $help = $settings['help']; goto UCkJL; oA8l6: include $this->template($template); goto JHUhn; RYSl3: $from_user = $this->getFromUser(); goto XyJit; JHUhn: } public function setuid($from_user) { goto FxEEQ; BO0xI: MiMYK: goto kGEtX; iBdfP: m_bjD: goto Buich; Buich: if (!($from_user['flag'] == 1 && ($from_user['flagtime'] == 0 || empty($from_user['flagtime'])))) { goto MiMYK; } goto bBjjr; Oh8ui: if (!empty($from_user['uuid'])) { goto m_bjD; } goto xAQYs; xAQYs: pdo_update('mihua_mall_member', array("uid" => $from_user['uid']), array("from_user" => $from_user['from_user'], "uniacid" => $_W['uniacid'])); goto iBdfP; FxEEQ: global $_W, $_GPC; goto CnvB_; bBjjr: pdo_update('mihua_mall_member', array("flagtime" => $from_user['createtime']), array("from_user" => $from_user['from_user'], "uniacid" => $_W['uniacid'])); goto BO0xI; CnvB_: $from_user = pdo_fetch('select a.from_user,a.uid as uuid,a.flag,a.flagtime,a.createtime, m.uid from ' . tablename('mihua_mall_member') . 'a' . ' left join ' . tablename('mc_mapping_fans') . ' m on a.from_user = m.openid and a.uniacid= m.uniacid ' . "where m.openid='{$from_user}' and m.uniacid = " . $_W['uniacid']); goto Oh8ui; kGEtX: } public function doMobilelist() { goto LQWZG; wJAJ8: zy6ju: goto MQ7js; tFB37: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto Fkvr_; pw0sD: $data1 = array(); goto wCVHS; MFmV1: $logo = $cfg['logo']; goto cJFkx; ToGIr: $description = $cfg['description']; goto MFmV1; B5pfy: $initParams = array("op" => "index", "sharedata" => empty($sharedata) ? '""' : $sharedata); goto K6r3U; pRwLr: $psize = 4; goto bFnuc; M2jZ_: $condition .= " AND ccate = '{$cid}'"; goto jqczS; WR9NO: $from_user = $this->getFromUser(); goto Cb5e5; tI_lZ: $advs = pdo_fetchall('select * from ' . tablename('mihua_mall_adv') . " where enabled=1 and uniacid= '{$_W['uniacid']}' and type=1 order by displayorder asc"); goto mfF19; c7FzN: unset($adv); goto MOtSx; NbAJV: $islist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE  
		istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' {$condition} and  total>0 ORDER BY  sort  DESC,displayorder DESC, sales DESC "); goto SsHYT; uvcSc: $qr_code = $this->getQr_code(); goto Donsp; Klo50: foreach ($advs3 as &$adv) { goto Ygj41; S_QZ0: wpX5G: goto he88D; tE6hV: $adv['link'] = $adv['link']; goto sVbr0; Ygj41: if (!(substr($adv['link'], 0, 5) != 'http:')) { goto cGPiV; } goto tE6hV; sVbr0: cGPiV: goto S_QZ0; he88D: } goto E120G; cPduV: include $this->template($template); goto kTahB; LQWZG: global $_W, $_GPC; goto jX6TR; iV_rz: $condition .= " AND pcate = '{$cid}'"; goto rU6Le; f_DRF: $qiandao = $settings['qiandao_jifen']; goto wj8Z3; a1tgt: $rpindex = max(1, intval($_GPC['rpage'])); goto SZyus; ygnJr: if (empty($_GPC['keyword'])) { goto KTMs1; } goto TIBdx; GrVza: include $this->template($template); goto UxqPe; JfiNA: $sharedata = array("title" => $share[0]['params']['title'], "desc" => $share[0]['params']['desc'], "link" => "", "imgUrl" => tomedia($this->module['config']['logo'])); goto SO4je; vjwk0: $redpacket = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' {$condition} and `red_packet` !='0.00' and status=1 and  total>0 ORDER BY  sort  DESC,displayorder DESC, sales DESC "); goto tFB37; UOtLT: if (empty($share)) { goto BL1JP; } goto JfiNA; SiE8y: $page['basicparams'] = json_encode(iunserializer($page['basicparams'])); goto hQgHI; iaUCi: AcqgP: goto bl9ia; mr5gf: if (!($_GPC['mid'] != $_COOKIE[$shareid] && !empty($_GPC['mid']))) { goto MPxtv; } goto Mqkie; kTahB: exit; goto oEfKX; Fkvr_: $msg = pdo_fetch('select * from ' . tablename('mihua_mall_msg') . ' where msg_id=(select MAX(msg_id) from ' . tablename('mihua_mall_msg') . ") and uniacid = '{$_W['uniacid']}' ;"); goto tvtf1; wFDEP: $cfg = $this->module['config']; goto ldRjU; P4sxI: eM2JH: goto jzYfH; JVLvk: $condition = ' and isrecommand=1'; goto DLDPG; OsGnj: ep20C: goto xL4as; cyGM3: $userinfo = model_user::initUserInfo(); goto WR9NO; mKnSx: $pindex = max(1, intval($_GPC['page'])); goto pRwLr; fiYBa: $signPackage = $this->getSignPackage($modulephp); goto TLWG0; cJFkx: $ydyy = $cfg['ydyy']; goto ZZDEk; RDtd3: $profile = $this->getProfile(); goto gRPGh; qxi1e: h2Tyj: goto oh9Ge; AwbBu: if (!$advs3) { goto C3xQJ; } goto Klo50; Uhj51: unset($adv); goto fBPz9; R1CXZ: $modulephp = 'list'; goto fiYBa; PYHq5: $userinfo = model_user::initUserInfo(); goto QldAR; GksMy: if (!$isgroup) { goto h2Tyj; } goto pw0sD; RRkPK: OE4Mq: goto lclW9; Donsp: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto TiYsE; F36i8: MYSHL: goto qxi1e; DtxyC: MPxtv: goto mKnSx; bFnuc: $condition = ''; goto NbIbK; Mqkie: $this->shareClick($_GPC['mid'], $_GPC['joinway']); goto x_IwL; SsHYT: $xflist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and  uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' {$condition} and deductible >0 and  total>0  ORDER BY  sort  DESC,displayorder DESC, sales DESC limit {$cfg['indexss']}"); goto vjwk0; Cb5e5: $this->setuid($from_user); goto RDtd3; FZ1YL: $cfg['indexss'] = 5; goto iaUCi; iN6YV: if (empty($uid)) { goto D1FMm; } goto fBho1; TIBdx: $condition .= " AND title LIKE '%{$_GPC['keyword']}%'"; goto v4Ad2; SO4je: BL1JP: goto B5pfy; d_GbA: if (!($num > 0)) { goto EGdHD; } goto BxOiX; Akm60: if (!$advs2) { goto utrUq; } goto ta4Eg; SZyus: $rpsize = 6; goto JVLvk; IYaC3: $imgUrl = $_W['attachurl'] . $cfg['logo']; goto N_dBI; Y3WhD: unset($c); goto mjfKo; DLDPG: $rlist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' {$condition}  and  total>0  ORDER BY sales desc ,displayorder DESC "); goto wFDEP; cMpMC: foreach ($category as $index => $row) { goto CNR5y; CNR5y: if (empty($row['parentid'])) { goto uaZDQ; } goto IIXim; STvIV: uaZDQ: goto FZ8Sc; OlypY: unset($category[$index]); goto STvIV; IIXim: $children[$row['parentid']][$row['id']] = $row; goto OlypY; FZ8Sc: EHy56: goto ZVlxz; ZVlxz: } goto wJAJ8; QldAR: $stamp = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_card') . ' c  where not EXISTS  (SELECT * FROM ' . tablename('mihua_mall_usercard') . " u where u.userid= '{$userinfo['id']}' and  u.uniacid= '{$_W['uniacid']}' and c.`id` =u.`cardid`) and  c.uniacid= '{$_W['uniacid']}' and c.status=0 and c.starttime<" . time() . ' and c.endtime>' . time() . ' and c.lastnum>1  and c.cardtype IN (1,2)'); goto NbAJV; BxOiX: $page = Util::getDataByCacheFirst('custompage', 'index', array("Util", "getSingelDataInSingleTable"), array("mihua_mall_custom", array("uniacid" => $_W['uniacid'], "status" => 0))); goto gaQyC; NbIbK: if (!empty($_GPC['ccate'])) { goto OE4Mq; } goto yHYXu; bl9ia: if (!($cfg['groupbutton'] == 1)) { goto bovFv; } goto aSWwT; ThE5M: $title = '商城首页'; goto P4sxI; xV3Fl: $num = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_custom') . " WHERE uniacid = '{$_W['uniacid']}'  and status=0"); goto d_GbA; jX6TR: load()->model('mc'); goto cyGM3; ZZDEk: $description = $cfg['description']; goto IYaC3; K6r3U: $title = $share[0]['params']['title']; goto pwE4n; F49sj: $advs3 = pdo_fetchall('select * from ' . tablename('mihua_mall_adv') . " where enabled=1 and uniacid= '{$_W['uniacid']}' and type=3 order by displayorder asc"); goto AwbBu; v4Ad2: KTMs1: goto aJl15; MQ7js: $recommandcategory = array(); goto olFhD; x_IwL: setcookie($shareid, $this->getShareId(), time() + 3600 * 24 * $day_cookies); goto DtxyC; olFhD: foreach ($category as &$c) { goto UNMA_; BF2IA: tOjzv: goto DZhko; UbZHm: $c['list'] = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}' and deleted=0 AND status = '1'  and pcate='{$c['id']}'  ORDER BY displayorder DESC, sales DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto F3aQb; vFAuW: $c['pager'] = pagination($c['total'], $pindex, $psize, $url = '', $context = array("before" => 0, "after" => 0, "ajaxcallback" => "")); goto Bb0mU; lQ6ZW: cFMix: goto NNlX0; Bb0mU: $recommandcategory[] = $c; goto lQ6ZW; fNhLt: YeGnN: goto J6nnj; DZhko: dVQoi: goto egt2E; NNlX0: if (empty($children[$c['id']])) { goto tOjzv; } goto Axiq2; Axiq2: foreach ($children[$c['id']] as &$child) { goto Chv0n; pZzH0: $child['list'] = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 AND status = '1'  and pcate='{$c['id']}' and ccate='{$child['id']}'  ORDER BY displayorder DESC, sales DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto Y_paN; AqDqi: JZ5Nz: goto slsyE; X_dlv: Mnk84: goto AqDqi; oIuS4: $child['pager'] = pagination($child['total'], $pindex, $psize, $url = '', $context = array("before" => 0, "after" => 0, "ajaxcallback" => "")); goto q5odI; Y_paN: $child['total'] = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0  AND status = '1' and pcate='{$c['id']}' and ccate='{$child['id']}' "); goto oIuS4; Chv0n: if (!($child['isrecommand'] == 1)) { goto Mnk84; } goto pZzH0; q5odI: $recommandcategory[] = $child; goto X_dlv; slsyE: } goto fNhLt; J6nnj: unset($child); goto BF2IA; F3aQb: $c['total'] = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0  AND status = '1' and pcate='{$c['id']}'"); goto vFAuW; UNMA_: if (!($c['isrecommand'] == 1)) { goto cFMix; } goto UbZHm; egt2E: } goto R0rd2; SgsXf: $uid = mc_openid2uid($from_user); goto iN6YV; oX8XX: $settings = $this->module['config']; goto f_DRF; ldRjU: if (!empty($cfg['indexss'])) { goto AcqgP; } goto FZ1YL; SGk8n: goto q3qPz; goto umMhB; Ik4wz: $template = $this->selectTemplate('list'); goto GrVza; tVLDx: utrUq: goto F49sj; gRPGh: $this->checkisAgent($from_user, $profile); goto nAxJC; oFT1R: goto q3qPz; goto RRkPK; hQgHI: $share = json_decode($page['basicparams'], true); goto UOtLT; N_dBI: if (!empty($title)) { goto eM2JH; } goto ThE5M; TiYsE: $cfg = $this->module['config']; goto xV3Fl; pwE4n: $template = $this->selectTemplate('temp/index/index'); goto cPduV; umMhB: BivxI: goto f6Un4; rU6Le: q3qPz: goto ygnJr; oh9Ge: bovFv: goto PYHq5; vkD1v: btFyg: goto Uhj51; wj8Z3: D1FMm: goto Wx9s4; mfF19: foreach ($advs as &$adv) { goto u9sRy; ytlvY: $adv['link'] = $adv['link']; goto MdWSP; u9sRy: if (!(substr($adv['link'], 0, 5) != 'http:')) { goto bir06; } goto ytlvY; H32Su: UiSZv: goto JgSR5; MdWSP: bir06: goto H32Su; JgSR5: } goto vkD1v; aJl15: $zt_list = pdo_fetchall('select *  from ' . tablename('mihua_zt') . " where status=1 and uniacid = '{$_W['uniacid']}' order by zt_order  desc,zt_id desc "); goto D2Fpd; jzYfH: $day_cookies = 15; goto lyMcU; nAxJC: $shownotice = $this->checkUser(); goto uvcSc; aSWwT: $isgroup = pdo_fetchall('SELECT id,title,groupprice,sales,thumb FROM ' . tablename('mihua_mall_goods') . ' WHERE  ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' and deleted=0 AND status = '1' {$condition} and isgroup=1 and  total>0 ORDER BY  sort  DESC, displayorder DESC, sales DESC 
		 "); goto GksMy; R11Vr: $timestr = date('Y-m-d', TIMESTAMP); goto SgsXf; wCVHS: foreach ($isgroup as $key => $value) { goto CrHTG; CrHTG: $data = pdo_fetchall('SELECT   distinct(o.from_user),og.goodsid, u.headimgurl  FROM ' . tablename('mihua_mall_order_goods') . 'og  left join' . tablename('mihua_mall_order') . 'o on og.orderid=o.id and og.uniacid=o.uniacid ' . 'left join' . tablename('mihua_mall_user') . 'u on o.uid=u.uid and o.uniacid=u.uniacid ' . "WHERE og.uniacid = '{$_W['uniacid']}' 
				and og.goodsid='{$value['id']}' 
				and o.status>=1
				ORDER BY o.createtime DESC limit {$cfg['indexss']}"); goto BUvB3; BUvB3: $data1[$value['id']] = $data; goto B_4qE; B_4qE: wpma4: goto IV12_; IV12_: } goto F36i8; lyMcU: $shareid = mihua_COOKIE_SID . $_W['uniacid']; goto mr5gf; f6Un4: $cid = intval($_GPC['pcate']); goto iV_rz; ta4Eg: foreach ($advs2 as &$adv) { goto JQEMK; H2S2s: $adv['link'] = $adv['link']; goto q2WIM; PnMAA: F5LZj: goto ux8Y9; JQEMK: if (!(substr($adv['link'], 0, 5) != 'http:')) { goto e7aK2; } goto H2S2s; q2WIM: e7aK2: goto PnMAA; ux8Y9: } goto OsGnj; gaQyC: $page['params'] = json_encode(iunserializer($page['params'])); goto SiE8y; E120G: J0V7L: goto c7FzN; jqczS: $_GPC['pcate'] = pdo_fetchcolumn('SELECT parentid FROM ' . tablename('mihua_mall_category') . ' WHERE id = :id', array(":id" => intval($_GPC['ccate']))); goto SGk8n; TLWG0: $title = $cfg['shopname']; goto ToGIr; D2Fpd: $children = array(); goto nTaZ2; oEfKX: EGdHD: goto R1CXZ; fBPz9: $advs2 = pdo_fetchall('select * from ' . tablename('mihua_mall_adv') . " where enabled=1 and uniacid= '{$_W['uniacid']}' and type=2 order by displayorder asc"); goto Akm60; MOtSx: C3xQJ: goto a1tgt; xL4as: unset($adv); goto tVLDx; lclW9: $cid = intval($_GPC['ccate']); goto M2jZ_; R0rd2: jYucp: goto Y3WhD; fBho1: $result = pdo_fetch('select * from ' . tablename('mihua_mall_qiandao') . ' where timestr=:timestr and uid=:uid', array(":timestr" => $timestr, ":uid" => $uid)); goto oX8XX; nTaZ2: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' and enabled=1 and isrecommand= 1 ORDER BY parentid ASC, displayorder DESC", array(), 'id'); goto cMpMC; yHYXu: if (!empty($_GPC['pcate'])) { goto BivxI; } goto oFT1R; mjfKo: $carttotal = $this->getCartTotal(); goto tI_lZ; Wx9s4: O6BDy: goto Ik4wz; tvtf1: if (!($shownotice != 1)) { goto O6BDy; } goto R11Vr; UxqPe: } public function doMobilelistmore_rec() { goto o8GLl; sRygR: $condition = ' and isrecommand=1 '; goto pLOKo; MeIw2: include $this->template($template); goto EaNd6; N3btD: $pindex = max(1, intval($_GPC['page'])); goto OVvgr; pLOKo: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 AND status = '1' {$condition} ORDER BY displayorder DESC, sales DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto pFHMX; pFHMX: $template = $this->selectTemplate('list_more'); goto MeIw2; o8GLl: global $_GPC, $_W; goto N3btD; OVvgr: $psize = 6; goto sRygR; EaNd6: } public function doMobilelistmore() { goto wSrog; mbRMM: $cid = intval($_GPC['ccate']); goto CWCDc; AnU8E: goto xk31a; goto N2P2t; kQmmo: $_GPC['pcate'] = pdo_fetchcolumn('SELECT parentid FROM ' . tablename('mihua_mall_category') . ' WHERE id = :id', array(":id" => intval($_GPC['ccate']))); goto Bj5XZ; WagM7: include $this->template('list_more'); goto njAwp; NXW7P: $pindex = max(1, intval($_GPC['page'])); goto x1Fpt; O4Oyk: $cid = intval($_GPC['pcate']); goto ppqEJ; N2P2t: zcRTz: goto mbRMM; wSrog: global $_GPC, $_W; goto NXW7P; CWCDc: $condition .= " AND ccate = '{$cid}'"; goto kQmmo; iIoeF: if (!empty($_GPC['ccate'])) { goto zcRTz; } goto wgCAx; ppqEJ: $condition .= " AND pcate = '{$cid}'"; goto ZB2Kr; sn4Kb: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}' AND status = '1' {$condition} ORDER BY displayorder DESC, sales DESC LIMIT " . ($pindex - 1) * $psize . ',' . $psize); goto WagM7; Bj5XZ: goto xk31a; goto CdtlF; CdtlF: dA502: goto O4Oyk; wgCAx: if (!empty($_GPC['pcate'])) { goto dA502; } goto AnU8E; x1Fpt: $psize = 6; goto ynFE8; ZB2Kr: xk31a: goto sn4Kb; ynFE8: $condition = ''; goto iIoeF; njAwp: } public function doMobilelist2() { goto XtxHq; LwJUT: $sortb22 = 'desc'; goto opJSH; PLjKy: $profile = $this->getProfile(); goto mX7ES; eAB_I: zJCJM: goto KfSwB; lsklq: if (empty($_GPC['istime'])) { goto kFQrg; } goto I_1kx; g88Im: $sortb11 = 'desc'; goto igSnZ; fgNLu: $ydyy = $cfg['ydyy']; goto zOIUE; ZlB4M: Kyw5w: goto HNAOw; FMioe: $sortfield = 'sales ' . $sortb1; goto Ciptw; zWQkP: $description = $cfg['description']; goto FYQ3g; d76wl: $psize = 10; goto hSRPs; vL7Da: if (!empty($_GPC['ccate'])) { goto Cl1pT; } goto Ubin2; MhmPE: goto Kyw5w; goto RIB7L; X7pBL: $_GPC['pcate'] = pdo_fetchcolumn('SELECT parentid FROM ' . tablename('mihua_mall_category') . ' WHERE id = :id', array(":id" => intval($_GPC['ccate']))); goto JzUyd; vVblI: $signPackage = $this->getSignPackage($modulephp); goto FLt_v; Ubin2: if (!empty($_GPC['pcate'])) { goto OEaKG; } goto Ap5mY; HvIF8: $sorturl .= '&isdiscount=1'; goto tGHfY; xZKGx: if (!($sort == 3)) { goto ZAXna; } goto X1xno; u5i5R: $sortb1 = empty($_GPC['sortb1']) ? 'desc' : $_GPC['sortb1']; goto F40zA; LhszP: $cid = intval($_GPC['pcate']); goto KXyQ3; C1gfE: $pager = pagination($total, $pindex, $psize, $url = '', $context = array("before" => 0, "after" => 0, "ajaxcallback" => "")); goto ANc1G; C5i_D: $condition .= ' AND isdiscount = 1'; goto HvIF8; j89M6: if ($sort == 0) { goto iqPTS; } goto zf2lJ; tYil7: if (empty($_GPC['isnew'])) { goto IMagb; } goto pY0Si; uvdHj: $sortfield = 'marketprice ' . $sortb3; goto IzCVz; x0_19: $sortb22 = 'desc'; goto NM2d9; XtxHq: global $_W, $_GPC; goto OPeTI; F40zA: $sortb2 = empty($_GPC['sortb2']) ? 'desc' : $_GPC['sortb2']; goto obn7m; FIqoU: if (!($profile['status'] == 0)) { goto MzAFD; } goto k2mNS; HV9Uo: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 AND 
		status = '1' {$condition}  ORDER BY {$sortfield}  "); goto xxPE4; tGHfY: ToduW: goto lsklq; dO482: $cid = intval($_GPC['ccate']); goto O_KZR; L4kpP: $sortb00 = $sortb0 == 'desc' ? 'asc' : 'desc'; goto qaOzY; O_KZR: $condition .= " AND ccate = '{$cid}'"; goto X7pBL; LCuwS: $shownotice = $this->checkUser(); goto gYzLo; KfSwB: $sort = empty($_GPC['sort']) ? 0 : $_GPC['sort']; goto DSnkN; wttJW: IMagb: goto ZQW78; hkBHl: $sortb0 = empty($_GPC['sortb0']) ? 'desc' : $_GPC['sortb0']; goto u5i5R; qwKN1: D6CCK: goto CmAL9; q3R0m: $qr_code = $this->getQr_code(); goto mJQj2; FLt_v: $pindex = max(1, intval($_GPC['page'])); goto d76wl; pY0Si: $condition .= ' AND isnew = 1'; goto Ygbba; JFu4i: kFQrg: goto TfEjH; OPeTI: $this->toflag(); goto PLjKy; n9tVD: foreach ($category as $index => $row) { goto nCWrE; PhH1z: $children[$row['parentid']][$row['id']] = $row; goto pYuf9; J0cs_: o3YJ5: goto YTkLD; Z2cle: PjKmh: goto J0cs_; pYuf9: unset($category[$index]); goto Z2cle; nCWrE: if (empty($row['parentid'])) { goto PjKmh; } goto PhH1z; YTkLD: } goto rcd48; L2fa1: $sorturl .= '&istime=1'; goto JFu4i; igSnZ: $sortb33 = 'asc'; goto ZlB4M; ZQW78: if (empty($_GPC['ishot'])) { goto Hrly1; } goto Q0mXe; PGDLd: CFRF_: goto TnHqA; aGYIt: $modulephp = 'list2'; goto ynSM9; IZcT5: $sortb22 = $sortb2 == 'desc' ? 'asc' : 'desc'; goto F2z0L; CmAL9: $sorturl = $this->createMobileUrl('list2', array("keyword" => $_GPC['keyword'], "pcate" => $_GPC['pcate'], "ccate" => $_GPC['ccate'])); goto tYil7; uDXhO: xEE8e: goto oWW6C; sCXVP: $sortb11 = 'desc'; goto Ib52t; SPWbc: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0  AND status = '1' {$condition}"); goto C1gfE; kcbBb: $sortb33 = 'asc'; goto qwKN1; zf2lJ: if ($sort == 1) { goto AwP31; } goto Drx9V; eFXWO: Cl1pT: goto dO482; epEQY: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto sm1F1; hSRPs: $condition = ''; goto vL7Da; oWW6C: unset($r); goto SPWbc; X1xno: $sortb33 = $sortb3 == 'asc' ? 'desc' : 'asc'; goto uvdHj; Ciptw: $sortb00 = 'desc'; goto x0_19; ANc1G: $carttotal = $this->getCartTotal(); goto AjJ6N; Ib52t: $sortb22 = 'desc'; goto kcbBb; kX9Re: $sortb00 = 'desc'; goto g88Im; JzUyd: goto CFRF_; goto OZ6p7; k2mNS: $profile['flag'] = 0; goto TgDbf; KXyQ3: $condition .= " AND pcate = '{$cid}'"; goto PGDLd; Ygbba: $sorturl .= '&isnew=1'; goto wttJW; IzCVz: $sortb00 = 'desc'; goto n2Agx; obn7m: $sortb3 = empty($_GPC['sortb3']) ? 'asc' : $_GPC['sortb3']; goto j89M6; TgDbf: MzAFD: goto epEQY; Ap5mY: goto CFRF_; goto eFXWO; LF_Pl: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' and enabled=1 ORDER BY parentid ASC, displayorder DESC", array(), 'id'); goto n9tVD; FF3dA: $sorturl .= '&ishot=1'; goto Fc2ck; Fc2ck: Hrly1: goto ufp1d; zOIUE: $logo = $cfg['logo']; goto zWQkP; gYzLo: $cfg = $this->module['config']; goto q3R0m; xxPE4: foreach ($list as &$r) { goto mmAFn; mmAFn: if (!($r['istime'] == 1)) { goto Yv6jb; } goto VkFNQ; VkFNQ: $arr = $this->time_tran($r['timeend']); goto aCByC; wy6Rr: $r['timelast'] = $arr[1]; goto JWeXU; aCByC: $r['timelaststr'] = $arr[0]; goto wy6Rr; aCOBN: EmrgF: goto JgQeM; JWeXU: Yv6jb: goto aCOBN; JgQeM: } goto uDXhO; OZ6p7: OEaKG: goto LhszP; RIB7L: XqlDA: goto IZcT5; I_1kx: $condition .= ' AND istime = 1 and ' . time() . '>=timestart and ' . time() . '<=timeend'; goto L2fa1; DSnkN: $sortfield = 'displayorder asc'; goto hkBHl; Q0mXe: $condition .= ' AND ishot = 1'; goto FF3dA; F2z0L: $sortfield = 'viewcount ' . $sortb2; goto kX9Re; mJQj2: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto vVblI; lOBzf: $sortb11 = $sortb1 == 'desc' ? 'asc' : 'desc'; goto FMioe; b03Fj: goto D6CCK; goto meGWa; TfEjH: $children = array(); goto LF_Pl; zUERx: AwP31: goto lOBzf; n2Agx: $sortb11 = 'desc'; goto LwJUT; TnHqA: if (empty($_GPC['keyword'])) { goto zJCJM; } goto BR_V2; ufp1d: if (empty($_GPC['isdiscount'])) { goto ToduW; } goto C5i_D; meGWa: iqPTS: goto L4kpP; mX7ES: load()->model('mc'); goto aGYIt; FYQ3g: $id = $profile['id']; goto FIqoU; qaOzY: $sortfield = 'createtime ' . $sortb0; goto sCXVP; Drx9V: if ($sort == 2) { goto XqlDA; } goto xZKGx; Gnszh: R0xNd: goto b03Fj; BR_V2: $condition .= " AND title LIKE '%{$_GPC['keyword']}%'"; goto eAB_I; HNAOw: goto R0xNd; goto zUERx; opJSH: ZAXna: goto MhmPE; ynSM9: $from_user = $this->getFromUser(); goto LCuwS; sm1F1: $template = $this->selectTemplate('list2'); goto WrlZx; NM2d9: $sortb33 = 'asc'; goto Gnszh; WrlZx: include $this->template($template); goto S8KrR; rcd48: XWXli: goto HV9Uo; AjJ6N: $cfg = $this->module['config']; goto fgNLu; S8KrR: } public function doMobileListCategory() { goto JNEcn; UL1gm: if (!empty($_GPC['ccate'])) { goto mHuF8; } goto AHtEM; Z5_LQ: goto NsG8Y; goto ewIe5; tT3JW: PVEGy: goto XE3Ma; zhlBn: foreach ($category as $index => $row) { goto dPmbR; dPmbR: if (empty($row['parentid'])) { goto BH7RO; } goto mcS49; w3sTG: unset($category[$index]); goto qMrCq; qMrCq: BH7RO: goto o1FZx; o1FZx: tLj1p: goto noi2J; mcS49: $children[$row['parentid']][$row['id']] = $row; goto w3sTG; noi2J: } goto RxQHz; HQMym: $rlist = pdo_fetchall('SELECT distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . ' o on g.othercate= o.othercate  WHERE ((g.istime =\'0\') or 	(g.istime =\'1\' and ' . time() . '>=g.timestart and ' . time() . "<=g.timeend)) and g.uniacid = '{$_W['uniacid']}' and g.deleted=0 AND g.status = '1'  and (g.pcate=:pcate or o.cateid=:pcate) and 
			 g.status=1 ORDER BY g.sort DESC ", $where); goto XfYBI; QEuPt: zU0L4: goto Cpu5I; aEXa7: goto ryA6U; goto LDN29; XiPLu: $pcate = intval($_GPC['pcate']); goto NEeJd; cvCnW: $type = 'new'; goto q5j1s; JNEcn: global $_W, $_GPC; goto zRFY2; LtuQG: ryA6U: goto Z5_LQ; v0EGZ: $ydyy = $cfg['ydyy']; goto oLF1v; SIye4: if ($_GPC['type'] == 'hot') { goto VpnGJ; } goto WtTLv; O_BmY: $this->toflag(); goto smiPs; Fs6sX: mHuF8: goto maxu2; Cpu5I: $rlist = $credit; goto pYEuR; kAtPm: $rlist = pdo_fetchall('SELECT distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . ' o on g.othercate= o.othercate  WHERE ((g.istime =\'0\') or 	(g.istime =\'1\' and ' . time() . '>=g.timestart and ' . time() . "<=g.timeend)) and g.uniacid = '{$_W['uniacid']}' and g.deleted=0 AND g.status = '1'  and (g.ccate=:ccate or o.cateid=:ccate) and 
			 g.status=1 ORDER BY g.sort DESC ", $where); goto tT3JW; gApq4: YS4YY: goto gPyAf; wtfHQ: $rlist = $deductible; goto Un8GU; d9RUF: $template = $this->selectTemplate('list_category'); goto ba8_e; VXp4I: $hot = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' ORDER BY sales DESC "); goto WAblv; q5j1s: bQ_8h: goto z_6Bv; ewIe5: edvNe: goto RNZrU; sLkHn: $shownotice = $this->checkUser(); goto GYS09; WtTLv: if (!($_GPC['type'] == 'new')) { goto bQ_8h; } goto S3Ilq; Q5BK5: $xsqg = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `credit` >0 and status=1 ORDER BY displayorder DESC, sales DESC "); goto JkGBv; QX5R3: goto XIRqd; goto kjQAd; idZag: if (!empty($_GPC['pcate'])) { goto Du9Ig; } goto UL1gm; AHtEM: if ($_GPC['type'] == 'redpacket') { goto edvNe; } goto iMySA; oLF1v: $zt_list = pdo_fetchall('select *  from ' . tablename('mihua_zt') . " where status=1 and uniacid = '{$_W['uniacid']}' order by zt_order  desc,zt_id desc "); goto W4w1g; wcvk8: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto VLNil; tfDaP: Du9Ig: goto XiPLu; smiPs: $from_user = $this->getFromUser(); goto sLkHn; VLNil: $title = $cfg['shopname']; goto Ne0tp; XE3Ma: goto N5qMI; goto tfDaP; mJXxk: $carttotal = $this->getCartTotal(); goto DD8Dx; UGpTP: NsG8Y: goto qTdKN; WAblv: $new = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' ORDER BY id DESC "); goto idZag; qTdKN: goto PVEGy; goto Fs6sX; i9Q6S: goto YS4YY; goto LTXv_; W4w1g: $rlist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'   ORDER BY sort DESC "); goto ICYT3; xIaLT: $imgUrl = $_W['attachurl'] . $cfg['logo']; goto JRoHu; sGfLD: $deductible = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `deductible` >0 and status=1 ORDER BY displayorder DESC, sales DESC "); goto TuukO; h9fw4: $type = 'redpacket'; goto UGpTP; kRJyj: $type = 'xsqg'; goto gApq4; DD8Dx: $cfg = $this->module['config']; goto v0EGZ; RNZrU: $rlist = $redpacket; goto h9fw4; BffXD: VpnGJ: goto jHUMK; mJWWd: $where[':ccate'] = $ccate; goto kAtPm; vv0MG: XIRqd: goto i9Q6S; Dpccn: if ($_GPC['type'] == 'xg') { goto vn60x; } goto SIye4; EBsdn: if ($_GPC['type'] == 'xsqg') { goto KcPOy; } goto Dpccn; ba8_e: include $this->template($template); goto V3Meh; RxQHz: cU24o: goto mJXxk; D5QAu: $type = 'xg'; goto vv0MG; LTXv_: KcPOy: goto TQyWf; kjQAd: vn60x: goto PyETc; S3Ilq: $rlist = $new; goto cvCnW; zRFY2: load()->model('mc'); goto O_BmY; Ne0tp: $description = $cfg['description']; goto xIaLT; pYEuR: $type = 'credit'; goto vML4g; DgcNm: $category = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_category') . " WHERE uniacid = '{$_W['uniacid']}' and enabled=1 ORDER BY parentid ASC, displayorder DESC", array(), 'id'); goto zhlBn; JkGBv: $xg = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `astrict` >0 and status=1 ORDER BY displayorder DESC, sales DESC "); goto VXp4I; TuukO: $credit = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `credit` >0 and status=1 ORDER BY displayorder DESC, sales DESC "); goto Q5BK5; DM1N7: $type = 'hot'; goto p8FR3; iMySA: if ($_GPC['type'] == 'deductible') { goto VeOj1; } goto jms2i; TQyWf: $rlist = $xsqg; goto kRJyj; GYS09: $cfg = $this->module['config']; goto wgFQZ; z_6Bv: goto WDHbx; goto BffXD; p8FR3: WDHbx: goto QX5R3; PyETc: $rlist = $xg; goto D5QAu; wgFQZ: $qr_code = $this->getQr_code(); goto wcvk8; LDN29: VeOj1: goto wtfHQ; maxu2: $ccate = intval($_GPC['ccate']); goto mJWWd; NEeJd: $where[':pcate'] = $pcate; goto HQMym; Un8GU: $type = 'deductible'; goto LtuQG; XfYBI: N5qMI: goto d9RUF; ICYT3: $redpacket = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `red_packet` !='0.00' and status=1 ORDER BY displayorder DESC, sales DESC "); goto sGfLD; JRoHu: $signPackage = $this->getSignPackage($modulephp); goto DgcNm; jms2i: if ($_GPC['type'] == 'credit') { goto zU0L4; } goto EBsdn; gPyAf: goto sVwSU; goto QEuPt; vML4g: sVwSU: goto aEXa7; jHUMK: $rlist = $hot; goto DM1N7; V3Meh: } public function doMobiletuiguang() { goto JSE_s; JSE_s: global $_GPC, $_W; goto diofW; qm5Q2: $rule = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE `uniacid` = :uniacid ', array(":uniacid" => $_W['uniacid'])); goto BjktR; diofW: $carttotal = $this->getCartTotal(); goto a3xGB; yvkTK: $profile = $this->getProfile(); goto hllqk; Th0mA: exit; goto NamXN; ocmUs: $from_user = $this->getFromUser(); goto HqaOT; eFYve: $this->memberQrcode($from_user); goto sBlmr; VINBG: Al0sq: goto mlOAW; ICOj9: include $this->template($template); goto Th0mA; hllqk: $id = $profile['id']; goto eFYve; Wudlz: include $this->template($template); goto Eoh1i; z1AB5: $template = $this->selectTemplate('forbidden'); goto ICOj9; NALCc: $logo = $cfg['logo']; goto ZuUPL; mlOAW: $cfg = $this->module['config']; goto NALCc; PgiNa: $template = $this->selectTemplate('tgym'); goto Wudlz; MIZtN: exit; goto VINBG; BjktR: $template = $this->selectTemplate('register'); goto VZLP_; VZLP_: include $this->template($template); goto MIZtN; lMxyF: if (!empty($profile)) { goto Al0sq; } goto qm5Q2; ZuUPL: $description = $cfg['description']; goto PgiNa; X56Ny: $rule = pdo_fetchcolumn('SELECT rule FROM ' . tablename('mihua_mall_rules') . ' WHERE uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto yvkTK; sBlmr: if (!(intval($profile['id']) && $profile['status'] == 0)) { goto CMYe6; } goto z1AB5; a3xGB: $share = mihua_COOKIE_QRCODE . $_W['uniacid']; goto AMPBf; HqaOT: $goods = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id', array(":id" => $gid)); goto X56Ny; AMPBf: $gid = $_GPC['gid']; goto ocmUs; NamXN: CMYe6: goto lMxyF; Eoh1i: } public function doMobileGetGoods() { goto kv7DQ; cMum2: if ($_GPC['type'] == 'credit') { goto rRbV5; } goto llOcv; VoQKF: goto B3OER; goto i_yZt; vItEP: zkI9T: goto rEPbz; sLjSH: if ($_GPC['type'] == 'deductible') { goto rOgqS; } goto cMum2; rLzM2: BtsFy: goto OD3P7; BBauA: if ($_GPC['type'] == 'xg') { goto INW3b; } goto JpgQt; RfslT: V9k9X: goto iTF4J; Lua55: hOu2_: goto Xlyrc; whhuQ: goto BtsFy; goto LE4Mc; xDB2d: goto J3B9K; goto sS1Zz; J1YTs: if ($_GPC['type'] == 'child_goods') { goto V9k9X; } goto svqpX; svqpX: if ($_GPC['type'] == 'redpacket') { goto uOHpc; } goto sLjSH; YUZKY: B3OER: goto whhuQ; rM1m_: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `deductible` >'0' and status=1 and  total>0  ORDER BY displayorder DESC, sales DESC "); goto JKrG0; wVl4j: $where[':pcate'] = $cid; goto w72HH; JpgQt: if ($_GPC['type'] == 'hot') { goto gjls1; } goto Plsxq; kv7DQ: global $_W, $_GPC; goto uYjy9; GeZXn: goto wGHWP; goto RfslT; YElw0: $list = pdo_fetchall('SELECT distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . ' o on g.othercate= o.othercate  WHERE ((g.istime =\'0\') or 	(g.istime =\'1\' and ' . time() . '>=g.timestart and ' . time() . "<=g.timeend)) and g.uniacid = '{$_W['uniacid']}' and g.deleted=0 AND g.status = '1' and  g.total>0 and (g.ccate=:ccate or o.cateid=:ccate) and 
			 g.status=1 ORDER BY g.displayorder DESC, g.sales DESC ", $where); goto Qm1MT; s6jGF: ahfle: goto OLQ9D; g9iNS: INW3b: goto ETOkW; oBPBa: ee9Gn: goto R2Go7; llOcv: if ($_GPC['type'] == 'xsqg') { goto OX8xO; } goto BBauA; rEPbz: goto Au1ym; goto g9iNS; cCZl_: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' and  total>0  ORDER BY displayorder DESC, sales DESC "); goto vItEP; esaoH: goto ee9Gn; goto MUgwe; dMpQb: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `credit` >'0' and status=1 and  total>0  ORDER BY displayorder DESC, sales DESC "); goto YUZKY; ezqwD: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `credit` >'0' and status=1 and  total>0  ORDER BY displayorder DESC, sales DESC "); goto rLzM2; CrAE1: viuZc: goto A6biv; OLQ9D: $cid = intval($_GPC['cid']); goto wVl4j; r5BnG: if ($_GPC['type'] == 'class_goods') { goto ahfle; } goto J1YTs; LE4Mc: rRbV5: goto ezqwD; sS1Zz: uOHpc: goto iZ60F; Xlyrc: if (!empty($list)) { goto XUN6T; } goto im5Qd; A6biv: goto zkI9T; goto dWMYW; HUL7K: rOgqS: goto rM1m_; MUgwe: XUN6T: goto H1OZ6; uYjy9: $errcode = 0; goto r5BnG; Ec2Pq: J3B9K: goto GeZXn; iTF4J: $cid = intval($_GPC['cid']); goto W_BUz; W_BUz: $where[':ccate'] = $cid; goto YElw0; JKrG0: XMWI3: goto xDB2d; Qm1MT: wGHWP: goto cBGQH; ETOkW: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `astrict` >'0' and status=1 and  total>0  ORDER BY displayorder DESC, sales DESC "); goto Ekoz0; H1OZ6: echo json_encode(array("status" => "success", "list" => $list)); goto oBPBa; im5Qd: echo json_encode(array("msg" => "暂时没有商品！")); goto esaoH; w72HH: $list = pdo_fetchall('SELECT distinct g.id,g.* FROM ' . tablename('mihua_mall_goods') . '  g left join ' . tablename('mihua_mall_othercate') . ' o on g.othercate= o.othercate  WHERE ((g.istime =\'0\') or 	(g.istime =\'1\' and ' . time() . '>=g.timestart and ' . time() . "<=g.timeend)) and g.uniacid = '{$_W['uniacid']}' and g.deleted=0 AND g.status = '1'  and  g.total>0 and (g.pcate=:pcate or o.cateid=:pcate) and 
			 g.status=1 ORDER BY g.displayorder DESC, g.sales DESC ", $where); goto Lua55; OD3P7: goto XMWI3; goto HUL7K; iZ60F: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1'  and `red_packet` !='0.00' and status=1  and  total>0 ORDER BY displayorder DESC, sales DESC "); goto Ec2Pq; cBGQH: goto hOu2_; goto s6jGF; Plsxq: if (!($_GPC['type'] == 'new')) { goto viuZc; } goto inIaI; dWMYW: gjls1: goto cCZl_; inIaI: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE ((istime =\'0\') or 
		(istime =\'1\' and ' . time() . '>=timestart and ' . time() . "<=timeend)) and uniacid = '{$_W['uniacid']}' 
		 and deleted=0 AND status = '1' and  total>0  ORDER BY id DESC "); goto CrAE1; i_yZt: OX8xO: goto dMpQb; Ekoz0: Au1ym: goto VoQKF; R2Go7: } public function doMobileMyfans() { goto fgh2y; AtsgK: $id = $profile['id']; goto pcZzM; j4NSR: $count1 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}"); goto zF0M3; tPTGX: $sql3_member = 'select mber3.from_user from ' . tablename('mihua_mall_member') . ' mber3 where mber3.realname<>\'\' and  mber3.id!=mber3.shareid and mber3.shareid in (' . $level3 . ')  '; goto LHNEf; fLloV: $from_user = $_W['openid']; goto fDoWF; LE2YY: $modulephp = 'myfans'; goto hs0UG; hTgwP: if (!(true && $cfg['globalCommissionLevel'] >= 3)) { goto m0Nq9; } goto neTKN; CbqpB: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto j4NSR; lK69r: $profile = $this->getProfile(); goto kOjmu; ELGTx: $this->toflag(); goto fLloV; ZzbkB: $cfg = $this->module['config']; goto AtsgK; gzIP7: $signPackage = $this->getSignPackage($modulephp); goto ZzbkB; kOjmu: xSzOt: goto gzIP7; HfQ0Z: m0Nq9: goto pJpim; gFTS3: if (!true) { goto wu4XB; } goto CbqpB; fct2j: $count2 = 0; goto jz1hK; vCvhP: $sql2_member = 'select mber2.from_user from ' . tablename('mihua_mall_member') . ' mber2 where mber2.realname<>\'\' and mber2.id!=mber2.shareid and mber2.shareid in (' . $level2 . ')  '; goto x9QkC; fgh2y: global $_W, $_GPC; goto ELGTx; i1l0y: include $this->template($template); goto hHwMz; neTKN: $level3 = 'select level3m.id from ' . tablename('mihua_mall_member') . ' level3m where level3m.id!=level3m.shareid and level3m.shareid in( ' . $level2 . ')'; goto tPTGX; pcZzM: $count1 = 0; goto fct2j; jz1hK: $count3 = 0; goto gFTS3; hs0UG: if (!empty($profile['id'])) { goto xSzOt; } goto yR2hr; zF0M3: wu4XB: goto dYzUZ; fDoWF: $profile = $this->getProfile(); goto wGLRu; x9QkC: $count2 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql2_member . ')) and (fans.openid not in (' . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}"); goto bIclP; dYzUZ: if (!(true && $cfg['globalCommissionLevel'] >= 2)) { goto GiahW; } goto SjT7U; wGLRu: load()->model('mc'); goto LE2YY; bIclP: GiahW: goto hTgwP; yR2hr: $this->autoRegedit($modulephp); goto lK69r; pJpim: $template = $this->selectTemplate('myfans'); goto i1l0y; SjT7U: $level2 = 'select level2m.id from ' . tablename('mihua_mall_member') . ' level2m where level2m.id!=level2m.shareid and  level2m.shareid = ' . $profile['id']; goto vCvhP; LHNEf: $count3 = pdo_fetchcolumn('	select count(*) from ' . tablename('mc_mapping_fans') . " fans where openid!='{$from_user}' and (fans.openid in (" . $sql3_member . ')) and (fans.openid not in (' . $sql1_member . ')) and (fans.openid not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}"); goto HfQ0Z; hHwMz: } public function doMobileMyfansDetail() { goto xxUMM; diNWu: $where_flag1 = ' and mber1.flag=1'; goto A4yT1; r_TbO: if (!($level == '1' || $level == '2' || $level == '3')) { goto MmFye; } goto hoi6G; W2L1T: $id = $profile['id']; goto aqER7; Z585P: MmFye: goto VajrV; ZttzY: $profile = $this->getProfile(); goto INPDa; b91Wc: if (!($level == '4')) { goto PXBD0; } goto Rl1Pz; O8XIP: $this->autoRegedit($modulephp); goto ZttzY; v4tdF: CDNcP: goto gUlX_; HpnvF: m3hcm: goto ymphw; cLLb3: $where_flag3 = ' and mber3.flag=0'; goto FEL0h; AaVp1: $from_user = $_W['openid']; goto ckvha; aqER7: $flag = $_GPC['flag']; goto RLx8l; UFSN4: $sql2_member = 'select mber2.from_user from ' . tablename('mihua_mall_member') . " mber2 where mber2.realname<>'' and mber2.id!=mber2.shareid {$where_flag2} and mber2.shareid in (" . $level2 . ')  '; goto awjdK; RLx8l: if ($flag == 1) { goto AHfZk; } goto hOu5L; LB3UC: AHfZk: goto diNWu; ckvha: $profile = $this->getProfile(); goto M9hdF; CT2Xv: $template = $this->selectTemplate('myfansDetail'); goto vrfct; z6V4f: $fansall = pdo_fetchall('	select fans.*,(select uid from ' . tablename('mc_mapping_fans') . ' wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid  limit 1) uid from ' . tablename('mihua_mall_member') . " fans where from_user!='{$from_user}' and (fans.from_user in (" . $sql3_member . ')) and (fans.from_user not in (' . $sql1_member . ')) and (fans.from_user not in  (' . $sql2_member . ")) and fans.uniacid={$_W['uniacid']}  order by fans.createtime desc"); goto w7_bc; Rl1Pz: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto APuhA; hOu5L: $where_flag1 = ' and mber1.flag=0'; goto rMksq; HfiMh: tFmjo: goto LjA3r; a3mL2: MatZq: goto r_TbO; BNLkT: $fansall = pdo_fetchall('	select fans.*,(select uid from ' . tablename('mc_mapping_fans') . ' wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid limit 1) uid from ' . tablename('mihua_mall_member') . " fans where  from_user!='{$from_user}' and  ( fans.from_user in (" . $sql2_member . ')) and (fans.from_user not in (' . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}  order by fans.createtime desc"); goto v4tdF; awjdK: if (!($level == '2')) { goto CDNcP; } goto BNLkT; OFjBM: if (!empty($profile['id'])) { goto BENNW; } goto O8XIP; iye1w: PXBD0: goto YoiMj; YRgax: $level = $_GPC['level']; goto W2L1T; rPUxb: $level2 = 'select level2m.id from ' . tablename('mihua_mall_member') . ' level2m where level2m.id!=level2m.shareid and  level2m.shareid = ' . $profile['id']; goto UFSN4; rMksq: $where_flag2 = ' and mber2.flag=0'; goto cLLb3; w7_bc: fBYGd: goto JFP7J; INPDa: BENNW: goto szKlN; OxLQZ: $modulephp = 'myfansDetail'; goto OFjBM; nsFAp: if (!($level == '3')) { goto fBYGd; } goto z6V4f; JFP7J: nbM6O: goto b91Wc; JBW0j: $fansall = pdo_fetchall('	select fans.*,(select uid from ' . tablename('mc_mapping_fans') . ' wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid  limit 1) uid from ' . tablename('mihua_mall_member') . ' fans where (select follow from ' . tablename('mc_mapping_fans') . " wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid  limit 1)=1 and from_user!='{$from_user}' and ( fans.from_user in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}  order by fans.createtime desc"); goto HfiMh; ymphw: O1dY3: goto CT2Xv; hoi6G: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . " mber1 where mber1.realname<>'' and mber1.id!=mber1.shareid {$where_flag1} and mber1.shareid = " . $profile['id']; goto F5sC1; F5sC1: if (!($level == '1')) { goto TN_oR; } goto KCXkS; SyRM4: $sql3_member = 'select mber3.from_user from ' . tablename('mihua_mall_member') . " mber3 where mber3.realname<>'' and mber3.id!=mber3.shareid {$where_flag3}  and mber3.shareid in (" . $level3 . ')  '; goto nsFAp; KCXkS: $fansall = pdo_fetchall('	select fans.*,(select uid from ' . tablename('mc_mapping_fans') . ' wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid  limit 1) uid from ' . tablename('mihua_mall_member') . " fans where from_user!='{$from_user}' and ( fans.from_user in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']} order by fans.createtime desc"); goto GP36y; LjA3r: if (!$fansall) { goto O1dY3; } goto xiACe; szKlN: $signPackage = $this->getSignPackage($modulephp); goto YRgax; hhRzj: $level3 = 'select level3m.id from ' . tablename('mihua_mall_member') . ' level3m where level3m.id!=level3m.shareid and level3m.shareid in( ' . $level2 . ')'; goto SyRM4; w8VIf: $sql1_member = 'select mber1.from_user from ' . tablename('mihua_mall_member') . ' mber1 where mber1.realname<>\'\' and mber1.id!=mber1.shareid and mber1.shareid = ' . $profile['id']; goto JBW0j; A4yT1: $where_flag2 = ' and mber2.flag=1'; goto EO_lT; FEL0h: goto MatZq; goto LB3UC; xxUMM: global $_W, $_GPC; goto jqMK2; VajrV: if (!($level == '2' || $level == '3')) { goto rJXHL; } goto rPUxb; jqMK2: $this->toflag(); goto AaVp1; APuhA: $fansall = pdo_fetchall('	select fans.*,(select uid from ' . tablename('mc_mapping_fans') . ' wefans where wefans.openid=fans.from_user and wefans.uniacid=fans.uniacid  limit 1) uid from ' . tablename('mihua_mall_member') . " fans where from_user!='{$from_user}' and ( fans.from_user in (" . $sql1_member . ") ) and fans.uniacid={$_W['uniacid']}  order by fans.createtime desc"); goto iye1w; gUlX_: rJXHL: goto b4aIm; vrfct: include $this->template($template); goto lB35V; b4aIm: if (!($level == '3')) { goto nbM6O; } goto hhRzj; M9hdF: load()->model('mc'); goto OxLQZ; GP36y: TN_oR: goto Z585P; xiACe: foreach ($fansall as $key => $value) { goto rAbmc; qV8E0: lkiIO: goto xV3Zg; m0xrb: $fansall[$key]['avatar'] = $avatar['avatar']; goto YeaT5; poS8L: if (!$avatar) { goto t45ci; } goto m0xrb; rAbmc: $avatar = mc_fetch($value['uid'], array("avatar")); goto poS8L; YeaT5: t45ci: goto qV8E0; xV3Zg: } goto HpnvF; YoiMj: if (!($level == '5')) { goto tFmjo; } goto w8VIf; EO_lT: $where_flag3 = ' and mber3.flag=1'; goto a3mL2; lB35V: } public function doMobileMyCart() { goto vIxgg; XOMVx: $goodsid = intval($_GPC['id']); goto MRFvy; LqFPG: die(json_encode($result)); goto EzgoO; EzgoO: exit; goto xojih; FgZZR: WJHKk: goto qzruI; fckFS: if ($row == false) { goto pnWkz; } goto CMxSf; K8l0p: pdo_update('mihua_mall_cart', $data, array("id" => $row['id'])); goto xp4ma; HaQ_0: $data = array("marketprice" => $marketprice, "total" => $t, "optionid" => $optionid); goto K8l0p; MRFvy: $total = intval($_GPC['total']); goto dllC1; NpS8b: $qr_code = $this->getQr_code(); goto PUti4; jsGRI: $carttotal = $this->getCartTotal(); goto ozu8F; LH2kg: $orderTotal = pdo_fetchcolumn($sql, $params); goto iZsKz; KbGfq: goto zhjix; goto tWt03; vIxgg: global $_W, $_GPC; goto wyKH0; YE62L: goto IfEne; goto qC3oG; VxT8s: pdo_delete('mihua_mall_cart', array("from_user" => $from_user, "uniacid" => $_W['uniacid'], "id" => $id)); goto ClOpm; CMxSf: $t = $total + $row['total']; goto ebqmW; VCoJj: php6n: goto UnDb1; yB_nz: $sql = 'update ' . tablename('mihua_mall_cart') . " set total={$num} where id=:id"; goto uN6v2; sd9ID: die(json_encode($result)); goto WQTUG; R4IxG: die(json_encode(array("result" => 1))); goto Gvhl2; AgR6g: XIkj3: goto YE62L; ybyYc: $cfg = $this->module['config']; goto NpS8b; tWt03: v7HcY: goto XOMVx; qnaTY: if ($op == 'add') { goto v7HcY; } goto EdC9f; j1iBB: $signPackage = $this->getSignPackage($modulephp); goto wiV6i; qC3oG: tpCRc: goto GMLp2; OSxrm: IfEne: goto KbGfq; qzruI: hwbLa: goto REF0O; jpHbW: $shownotice = $this->checkUser(); goto ybyYc; eVhLB: R1J6J: goto HaQ_0; PP2oF: die(json_encode($result)); goto EjGTp; ckGcf: $goodsOptionStock = 0; goto rqTE1; t9h28: $totalprice = 0; goto LezJD; ebqmW: if (empty($goods['astrict'])) { goto R1J6J; } goto zfHOh; IRYft: $params = array(":goodsid" => $goodsid, ":from_user" => $_W['fans']['from_user']); goto LH2kg; GMLp2: pdo_delete('mihua_mall_cart', array("from_user" => $from_user, "uniacid" => $_W['uniacid'])); goto RL2hX; EjGTp: zhjix: goto v4fnh; a8wZI: $goods = pdo_fetch('SELECT id, type, total,marketprice,astrict FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id', array(":id" => $goodsid)); goto od5Uj; W3JRv: $id = intval($_GPC['id']); goto h6zbN; wiV6i: $profile = $this->getProfile(); goto QidZw; txE8f: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_cart') . " WHERE  uniacid = '{$_W['uniacid']}' AND from_user = '" . $from_user . '\''); goto t9h28; erkPk: $op = $_GPC['op']; goto qnaTY; PUti4: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto sNMu0; iIRUI: GnzKl: goto eVhLB; o1ODP: $result = array("result" => 2, "maxbuy" => $goods['astrict']); goto sd9ID; pkLgo: HVsvm: goto BUpC0; rqTE1: $goodsOptionStock = $goods['total']; goto PpyiH; D5K3L: $t = $goods['astrict']; goto o1ODP; Gvhl2: Pxwos: goto yHKhn; u0mr0: exit; goto pkLgo; GeFMw: message($result, '', 'ajax'); goto hs1pT; qC22B: load()->model('mc'); goto eVyAt; H3PI6: vDmTF: goto LTEv4; yHKhn: goto XIkj3; goto H3PI6; dllC1: $total = empty($total) ? 1 : $total; goto W3l_r; uN6v2: pdo_query($sql, array(":id" => $id)); goto R4IxG; BUpC0: $marketprice = $goods['marketprice']; goto ckGcf; hs1pT: WLokq: goto Ak96E; od5Uj: if (!empty($goods)) { goto WLokq; } goto xHcsf; FxN3_: xdbJf: goto W3JRv; Eh0Lv: $result = array("result" => 0, "maxbuy" => $goodsOptionStock); goto LqFPG; sNMu0: $modulephp = 'myCart'; goto j1iBB; iZsKz: if (!(!empty($goods['astrict']) && $orderTotal + $total > $goods['astrict'])) { goto HVsvm; } goto k3kIj; UmVX8: PVfKh: goto E8ivR; UnDb1: $template = $this->selectTemplate('cart'); goto yty94; H6oA0: die(json_encode($result)); goto u0mr0; RL2hX: die(json_encode(array("result" => 1))); goto OSxrm; LTEv4: $id = intval($_GPC['id']); goto VxT8s; ClOpm: die(json_encode(array("result" => 1, "cartid" => $id))); goto AgR6g; bmTV4: foreach ($list as &$item) { goto OVqCV; uRpkm: $totalprice += $item['totalprice']; goto k0Tlw; OVqCV: $goods = pdo_fetch('SELECT  title, thumb, marketprice, unit, total,astrict FROM ' . tablename('mihua_mall_goods') . ' WHERE id=:id limit 1', array(":id" => $item['goodsid'])); goto TzPxJ; TzPxJ: $option = pdo_fetch('select title,marketprice,stock from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $item['optionid'])); goto UHMbY; FVSTk: $goods['optionname'] = $option['title']; goto CSFQB; eL0cI: $goods['total'] = $option['stock']; goto s78vf; UHMbY: if (!$option) { goto zMuE3; } goto X11SY; CSFQB: $goods['marketprice'] = $option['marketprice']; goto eL0cI; k0Tlw: Tinjf: goto jkhS7; jx5l2: $item['goods'] = $goods; goto JTxiW; s78vf: zMuE3: goto jx5l2; JTxiW: $item['totalprice'] = floatval($goods['marketprice']) * intval($item['total']); goto uRpkm; X11SY: $goods['title'] = $goods['title']; goto FVSTk; jkhS7: } goto UmVX8; PpyiH: if (empty($optionid)) { goto hwbLa; } goto E_OUz; xojih: mS0QP: goto Usbkv; fot1d: goto Pxwos; goto FxN3_; Ak96E: $sql = 'SELECT SUM(`og`.`total`) AS `orderTotal` FROM ' . tablename('mihua_mall_order_goods') . ' AS `og` JOIN ' . tablename('mihua_mall_order') . ' AS `o` ON `og`.`orderid` = `o`.`id` WHERE `og`.`goodsid` = :goodsid AND `o`.`from_user` = :from_user'; goto IRYft; EdC9f: if ($op == 'clear') { goto tpCRc; } goto zZ0o7; eVyAt: $from_user = $this->getFromUser(); goto jpHbW; E8ivR: unset($item); goto VCoJj; Usbkv: $row = pdo_fetch('SELECT id, total FROM ' . tablename('mihua_mall_cart') . " WHERE from_user = :from_user AND uniacid = '{$_W['uniacid']}' AND goodsid = :goodsid  and optionid=:optionid", array(":from_user" => $from_user, ":goodsid" => $goodsid, ":optionid" => $optionid)); goto fckFS; xp4ma: goto c3fgC; goto QuO6w; E_OUz: $option = pdo_fetch('select marketprice,stock from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $optionid)); goto Ra8LU; dJjEh: $marketprice = $option['marketprice']; goto p4PKJ; W3l_r: $optionid = intval($_GPC['optionid']); goto a8wZI; p4PKJ: $goodsOptionStock = $option['stock']; goto FgZZR; QuO6w: pnWkz: goto H5Lor; xHcsf: $result['message'] = '抱歉，该商品不存在或是已经被删除！'; goto GeFMw; REF0O: if (!($goodsOptionStock <= $total && $goodsOptionStock != -1)) { goto mS0QP; } goto Eh0Lv; yty94: include $this->template($template); goto fot1d; LezJD: if (empty($list)) { goto php6n; } goto bmTV4; h6zbN: $num = intval($_GPC['num']); goto yB_nz; ozu8F: $result = array("result" => 1, "total" => $carttotal); goto PP2oF; WQTUG: exit; goto iIRUI; AduH0: pdo_insert('mihua_mall_cart', $data); goto oeG_1; zZ0o7: if ($op == 'remove') { goto vDmTF; } goto crjUb; k3kIj: $result = array("result" => 2, "maxbuy" => $goods['astrict']); goto H6oA0; Ra8LU: if (empty($option)) { goto WJHKk; } goto dJjEh; oeG_1: c3fgC: goto jsGRI; wyKH0: $this->checkAuth(); goto qC22B; crjUb: if ($op == 'update') { goto xdbJf; } goto txE8f; zfHOh: if (!($t > $goods['astrict'])) { goto GnzKl; } goto D5K3L; H5Lor: $data = array("uniacid" => $_W['uniacid'], "goodsid" => $goodsid, "goodstype" => $goods['type'], "marketprice" => $marketprice, "from_user" => $from_user, "total" => $total, "optionid" => $optionid); goto AduH0; QidZw: $id = $profile['id']; goto erkPk; v4fnh: } public function setOrderCredit($orderid, $add = true) { goto zSluD; ls6k_: $user = mc_fetch($uid); goto xugDz; MpjM1: $credits = 0; goto I534t; uMmrg: $keyword4 = $new_credit . '积分'; goto zqCHZ; nb6k7: $this->sendtmpmsg_credit($from_user, $creditTemplateid, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $keyword4, $remark); goto SllRT; qywnn: wMDx5: goto o2O5A; NDnno: $from_user = $order['from_user']; goto ShlPo; l8oZm: pdo_update('mc_members', array("credit1" => $new_credit), array("uid" => $uid, "uniacid" => $uniacid)); goto wj6j3; romGa: $creditTemplateid = $cfg['creditTemplateid']; goto tabRH; ojV5N: if (!($new_credit <= 0)) { goto w861N; } goto EYvyM; igpW1: if (empty($fans)) { goto AqYQq; } goto zGCod; xugDz: $timestr = date('Y-m-d H:i', TIMESTAMP); goto dGYhw; bObQE: vF0qg: goto NDnno; wj6j3: if (empty($creditTemplateid)) { goto bBHq8; } goto ls6k_; zqCHZ: $remark = '感谢您的支持'; goto nb6k7; dGYhw: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('fansindex'); goto R7B5m; WlwMU: $keyword2 = $credits . '积分'; goto pGg4Z; zSluD: global $_W, $_GPC; goto e1Ls7; I534t: $ordergoods = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . 'WHERE orderid = :id and uniacid = :uniacid ', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto gX4wo; l9mz6: c5LRt: goto xRUfu; Q3IUi: if (!(empty($order['id']) || $order['credit_flag'] == '1')) { goto qKLrp; } goto RdbCb; B6y5b: $fans = mc_credit_fetch($uid); goto igpW1; il0mM: $new_credit = $fans['credit1'] - $credits; goto ojV5N; czDCU: ROY8p: goto zy94F; gX4wo: if (empty($ordergoods)) { goto ROY8p; } goto FIS_g; ShlPo: $uid = mc_openid2uid($from_user); goto B6y5b; o2O5A: $new_credit = $credits + $fans['credit1']; goto tXWz0; zcK8z: $uniacid = $_W['uniacid']; goto ihMcz; xRUfu: if (!($credits <= 0)) { goto vF0qg; } goto dzwwD; ihMcz: $cfg = $this->module['config']; goto romGa; R7B5m: $goodstitle = '亲爱的：' . $user['nickname'] . ',您的积分账户有新的变动'; goto AqanY; AqanY: $keyword1 = $timestr; goto WlwMU; tabRH: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id limit 1', array(":id" => $orderid)); goto Q3IUi; FIS_g: foreach ($ordergoods as $o) { goto xiz4E; xiz4E: $goods = pdo_fetchall('SELECT credit FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id and uniacid = :uniacid ', array(":id" => $o['goodsid'], ":uniacid" => $_W['uniacid'])); goto TXNFe; b4hAJ: BPLLb: goto kU1Fj; HWri9: foreach ($goods as $g) { $credits += $g['credit'] * $o['total']; GI6Z3: } goto xZ74e; xZ74e: D3lV7: goto b4hAJ; kU1Fj: Z9kB8: goto Si2C2; TXNFe: if (empty($goods)) { goto BPLLb; } goto HWri9; Si2C2: } goto l9mz6; zGCod: if ($add) { goto wMDx5; } goto il0mM; dzwwD: return; goto bObQE; EYvyM: $new_credit = 0; goto Otg1M; mI862: AqYQq: goto czDCU; SllRT: bBHq8: goto mI862; RdbCb: return; goto j7bd0; km15F: goto IuAWt; goto qywnn; Otg1M: w861N: goto km15F; pGg4Z: $keyword3 = '完成交易'; goto uMmrg; j7bd0: qKLrp: goto MpjM1; mFBrb: pdo_update('mihua_mall_order', array("credit_flag" => 1), array("id" => $orderid, "uniacid" => $uniacid)); goto l8oZm; e1Ls7: load()->model('mc'); goto zcK8z; tXWz0: IuAWt: goto mFBrb; zy94F: } public function sedtextmsg($info, $from_user) { goto wf4W3; wf4W3: $message = array("msgtype" => "text", "text" => array("content" => urlencode($info)), "touser" => $from_user); goto jlKch; YF_Or: if (!is_error($status)) { goto jpkNa; } goto eaTgW; jlKch: $account_api = WeAccount::create(); goto JD79P; ZANnE: jpkNa: goto FnERy; JD79P: $status = $account_api->sendCustomNotice($message); goto YF_Or; eaTgW: message('发送失败，原因为' . $status['message']); goto ZANnE; FnERy: } public function sendconfirmmsg($id) { goto mnnY9; ixjxO: $profile = $this->getProfile($from_user); goto GH31P; ors6B: pdo_update('mihua_mall_member', array("flag" => 1, "uid" => $uid, "flagtime" => TIMESTAMP), array("from_user" => $order['from_user'])); goto VFRlE; cudia: if (!$order['shareid3']) { goto k3wF9; } goto h52D7; mnnY9: global $_W, $_GPC; goto A4rOW; d0At2: if (!($user_data['flag'] != 1)) { goto VJDfI; } goto ors6B; VFRlE: VJDfI: goto kGFJc; fUHBZ: $uid = mc_openid2uid($order['from_user']); goto zvW7m; GH31P: if (empty($profile)) { goto ptwsr; } goto ycpcg; uzrO4: vcEvP: goto mg3_s; CK0hI: $this->sendxjdlshtz($order['ordersn'], $order['price'], $realname, $openid); goto rLly8; YYupA: ESSIC: goto cudia; ccjaV: if (!($openid != $order['from_user'])) { goto DCfbA; } goto CK0hI; dUYUG: $user_data = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . '   WHERE from_user=:from_user', array(":from_user" => $order['from_user'])); goto d0At2; A4rOW: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE id ={$id}"); goto fUHBZ; kGFJc: goto n51aO; goto A1YUq; ycpcg: if (!$order['shareid']) { goto vcEvP; } goto JxJC8; q9mWc: $this->sendxjdlshtz($order['ordersn'], $order['price'], $realname, $openid); goto YYupA; DmL6i: $from_user = $order['from_user']; goto ixjxO; rLly8: DCfbA: goto uzrO4; cRRAO: n51aO: goto XS3dt; zvW7m: $realname = pdo_fetchcolumn('select nickname from ' . tablename('mc_members') . " where uid ={$uid}"); goto DmL6i; pfYBx: $this->sendxjdlshtz($order['ordersn'], $order['price'], $realname, $openid); goto fPycm; JxJC8: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid']} "); goto ccjaV; h52D7: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid3']} "); goto pfYBx; WcG90: $openid = pdo_fetchcolumn('select from_user from ' . tablename('mihua_mall_member') . " where id={$order['shareid2']} "); goto q9mWc; mg3_s: if (!$order['shareid2']) { goto ESSIC; } goto WcG90; fPycm: k3wF9: goto dUYUG; A1YUq: ptwsr: goto cRRAO; XS3dt: } private function setbackmoney($orderid, $add = true) { goto d3xOh; UEO_P: $url2 = $_W['siteroot'] . 'app/' . $this->createMobileUrl('fansindex'); goto tKMdm; yh8_F: $backmoney = 0; goto ndjLY; QwPrI: $cfg = $this->module['config']; goto JnDI_; Rombp: if (!($backmoney <= 0)) { goto bgitT; } goto zp2e9; tgceZ: bgitT: goto RCFlM; RCFlM: $uid = mc_openid2uid($order['from_user']); goto kh8vh; Rpk4q: $falg = 0; goto X5mdv; X5mdv: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id and uniacid = :uniacid  limit 1', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto mqfch; H07Tm: return; goto WC26L; tKMdm: $goodstitle2 = '恭喜您，获得' . $backmoney . '元红包,已存入您的余额，赶快下单使用吧！'; goto jX3XK; jX3XK: $this->sendtmpmsg_red($order['from_user'], $sendMsgred, $url2, $goodstitle2, $keyword1, $keyword2, $keyword3, ''); goto IigU_; NZNs7: load()->model('mc'); goto Rpk4q; mqfch: if (!(empty($order['id']) || $order['send_backmoney'] == '1')) { goto uRPCR; } goto H07Tm; d3xOh: global $_W, $_GPC; goto QwPrI; ouZWc: if (empty($ordergoods)) { goto HJJB3; } goto imG0l; IigU_: return $flag = 1; goto TQaOs; IQGZ4: $keyword2 = $backmoney . '元'; goto RbEq4; TQaOs: HJJB3: goto ZH2Bf; ndjLY: $ordergoods = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . 'WHERE orderid = :id and uniacid = :uniacid ', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto ouZWc; WC26L: uRPCR: goto yh8_F; JnDI_: $sendMsgred = $cfg['sendMsgred']; goto NZNs7; F0KaU: $keyword1 = '确认收货'; goto IQGZ4; DEsvJ: YJWQ9: goto Rombp; kh8vh: $result = mc_credit_update($uid, 'credit2', $backmoney, array($uid, "商城消费返现", "mihua_mall", 1)); goto MWj3O; m2l3d: pdo_insert('core_paylog', $paylog); goto tT8qg; zp2e9: return; goto tgceZ; MWj3O: $paylog = array("type" => "return", "uniacid" => $_W['uniacid'], "openid" => $order['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $backmoney, "module" => "mihua_mall", "tag" => "商城消费返现", "encrypt_code" => "商城消费返现"); goto m2l3d; RbEq4: $keyword3 = '商城余额'; goto UEO_P; tT8qg: pdo_update('mihua_mall_order', array("send_backmoney" => 1), array("id" => $order['id'], "uniacid" => $_W['uniacid'])); goto F0KaU; imG0l: foreach ($ordergoods as $o) { goto p3MXu; NnzSZ: if (empty($goods)) { goto V1z_5; } goto wdXZC; p3MXu: $goods = pdo_fetchall('SELECT backmoney FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id and uniacid = :uniacid ', array(":id" => $o['goodsid'], ":uniacid" => $_W['uniacid'])); goto NnzSZ; k1DEV: py8vl: goto Qxc3d; wdXZC: foreach ($goods as $g) { $backmoney += $g['backmoney'] * $o['total']; ncoPF: } goto k1DEV; Qxc3d: V1z_5: goto YBoaq; YBoaq: k8cSV: goto VhMAx; VhMAx: } goto DEsvJ; ZH2Bf: } public function setOrderRed($orderid, $add = true) { goto jRSiQ; rGm6A: SH1Qg: goto UVYiC; UUuyK: $url2 = $_W['siteroot'] . 'app/' . $this->createMobileUrl('redrecord'); goto F03Jm; mvLiu: TSLer: goto TGY9O; oX6jc: return; goto j8K0d; b68m9: $class_redBao->money = $red_packet; goto C8Car; pOsTc: $this->sendtmpmsg_red($order['from_user'], $sendMsgred, $url2, $goodstitle2, $keyword1, $keyword2, $keyword3, $remark); goto GbWlv; Btdzw: $remark = '------------------------------\\n' . '订单编号：' . $order['ordersn'] . '\\n' . '联系电话：' . $address['mobile']; goto TPtug; X1JZB: $ordergoods = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . 'WHERE orderid = :id and uniacid = :uniacid ', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto b1naY; F03Jm: $goodstitle2 = '亲爱的' . $user['nickname'] . '，恭喜您，获得一个红包！'; goto pOsTc; MRNM5: foreach ($ordergoods as $o) { goto e4ZsW; pOW9A: foreach ($goods as $g) { $red_packet += $g['red_packet'] * $o['total']; Nx7O2: } goto zsjFK; elRbU: ECpVJ: goto qbAke; e4ZsW: $goods = pdo_fetchall('SELECT red_packet FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id and uniacid = :uniacid ', array(":id" => $o['goodsid'], ":uniacid" => $_W['uniacid'])); goto uC1r_; zsjFK: bJpkO: goto WGdFK; uC1r_: if (empty($goods)) { goto OFaNR; } goto pOW9A; WGdFK: OFaNR: goto elRbU; qbAke: } goto m2Uhf; aWPMd: if (!(empty($order['id']) || $order['send_redpacket'] == '1')) { goto vg6nU; } goto oX6jc; TPtug: $uid = mc_openid2uid($order['from_user']); goto JrzBX; lg80h: if (!($red_packet < 1 || $red_packet > 200)) { goto TSLer; } goto K23MI; K23MI: return; goto mvLiu; j8K0d: vg6nU: goto lAqbp; xDxOM: RnOXS: goto UUuyK; b1naY: if (empty($ordergoods)) { goto DH1Dq; } goto MRNM5; zmuVM: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id and uniacid = :uniacid  limit 1', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto aWPMd; YJ4xh: if (!(!empty($noticeid) && !empty($sendMsgred))) { goto lu4Ns; } goto Is15C; sLJTb: $cfg = $this->module['config']; goto Z7sZp; Z7sZp: load()->model('mc'); goto uqMCn; jCA2f: foreach ($noticeid as &$adminid) { $this->sendtmpmsg_red($adminid['from_user'], $sendMsgred, $url, $goodstitle, $keyword1, $keyword2, $keyword3, $remark); oVpTq: } goto xDxOM; kyZ7B: $keyword3 = '微信红包'; goto jCA2f; le8_1: pdo_insert('mihua_mall_red', array("openid" => $order['from_user'], "commission_flag" => 2, "money" => $red_packet, "orderid" => $order['id'], "addtime" => TIMESTAMP, "uniacid" => $_W['uniacid'])); goto zueaI; Sx8z7: if ($re == 1) { goto m8kYy; } goto le8_1; wj2kr: goto SH1Qg; goto dfkeK; jRSiQ: global $_W, $_GPC; goto sLJTb; UYNtJ: $keyword1 = '确认收货'; goto Es6fK; K9It9: pdo_insert('mihua_mall_red', array("openid" => $order['from_user'], "money" => $red_packet, "orderid" => $order['id'], "addtime" => TIMESTAMP, "uniacid" => $_W['uniacid'])); goto JUTk0; dfkeK: m8kYy: goto K9It9; JUTk0: pdo_update('mihua_mall_order', array("send_redpacket" => 1), array("id" => $order['id'], "uniacid" => $_W['uniacid'])); goto M9f8_; qGSfL: $url = $_W['siteroot'] . 'app/' . $this->createMobileUrl('redrecord_manage'); goto Btdzw; uqMCn: $sendMsgred = $cfg['sendMsgred']; goto qxj0p; JrzBX: $user = mc_fetch($uid); goto RAyCL; qxj0p: $falg = 0; goto zmuVM; mSBl8: $class_redBao->openid = $order['from_user']; goto b68m9; Es6fK: $keyword2 = $red_packet . '元'; goto kyZ7B; UVYiC: DH1Dq: goto rNdHQ; C8Car: $re = $class_redBao->send(); goto Sx8z7; lAqbp: $red_packet = 0; goto X1JZB; zueaI: return $flag = 1; goto wj2kr; Is15C: $address = pdo_fetch('SELECT realname,province,city,area,address,mobile FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id', array(":id" => $order['addressid'])); goto qGSfL; GbWlv: lu4Ns: goto rGm6A; RAyCL: $goodstitle = '用户：' . $user['nickname'] . ',获得一个红包'; goto UYNtJ; M9f8_: $noticeid = pdo_fetchall('select from_user from ' . tablename('mihua_mall_admin') . '  where msg_flag=\'0\'  and uniacid = ' . $_W['uniacid']); goto YJ4xh; TGY9O: $class_redBao = C('redBao'); goto mSBl8; m2Uhf: mwmaX: goto lg80h; rNdHQ: } public function doMobileTopay() { goto WcFEo; WcFEo: global $_GPC, $_W; goto b8Cw6; E4XzP: $this->pay($ps); goto BHeOU; b8Cw6: $ps = array("tid" => $_GPC['tid'], "ordersn" => $_GPC['ordersn'], "title" => "微信支付", "fee" => $_GPC['fee']); goto E4XzP; BHeOU: } public function doMobileContactUs() { goto LjcvF; Rm9Hd: $cfg = $this->module['config']; goto W9Qsr; t11MG: include $this->template($template); goto TQ_AQ; LjcvF: global $_W; goto Rm9Hd; W9Qsr: $template = $this->selectTemplate('contactus'); goto t11MG; TQ_AQ: } public function doMobileMyOrder() { goto tYCsb; ItOdU: $comment_jifen = $cfg['comment_jifen']; goto SoyN_; Z35tv: if ($status == 1) { goto r3E03; } goto GVSfF; j3BgA: JMTxn: goto tFlQa; UX2p2: if ($item['ded_money'] > 0) { goto nB6s5; } goto oTe7I; pUYgX: $psize = 20; goto itvrB; x9DE3: tux12: goto yXpZc; qcc1I: $this->autoRegedit($modulephp); goto gWwlK; Rw5RC: exit; goto hQ4rN; pEFea: $this->toflag(); goto V6hmS; CrMI_: if (empty($profile)) { goto uHTqP; } goto kPSEf; cK98W: DNYSA: goto fYqhr; hQ4rN: geT9L: goto tFPq2; vhm_w: $profile = $this->getProfile($from_user); goto CrMI_; tdAVU: goto uPBws; goto VOwDh; Zk6sb: if (!($item['addressid'] != 0)) { goto DNYSA; } goto J0ukx; N_pwt: goto pTNjO; goto x9DE3; Y2_Gz: exit; goto oeJet; Sj5W1: goto iaZS6; goto JO3Fe; nnwl0: $template = $this->selectTemplate('order'); goto NDYaJ; aDpKI: c5oo9: goto hENLr; oTXNc: eppbx: goto n798K; fYqhr: if (!$item['qr_code']) { goto sScsE; } goto CVqGw; tFPq2: $from_user = $order['from_user']; goto vhm_w; jeKbu: exit; goto u0TN_; rXX69: if (!($tmp == 1)) { goto TTJCm; } goto aM8LO; f_U70: $orderid = intval($_GPC['orderid']); goto BRhX1; dXrRE: $red_packet = floatval($red_packet); goto ZpN5W; XML6F: foreach ($goods as $key => $g) { goto wvZDz; qmUoq: $have_content[$g['id']] = $comment['comment_content']; goto GS3Lx; OuSwj: PmgPJ: goto H2PH1; aFXvG: $g['marketprice'] = $option['marketprice']; goto hCDwQ; V50rX: $verifystore = pdo_fetch('select * from ' . tablename('mihua_mall_store') . ' where id=:id and uniacid=:uniacid  limit 1', array(":id" => $g['verifystoreid'], ":uniacid" => $_W['uniacid'])); goto I5ykE; hCDwQ: $g['groupprice'] = $option['groupprice']; goto OuSwj; j6t1P: if (!$option) { goto PmgPJ; } goto RPLzC; GQipb: $g['refund'] = $this->isrefund($g['iscanrefund'], $g['createtime'], $g['order_status']); goto j6t1P; H2PH1: $comment = pdo_fetch('select * from ' . tablename('mihua_mall_comment') . ' where ordersn=:ordersn and goods_id=:goods_id 
				and  uid=:uid ', array(":ordersn" => $item['ordersn'], ":goods_id" => $g['id'], ":uid" => $_W['member']['uid'])); goto lcKEd; P2H76: $goods[$key]['verifyopen'] = $verifyopen; goto Qr08X; I5ykE: $goods[$key]['verifystore'] = $verifystore; goto K5GFs; Qr08X: lrj_y: goto RbNzv; lcKEd: if (!$comment) { goto XgmjK; } goto qmUoq; GS3Lx: XgmjK: goto V50rX; RPLzC: $g['optiontitle'] = '[' . $option['title'] . ']'; goto aFXvG; wvZDz: $option = pdo_fetch('select title,marketprice,weight,stock,groupprice from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $g['optionid'])); goto GQipb; K5GFs: $verifyopen = pdo_fetch('select * from ' . tablename('mihua_mall_saler') . ' where openid=:openid and uniacid=:uniacid  limit 1', array(":openid" => $g['verifyopenid'], ":uniacid" => $_W['uniacid'])); goto P2H76; RbNzv: } goto A1Od3; CHUOf: if (!empty($deductible)) { goto AVQ5i; } goto VULCe; J0ukx: $address = pdo_fetch('SELECT realname,province,city,area,address,mobile FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id', array(":id" => $item['addressid'])); goto cK98W; IzJUs: r3E03: goto tJbH3; tYCsb: global $_W, $_GPC; goto pEFea; vTpVW: if (!empty($profile['id'])) { goto ORWXT; } goto qcc1I; AQaoN: $dispatch = pdo_fetch('select id,dispatchname,dispatchtype from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $item['dispatch'])); goto Zk6sb; HO56j: $this->setOrderStock($orderid); goto k84VO; tFlQa: $id = intval($_GPC['id']); goto dpwXh; H2I0j: pTNjO: goto wj6w6; oeJet: t4fNI: goto z0_Gj; Z6Oez: message('抱歉，您的订单不存或是已经被取消！', $this->createMobileUrl('myorder'), 'error'); goto oTXNc; fPpbr: $signPackage = $this->getSignPackage($modulephp); goto iOUhZ; daUoP: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}' AND from_user = '" . $from_user . '\''); goto hzhyr; GVSfF: if ($status == 6) { goto tux12; } goto oWegh; aEXco: if ($op == 'detail') { goto liNBa; } goto IWqFe; OB2BX: $pindex = max(1, intval($_GPC['page'])); goto pUYgX; ZauRd: if ($op == 'remove') { goto JMTxn; } goto Nf0OJ; VULCe: $deductible = 0.1; goto BO39y; XylYI: exit; goto wem86; ZpN5W: $template = $this->selectTemplate('order_detail'); goto jhhGp; VOMV4: liNBa: goto w1JXb; cFsuY: $where .= ' and ((paytype=3  AND (status = 0 or status = 1)) or (paytype!=3 AND status = 1 ) ) AND sendtype=0'; goto N_pwt; VU7xn: goto pTNjO; goto IzJUs; uy9K6: ohylz: goto tdAVU; dtXQa: $carttotal = $this->getCartTotal(); goto M8UWR; SoyN_: $modulephp = 'myorder'; goto vTpVW; M8UWR: if (!($item['addressid'] != 0)) { goto KClCY; } goto UBz1Q; C02vJ: tTr9s: goto uoqy1; mK_cE: goto ohylz; goto VOMV4; oWegh: $where .= " and status={$status}"; goto VU7xn; iYofV: $count_ded = $item['deductible'] * $deductible; goto Sj5W1; NDYaJ: include $this->template($template); goto mK_cE; eQ409: iaZS6: goto aDpKI; iOUhZ: $id = $profile['id']; goto MNa0f; KTrA0: $where = " uniacid = '{$_W['uniacid']}' AND from_user = '" . $from_user . '\''; goto Z35tv; IWqFe: $odurl = 'myorder'; goto OB2BX; tYr1r: $profile = $this->getProfile(); goto CT2pk; S6e0J: uHTqP: goto LWqw6; n798K: $goodsid = pdo_fetchall('SELECT goodsid,total FROM ' . tablename('mihua_mall_order_goods') . " WHERE orderid = '{$orderid}'", array(), 'goodsid'); goto jdb1L; ypsHe: sScsE: goto d2cTE; OobQ5: $cfg = $this->module['config']; goto ItOdU; LRfWn: if (!($order['paytype'] != 3)) { goto tTr9s; } goto FYv6T; u0TN_: TTJCm: goto C02vJ; X7qs_: unset($g); goto AQaoN; w1JXb: $orderid = intval($_GPC['orderid']); goto BQfZl; hzhyr: $pager = pagination($total, $pindex, $psize); goto EbrMi; jhhGp: include $this->template($template); goto uy9K6; BO39y: AVQ5i: goto iYofV; oTe7I: $deductible = $settings['deductible']; goto CHUOf; FYv6T: pdo_update('mihua_mall_order', array("status" => 3), array("id" => $orderid, "from_user" => $from_user, "uniacid" => $_W['uniacid'])); goto HO56j; LWqw6: rxt7c: goto LRfWn; hcsQK: ORWXT: goto fPpbr; yXpZc: $where .= ' and status in(0,1,2,3,4)'; goto H2I0j; V6hmS: $from_user = $_W['openid']; goto tYr1r; BRhX1: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id AND from_user = :from_user', array(":id" => $orderid, ":from_user" => $from_user)); goto lEl1K; UBz1Q: $address = pdo_fetch('SELECT realname,province,city,area,address,mobile FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id', array(":id" => $item['addressid'])); goto Vf5qv; GQYx0: U2U4V: goto vGyD5; CT2pk: load()->model('mc'); goto OobQ5; GU_zZ: $tmp = $this->setOrderRed($orderid); goto rXX69; wj6w6: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE {$where} ORDER BY id DESC ", array(), 'id'); goto daUoP; itvrB: $status = intval($_GPC['status']); goto KTrA0; lEl1K: if (!empty($order)) { goto geT9L; } goto F7igX; CVqGw: $qr_code = str_replace(IA_ROOT, '', $item['qr_code']); goto ypsHe; A1Od3: Ofzu0: goto X7qs_; EbrMi: if (empty($list)) { goto splSS; } goto xPYm4; VOwDh: wqXrm: goto f_U70; dpwXh: pdo_delete('mihua_mall_order', array("from_user" => $from_user, "uniacid" => $_W['uniacid'], "id" => $id)); goto o703e; nNgUW: $this->setbackmoney($orderid); goto GU_zZ; Vb0BT: goto rxt7c; goto S6e0J; k84VO: $this->setOrderCredit($orderid); goto V1qBD; wem86: uPBws: goto P06Z1; kPSEf: $this->sendconfirmmsg($orderid); goto Vb0BT; JO3Fe: nB6s5: goto vOl5I; cv0XF: if (!($item['deductible'] > 0)) { goto c5oo9; } goto UX2p2; xPYm4: foreach ($list as &$row) { goto y_dqD; d3dpJ: unset($item); goto vwPvM; y_dqD: $goods = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit, g.marketprice,o.total,o.optionid,o.order_status,o.id as ogid FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$row['id']}'"); goto JnUt0; RKcwV: $row['total'] = $goods['total']; goto OosvX; JnUt0: foreach ($goods as &$item) { goto KsoIu; OFul5: $item['marketprice'] = $option['marketprice']; goto t0zj0; t0zj0: $item['groupprice'] = $option['groupprice']; goto c0tSm; c0tSm: ZPmzd: goto o809l; o809l: Hi17m: goto mSy1T; bejlq: $item['title'] = '[' . $option['title'] . ']' . $item['title']; goto OFul5; QU_k1: if (!$option) { goto ZPmzd; } goto bejlq; KsoIu: $option = pdo_fetch('select title,marketprice,groupprice,weight,stock from ' . tablename('mihua_mall_goods_option') . ' where id=:id limit 1', array(":id" => $item['optionid'])); goto QU_k1; mSy1T: } goto HEg4e; OosvX: $row['dispatch'] = pdo_fetch('select id,dispatchname from ' . tablename('mihua_mall_dispatch') . ' where id=:id limit 1', array(":id" => $row['dispatch'])); goto xGcOc; xGcOc: SjjZE: goto EV3Bo; HEg4e: rhhlm: goto d3dpJ; vwPvM: $row['goods'] = $goods; goto RKcwV; EV3Bo: } goto GQYx0; aM8LO: die(json_encode(array("result" => 1, "str" => "确认收货完成,红包发送失败"))); goto jeKbu; Nf0OJ: if ($op == 'confirm') { goto wqXrm; } goto aEXco; P06Z1: goto t4fNI; goto j3BgA; V1qBD: $this->setCommission($orderid); goto nNgUW; gWwlK: $profile = $this->getProfile(); goto hcsQK; vGyD5: splSS: goto dtXQa; jdb1L: $goods = pdo_fetchall('SELECT g.id, g.title, g.thumb, g.unit,g.groupprice, g.marketprice,g.iscanrefund,o.id as ogid,o.total,o.optionid,o.order_status, o.createtime,o.qr_code,o.verifytime,o.verifyopenid,o.verified ,o.qr_code_str FROM ' . tablename('mihua_mall_order_goods') . ' o left join ' . tablename('mihua_mall_goods') . ' g on o.goodsid=g.id ' . " WHERE o.orderid='{$orderid}'"); goto XML6F; hENLr: if (!empty($item)) { goto eppbx; } goto Z6Oez; d2cTE: $red_packet = pdo_fetchcolumn('select money from ' . tablename('mihua_mall_red') . ' where orderid=:id limit 1', array(":id" => $item['id'])); goto dXrRE; Vf5qv: KClCY: goto nnwl0; uoqy1: die(json_encode(array("result" => 0, "str" => "确认收货完成"))); goto XylYI; F7igX: die(json_encode(array("result" => 0, "str" => "抱歉，您的订单不存在或是已经被取消！"))); goto Rw5RC; vOl5I: $count_ded = $item['ded_money']; goto eQ409; MNa0f: $op = $_GPC['op']; goto ZauRd; o703e: echo json_encode(array("status" => "0", "str" => "删除成功")); goto Y2_Gz; BQfZl: $item = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . " WHERE uniacid = '{$_W['uniacid']}' AND from_user = '" . $from_user . "' and id='{$orderid}' limit 1"); goto cv0XF; tJbH3: $where .= ' and (ordertype=1 or (ordertype!=1 and iscomplete=1))'; goto cFsuY; z0_Gj: } public function setCommission($orderid) { goto kKOYw; Zn32l: $tm = 0; goto xgnB3; YyUpD: $goods = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_order_goods') . ' WHERE orderid=' . $orderid . ' and uniacid=' . $_W['uniacid']); goto hWMes; zZ9wf: $cfg = $this->module['config']; goto LkhC1; I03M9: $paylog = array("type" => "zhifu", "uniacid" => $_W['uniacid'], "openid" => $user1['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $cm, "module" => "mihua_mall", "tag" => ' 支付红包' . $cm . '元【1级会员佣金】'); goto ymumb; Vkbz3: $total = 0; goto mw1Oj; tjhuS: if (!$cfg['logo_imgurl']) { goto BMlYu; } goto XF67i; HN9Xd: $params['logo_imgurl'] = $_W['siteroot'] . 'attachment/' . $cfg['logo_imgurl']; goto HJT8d; nVIXk: tbmKy: goto hJshn; E1c0D: $cm = 0; goto OVgW7; D2Jnv: $data = array("uniacid" => $_W['uniacid'], "mid" => $order['shareid3'], "ogid" => $order['id'], "commission" => $cm, "content" => "发送红包", "isshare" => 0, "createtime" => TIMESTAMP); goto dhSUm; mEfqi: KtDci: goto Ch3p5; m1nZj: $ret = sendRedPack($params, $order['id']); goto NLLc2; sEMtb: $params['total_amount'] = $tm * 100; goto ajZM1; Tgm3C: if (!($total > 1)) { goto HqrwR; } goto pqDaX; iqrJP: $paylog = array("type" => "zhifu", "uniacid" => $_W['uniacid'], "openid" => $user3['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $cm, "module" => "mihua_mall", "tag" => ' 支付红包' . $cm . '元【3级会员佣金】'); goto C2aYD; GeqAa: $tm = 200; goto AKgK_; Zt0cj: pdo_insert('core_paylog', $paylog); goto SXNHn; Pe6bf: pdo_update('mihua_mall_member', array("commission" => $user1['commission'] + $cm, "zhifu" => $user1['zhifu'] + $cm), array("from_user" => $user1['from_user'])); goto D4S7b; XF67i: $params['logo_imgurl'] = $_W['siteroot'] . 'attachment/' . $cfg['logo_imgurl']; goto Qvnas; DPmmi: $params['remark'] = $cfg['remark']; goto JzRxx; tBana: $params['wxappid'] = $_W['account']['key']; goto xr3xr; mB4KK: $params['min_value'] = $params['max_value'] = $params['total_amount']; goto e0GYX; Uuwjz: $total += $tm; goto V9EVP; NLLc2: if ($ret) { goto WqATD; } goto Uuwjz; pf_RX: pdo_insert('mihua_mall_commission', $data); goto I03M9; jk0nn: HqrwR: goto Pe6bf; o7FK0: if (!($t3 > 0 && $order['shareid3'] > 0)) { goto w3KFo; } goto Gci0K; e0GYX: $ret = sendRedPack($params, $order['id']); goto lN1i4; ybPHy: JCjRk: goto GeqAa; ajZM1: $params['min_value'] = $params['max_value'] = $params['total_amount']; goto m1nZj; EVsXk: return; goto K63Mk; D4S7b: EhR0W: goto Mwl5H; fqvaH: $params['mch_id'] = $cfg['mch_id']; goto tBana; F2r4k: $tm = 200; goto lOZiE; Y6vaU: pdo_update('mc_members', array("credit1" => $credit1 + $cm), array("uid" => $user3['uid'])); goto mEfqi; gqOfk: qkWeK: goto l2K1g; XmJC_: $params = array(); goto z_Fj7; ozlrM: $total -= 200; goto w_9Yy; UMkvz: $credit1 = pdo_fetchcolumn('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=:uid', array(":uid" => $user3['uid'])); goto Y6vaU; G8te2: load()->model('mc'); goto zZ9wf; Mwl5H: if (!($t2 > 0 && $order['shareid2'] > 0)) { goto wN0GI; } goto Cfxbk; OfBQb: $ret = sendRedPack($params, $order['id']); goto RZxJJ; JPT1I: RY2IX: goto GX9Dp; UVWkB: if (!($total > 1)) { goto KtDci; } goto XmJC_; AKgK_: $total -= 200; goto gqOfk; IRtRz: $params['total_num'] = 1; goto VM16Q; HJT8d: mcqiy: goto pQBJP; t0rDo: $total += $tm; goto mV3sQ; A2Ex0: $params['max_value'] = 100; goto biE5s; RaLB4: $params['remark'] = $cfg['remark']; goto xHXrP; OVgW7: $tm = 0; goto fk1n0; QSWCX: $cm = 0; goto Zn32l; Awdbs: $params['total_amount'] = $tm * 100; goto mB4KK; Qvnas: BMlYu: goto E1c0D; YZFH0: LbZbt: goto VLre_; Hyrrf: goto Op_Uq; goto y7bZN; lOZiE: $total -= 200; goto wVqFa; Hb3e5: $user2 = pdo_fetch('SELECT id,from_user,balance,commission,zhifu,uid FROM ' . tablename('mihua_mall_member') . ' WHERE id=:uid', array(":uid" => $order['shareid2'])); goto nwEAO; JWFfZ: $params['nick_name'] = $_W['uniaccount']['name']; goto cCfGb; SbOYs: $tm = $total; goto Vkbz3; y83uR: $credit1 = pdo_fetchcolumn('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=:uid', array(":uid" => $user1['uid'])); goto afIe1; qLlHn: $params['key'] = $cfg['key']; goto EVv7M; iNlEh: $from_user = $order['from_user']; goto yJx2z; Q7ZVO: $params['nick_name'] = $_W['uniaccount']['name']; goto CJekr; wu1Dz: if (!($total > 1)) { goto o0DoA; } goto WQ9RN; oTgZm: ldTZ5: goto g48Da; afIe1: pdo_update('mc_members', array("credit1" => $credit1 + $cm), array("uid" => $user1['uid'])); goto jk0nn; C2aYD: pdo_insert('core_paylog', $paylog); goto UMkvz; z392t: foreach ($goods as $g) { goto WrJ1i; RVM6M: $t2 += $g['commission2'] * floatval($g['total']); goto goKFj; ae0zU: P67Gl: goto HGX81; goKFj: $t3 += $g['commission3'] * floatval($g['total']); goto ae0zU; WrJ1i: $t1 += $g['commission'] * floatval($g['total']); goto RVM6M; HGX81: } goto YZFH0; z_Fj7: $params['mch_id'] = $cfg['mch_id']; goto L43sU; IIvIB: $total = $t3 + floatval($user3['balance']); goto UVWkB; Gci0K: $total = 0; goto gulmt; ryRvD: if ($total > 200) { goto JCjRk; } goto SbOYs; AK5Nt: $params['key'] = $cfg['key']; goto fXf1w; hWMes: $t1 = $t2 = $t3 = 0; goto z392t; l2K1g: $params['total_amount'] = $tm * 100; goto AFqe_; SXNHn: $credit1 = pdo_fetchcolumn('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=:uid', array(":uid" => $user2['uid'])); goto OaQtz; RR647: $params['key'] = $cfg['key']; goto tjhuS; NLuBC: $tm = $total; goto eJpSP; KM20x: $params['re_openid'] = $user1['from_user']; goto VttXz; EPG3h: goto ldTZ5; goto D51nh; MAWD1: $tm = $total; goto WUTJU; x5HTz: $params['max_value'] = 100; goto OxSGW; Ch3p5: pdo_update('mihua_mall_member', array("commission" => $user3['commission'] + $cm, "zhifu" => $user3['zhifu'] + $cm), array("from_user" => $user3['from_user'])); goto k97dW; ngWof: $params['min_value'] = 100; goto jJgf3; cnAs1: $params['send_name'] = $_W['uniaccount']['description']; goto KM20x; RNFMc: $tm = 0; goto ryRvD; WtX8d: return; goto cmZOM; D51nh: BQcjI: goto ZhNCE; cCfGb: $params['send_name'] = $_W['uniaccount']['description']; goto HjImV; a66sJ: $params['total_num'] = 1; goto vM4nI; g48Da: $data = array("uniacid" => $_W['uniacid'], "mid" => $order['shareid'], "ogid" => $order['id'], "commission" => $cm, "content" => "发送红包", "isshare" => 0, "createtime" => TIMESTAMP); goto pf_RX; L43sU: $params['wxappid'] = $_W['account']['key']; goto Q7ZVO; AFqe_: $params['min_value'] = $params['max_value'] = $params['total_amount']; goto OfBQb; MwI_w: $params['act_name'] = $cfg['act_name']; goto qLlHn; JzRxx: $params['act_name'] = $cfg['act_name']; goto RR647; GX9Dp: $cm += $tm; goto nVIXk; jJgf3: $params['total_num'] = 1; goto TN32C; Zgx2h: goto r0vq2; goto YbkR4; xHXrP: $params['act_name'] = $cfg['act_name']; goto AK5Nt; K63Mk: NEauV: goto mbzx9; Cfxbk: $total = 0; goto Hb3e5; VJ4GT: coMIQ: goto QSWCX; WUTJU: $total = 0; goto Hyrrf; hJshn: $data = array("uniacid" => $_W['uniacid'], "mid" => $order['shareid2'], "ogid" => $order['id'], "commission" => $cm, "content" => "发送红包", "isshare" => 0, "createtime" => TIMESTAMP); goto fsdwS; RsXCE: $params['re_openid'] = $user3['from_user']; goto A2Ex0; VM16Q: $params['wishing'] = $cfg['wishing']; goto GyQaE; lN1i4: if ($ret) { goto RY2IX; } goto t0rDo; VttXz: $params['max_value'] = 100; goto ngWof; OxSGW: $params['min_value'] = 100; goto a66sJ; TN32C: $params['wishing'] = $cfg['wishing']; goto RaLB4; w_9Yy: r0vq2: goto Awdbs; k97dW: w3KFo: goto Dw4Bf; pqDaX: $params = array(); goto fqvaH; OaQtz: pdo_update('mc_members', array("credit1" => $credit1 + $cm), array("uid" => $user2['uid'])); goto SlzeK; VLre_: include IA_ROOT . '/addons/mihua_mall/class/redpack.php'; goto H7msk; uBIN7: $params['wxappid'] = $_W['account']['key']; goto JWFfZ; V9EVP: goto ccWyB; goto ZJv9b; xgnB3: if ($total > 200) { goto lgz1e; } goto MAWD1; H7msk: if (!($t1 > 0 && $order['shareid'] > 0)) { goto EhR0W; } goto pwm8c; mbzx9: $order = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_order') . ' WHERE id = :id AND uniacid = :uniacid', array(":id" => $orderid, ":uniacid" => $_W['uniacid'])); goto iNlEh; eJpSP: $total = 0; goto Zgx2h; yJx2z: if (!($order['status'] != 3 || empty($from_user))) { goto jrr0K; } goto WtX8d; fXf1w: if (!$cfg['logo_imgurl']) { goto mcqiy; } goto HN9Xd; Dg7Y7: $paylog = array("type" => "zhifu", "uniacid" => $_W['uniacid'], "openid" => $user2['from_user'], "tid" => date('Y-m-d H:i:s'), "fee" => $cm, "module" => "mihua_mall", "tag" => ' 支付红包' . $cm . '元【2级会员佣金】'); goto Zt0cj; vM4nI: $params['wishing'] = $cfg['wishing']; goto DPmmi; sPyaG: wN0GI: goto o7FK0; EVv7M: if (!$cfg['logo_imgurl']) { goto coMIQ; } goto dGAxN; m9LQi: ccWyB: goto D2Jnv; GyQaE: $params['remark'] = $cfg['remark']; goto MwI_w; xr3xr: $params['nick_name'] = $_W['uniaccount']['name']; goto cnAs1; fk1n0: if ($total > 200) { goto SN5yH; } goto NLuBC; YbkR4: SN5yH: goto QQ0XC; wVqFa: Op_Uq: goto sEMtb; mV3sQ: goto tbmKy; goto JPT1I; QQ0XC: $tm = 200; goto ozlrM; dGAxN: $params['logo_imgurl'] = $_W['siteroot'] . 'attachment/' . $cfg['logo_imgurl']; goto VJ4GT; dhSUm: pdo_insert('mihua_mall_commission', $data); goto iqrJP; LkhC1: if (!empty($orderid)) { goto NEauV; } goto EVsXk; jr3RU: $total += $tm; goto EPG3h; RZxJJ: if ($ret) { goto BQcjI; } goto jr3RU; pwm8c: $user1 = pdo_fetch('SELECT id,from_user,balance,commission,zhifu,uid FROM ' . tablename('mihua_mall_member') . ' WHERE id=:uid', array(":uid" => $order['shareid'])); goto hRX0s; hRX0s: $total = $t1 + floatval($user1['balance']); goto Tgm3C; y7bZN: lgz1e: goto F2r4k; EdBlr: pdo_update('mihua_mall_member', array("commission" => $user2['commission'] + $cm, "zhifu" => $user2['zhifu'] + $cm), array("from_user" => $user2['from_user'])); goto sPyaG; WQ9RN: $params = array(); goto ayrpJ; CJekr: $params['send_name'] = $_W['uniaccount']['description']; goto RsXCE; SlzeK: o0DoA: goto EdBlr; cmZOM: jrr0K: goto YyUpD; ymumb: pdo_insert('core_paylog', $paylog); goto y83uR; gulmt: $user3 = pdo_fetch('SELECT id,from_user,balance,commission,zhifu,uid FROM ' . tablename('mihua_mall_member') . ' WHERE id=:uid', array(":uid" => $order['shareid3'])); goto IIvIB; fsdwS: pdo_insert('mihua_mall_commission', $data); goto Dg7Y7; kKOYw: global $_W, $_GPC; goto G8te2; pQBJP: $cm = 0; goto RNFMc; HjImV: $params['re_openid'] = $user2['from_user']; goto x5HTz; ZJv9b: WqATD: goto OcLY6; biE5s: $params['min_value'] = 100; goto IRtRz; mw1Oj: goto qkWeK; goto ybPHy; OcLY6: $cm += $tm; goto m9LQi; ayrpJ: $params['mch_id'] = $cfg['mch_id']; goto uBIN7; ZhNCE: $cm += $tm; goto oTgZm; nwEAO: $total = $t2 + floatval($user2['balance']); goto wu1Dz; Dw4Bf: } public function doMobileDetail() { goto NwOsX; vS2ME: $goods['timelast'] = $arr[1]; goto t2nHR; plbyb: $shareid = mihua_COOKIE_SID . $_W['uniacid']; goto sM02z; vLdVl: $uid = mc_openid2uid($from_user); goto Hfopf; Zg2QO: $cart_count = pdo_fetchcolumn('SELECT count(*) FROM ' . tablename('mihua_mall_cart') . " WHERE from_user = :from_user AND uniacid = '{$uniacid}' ", array(":from_user" => $from_user)); goto A1gMA; EIhRp: $comment_count = count($comment_list); goto HEYmc; PYpBs: V3MqD: goto rdTlh; GwlmU: $have_zan = pdo_fetchcolumn('select zan_id from ' . tablename('mihua_mall_zan') . " where uid={$_W['member']['uid']} and goods_id={$goodsid} "); goto myzdZ; TKLq2: if (!($cfg['groupbutton'] == 1 && $goods['isgroup'] == 1)) { goto thaFJ; } goto aBX7k; agdTV: thaFJ: goto A7F3c; W5qfc: if (!($goods['istime'] == 1)) { goto Hd9xm; } goto xB2XK; p_yKG: $goodsid = intval($_GPC['id']); goto pEVs8; wOZg8: $params = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods_param') . ' WHERE goodsid=:goodsid order by displayorder asc', array(":goodsid" => $goods['id'])); goto Y6UdN; Oh_F7: unset($s); goto FZMfN; fQpIC: $day_cookies = 15; goto plbyb; yoYVD: if (!($commission == false || $commission == null || $commission < 0)) { goto gJ1tH; } goto sG2fX; RLtuI: $member['flag'] = 0; goto TsQCR; P1KWC: if (!(time() > $goods['timeend'])) { goto pb57R; } goto Gu_G5; vo6xV: $piclist = array(array("attachment" => $goods['thumb'])); goto zwJ2e; cr4g3: if (!($cfg['globalCommissionLevel'] >= 1)) { goto e3EQp; } goto xPEd1; Gu_G5: $timeend = 1; goto QzdA5; QzdA5: pb57R: goto Lc32N; aBX7k: $opengroup = 1; goto EclZR; WeOjb: $timestart = 1; goto u1tgy; xB2XK: if (!(time() < $goods['timestart'])) { goto jwo9P; } goto WeOjb; Y6UdN: $carttotal = $this->getCartTotal(); goto xbKIP; RchZI: if ($model_page == 2) { goto nTfF6; } goto b_2X3; J7_Ou: if (empty($goods['storeids'])) { goto Q92it; } goto L0b5T; jTNTd: if (!($goods['type'] == 3)) { goto EgVWU; } goto Cie1h; jls3Q: Dr9E1: goto gHK6a; xyl9n: gJ1tH: goto i16oo; kBRKQ: $from_user = $this->getFromUser(); goto Vo_3k; IJcvB: $template = $this->selectTemplate('detail02'); goto UEL3s; TTCk0: c2qqq: goto hQ2_n; sG2fX: $commission = $cfg['globalCommission']; goto xyl9n; yL95i: $shownotice = $this->checkUser(); goto rYcW2; HAPEk: $stamp = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_card') . 'where ' . time() . "<=endtime and uniacid = '{$_W['uniacid']}' 
		 and  status = '0'  ORDER BY  time  "); goto TKLq2; wne8_: $commtime = pdo_fetch('SELECT promotercount,promotermoney,promotertimes from ' . tablename('mihua_mall_rules') . ' where uniacid = ' . $_W['uniacid']); goto TNrRn; vvrDW: $profile = $this->getProfile(); goto u75Z9; e3XSl: $commission3 = $goods['commission3']; goto yoYVD; zKr8e: $refundtime = $this->getRefundtime(); goto kBRKQ; L0b5T: $storeids = array_merge(explode(',', $goods['storeids']), $storeids); goto C3chr; rYcW2: $qr_code = $this->getQr_code(); goto mjnSt; i16oo: if (!($commission2 == false || $commission2 == null || $commission2 < 0)) { goto B2cms; } goto Us29I; ZsbXf: $commission2 = $goods['commission2']; goto e3XSl; Vo_3k: $profile = $this->getProfile(); goto yL95i; XreJ9: $signPackage = $this->getSignPackage('detail', array("id" => $goods['id']), $_W['attachurl'] . $goods['thumb'], $goods['title']); goto NzRqa; R8z14: nxfWM: goto jls3Q; aCE5z: $myheadimg = mc_fetch($uid, array("avatar", "nickname")); goto Ov3z3; sK_wx: $signPackage = $this->getSignPackage($modulephp); goto vLdVl; MLeBV: if (!($cfg['globalCommissionLevel'] >= 3)) { goto nxfWM; } goto vhVSW; hQ2_n: $comment_list = pdo_fetchall('select c.*,c.nickname as xnnickname,g.nickname from ' . tablename('mihua_mall_comment') . ' c left join ' . tablename('mc_members') . ' g on g.uid=c.uid 
		where c.goods_id=' . $goodsid . ' and c.status=1 and c.uniacid =' . $_W['uniacid'] . ' order by addtime desc'); goto tL_wY; hfWQA: uhwMA: goto Oh_F7; HEYmc: $collect = pdo_fetchcolumn('select collect_id from ' . tablename('mihua_mall_collect') . ' where  uniacid = :uniacid and from_user=:from_user and collect_id=:id limit 1', array(":uniacid" => $uniacid, ":id" => $goodsid, ":from_user" => $from_user)); goto HAPEk; pW2Pi: goto sr9I0; goto V1Fu5; Nofgy: vBzX6: goto wOZg8; PpUqA: if (!is_array($urls)) { goto dLVv0; } goto mOSr2; NwOsX: global $_W, $_GPC; goto EMhjV; pEVs8: $goods = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_goods') . ' WHERE id = :id  and uniacid=:uniacid', array(":id" => $goodsid, ":uniacid" => $uniacid)); goto jTNTd; gHK6a: $model_page = intval($_GPC['p']); goto RchZI; B85Wl: if (!(!empty($fans) && !empty($fans['uid']) && $fans['follow'] != 1 && empty($_COOKIE[mihua_COOKIE_OPENID . '_checkfollow' . $uniacid]))) { goto ELkYl; } goto PY1ab; Mompz: E_53C: goto sZhiZ; xbKIP: $rmlist = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_goods') . " WHERE uniacid = '{$_W['uniacid']}'  and deleted=0 AND status = '1' and ishot='1' ORDER BY displayorder DESC, sales DESC limit 4 "); goto ZFxxa; A7F3c: if (!($cfg['commissionbutton'] == 0)) { goto Dr9E1; } goto A8CL0; lD8aj: $title = $cfg['shopname']; goto fQpIC; EMhjV: load()->model('mc'); goto pKu8N; gC7zA: EgVWU: goto k7Qgc; YFhVC: nTfF6: goto IJcvB; Ov3z3: if ($cfg['comment_flag'] == 1) { goto c2qqq; } goto H4Ofp; PY1ab: setcookie(mihua_COOKIE_OPENID . $_W['uniacid'], '', time() - 1); goto ZfAbB; Lc32N: Hd9xm: goto Pwgjx; A8CL0: $commission_flag = 1; goto wne8_; h_E0r: $from_user = $this->getFromUser(); goto lt873; kWbBe: $stock = $goods['total']; goto h3lli; UT7_n: dxjni: goto XreJ9; rdTlh: $arr = $this->time_tran($goods['timeend']); goto LtrjZ; gP4fj: $specitemids = explode('_', $options[0]['specs']); goto dQ4bW; ZFxxa: $ydyy = $cfg['ydyy']; goto NOQQg; Cie1h: $v = $goods['virtual']; goto E2McF; V1Fu5: apgYZ: goto bkHEs; pFY8Z: foreach ($allspecs as &$s) { $s['items'] = pdo_fetchall('select * from ' . tablename('mihua_mall_spec_item') . ' where  `show`=1 and specid=:specid order by displayorder asc', array(":specid" => $s['id'])); MnE2J: } goto hfWQA; OYLEQ: setcookie($shareid, $this->getShareId(), time() + 3600 * 24 * $day_cookies); goto Ds025; UCFps: $select = ' a.id,a.lastnumber,a.overtime,b.nickname,b.headimgurl '; goto nqnlH; YDDbf: QqsX8: goto cr4g3; vhVSW: $commission3 = $marketprice * $commission3 / 100; goto R8z14; yb0Vo: W5PV4: goto W5qfc; HOvfs: $groupsz = pdo_fetch('SELECT count(*) as num FROM ' . tablename('mihua_mall_group') . ' WHERE gid = :id and uniacid = :uniacid', array(":id" => $_GPC['id'], ":uniacid" => $_W['uniacid'])); goto agdTV; xPEd1: $commission = $marketprice * $commission / 100; goto dhkR4; vsJgU: $urls = unserialize($goods['thumb_url']); goto PpUqA; Jwbwr: message('抱歉，商品不存在或是已经被删除！'); goto yb0Vo; Ds025: LmSIe: goto uHlsB; zwJ2e: if (!($goods['thumb_url'] != 'N;')) { goto dxjni; } goto vsJgU; u1tgy: jwo9P: goto P1KWC; sM02z: if (!($_GPC['mid'] != $_COOKIE[$shareid] && !empty($_GPC['mid']))) { goto LmSIe; } goto cxYOV; NzRqa: $marketprice = $goods['marketprice']; goto xFNtx; xFNtx: $productprice = $goods['productprice']; goto xLnZZ; PKuDi: $allspecs = pdo_fetchall('select * from ' . tablename('mihua_mall_spec') . ' where goodsid=:id order by displayorder asc', array(":id" => $goodsid)); goto pFY8Z; NrP9d: if (!empty($goods)) { goto W5PV4; } goto Jwbwr; h3lli: $astrict = $goods['astrict']; goto PKuDi; NOQQg: $description = $cfg['description']; goto ZofSf; myzdZ: IF3_u: goto NrP9d; A6uaM: $specs = array(); goto WlBGv; k7Qgc: $stores = array(); goto Aec1E; cH_3k: if (!($cfg['globalCommissionLevel'] >= 2)) { goto Yk40O; } goto mUmBg; xYfnz: gGXEa: goto Nofgy; xLnZZ: $groupprice = $goods['groupprice']; goto kWbBe; t2nHR: $ccate = intval($goods['ccate']); goto Uei8B; lt873: ELkYl: goto lD8aj; ZfAbB: setcookie(mihua_COOKIE_OPENID . '_checkfollow' . $_W['uniacid'], '1', time() + 300); goto h_E0r; Aec1E: if (!($goods['isverify'] != 1)) { goto V3MqD; } goto RaRvJ; ItBma: B2cms: goto MRGuU; bC4Ff: if (!($profile['status'] == 0)) { goto E_53C; } goto oHMnt; R_Onw: include $this->template($template); goto M15_S; u75Z9: zGn_C: goto sK_wx; A1gMA: if (!empty($profile['id'])) { goto zGn_C; } goto vvrDW; dhkR4: e3EQp: goto cH_3k; pKu8N: $cfg = $this->module['config']; goto zKr8e; IWXlH: if (empty($storeids)) { goto apgYZ; } goto AH7cX; tL_wY: cbqcm: goto EIhRp; Uei8B: $member = $profile; goto wddan; cxYOV: $this->shareClick($_GPC['mid'], $_GPC['joinway']); goto OYLEQ; uHlsB: $this->checkisAgent($from_user, $profile); goto p_yKG; H9H4S: $group = $data[0]; goto HOvfs; Hfopf: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto B85Wl; b_2X3: $template = $this->selectTemplate('detail'); goto Z3jLS; GSpvt: Yk40O: goto MLeBV; wddan: if (!$_W['member']['uid']) { goto IF3_u; } goto GwlmU; oHMnt: $profile['flag'] = 0; goto Mompz; MRGuU: if (!($commission3 == false || $commission3 == null || $commission3 < 0)) { goto QqsX8; } goto beEDh; Pwgjx: pdo_query('update ' . tablename('mihua_mall_goods') . " set viewcount=viewcount+1 where id=:id and uniacid='{$_W['uniacid']}' ", array(":id" => $goodsid)); goto vo6xV; UEL3s: JwCY_: goto R_Onw; RaRvJ: $storeids = array(); goto J7_Ou; mjnSt: $modulephp = 'detail'; goto aAUJH; mUmBg: $commission2 = $marketprice * $commission2 / 100; goto GSpvt; E2McF: $goods['total'] = pdo_fetchcolumn('select count(*) from ' . tablename('mihua_mall_virtual_data') . ' where typeid=:typeid and uniacid=:uniacid and openid=0 limit 1', array(":typeid" => $v, ":uniacid" => $_W['uniacid'])); goto gC7zA; Z3jLS: goto JwCY_; goto YFhVC; aAUJH: $uniacid = $_W['uniacid']; goto Zg2QO; Us29I: $commission2 = $cfg['globalCommission2']; goto ItBma; FZMfN: $options = pdo_fetchall('select id,title,thumb,marketprice,productprice,groupprice,costprice, stock,weight,specs from ' . tablename('mihua_mall_goods_option') . ' where goodsid=:id order by id asc', array(":id" => $goodsid)); goto A6uaM; beEDh: $commission3 = $cfg['globalCommission3']; goto YDDbf; TNrRn: $commission = $goods['commission']; goto ZsbXf; ZofSf: $id = $profile['id']; goto cV1yx; TsQCR: AgIuk: goto aCE5z; dQ4bW: foreach ($specitemids as $itemid) { goto iuc3j; iuc3j: foreach ($allspecs as $ss) { goto eYRa8; eYRa8: $items = $ss['items']; goto Zr66A; yD0C7: lOG9q: goto rG0_e; rG0_e: vE86H: goto MwZ6v; Zr66A: foreach ($items as $it) { goto xXka0; ACYMI: F5Gmw: goto XGNKS; XGNKS: Z9INe: goto gqmQ7; bCFoe: $specs[] = $ss; goto F89yO; xXka0: if (!($it['id'] == $itemid)) { goto F5Gmw; } goto bCFoe; F89yO: goto lOG9q; goto ACYMI; gqmQ7: } goto yD0C7; MwZ6v: } goto fAd4_; fAd4_: hQLf6: goto kEENs; kEENs: GNMhP: goto M89TW; M89TW: } goto xYfnz; AH7cX: $stores = pdo_fetchall('select * from ' . tablename('mihua_mall_store') . ' where id in (' . implode(',', $storeids) . ') and uniacid=:uniacid and status=1', array(":uniacid" => $_W['uniacid'])); goto pW2Pi; mdjeR: $where = array("uniacid" => $_W['uniacid'], "gid" => intval($_GPC['id']), "status" => 1, "overtime>" => time()); goto UCFps; qEaQy: dLVv0: goto UT7_n; H4Ofp: $comment_list = pdo_fetchall('select c.*,c.nickname as xnnickname,g.nickname from ' . tablename('mihua_mall_comment') . ' c left join ' . tablename('mc_members') . ' g on g.uid=c.uid 
		where c.goods_id=' . $goodsid . ' and c.uniacid =' . $_W['uniacid'] . ' order by addtime desc'); goto UtSDQ; C3chr: Q92it: goto IWXlH; mOSr2: $piclist = array_merge($piclist, $urls); goto qEaQy; EclZR: $groupid = $_GPC['groupid']; goto mdjeR; sZhiZ: if (!($member['status'] == 0)) { goto AgIuk; } goto RLtuI; bkHEs: $stores = pdo_fetchall('select * from ' . tablename('mihua_mall_store') . ' where  uniacid=:uniacid and status=1', array(":uniacid" => $_W['uniacid'])); goto V2N9N; UtSDQ: goto cbqcm; goto TTCk0; LtrjZ: $goods['timelaststr'] = $arr[0]; goto vS2ME; V2N9N: sr9I0: goto PYpBs; nqnlH: $data = model_group::getLatelyGroup($where, '', 1, 3, $select, ' a.`id` DESC ', false); goto H9H4S; cV1yx: $theone = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_rules') . ' WHERE  uniacid = :uniacid', array(":uniacid" => $_W['uniacid'])); goto bC4Ff; WlBGv: if (!(count($options) > 0)) { goto vBzX6; } goto gP4fj; M15_S: } public function doMobileAddress() { goto Y_Yz6; hiulG: if (!empty($id)) { goto R6xrf; } goto rCRHr; IarlB: goto Oc7Vh; goto pmZu6; dWWIt: message($row, '', 'ajax'); goto YnAPq; FGvFl: $id = intval($_GPC['id']); goto qucgj; f3qNP: if ($operation == 'detail') { goto qI82M; } goto C4_JM; R1pEu: pdo_update('mihua_mall_address', array("isdefault" => 0), array("uniacid" => $_W['uniacid'], "openid" => $from_user)); goto pi25d; gr1bw: load()->model('mc'); goto x5JD_; SHBgy: $id = pdo_insertid(); goto HTL7b; oKeEw: $useAddApi = true; goto jKInQ; prxoj: message(1, '', 'ajax'); goto IarlB; YTV7w: $carttotal = $this->getCartTotal(); goto R8QSt; R8QSt: $template = $this->selectTemplate('address'); goto uaUBF; HJbHO: if (!empty($id)) { goto vEI1l; } goto R1pEu; rCRHr: message(0, '', 'ajax'); goto xBbci; sGswy: if (!(empty($address) || count($address) == 0)) { goto UsAn2; } goto oKeEw; vKqJJ: $fans = mc_fansinfo($from_user, $_W['acid'], $_W['uniacid']); goto V0Lyt; yx1gr: $from = $_GPC['from']; goto rX6vV; rX6vV: $returnurl = urldecode($_GPC['returnurl']); goto e48Oy; YnAPq: goto Oc7Vh; goto eohHU; EIdJI: pdo_insert('mihua_mall_address', $data); goto SHBgy; nyaHr: $http_str = $_W['siteroot']; goto TEkVi; mgCFH: $state = $_GPC['state']; goto DtU4P; Oi6CV: unset($data['uniacid']); goto lVDhH; LiBoK: $id = intval($_GPC['id']); goto HY9BG; mSWCT: $id = intval($_GPC['id']); goto j4Pao; FjATw: $address = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_address') . ' WHERE deleted=0 and openid = :openid', array(":openid" => $from_user)); goto sGswy; SCFkN: pdo_update('mihua_mall_address', array("isdefault" => 1), array("id" => $id)); goto prxoj; xe32K: $this->checkAuth(); goto gr1bw; yNcic: OVZ0E: goto BiSDW; KW2no: JgmE_: goto bCZDd; Qj3PT: $profile = $this->getProfile(); goto KW2no; vT88g: if ($operation == 'post') { goto OVZ0E; } goto W106c; lTHS4: if (!(empty($_GPC['realname']) || empty($_GPC['mobile']) || empty($_GPC['address']))) { goto uq2o1; } goto GVEL9; Cz0NJ: Oc7Vh: goto xFWAK; lVDhH: unset($data['openid']); goto yzpa5; orPDU: pdo_update('mihua_mall_address', array("isdefault" => 1), array("id" => $maxid, "uniacid" => $_W['uniacid'], "openid" => $from_user)); goto u89rs; F1V_L: $shownotice = $this->checkUser(); goto CpXRp; K0mq8: $uid = mc_openid2uid($from_user); goto p620D; uaUBF: include $this->template($template); goto kR4jj; GVEL9: message('请完善您的资料！'); goto yB982; DtU4P: $code = $_GPC['code']; goto nyaHr; BiSDW: $id = intval($_GPC['id']); goto PNl1K; uXMBC: $this->getUserTokenForAddr(); goto ApL1m; PNl1K: $data = array("uniacid" => $_W['uniacid'], "openid" => $from_user, "realname" => $_GPC['realname'], "mobile" => $_GPC['mobile'], "province" => $_GPC['province'], "city" => $_GPC['city'], "area" => $_GPC['area'], "address" => $_GPC['address']); goto lTHS4; zT6Tj: if (empty($address)) { goto q43tL; } goto CP3mh; KBK9F: $profile = $this->getProfile(); goto F1V_L; JDKRj: ke4jl: goto N_Jgk; vW4zw: if (!($address['isdefault'] == 1)) { goto I7xcK; } goto rS_Hk; vD37w: R6xrf: goto KHaNG; TEkVi: $addressSignInfo = $this->getAddressSignInfo($code, $http_str, $signPackage); goto fXid4; lRpP7: q43tL: goto IkV2p; ApL1m: qrl2o: goto m5cNY; S1qaR: goto Oc7Vh; goto bIt8N; p620D: $profile = mc_fetch($uid, array("resideprovince", "residedist", "residedist", "address", "realname", "mobile")); goto FjATw; j4Pao: if (empty($id)) { goto Kk5EJ; } goto ovebL; x5JD_: $from_user = $_W['openid']; goto KBK9F; G8kuE: I7xcK: goto lRpP7; eohHU: LwwyF: goto mSWCT; V0Lyt: $modulephp = 'address'; goto rMypm; CpXRp: $cfg = $this->module['config']; goto eyq40; CP3mh: pdo_update('mihua_mall_address', array("deleted" => 1, "isdefault" => 0), array("id" => $id, "uniacid" => $_W['uniacid'], "openid" => $from_user)); goto vW4zw; qNSek: ZF3Wb: goto G8kuE; ZPWDH: cZ2Ur: goto hiulG; HY9BG: $row = pdo_fetch('SELECT id, realname, mobile, province, city, area, address FROM ' . tablename('mihua_mall_address') . ' WHERE id = :id', array(":id" => $id)); goto dWWIt; rMypm: if (!empty($profile['id'])) { goto JgmE_; } goto Qj3PT; dmyMH: Wqr3C: goto S1qaR; N_Jgk: goto Wqr3C; goto psSM5; pmZu6: qI82M: goto LiBoK; W106c: if ($operation == 'default') { goto Nf48M; } goto f3qNP; C4_JM: if ($operation == 'remove') { goto LwwyF; } goto K0mq8; bIt8N: Nf48M: goto FGvFl; IkV2p: Kk5EJ: goto KOayF; HTL7b: $uid = mc_openid2uid($from_user); goto Cc4YK; rS_Hk: $maxid = pdo_fetchcolumn('select max(id) as maxid from ' . tablename('mihua_mall_address') . " where uniacid='{$_W['uniacid']}' and openid='" . $from_user . '\' limit 1 '); goto Y5ubr; kR4jj: goto Oc7Vh; goto yNcic; pi25d: $data['isdefault'] = 1; goto EIdJI; m5cNY: if (!(isset($_GPC['code']) && $_GPC['code'] != 'authdeny')) { goto wDfYI; } goto mgCFH; ovebL: $address = pdo_fetch('select isdefault from ' . tablename('mihua_mall_address') . " where id='{$id}' and uniacid='{$_W['uniacid']}' and openid='" . $from_user . '\' limit 1 '); goto zT6Tj; qucgj: pdo_update('mihua_mall_address', array("isdefault" => 0), array("uniacid" => $_W['uniacid'], "openid" => $from_user)); goto SCFkN; xBbci: goto ke4jl; goto vD37w; KOayF: die(json_encode(array("result" => 1, "maxid" => 0))); goto Cz0NJ; fXid4: wDfYI: goto Cydw_; u89rs: die(json_encode(array("result" => 1, "maxid" => $maxid))); goto qNSek; eyq40: $qr_code = $this->getQr_code(); goto vKqJJ; Cydw_: UsAn2: goto YTV7w; cgD90: if (!(empty($profile['realname']) || empty($profile['mobile']))) { goto cZ2Ur; } goto VZspA; psSM5: vEI1l: goto Oi6CV; yB982: uq2o1: goto HJbHO; Y_Yz6: global $_W, $_GPC; goto xe32K; Cc4YK: $profile = mc_fetch($uid, array("realname", "mobile")); goto cgD90; Y5ubr: if (empty($maxid)) { goto ZF3Wb; } goto orPDU; bCZDd: $signPackage = $this->getSignPackage($modulephp); goto yx1gr; MCodo: message($id, '', 'ajax'); goto dmyMH; VZspA: mc_update($uid, array("mobile" => $_GPC['mobile'])); goto ZPWDH; e48Oy: $operation = $_GPC['op']; goto vT88g; KHaNG: message($id, '', 'ajax'); goto JDKRj; jKInQ: if (isset($_GPC['code'])) { goto qrl2o; } goto uXMBC; yzpa5: pdo_update('mihua_mall_address', $data, array("id" => $id)); goto MCodo; xFWAK: } public function doMobileAjaxdelete() { goto G3H5p; G3H5p: global $_GPC; goto brV_O; NCqH2: if (file_delete($delurl)) { goto HvF7n; } goto DzNaJ; UHJoy: echo 1; goto liSW3; d2f_8: HvF7n: goto UHJoy; brV_O: $delurl = $_GPC['pic']; goto NCqH2; DzNaJ: echo 0; goto KAgUJ; liSW3: JeecG: goto v4RhK; KAgUJ: goto JeecG; goto d2f_8; v4RhK: } public function doMobileAward() { goto UvBz2; pkHJz: $profile = mc_credit_fetch($uid); goto Fok93; rd6G5: include $this->template($template); goto d5Uh5; kFwIN: $award_list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_credit_award') . " WHERE uniacid = '{$_W['uniacid']}' and NOW() < deadline and amount > 0"); goto sEmRU; sEmRU: $uid = mc_openid2uid($from_user); goto pkHJz; UvBz2: global $_W, $_GPC; goto y1nvv; y1nvv: $from_user = $this->getFromUser(); goto kFwIN; Fok93: $template = $this->selectTemplate('credit_new'); goto rd6G5; d5Uh5: } public function doMobileFillInfo() { goto W3paO; x_OC8: $award_info = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_credit_award') . " WHERE award_id = {$award_id} AND uniacid = '{$_W['uniacid']}'"); goto xxq7Z; W3paO: global $_W, $_GPC; goto d27K8; yE5_Y: $award_id = intval($_GPC['award_id']); goto QNuKQ; xxq7Z: include $this->template('credit_fillinfo_new'); goto Js1u0; QNuKQ: $uid = mc_openid2uid($from_user); goto BugLf; d27K8: $from_user = $this->getFromUser(); goto yE5_Y; BugLf: $profile = mc_credit_fetch($uid); goto x_OC8; Js1u0: } public function doMobileCredit() { goto JPZnp; uQQk7: Dkgsr: goto WaG_9; Y7xXZ: g9UiT: goto TzP2a; bXGTI: hHlLm: goto uQQk7; DNLBf: pdo_insert('mihua_mall_credit_request', $data); goto gtN29; Y1iIg: message('请选择要兑换的商品！', $this->createMobileUrl('award'), 'error'); goto x4X7N; IwaXy: if ($fans['credit1'] >= $award_info['credit_cost'] && $award_info['amount'] > 0) { goto gK1BC; } goto l6td6; XITDP: $data = array("uniacid" => $_W['uniacid'], "from_user" => $from_user, "award_id" => $award_id, "createtime" => TIMESTAMP); goto DNLBf; ehdAi: pdo_update('mihua_mall_credit_award', $data, array("uniacid" => $_W['uniacid'], "award_id" => $award_id)); goto XITDP; b1gUn: $award_id = intval($_GPC['award_id']); goto X2x78; x4X7N: goto Dkgsr; goto Y7xXZ; IVd9m: $fans = mc_credit_fetch($uid); goto hHuq7; hHuq7: $award_info = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_credit_award') . " WHERE award_id = {$award_id} AND uniacid = '{$_W['uniacid']}'"); goto IwaXy; g6vOd: gK1BC: goto XYJ_x; X2x78: if (!empty($_GPC['award_id'])) { goto g9UiT; } goto Y1iIg; Ny4Zp: $from_user = $this->getFromUser(); goto b1gUn; JPZnp: global $_W, $_GPC; goto Ny4Zp; juNbN: pdo_update('mc_members', $data, array("uid" => $uid)); goto i38x3; TzP2a: $uid = mc_openid2uid($from_user); goto IVd9m; gtN29: $data = array("realname" => $_GPC['realname'], "mobile" => $_GPC['mobile'], "credit1" => $fans['credit1'] - $award_info['credit_cost'], "residedist" => $_GPC['residedist']); goto juNbN; l6td6: message('积分不足或商品已经兑空，请重新选择商品！<br>当前商品所需积分:' . $award_info['credit_cost'] . '<br>您的积分:' . $fans['credit1'] . '. 商品剩余数量:' . $award_info['amount'] . '<br><br>小提示：<br>每日签到，可以赚取积分', referer(), 'error'); goto FL5u6; FL5u6: goto hHlLm; goto g6vOd; XYJ_x: $data = array("amount" => $award_info['amount'] - 1); goto ehdAi; i38x3: message('积分兑换成功！', $this->createMobileUrl('mycredit', array("op" => "display")), 'success'); goto bXGTI; WaG_9: } public function doMobileSearch() { goto mGB2p; uoJhp: header("location:{$url}"); goto JkYVG; HE3Pq: $keyword = $_GPC['keyword']; goto W0h4a; JkYVG: exit; goto FzkGg; W0h4a: $url = $this->createMobileUrl('list2', array("m" => "mihua_mall", "uniacid" => $_W['uniacid'], "keyword" => $keyword, "sort" => 1)); goto uoJhp; mGB2p: global $_GPC, $_W; goto HE3Pq; FzkGg: } public function doMobileMycredit() { goto yH8kP; O7eXX: $profile = mc_credit_fetch($uid); goto Gs9tW; yH8kP: global $_W, $_GPC; goto ufTGB; KsBJI: $award_list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_credit_award') . ' as t1,' . tablename('mihua_mall_credit_request') . 'as t2 WHERE t1.award_id=t2.award_id AND from_user=\'' . $from_user . "' AND t1.uniacid = '{$_W['uniacid']}' ORDER BY t2.createtime DESC"); goto rh1TC; WQYBU: include $this->template($template); goto KdKNz; rh1TC: $uid = mc_openid2uid($from_user); goto O7eXX; d1Gxn: $template = $this->selectTemplate('credit_mycredit_new'); goto WQYBU; ufTGB: $from_user = $this->getFromUser(); goto KsBJI; Gs9tW: $user = $this->getProfile(); goto d1Gxn; KdKNz: } public function doMobileZhifu() { goto muLQ3; NrK3f: $from_user = $this->getFromUser(); goto j7dv5; I4T6f: $uniacid = $_W['uniacid']; goto NrK3f; muLQ3: global $_GPC, $_W; goto pwJWN; umMKp: $profile = pdo_fetch('SELECT * FROM ' . tablename('mihua_mall_member') . ' WHERE  uniacid = :uniacid  AND from_user = :from_user', array(":uniacid" => $_W['uniacid'], ":from_user" => $from_user)); goto kevx8; ZaAAD: $list = pdo_fetchall('SELECT * FROM ' . tablename('paylog') . ' WHERE openid=\'' . $from_user . '\' AND type=\'zhifu\' AND uniacid=' . $_W['uniacid'] . ' ORDER BY plid DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize); goto umMKp; j7dv5: $cfg = $this->module['config']; goto FKnhl; nFETv: $psize = 30; goto I4T6f; pwJWN: $pindex = max(1, intval($_GPC['page'])); goto nFETv; LB5pp: $pager = pagination($total, $pindex, $psize); goto ZaAAD; nAR1L: include $this->template($template); goto yd848; FKnhl: $zhifucommission = $cfg['zhifuCommission']; goto sXrXF; sXrXF: $profile = $this->getProfile(); goto wmWPu; kevx8: $id = $profile['id']; goto YdYbi; wmWPu: $id = $profile['id']; goto elodc; YdYbi: $template = $this->selectTemplate('dakuan'); goto nAR1L; elodc: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('paylog') . ' WHERE  openid=\'' . $from_user . '\' AND type=\'zhifu\' AND `uniacid` = ' . $_W['uniacid']); goto LB5pp; yd848: } public function doMobileMsg() { goto xUV1y; jB02j: pdo_update('mihua_mall_member', array("msg_id_str" => $msg_id_str), array("from_user" => $openid)); goto pJvdz; ffeGu: $msg_id_str = pdo_fetchcolumn('select msg_id_str from ' . tablename('mihua_mall_member') . " where from_user='{$openid}'"); goto zugFH; b3Yx6: foreach ($list as $key => $value) { $msg_id_str3 .= ',' . $value['msg_id']; bqtKG: } goto S3s8P; xUV1y: global $_W, $_GPC; goto HA_Bx; S3s8P: W47tF: goto ffeGu; pJvdz: $template = $this->selectTemplate('msg'); goto QcCM3; PpEzr: $msg_id_str = trim($msg_id_str2, ','); goto jB02j; zugFH: $msg_id_str2 = $msg_id_str . $msg_id_str3; goto PpEzr; HA_Bx: $openid = $_W['openid']; goto w83Bz; w83Bz: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_msg') . ' where status=1 AND `uniacid` = ' . $_W['uniacid']); goto b3Yx6; QcCM3: include $this->template($template); goto jZr8F; jZr8F: } public function doMobileMsg_content() { goto LXyYD; LXyYD: global $_W, $_GPC; goto uFz3X; QY__K: include $this->template($template); goto J2Kbg; HLFaI: $msg = pdo_fetch('select * from ' . tablename('mihua_mall_msg') . " where status=1 and msg_id='{$msg_id}'"); goto PkTFJ; uFz3X: $msg_id = intval($_GPC['msg_id']); goto HLFaI; PkTFJ: $template = $this->selectTemplate('msg_content'); goto QY__K; J2Kbg: } public function web_msg() { goto p8PNV; ly_OE: $msg_id_str = trim($msg_id_str, ','); goto EbykB; IORI3: ph6uR: goto ly_OE; E8awK: if ($msg_id_str) { goto ph6uR; } goto VpHSC; VnTL7: if (!$openid) { goto X3vbF; } goto RePSi; JmiFJ: smUA_: goto d3eQe; R2jUT: goto smUA_; goto IORI3; d3eQe: X3vbF: goto LljgS; UhEBE: $openid = $_W['openid']; goto VnTL7; EbykB: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_msg') . " where status=1 and msg_id not in({$msg_id_str}) order by msg_id desc"); goto JmiFJ; LljgS: return $list; goto gWWCn; VpHSC: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_msg') . " where status=1  and uniacid = '{$_W['uniacid']}' order by msg_id desc "); goto R2jUT; RePSi: $msg_id_str = pdo_fetchcolumn('select msg_id_str from ' . tablename('mihua_mall_member') . " where from_user='{$openid}' and  uniacid = '{$_W['uniacid']}'"); goto E8awK; p8PNV: global $_W; goto UhEBE; gWWCn: } public function get_red_record($id) { goto A1lCX; A1lCX: $openid = pdo_fetchcolumn('select from_user from  ' . tablename('mihua_mall_member') . ' where id=:id', array("id" => $id)); goto pc0uN; UekiA: return array("max_have" => $max_have + $max_have2 + $max_have3, "done_have" => $done_have + $done_have1, "self_have" => $self_have, "new_send" => $done_have); goto F_Cfm; v_v1i: $done_have1 = pdo_fetchcolumn('select sum(fee) from ' . tablename('core_paylog') . " where openid='{$openid}' and module='bj_qmxk' and acid=0 and type='zhifu' "); goto UcoFE; UW5In: $max_have3 = pdo_fetchcolumn('select sum(goods.commission3*goods.total) from ' . tablename('mihua_mall_order_goods') . ' goods LEFT JOIN ' . tablename('mihua_mall_order') . " ord on ord.id=goods.orderid 
where (ord.shareid3={$id}) and ord.status=3"); goto TgYjr; pGDkp: $self_have = pdo_fetchcolumn('SELECT sum(money) from ' . tablename('mihua_mall_red') . " where openid='{$openid}' and (orderid=null or  orderid<=0)  "); goto v_v1i; TgYjr: $done_have = pdo_fetchcolumn('SELECT sum(money) from ' . tablename('mihua_mall_red') . " where openid='{$openid}' and orderid > 0 "); goto pGDkp; pc0uN: $max_have = pdo_fetchcolumn('select sum(goods.commission*goods.total) from ' . tablename('mihua_mall_order_goods') . ' goods LEFT JOIN ' . tablename('mihua_mall_order') . " ord on ord.id=goods.orderid 
where (ord.shareid={$id}) and ord.status=3"); goto N7F1_; FC_Zq: $self_have = $self_have ? $self_have : 0; goto UekiA; N7F1_: $max_have2 = pdo_fetchcolumn('select sum(goods.commission2*goods.total) from ' . tablename('mihua_mall_order_goods') . ' goods LEFT JOIN ' . tablename('mihua_mall_order') . " ord on ord.id=goods.orderid 
where (ord.shareid2={$id}) and ord.status=3"); goto UW5In; UcoFE: $max_have = $max_have ? $max_have : 0; goto FC_Zq; F_Cfm: } public function doMobileBalance() { goto D52yb; LAYa2: if (!($_GPC['submit'] == 'do_money_in')) { goto qgsui; } goto Mqrws; mKWGh: $in['from_user'] = $from_user; goto g_USP; D52yb: global $_W, $_GPC; goto TtmX2; MwSRB: $in['addtime'] = TIMESTAMP; goto ScjYD; HWNBp: $template = $this->selectTemplate('balance'); goto nFjRn; DgArH: $in['uid'] = $uid; goto mKWGh; QqJXc: $uid = $_W['fans']['uid']; goto s20Wl; nFjRn: include $this->template($template); goto WF2yE; iPfz3: $log = pdo_get('core_paylog', array("uniacid" => $_W['uniacid'], "module" => "mihua_mall", "tid" => $params['tid'])); goto lPLWb; Mqrws: $in['uniacid'] = $_W['uniacid']; goto DgArH; t2t4n: mc_oauth_userinfo(); goto siUJx; odyBX: y4g0F: goto LAYa2; St4ym: $from_user = $_W['openid']; goto QqJXc; lPLWb: if (!empty($log)) { goto p3jq0; } goto s400o; TtmX2: load()->model('mc'); goto St4ym; s20Wl: if ($uid) { goto y4g0F; } goto t2t4n; ycvHy: pdo_insert('core_paylog', $log); goto c1BOC; g_USP: $in['money'] = floatval($_GPC['money']); goto MwSRB; c1BOC: p3jq0: goto Suty2; siUJx: $uid = $_W['fans']['uid']; goto odyBX; Suty2: $this->pay($params); goto CR66i; ry0q5: $params = array("tid" => 'ye' . $id, "ordersn" => 'ye' . $id, "title" => "充值余额", "fee" => $in['money'], "user" => $from_user); goto iPfz3; G9Us1: $id = pdo_insertid(); goto ry0q5; ScjYD: pdo_insert('mihua_mall_balance', $in); goto G9Us1; J_bPu: qgsui: goto HWNBp; CR66i: exit; goto J_bPu; s400o: $log = array("uniacid" => $_W['uniacid'], "acid" => $_W['acid'], "openid" => $_W['member']['uid'], "module" => "mihua_mall", "tid" => $params['tid'], "fee" => $params['fee'], "card_fee" => $params['fee'], "status" => "0", "is_usecard" => "0"); goto ycvHy; WF2yE: } public function doMobileBalance_record() { goto sn68W; BNPZr: $list = pdo_fetchall('select * from ' . tablename('mihua_mall_balance') . ' where  (uid=:uid or from_user=:from_user) and uniacid=:uniacid order by balance_id desc', array(":uid" => $uid, ":from_user" => $from_user, ":uniacid" => $_W['uniacid'])); goto av37g; URm5u: global $_GPC, $_W; goto lxDqB; lxDqB: $from_user = $this->getFromUser(); goto L6io1; av37g: $template = $this->selectTemplate('balance_record'); goto mD41W; L6io1: $uid = mc_openid2uid($from_user); goto BNPZr; sn68W: load()->model('mc'); goto URm5u; mD41W: include $this->template($template); goto YAl_P; YAl_P: } public function doWebCustom() { goto EroGb; q9yAD: goto weXWv; goto X5_TZ; Y3wP8: cache_delete('mihua_mall:' . $_W['uniacid'] . ':custompage'); goto qgy9T; nHyX9: if (!($op == 'add' || $op == 'edit')) { goto Rekft; } goto SDXtw; gu2sh: $page['basicparams'] = '
		[{
			id:\'M0\',
			temp:\'topbar\',
			params:{
				title:\'\',desc:\'\',bgColor:\'\',floatico:\'0\',floatstyle:\'right\',floatwidth:\'30\',floattop:\'30\',floatimg:\'\',floatlink:\'\',totop:\'1\',totopimg:\'\',totopwidth:\'50\',totoptop:\'80\'
			}
		}]
'; goto adAdJ; M0fiA: FVDmU: goto loH9g; F77nQ: $this->adminMessage('请先选择页面'); goto Z9XBX; DYTkG: $data = Util::getAllDataInSingleTable('mihua_mall_custom', $where, $_GPC['page'], 10); goto kMSCK; jf3zA: pdo_update('mihua_mall_custom', array("status" => 1), array("uniacid" => $_W['uniacid'])); goto Iywuc; iS504: $this->adminMessage('删除成功！', referer(), 'success'); goto aE7ck; tmgMw: Rekft: goto TuNa9; kMSCK: $list = $data[0]; goto J_nw0; J_nw0: $pager = $data[1]; goto Futz5; FR13o: if (!($op == 'list')) { goto xvHq3; } goto WxIgw; qgy9T: $this->adminMessage('操作成功！', referer(), 'success'); goto PkR8i; L_emN: include $this->template('custom'); goto R73MX; SXtUf: $res = self::deleteSingleData($_GPC['id'], 'mihua_mall_custom'); goto RjW6P; XTqL1: $id = intval($_GPC['id']); goto znI6A; i_QUo: BRwUu: goto Y3wP8; Futz5: foreach ($list as $k => $v) { goto Uuy4x; jbUrw: s60t9: goto vMTtB; KAwlc: $list[$k]['pagetitle'] = $basic[0]['params']['title']; goto jbUrw; Uuy4x: $basic = iunserializer($v['basicparams']); goto KAwlc; vMTtB: } goto wl0gs; dQxWM: $page = self::getSinglePage($id); goto jGHNn; X5_TZ: vN3yz: goto FYTdM; Et0ut: weXWv: goto tmgMw; yLRXE: $op = isset($_GPC['op']) ? $_GPC['op'] : 'list'; goto KuSUz; J1CU8: if ($status == 0) { goto sdQob; } goto XB_5q; Iywuc: pdo_update('mihua_mall_custom', array("status" => 0), array("uniacid" => $_W['uniacid'], "id" => $id)); goto i_QUo; W_Pz_: $this->adminMessage('操作完成,成功删除' . $res[0] . '项，失败' . $res[1] . '项', referer(), 'success'); goto M0fiA; FYTdM: $page = self::getSinglePage($_GPC['id']); goto Et0ut; VHsM7: goto BRwUu; goto VjIfi; WxIgw: $where['uniacid'] = $_W['uniacid']; goto DYTkG; s8kCe: $res = self::deleteDataInWeb($_GPC['checkid'], 'mihua_mall_custom'); goto W_Pz_; EroGb: global $_W, $_GPC; goto yLRXE; SDXtw: if (!empty($_GPC['id'])) { goto vN3yz; } goto gu2sh; wl0gs: uzUtS: goto JT_fz; aE7ck: h83YT: goto p7V4Y; wX156: $page['pagename'] = '默认备注名称'; goto q9yAD; KuSUz: if (!checksubmit('delete')) { goto FVDmU; } goto s8kCe; PkR8i: y3S5M: goto FR13o; Z9XBX: ZTzkV: goto J1CU8; adAdJ: $page['type'] = 0; goto wX156; VjIfi: sdQob: goto jf3zA; RjW6P: if (!$res) { goto h83YT; } goto iS504; znI6A: $status = intval($_GPC['status']); goto dQxWM; loH9g: if (!($op == 'toindex')) { goto y3S5M; } goto XTqL1; TuNa9: if (!($op == 'delete')) { goto ycaK6; } goto SXtUf; jGHNn: if (!empty($page)) { goto ZTzkV; } goto F77nQ; XB_5q: pdo_update('mihua_mall_custom', array("status" => $status), array("uniacid" => $_W['uniacid'], "id" => $id)); goto VHsM7; p7V4Y: ycaK6: goto L_emN; JT_fz: xvHq3: goto nHyX9; R73MX: } public function doWebAjax() { goto dwJcG; qbcaR: $data['type'] = intval($_GPC['pagetype']); goto jAzIR; ViyGe: cBxC0: goto Z1M2k; R459N: l3RHh: goto YUQqh; V7baX: rVzM3: goto jznHC; exJre: $cfg = $this->module['config']; goto w2NkP; RR6tA: $pageid = intval($_GPC['pageid']); goto qbcaR; qTgMG: Util::deleteCache('custompage', $pageid); goto cz2hR; Nw3Mg: if (empty($pageid)) { goto XebRj; } goto odilN; odilN: unset($data['status']); goto sfpqA; Kg8Gf: q4E8B: goto mXCQ8; hYR5_: JtGue: goto IJYOU; Pe5lm: $res = Util::inserData('mihua_mall_custom', $data); goto se1iT; mIVMx: foreach ((array) $list as $k => $v) { goto CgC0c; CgC0c: $list[$k]['thumpic'] = tomedia($v['pic']); goto I0xxj; X_2kM: if ($cfg['groupbutton'] == 1) { goto FxYiK; } goto FifkJ; C7o02: $list[$k]['realprice'] = $v['groupprice']; goto AmzGq; tYFZl: dcysi: goto eXIML; AmzGq: XMgqT: goto tYFZl; I0xxj: $list[$k]['url'] = $_W['siteroot'] . 'app/' . 'index.php?i=' . $_W['uniacid'] . '&c=entry&id=' . $v['id'] . '&do=detail&m=mihua_mall'; goto X_2kM; gFBmV: goto XMgqT; goto UjEDv; UjEDv: FxYiK: goto C7o02; FifkJ: $list[$k]['realprice'] = $v['marketprice']; goto gFBmV; eXIML: } goto V7baX; s911f: $userinfo = model_user::initUserInfo(); goto kn2eN; aCti2: die; goto TBZfe; fJ_Sr: die('1'); goto Kg8Gf; TBZfe: Naawi: goto deyzz; mMKLH: $data['basicparams'] = iserializer($basicparams); goto dIXIn; m_OHZ: X9vo3: goto iiRnE; Xi6Km: goto I5nmK; goto hYR5_; kn2eN: $list = pdo_fetchall('SELECT * FROM ' . tablename('mihua_mall_card') . ' c  where not EXISTS  (SELECT * FROM ' . tablename('mihua_mall_usercard') . " u where u.userid= '{$userinfo['id']}' and  u.uniacid= '{$_W['uniacid']}' and c.`id` =u.`cardid`) and c.status=0 and c.starttime<" . time() . ' and c.endtime>' . time() . ' and c.lastnum>1  and c.cardtype IN (1,2)'); goto CjCA0; pZ5Yq: $basicparams = json_decode(htmlspecialchars_decode($_GPC['basicparams']), true); goto I4uQq; sKmEP: if (!($_GPC['type'] == 'card')) { goto XXv4U; } goto s911f; dIXIn: $data['params'] = iserializer($params); goto RE1BX; rR1iv: if (!($_GPC['type'] == 'page')) { goto AAonB; } goto wgogd; Iia1o: goto m0nX9; goto n2PuD; SPTg1: goto I5nmK; goto S5a49; I4uQq: $params = json_decode(htmlspecialchars_decode($_GPC['params']), true); goto mMKLH; kN0my: if ($_GPC['op'] == 'savecustom') { goto j8jGS; } goto SPTg1; jAzIR: $data['pagename'] = htmlspecialchars($_GPC['pagename']); goto pZ5Yq; Z1M2k: AAonB: goto xeOj_; YUQqh: die('2'); goto mWNsu; clGMD: $where['title@'] = htmlspecialchars($_GPC['kw']); goto m_OHZ; pZ6vI: $where['status'] = 1; goto mFTly; ehOKy: $list = $data[0]; goto mIVMx; se1iT: m0nX9: goto NhYqi; IJYOU: if (!($_GPC['type'] == 'good')) { goto BKkEy; } goto CTgwl; w2NkP: if ($_W['isajax']) { goto Naawi; } goto aCti2; bvR9D: $list = $data[0]; goto m7Q93; Mw0iQ: $uniacid = $_W['uniacid']; goto exJre; deyzz: if ($_GPC['op'] == 'changesort') { goto ojdTf; } goto Bjyck; NhYqi: if (!$res) { goto l3RHh; } goto SY8Ct; wgogd: $where['uniacid'] = $_W['uniacid']; goto do531; m7Q93: foreach ($list as $k => $v) { $list[$k]['url'] = $_W['siteroot'] . 'app/' . 'index.php?i=' . $_W['uniacid'] . '&c=entry&id=' . $v['id'] . '&do=page&m=mihua_mall'; KCbMB: } goto ViyGe; n2PuD: XebRj: goto Pe5lm; sfpqA: $res = pdo_update('mihua_mall_custom', $data, array("uniacid" => $_W['uniacid'], "id" => $pageid)); goto qTgMG; jznHC: BKkEy: goto sKmEP; gMh6L: $data['status'] = 1; goto Nw3Mg; do531: $data = Util::getAllDataInSingleTable('mihua_mall_custom', $where, $_GPC['page'], 10, ' `id` DESC ', false, ' id,pagename '); goto bvR9D; JR9zV: goto I5nmK; goto bQ8O9; mFTly: if (empty($_GPC['kw'])) { goto X9vo3; } goto clGMD; dwJcG: global $_W, $_GPC; goto sjVBP; S5a49: ojdTf: goto iLIhX; NXEms: die; goto JR9zV; iiRnE: $data = self::getAllGood($where, intval($_GPC['page']), 10, '`sales` DESC', 'id,title,thumb,marketprice,productprice,groupnum,groupprice'); goto ehOKy; mXCQ8: die('2'); goto Xi6Km; bQ8O9: j8jGS: goto RR6tA; iLIhX: $res = self::insertGoodSort($_GPC['params'], $_GPC['id'], 'edit'); goto kUiFr; CTgwl: $where['uniacid'] = $uniacid; goto pZ6vI; xeOj_: $data['list'] = $list; goto qI6fi; kUiFr: if (!$res) { goto q4E8B; } goto fJ_Sr; qI6fi: echo json_encode($data); goto NXEms; cz2hR: util::deleteCache('custompage', 'index'); goto Iia1o; Bjyck: if ($_GPC['op'] == 'customsearch') { goto JtGue; } goto kN0my; RE1BX: $data['time'] = time(); goto gMh6L; CjCA0: XXv4U: goto rR1iv; mWNsu: I5nmK: goto zingq; SY8Ct: die('1'); goto R459N; sjVBP: $GPC = self::trimWithArray($_GPC); goto Mw0iQ; zingq: } static function getAllGood($where, $page, $num, $order = "`sales` DESC") { goto JPkmV; CNVEH: return array($newgoodinfo, $goodinfo[1], $goodinfo[2]); goto s1mFq; gMpa8: M7ORA: goto CNVEH; JPkmV: $goodinfo = Util::getAllDataInSingleTable('mihua_mall_goods', $where, $page, $num, $order); goto NVQtm; NVQtm: foreach ($goodinfo[0] as $k => $v) { $newgoodinfo[$k] = self::initSingleGoodPro($v); y_tXh: } goto gMpa8; s1mFq: } static function initSingleGoodPro($goodinfo) { goto PgSnh; PgSnh: $goodinfo = $goodinfo; goto mZ_Pa; FRrUg: $goodinfo['inco'] = iunserializer($goodinfo['inco']); goto fu1hM; AiCsL: $goodinfo['rulearray'] = iunserializer($goodinfo['rulearray']); goto TUbQf; fu1hM: $goodinfo['sort'] = self::getGoodSort($goodinfo['id']); goto WCWMW; TUbQf: $goodinfo['params'] = iunserializer($goodinfo['params']); goto FRrUg; WCWMW: return $goodinfo; goto xzHpL; mZ_Pa: $goodinfo['pic'] = iunserializer($goodinfo['thumb']); goto AiCsL; xzHpL: } static function getGoodSort($gid) { goto n4v17; rz3HB: SrEpL: goto uiDf3; n4v17: $sortinfo = Util::getAllDataInSingleTable('mihua_mall_goods_option', array("id" => $gid), 1, 50); goto E9pQC; uiDf3: return $array; goto f2WCF; E9pQC: foreach ($sortinfo[0] as $k => $v) { $array[$k] = $v['sortid']; gNl3_: } goto rz3HB; f2WCF: } static function insertGoodSort($sortarray, $id, $type) { goto eTqpp; NWp_p: OJ3Nl: goto iMdSN; gbRUV: return $res; goto LwmdC; EZlQO: rILW9: goto gbRUV; iMdSN: foreach ($sortarray as $k => $v) { $res = pdo_insert('mihua_mall_category', array("uniacid" => $_W['uniacid'], "id" => $id, "parentid" => $v)); TOt29: } goto EZlQO; T1Wp8: pdo_delete('mihua_mall_category', array("uniacid" => $_W['uniacid'], "id" => $id), 'AND'); goto NWp_p; lpknm: if (!($type == 'edit')) { goto OJ3Nl; } goto T1Wp8; eTqpp: global $_W; goto lpknm; LwmdC: } static function structWhereStringOfAnd($array, $head = "") { goto hkI1D; qnOT_: znn0h: goto kFCVz; kR66D: if (is_array($array)) { goto IRxjt; } goto P0ceU; zs74M: foreach ($array as $k => $v) { goto cOY02; o4nJ1: $eq = ' <= '; goto YXaM6; MEZQM: $k = trim(trim($k), '<'); goto o4nJ1; HMR2H: oQqs1: goto MEZQM; Q53M8: $k = trim(trim($k), '#'); goto kohm3; cOY02: if (!(isset($k) && $v === '')) { goto uGLf0; } goto OsEE4; OsEE4: message('存在异常参数' . $k); goto MOm3O; kohm3: nAg7F: goto slJmT; xH19t: q_sHu: goto zmLl6; f80yD: if (strpos($k, '<') !== false) { goto oQqs1; } goto L0K85; ufqsk: $eq = ' = '; goto REZQp; a03YN: goto nAg7F; goto HMR2H; REZQp: goto nAg7F; goto cpU79; uey5Z: if (strpos($k, '>') !== false) { goto E7mkp; } goto f80yD; cpU79: E7mkp: goto eXzGg; UqXnv: goto nAg7F; goto qnJRj; YXaM6: goto nAg7F; goto gH5yU; slJmT: $str .= empty($head) ? 'AND `' . $k . '`' . $eq . ':' . $k . ' ' : 'AND ' . $head . '.`' . $k . '`' . $eq . ':' . $k . ' '; goto LsOTY; L0K85: if (strpos($k, '@') !== false) { goto JYBDm; } goto HXHJE; eXzGg: $k = trim(trim($k), '>'); goto UDwLh; FVXL5: $eq = ' LIKE '; goto e2Vru; qnJRj: WJ3KI: goto yg4Mb; hPFaF: $v = '%' . $v . '%'; goto UqXnv; UDwLh: $eq = ' >= '; goto a03YN; HXHJE: if (strpos($k, '#') !== false) { goto WJ3KI; } goto ufqsk; e2Vru: $k = trim(trim($k), '@'); goto hPFaF; gH5yU: JYBDm: goto FVXL5; yg4Mb: $eq = ' IN '; goto Q53M8; LsOTY: $params[':' . $k] = $v; goto xH19t; MOm3O: uGLf0: goto uey5Z; zmLl6: } goto qnOT_; X2pWm: return array($str, $params); goto K2Gnu; DK2hU: IRxjt: goto sCuVM; hkI1D: global $_W; goto kR66D; sCuVM: $array['uniacid'] = $_W['uniacid']; goto YKyjk; YKyjk: $str = ''; goto zs74M; kFCVz: $str = trim($str, 'AND'); goto X2pWm; P0ceU: return false; goto DK2hU; K2Gnu: } static function fetchFunctionInCommon($countStr, $selectStr, $params, $page, $num, $order = "`id` DESC", $isNeadPager = false) { goto DFDNj; Xz6aS: return array($data, $pager, $total); goto x_hZ0; ypNzN: $data = pdo_fetchall($selectStr . " ORDER BY {$order} " . ' LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, $params); goto Af8SQ; bTPhu: $psize = $num; goto uXUes; Af8SQ: $pager = $isNeadPager ? pagination($total, $pindex, $psize) : ''; goto Xz6aS; uXUes: $total = $isNeadPager ? pdo_fetchcolumn($countStr, $params) : ''; goto ypNzN; DFDNj: $pindex = max(1, intval($page)); goto bTPhu; x_hZ0: } static function getSinglePage($id) { goto NV6X8; bzaUA: $page['params'] = json_encode(iunserializer($page['params'])); goto E05Ps; RhLf_: return $page; goto NUIcz; NV6X8: $id = intval($id); goto DNuOY; E05Ps: $page['basicparams'] = json_encode(iunserializer($page['basicparams'])); goto RhLf_; DNuOY: $page = Util::getDataByCacheFirst('custompage', $id, array("self", "getSingelDataInSingleTable"), array("mihua_mall_custom", array("id" => $id))); goto bzaUA; NUIcz: } static function getIndexPage() { goto UbakL; Bk2HB: $page['basicparams'] = json_encode(iunserializer($page['basicparams'])); goto VPwsv; VPwsv: return $page; goto rwcna; RRTeX: $page = Util::getDataByCacheFirst('custompage', 'index', array("self", "getSingelDataInSingleTable"), array("mihua_mall_custom", array("uniacid" => $_W['uniacid'], "status" => 0))); goto Q6VZK; UbakL: global $_W; goto RRTeX; Q6VZK: $page['params'] = json_encode(iunserializer($page['params'])); goto Bk2HB; rwcna: } static function deleteSingleData($id, $tablename) { goto Oec4e; aVrlu: return $res; goto j1ZoA; lI5Iw: if (!($tablename == 'mihua_mall_custom')) { goto XpW15; } goto FswKv; Oec4e: global $_W; goto MxOwl; zTive: $res = self::deleteData($id, $tablename); goto lI5Iw; zPJMf: XpW15: goto aVrlu; MxOwl: $id = intval($id); goto zTive; FswKv: util::deleteCache('custompage', $id); goto ZNWQx; ZNWQx: util::deleteCache('custompage', 'index'); goto zPJMf; j1ZoA: } static function deleteDataInWeb($arrayid, $tablename) { goto YJgXX; o5wxo: if (!empty($arrayid)) { goto iSW61; } goto i9GYR; agyeL: $failnum = 0; goto o5wxo; DcnfJ: $successnum = 0; goto agyeL; i9GYR: message('请选择所要删除的内容'); goto CYzbj; Tcmly: return array($successnum, $failnum); goto et1t_; CYzbj: iSW61: goto icbeM; YJgXX: global $_W; goto DcnfJ; icbeM: foreach ($arrayid as $k => $v) { goto FopY8; JFIlp: $failnum++; goto nPcJj; FopY8: $res = self::deleteSingleData($v, $tablename); goto Zs_bN; Zs_bN: if ($res) { goto GoGXN; } goto JFIlp; PNFiz: $successnum++; goto PVZoX; nPcJj: goto oYOn1; goto pA0_y; PVZoX: oYOn1: goto TB4xB; pA0_y: GoGXN: goto PNFiz; TB4xB: wNOSp: goto STZDL; STZDL: } goto inF7J; inF7J: FosNu: goto Tcmly; et1t_: } static function getSingelDataInSingleTable($tablename, $array, $select = "*") { goto TdtFp; zKBDc: $sql = "SELECT {$select} FROM " . tablename($tablename) . " WHERE {$data[0]} "; goto GQtxu; TdtFp: $data = self::structWhereStringOfAnd($array); goto zKBDc; GQtxu: return pdo_fetch($sql, $data[1]); goto UlKnF; UlKnF: } static function deleteData($id, $tablename) { goto p558t; WQuL2: PSqdq: goto g8N8U; PPrTp: $id = intval($id); goto T2pGj; AN725: message('抱歉，数据不存在或是已经被删除！'); goto WQuL2; Nn7dq: return false; goto iPAE2; iPAE2: cpWgl: goto PPrTp; T2pGj: $datainfo = self::getSingelDataInSingleTable($tablename, array("id" => $id)); goto auiMq; g8N8U: $res = pdo_delete($tablename, array("id" => $id, "uniacid" => $_W['uniacid']), 'AND'); goto EDQie; Nm2RZ: if (!($id == '')) { goto cpWgl; } goto Nn7dq; p558t: global $_W; goto Nm2RZ; auiMq: if (!empty($datainfo)) { goto PSqdq; } goto AN725; EDQie: return $res; goto jl4LD; jl4LD: } static function getCache($key, $name) { goto mjBP_; mjBP_: global $_W; goto x7V2u; AiBq1: return cache_read('mihua_mall:' . $_W['uniacid'] . ':' . $key . ':' . $name); goto jJryd; aJukA: return false; goto BxWav; x7V2u: if (!(empty($key) || empty($name))) { goto Nq_7Q; } goto aJukA; BxWav: Nq_7Q: goto AiBq1; jJryd: } static function trimWithArray($array) { goto DwnAk; T9JGy: GMQtB: goto CC0Qh; egPS1: return $res; goto LIfdE; DwnAk: if (is_array($array)) { goto GMQtB; } goto sVUXC; CC0Qh: foreach ($array as $k => $v) { $res[$k] = self::trimWithArray($v); ZbxOY: } goto T3Blp; T3Blp: mmwl3: goto egPS1; sVUXC: return trim($array); goto T9JGy; LIfdE: } function adminMessage($msg, $redirect = "", $type = "") { goto iXOFu; pLX8K: exit(json_encode($vars)); goto yVw2f; vMY7a: P_rPu: goto nbG2w; DMOCp: mkXKn: goto A496R; nbG2w: exit('
<script type=\"text/javascript\">
parent.require_once([\'jquery\', \'util\'], function($, util){
	var url = ' . (!empty($redirect) ? 'parent.location.href' : '\'\'') . ';
	var modalobj = util.message(\'' . $msg . '\', \'\', \'' . $type . '\');
	if (url) {
		modalobj.on(\'hide.bs.modal\', function(){$(\'.modal\').each(function(){if($(this).attr(\'id\') != \'modal-message\') {$(this).modal(\'hide\');}});top.location.reload()});
	}
});
</script>'); goto aH_ca; BeQXQ: $label = 'danger'; goto L9SO_; QGOw_: goto AksrQ; goto dKqC2; no7bM: $vars['message'] = $msg; goto He6hz; iXOFu: global $_W, $_GPC; goto UkNSc; L9SO_: Qo2nM: goto SEyjs; EfaF4: $label = 'warning'; goto V15IF; dNjW1: header('location: ' . $redirect); goto bigCC; dKqC2: RDtyL: goto pkjA0; yVw2f: goto CZL2k; goto vMY7a; bigCC: UTfid: goto tWInM; DXJWf: if (!($redirect == 'referer')) { goto mkXKn; } goto l7dhs; KF2dP: include $this->template($template); goto KGLqY; ukxSx: $template = 'admin_message'; goto KF2dP; bqYPU: AksrQ: goto n59EY; K9KSl: IQPYc: goto DXJWf; pkjA0: $type = in_array($type, array("success", "error", "info", "warning", "ajax", "sql")) ? $type : 'info'; goto bqYPU; A496R: if ($redirect == '') { goto RDtyL; } goto ainpU; KGLqY: exit; goto X9K05; aH_ca: CZL2k: goto ezuTB; vpP9R: $redirect = $_W['script_name'] . '?' . $_SERVER['QUERY_STRING']; goto K9KSl; He6hz: $vars['redirect'] = $redirect; goto kBkFU; xIGBi: if ($type != 'ajax' && !empty($_GPC['target'])) { goto P_rPu; } goto l9Tsc; n59EY: if (!($_W['isajax'] || !empty($_GET['isajax']) || $type == 'ajax')) { goto qPv51; } goto xIGBi; ezuTB: qPv51: goto roChf; l9Tsc: $vars = array(); goto no7bM; tWInM: $label = $type; goto ODcXf; ainpU: $type = in_array($type, array("success", "error", "info", "warning", "ajax", "sql")) ? $type : 'success'; goto QGOw_; ODcXf: if (!($type == 'error')) { goto Qo2nM; } goto BeQXQ; SEyjs: if (!($type == 'ajax' || $type == 'sql')) { goto hY142; } goto EfaF4; roChf: if (!(empty($msg) && !empty($redirect))) { goto UTfid; } goto dNjW1; UkNSc: if (!($redirect == 'refresh')) { goto IQPYc; } goto vpP9R; l7dhs: $redirect = referer(); goto DMOCp; V15IF: hY142: goto ukxSx; kBkFU: $vars['type'] = $type; goto pLX8K; X9K05: } function getRefundtime() { goto UTDTs; u21pL: iRhbT: goto eIBHS; o9xuD: if ($cfg['refundtime']) { goto lAwtt; } goto EPfnt; Im14H: $refundtime = $cfg['refundtime']; goto u21pL; EPfnt: $refundtime = 7; goto LgvIu; eIBHS: return $refundtime; goto PuNik; ZxFtV: lAwtt: goto Im14H; UTDTs: $cfg = $this->module['config']; goto o9xuD; LgvIu: goto iRhbT; goto ZxFtV; PuNik: } function isrefund($iscanrefund, $createtime, $orderstatus) { goto ulfEN; A9U16: cX1nN: goto ONwPr; yDc42: if (!($cfg['iscanrefund'] != 1 || $iscanrefund != 0 || $orderstatus < 1)) { goto I0_Yb; } goto P9k8f; uwQfW: I0_Yb: goto zDf63; luQD5: $fundtime = $this->getRefundtime(); goto yDc42; juaD5: return 0; goto uKJM3; P9k8f: return 0; goto uwQfW; FmSxV: ILfy6: goto MJVHF; MJVHF: return 1; goto A9U16; lS7zL: if (abs($a) <= $b) { goto ILfy6; } goto juaD5; WYODO: $b = $fundtime * 24 * 60 * 60; goto lS7zL; ulfEN: $cfg = $this->module['config']; goto luQD5; zDf63: $a = time() - $createtime; goto WYODO; uKJM3: goto cX1nN; goto FmSxV; ONwPr: } } ?>